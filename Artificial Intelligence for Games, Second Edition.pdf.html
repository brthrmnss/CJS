<html><html><p origfont="g_font_10" style="font-family: sans-serif; font-size: 59.7161px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 59.7161px; font-style: normal; font-weight: 400;">5 </p>
<span origfont="g_font_7" data-canvas-width="430.28389699199994" style="left: 151.402px; top: 356.29px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01482); border-left: none;" yquantized="350" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision Making </p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 59.7161px; font-style: normal; font-weight: 400;"> sk a gamer about game AI, and they think about decision making: the ability of a character </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> to decide what to do.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Carrying out that decision (movement, animation, and the like) is taken for granted. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In reality, decision making is typically a small part of the effort needed to build great gameAI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most games use very simple decision making systems: state machines and decision trees. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule-based systems are rarer, but important. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In recent years a lot of interest has been shown in more sophisticated decision making tools, such as fuzzy logic and neural networks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> However, developers haven’t been in a rush to embrace these technologies.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can be hard to get them working right. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision making is the middle component of our AI model (Figure 5.1), but despite this chapter’s name, we will also cover a lot of techniques used in tactical and strategic AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> All the techniques here are applicable to both intra-character and inter-character decision making. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This chapter will look at a wide range of decision making tools,from very simple mechanisms that can be implemented in minutes to comprehensive decision making tools that require more sophistication but can support richer behaviors to complete programming languages embedded in the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At the end of the chapter we’ll look at the output of decision making and how to actonit. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 630.087px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="630" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.1 </p>
<span origfont="g_font_7" data-canvas-width="459.4233064800001" style="left: 122.376px; top: 671.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01916); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Overview of Decision Making </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although there are many different decision making techniques, we can look at them all as acting in the same way. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The character processes a set of information that it uses to generate an action that it wants to carry out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The input to the decision making system is the knowledge that a character possesses, </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_19" style="font-family: sans-serif; font-size: 7.2px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 7.2px; font-style: normal; font-weight: 400;">Execution management </p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Group AI </p><span origfont="g_font_19" data-canvas-width="40.3416" style="left: 307.361px; top: 177.864px; font-size: 7.2px; font-family: sans-serif; transform: scaleX(1.00854); border-left: 50px solid blue;" yquantized="170" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 7.2px; font-style: normal; font-weight: 400;">Strategy </p><p origfont="g_font_28" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Character AI </p><span origfont="g_font_19" data-angle="-90" data-canvas-width="64.5504" style="left: 266.638px; top: 214.421px; font-size: 9.6px; font-family: sans-serif; transform: rotate(-90deg) scaleX(1.02744); border-left: 50px solid blue;" yquantized="210" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Decision making </p><span origfont="g_font_19" data-canvas-width="42.681599999999996" style="left: 307.994px; top: 248.546px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04101); border-left: 50px solid blue;" yquantized="240" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 292.302px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="290" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">World interfaceMovementAnimationPhysics </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.1 </span><span origfont="g_font_19" data-canvas-width="80.6688" style="left: 214.225px; top: 345.061px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03422); border-left: 50px solid blue;" yquantized="340" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">The AI model </p><span origfont="g_font_19" data-canvas-width="71.2128" style="left: 373.247px; top: 362.057px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03207); border-left: 50px solid blue;" yquantized="360" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="26.6784" style="left: 425.126px; top: 402.724px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02609); border-left: 50px solid blue;" yquantized="400" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="65.95200000000001" style="left: 310.837px; top: 433.058px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01465); border-left: 50px solid blue;" yquantized="430" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="83.8656" style="left: 212.627px; top: 468.133px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03538); border-left: 50px solid blue;" yquantized="460" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 506.529px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="500" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Internal knowledgeInternal changesAction requestDecision makerExternal knowledgeExternal changes </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.2 </span><span origfont="g_font_7" data-canvas-width="458.7849030720003" style="left: 109.412px; top: 544.761px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05711); border-left: none;" yquantized="540" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="458.7849030720003" style="left: 109.412px; top: 544.761px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05711); border-left: none;" yquantized="540" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision making schematic and the output is an action request.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The knowledge can be further broken down into external and internal knowledge.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> External knowledge is the information that a character knows about the game environment around it: the position of other characters, the layout of the level, whether a switch has been thrown, the direction that a noise is coming from, and so on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Internal knowledge is information about the character’s internal state or thought processes: its health, its ultimate goals, what it was doing a couple of seconds ago, and so on. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Typically,the same external knowledge can drive any of the algorithms in this chapter,whereas the algorithms themselves control what kinds of internal knowledge can be used (although they don’t constrain what that knowledge represents, in game terms). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions, correspondingly, can have two components: they can request an action that will change the external state of the character (such as throwing a switch,firing a weapon,moving into a room) or actions that only affect the internal state (see Figure 5.2).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Changes to the internal state </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">are less obvious in game applications but are significant in some decision making algorithms. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">They might correspond to changing the character’s opinion of the player, changing its emotional state, or changing its ultimate goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Again, algorithms will typically have the internal actions as part of their makeup, while external actions can be generated in a form that is identical for each algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The format and quantity of the knowledge depend on the requirements of the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Knowl- edge representation is intrinsically linked with most decision making algorithms.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is difficult to be completely general with knowledge representation, although we will consider some widely applicable mechanisms in Chapter 11. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions, on the other hand, can be treated more consistently.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll return to the problem of representing and executing actions at the end of this chapter. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 287.428px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="280" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.2 </p>
<span origfont="g_font_7" data-canvas-width="458.97140294399986" style="left: 122.615px; top: 329.254px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06738); border-left: none;" yquantized="320" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision trees are fast, easily implemented, and simple to understand.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are the simplest decision making technique that we’ll look at,although extensions to the basic algorithm can make them quite sophisticated.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are used extensively to control characters and for other in-game decision making, such as animation control. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">They have the advantage of being very modular and easy to create.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve seen them used for everything from animation to complex strategic and tactical AI. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although it is rare in current games, decision trees can also be learned, and the learned tree is relatively easy to understand (compared to, for example, the weights of a neural network).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll come back to this topic later in Chapter 7. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 490.068px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="490" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.1 </span>
<span origfont="g_font_7" data-canvas-width="459.1005182399999" style="left: 122.615px; top: 523.406px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0554); border-left: none;" yquantized="520" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Problem </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Given a set of knowledge, we need to generate a corresponding action from a set of possible actions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The mapping between input and output may be quite complex.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same action will be used for many different sets of input,but any small change in one input value might make the difference between an action being sensible and an action appearing stupid. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We need a method that can easily group lots of inputs together under one action, while allowing the input values that are significant to control the output. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 655.42px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.2 </span>
<span origfont="g_font_7" data-canvas-width="459.5261205120001" style="left: 122.376px; top: 688.757px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00995); border-left: none;" yquantized="680" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A decision tree is made up of connected decision points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The tree has a starting decision, its root. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For each decision, starting from the root, one of a set of ongoing options is chosen. </p>
<span origfont="g_font_7" data-canvas-width="394.5906907199999" style="left: 122.615px; top: 703.151px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00661); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Is enemy visible? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_19" data-canvas-width="12.2688" style="left: 290.099px; top: 148.43px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0224); border-left: 50px solid blue;" yquantized="140" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="77.568" style="left: 191.432px; top: 179.044px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02063); border-left: 50px solid blue;" yquantized="170" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">NoYe sIs enemy audible? </p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Is enemy &lt;10 m away? </p><span origfont="g_font_19" data-canvas-width="38.8032" style="left: 276.912px; top: 218.634px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.994954); border-left: 50px solid blue;" yquantized="210" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="26.1408" style="left: 198.563px; top: 238.43px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04563); border-left: 50px solid blue;" yquantized="230" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">NoYe sYe sIs enemyCreepon flank? </p><span origfont="g_font_19" data-canvas-width="26.4864" style="left: 247.792px; top: 286.968px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.980978); border-left: 50px solid blue;" yquantized="280" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 333.102px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="330" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">AttackNoYe sAttackMove </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.3 </span><span origfont="g_font_7" data-canvas-width="441.08415239999994" style="left: 127.416px; top: 384.438px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.987242); border-left: none;" yquantized="380" class="highlight2"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.08415239999994" style="left: 127.416px; top: 384.438px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.987242); border-left: none;" yquantized="380" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A decision treeEach choice is made based on the character’s knowledge.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because decision trees are often used as simple and fast decision mechanisms, characters usually refer directly to the global game state rather than have a representation of what they personally know. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Thealgorithmcontinuesalongthetree,makingchoicesateachdecisionnodeuntilthedecision process has no more decisions to consider.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At each leaf of the tree an action is attached.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the decision algorithm arrives at an action, that action is carried out immediately. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most decision treenodes make very simple decisions, typically with only two possible responses.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In Figure 5.3 the decisions relate to the position of an enemy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Noticethatoneactioncanbeplacedattheendof multiplebranches.InFigure5.3thecharacter will choose to attack unless it can’t see the enemy or is flanked.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The attack action is present at two leaves. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.4 shows the same decision tree with a decision having been made.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The path taken by the algorithm is highlighted, showing the arrival at a single action, which may then be executed by the character. </p>
<span origfont="g_font_13" data-canvas-width="58.060667904" style="left: 109.415px; top: 627.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0368); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0503067360002" style="left: 109.415px; top: 657.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00938); border-left: none;" yquantized="650" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decisions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decisions in a tree are simple.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They typically check a single value and don’t contain any Boolean logic (i.e., they don’t join tests together with AND or OR). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Depending on the implementation and the data types of the values stored in the character’s knowledge, different kinds of tests may be possible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A representative set is given in the following table, based on a game engine we’ve worked on: </p>
</html></html><html><html><p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Is enemy visible? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_19" data-canvas-width="12.2688" style="left: 303.299px; top: 148.43px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0224); border-left: 50px solid blue;" yquantized="140" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="77.568" style="left: 204.632px; top: 179.044px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02063); border-left: 50px solid blue;" yquantized="170" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">NoYe sIs enemy audible? </p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Is enemy &lt;10 m away? </p><span origfont="g_font_19" data-canvas-width="38.8032" style="left: 290.112px; top: 218.634px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.994954); border-left: 50px solid blue;" yquantized="210" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="26.1408" style="left: 211.763px; top: 238.43px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04563); border-left: 50px solid blue;" yquantized="230" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">NoYe sYe sIs enemyCreepon flank? </p><span origfont="g_font_19" data-canvas-width="26.4864" style="left: 260.992px; top: 286.968px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.980978); border-left: 50px solid blue;" yquantized="280" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 122.615px; top: 333.102px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="330" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">AttackNoYe sAttackMove </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.4 </span><span origfont="g_font_13" data-canvas-width="50.27367062400001" style="left: 140.617px; top: 366.242px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04377); border-left: none;" yquantized="360" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">The decision tree with a decision made </p></pre>
<span origfont="g_font_13" data-canvas-width="50.27367062400001" style="left: 140.617px; top: 366.242px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04377); border-left: none;" yquantized="360" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data TypeDecisions </p>
<span origfont="g_font_7" data-canvas-width="47.595723744000004" style="left: 140.617px; top: 478.919px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.977818); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span>
<span origfont="g_font_7" data-canvas-width="214.42942334399996" style="left: 322.442px; top: 478.919px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00825); border-left: none;" yquantized="470" class="highlight3"></span>
<span origfont="g_font_7" data-canvas-width="441.00046656" style="left: 140.617px; top: 528.987px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0678); border-left: none;" yquantized="520" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">BooleanValue is trueEnumeration (i.e., a set of values,    Matches one of a given set of values only one of which might be allowable)Numeric value (either integer or     Value is within a given range floating point) 3D VectorVector has a length within a given range (this can be used to check the distance between the character and an enemy, for example)In addition to primitive types, in object-oriented game engines it is common to allow the decision tree to access methods of instances.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This allows the decision tree to delegate more complex processing to optimized and compiled code, while still applying the simple decisions in the previous table to the return value. </p>
<span origfont="g_font_13" data-canvas-width="161.81841408" style="left: 122.615px; top: 606.691px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0373); border-left: none;" yquantized="600" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.02400547200017" style="left: 122.615px; top: 637.135px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00271); border-left: none;" yquantized="630" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Combinations of Decisions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The decision tree is efficient because the decisions are typically very simple.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each decision makes only one test.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When Boolean combinations of tests are required, the tree structure represents this. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To AND two decisions together,they are placed in series in the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first part of Figure 5.5 illustrates a tree with two decisions, both of which need to be true in order for action 1 to be carried out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This tree has the logic "if A AND B, then carry out action 1, otherwise carry out action 2." </p>
<span origfont="g_font_7" data-canvas-width="46.35717331200001" style="left: 122.615px; top: 709.104px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03016); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">If A AND B then action 1, otherwise action 2Ye s 1BYe s 2NoANo 2If A OR B then action 1, otherwise action 2Ye s1AYe sNo1BNo2 </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.5 </span><span origfont="g_font_7" data-canvas-width="441.08415240000005" style="left: 127.417px; top: 399.271px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03374); border-left: none;" yquantized="390" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.08415240000005" style="left: 127.417px; top: 399.271px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03374); border-left: none;" yquantized="390" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Trees representing AND and ORTo OR two decisions together, we also use the decisions in series, but with the two actions swapped over from theAND example above.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The second part of Figure 5.5 illustrates this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If either test returns true, then action 1 is carried out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Only if neither test passes is action 2 run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This tree has the logic "if A OR B, then carry out action 1, otherwise carry out action 2." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This ability for simple decision trees to build up any logical combination of tests is used in other decision making systems.We’ll see it again in the Rete algorithm in Section 5.8 on rule-based systems. </p>
<span origfont="g_font_13" data-canvas-width="124.950011904" style="left: 109.415px; top: 519.549px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03264); border-left: none;" yquantized="510" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.00487728000013" style="left: 109.415px; top: 549.993px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06498); border-left: none;" yquantized="540" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision Complexity </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because decisions are built into a tree, the number of decisions that need to be considered is usually much smaller than the number of decisions in the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 5.6 shows a decision tree with 15 different decisions and 16 possible actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> After the algorithm is run, we see that only four decisions are ever considered. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision trees are relatively simple to build and can be built in stages.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A simple tree can be implemented initially, and then as the AI is tested in the game, additional decisions can be added to trap special cases or add new behaviors. </p>
<span origfont="g_font_13" data-canvas-width="62.39179776" style="left: 109.415px; top: 670.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05749); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.994117672" style="left: 109.415px; top: 700.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01763); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Branching </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the examples so far, and in most of the rest of the chapter, decisions will choose between two options.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is called a binary decision tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no reason why you can’t build your decision </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.6 </span>
<span origfont="g_font_7" data-canvas-width="458.9403196320001" style="left: 122.611px; top: 527.916px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00296); border-left: none;" yquantized="520" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Wide decision tree with decision tree so that decisions can have any number of options.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You can also have different decisions with different numbers of branches. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Imagine having a guard character in a military facility.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The guard needs to make a decision basedonthecurrentalertstatusof thebase.Thisalertstatusmightbeoneof asetof states:"green," "yellow," "red," or "black," for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Using the simple binary decision making tree described above, we’d have to build the tree in Figure 5.7 to make a decision. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The same value (the alert state) may be checked three times.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This won’t be as much of a problem if we order the checks so the most likely states come first.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even so, the decision tree may have to do the same work several times to make a decision. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could allow our decision tree to have several branches at each decision point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With four branches, the same decision tree now looks like Figure 5.8. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This structure is flatter, only ever requires one decision, and is obviously more efficient. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Despite the obvious advantages, it is more common to see decision trees using only binary decisions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> First, this is because the underlying code for multiple branches usually simplifies </p>
</html></html><html><html><p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Is black?  </p>
<p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">           Is red?  </p>
<p origfont="g_font_19" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">           Is yellow? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_19" data-canvas-width="13.8528" style="left: 238.651px; top: 154.729px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.764556); border-left: 50px solid blue;" yquantized="150" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="45.888" style="left: 274.862px; top: 196.721px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01973); border-left: 50px solid blue;" yquantized="190" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="55.0656" style="left: 332.531px; top: 219.221px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0175); border-left: 50px solid blue;" yquantized="210" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 262.302px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="260" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">No                   NoNoGreen actionYe sYe sBlack actionYe sRed actionYellow action </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.7 </span><span origfont="g_font_19" data-canvas-width="51.561600000000006" style="left: 393.566px; top: 322.999px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01101); border-left: 50px solid blue;" yquantized="320" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Deep binary decision tree </p><span origfont="g_font_19" data-canvas-width="26.1504" style="left: 236.683px; top: 349.23px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.00578); border-left: 50px solid blue;" yquantized="340" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Black actionWhich alertBlack state? </p><span origfont="g_font_19" data-canvas-width="26.6784" style="left: 306.11px; top: 405.211px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.06714); border-left: 50px solid blue;" yquantized="400" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 459.581px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="450" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;">Red actionRedYellowYellow actionGreenGreen action </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.8 </p><span origfont="g_font_7" data-canvas-width="167.51753246400003" style="left: 109.412px; top: 500.061px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.08778); border-left: none;" yquantized="500" class="highlight2"></span><p class="after_vGap" style="display: inline;"></p></pre>
<span origfont="g_font_7" data-canvas-width="167.51753246400003" style="left: 109.412px; top: 500.061px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.08778); border-left: none;" yquantized="500" class="highlight2"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Flat decision tree with four branches down to a series of binary tests ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">if </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">statements in C/C++, for example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Although the deci- sion tree is simpler with multiple branches, the implementation speed is usually not significantly different. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Second, decision trees are typically binary because they can be more easily optimized.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In addition, some learning algorithms that work with decision trees require them to be binary. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">You can do anything with a binary tree that you can do with a more complex tree, so it has become traditional to stick with two branches per decision.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most, although not all, of the decision tree systems we’ve worked with have used binary decisions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We think it is a matter of implementationpreference.Doyouwanttheextraprogrammingworkandreductioninflexibility for the sake of a marginal speed up? </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 667.375px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="660" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.3 </p>
<span origfont="g_font_7" data-canvas-width="459.42330647999995" style="left: 109.176px; top: 700.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03942); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A decision tree takes as input a tree definition, consisting of decision tree nodes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Decision tree nodes might be decisions or actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In an object-oriented language, these may be sub-classes of </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">the tree node class.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The base class specifies a method used to perform the decision tree algorithm. </p>
<span origfont="g_font_35" data-canvas-width="123.73631999999998" style="left: 150.59px; top: 147.056px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">It is not defined in the base class (i.e., it is a pure virtual function): </p>
<span origfont="g_font_35" data-canvas-width="123.73631999999998" style="left: 150.59px; top: 147.056px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class DecisionTreeNode: </p><span origfont="g_font_7" style="left: 125.724px; top: 164.991px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="160" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" data-canvas-width="441.2885849520002" style="left: 140.376px; top: 196.832px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05825); border-left: none;" yquantized="190" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">def makeDecision() # Recursively walks through the tree </p></pre>
<span origfont="g_font_7" data-canvas-width="441.2885849520002" style="left: 140.376px; top: 196.832px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05825); border-left: none;" yquantized="190" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions simply contain details of the action to run if the tree arrives there.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Their structure depends on the action information needed by the game (see Section 5.11 later in the chapter on the structure of actions).  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Their </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">makeDecision </span>
<span origfont="g_font_7" style="left: 125.724px; top: 279.557px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">function simply returns the action (we’ll see how this is used in a moment): </p>
<span origfont="g_font_7" style="left: 125.724px; top: 279.557px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 293.957px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="290" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Action: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 308.357px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def makeDecision(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="174.92014276799998" style="left: 140.615px; top: 340.198px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.999544); border-left: none;" yquantized="340" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return this </p></pre>
<span origfont="g_font_7" data-canvas-width="174.92014276799998" style="left: 140.615px; top: 340.198px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.999544); border-left: none;" yquantized="340" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="182.91456000000002" style="left: 150.59px; top: 377.073px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Decisions have the following format: </p>
<span origfont="g_font_35" data-canvas-width="182.91456000000002" style="left: 150.59px; top: 377.073px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Decision (DecisionTreeNode): </p><span origfont="g_font_7" style="left: 125.724px; top: 395.008px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 409.408px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">trueNode </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 423.808px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">falseNode </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 438.208px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">testValue </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getBranch() # carries out the test def makeDecision() # Recursively walks through the tree </p><span origfont="g_font_7" data-canvas-width="48.193479743999994" style="left: 122.615px; top: 484.449px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04768); border-left: none;" yquantized="480" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 6 </p></pre>
<span origfont="g_font_7" data-canvas-width="48.193479743999994" style="left: 122.615px; top: 484.449px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04768); border-left: none;" yquantized="480" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> where the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">trueNode </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">falseNode </span>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">members are pointers to other nodes in the tree, and the </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> testValue </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">member points to the piece of data in the character’s knowledge which will form the basis of the test.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getBranch </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function carries out the test and returns which branch to follow. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Often, there are different forms of the decision node structure for different types of tests (i.e., for different data types).  </p>
<span origfont="g_font_35" data-canvas-width="166.77504" style="left: 150.59px; top: 588.542px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> For example, a decision for floating point values might look like the following: </p>
<span origfont="g_font_35" data-canvas-width="166.77504" style="left: 150.59px; top: 588.542px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock4"></span>
<pre markupfor="codeBlock4" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class FloatDecision (Decision): </p><span origfont="g_font_7" style="left: 125.724px; top: 606.477px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock4"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">minValue maxValue </p><span origfont="g_font_7" style="left: 125.724px; top: 635.277px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight4" markup="codeBlock4"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 649.677px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock4"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 664.077px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def getBranch(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 678.477px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight3" markup="codeBlock4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if maxValue &gt;= testValue &gt;= minValue: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return trueNode else: </p><span origfont="g_font_7" style="left: 125.724px; top: 707.277px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight4" markup="codeBlock4"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">return falseNode </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A decision tree can be referred to by its root node: the first decision it makes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A decision tree with no decisions might have an action as its root.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> This can be useful for prototyping a character’sAI, by forcing a particular action to always be returned from its decision tree. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The decision tree algorithm is recursively performed by the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">makeDecision </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 189.14px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> It can be trivially expressed as: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 189.14px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class Decision: </p><span origfont="g_font_7" style="left: 112.524px; top: 217.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 232.34px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def makeDecision(): </p><span origfont="g_font_7" style="left: 112.524px; top: 246.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Make the decision and recurse based on the result branch = getBranch() </p><span origfont="g_font_7" style="left: 112.524px; top: 275.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 302.599px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="300" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">return branch.makeDecision() </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 302.599px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="300" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">makeDecision </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function is called initially on the root node of the decision tree. </p>
<span origfont="g_font_13" data-canvas-width="109.031424" style="left: 109.415px; top: 339.666px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0286); border-left: none;" yquantized="330" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.389832144" style="left: 109.176px; top: 370.109px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.10095); border-left: none;" yquantized="370" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Multiple Branches </p>
<span origfont="g_font_7" style="left: 112.524px; top: 405.738px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Wecanimplementadecisionthatsupportsmultiplebranchesalmostassimply.Itsgeneralformis: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 405.738px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class MultiDecision (DecisionTreeNode): daughterNodes </p><span origfont="g_font_7" style="left: 112.524px; top: 434.538px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 448.938px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">testValue </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Carries out the test and returns the node to follow </p><span origfont="g_font_7" style="left: 112.524px; top: 477.738px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getBranch(): return daughterNodes[testValue] </p><span origfont="g_font_7" style="left: 112.524px; top: 506.538px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Recursively runs the algorithm, exactly as before </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 535.338px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 549.738px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def makeDecision(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 564.138px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">branch = getBranch() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 591.197px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="590" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">return branch.makeDecision() </p></pre>
<span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 591.197px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="590" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">daughterNodes </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">is a mapping between possible values of the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">testValue </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">and branches of the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be implemented as a hash table, or for a numeric test value it might be an array of daughter nodes that can be searched using a binary search algorithm. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 652.975px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="650" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.4 </span>
<span origfont="g_font_7" data-canvas-width="458.9690119199999" style="left: 109.415px; top: 686.313px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01599); border-left: none;" yquantized="680" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To see the decision tree in action, run the Decision Tree program that is available on the website. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">It is a command line program designed to let you see behind the scenes of a decision making process. </p>
<span origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">Program </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each decision in the tree is presented to you as a true or false option, so you are making the decision, rather than the software.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The output clearly shows how each decision is considered in turn until a final output action is available. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 170.575px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.5 </span>
<span origfont="g_font_7" data-canvas-width="459.128015016" style="left: 122.615px; top: 203.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0113); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Knowledge Representation </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision trees work directly with primitive data types.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Decisions can be based on integers, float- ing point numbers, Booleans, or any other kind of game-specific data.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> One of the benefits of decision trees is that they require no translation of knowledge from the format used by the rest of the game. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Correspondingly, decision trees are most commonly implemented so they access the state of the game directly.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a decision tree needs to know how far the player is from an enemy, then it will most likely access the player and enemy’s position directly. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This lack of translation can cause difficult-to-find bugs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a decision in the tree is very rarely used, then it may not be obvious if it is broken.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> During development, the structure of the game state regularly changes, and this can break decisions that rely on a particular structure or implementation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A decision might detect, for example, which direction a security camera is pointing.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the underlying implementation changes from a simple angle to a full quaternion to represent the camera rotation, then the decision will break. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To avoid this situation, some developers choose to insulate all access to the state of the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The techniques described in Chapter 10 on world interfacing provide this level of protection. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 465.775px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="460" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.6 </span>
<span origfont="g_font_7" data-canvas-width="459.0287875199999" style="left: 122.615px; top: 499.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00444); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementation Nodes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The function above relies on being able to tell whether a node is an action or a decision and being able to call the test function on the decision and have it carry out the correct test logic (i.e., in object-oriented programming terms, the test function must be polymorphic). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Botharesimpletoimplementusingobject-orientedlanguageswithruntime-typeinformation (i.e., we can detect which class an instance belongs to at runtime). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most games written in C++ switch off RTTI (runtime-type information) for speed reasons. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this case the "is instance of" test must be made using identification codes embedded into each class or another manual method. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Similarly, many developers avoid using virtual functions (the C++ implementation of poly- morphism).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case, some manual mechanism is needed to detect which kind of decision is needed and to call the appropriate test code. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The implementation on the website demonstrates both these techniques.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> It uses neither RTTI </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Library </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nor virtual functions, but relies on a numeric code embedded in each class. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The implementation also stores nodes in a single block of memory.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This avoids problems with different nodes being stored in different places, which causes memory cache problems and slower execution. </p>
<span origfont="g_font_7" data-canvas-width="49.123588080000005" style="left: 122.615px; top: 715.095px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02341); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;">5.2.7 </span>
<span origfont="g_font_7" data-canvas-width="459.4089603360001" style="left: 108.997px; top: 125.853px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02085); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Performance of Decision Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">You can see from the pseudo-code that the algorithm is very simple.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It takes no memory, and its performance is linear with the number of nodes visited. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">If we assume that each decision takes a constant amount of time and that the tree is balanced (see the next section for more details), then the performance of the algorithm is O(log </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">), where </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 2 </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of decision nodes in the tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is very common for the decisions to take constant time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The example decisions we gave in the table at the start of the section are all constant time processes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are some decisions that take more time, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A decision that checks if any enemy is visible, for example, may involve complex ray casting sight checks through the level geometry.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If this decision is placed in a decision tree, then the execution time of the decision tree will be swamped by the execution time of this one decision. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 310.18px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="310" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.8 </span>
<span origfont="g_font_7" data-canvas-width="458.97020743200005" style="left: 109.415px; top: 343.516px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02449); border-left: none;" yquantized="340" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Balancing the Tree </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision trees are intended to run fast and are fastest when the tree is balanced.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A balanced tree has about the same number of leaves on each branch.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Compare the decision trees in Figure 5.9. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The second is balanced (same number of behaviors in each branch), while the first is extremely unbalanced.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Both have 8 behaviors and 7 decisions. </p>
<span origfont="g_font_19" data-canvas-width="70.43520000000001" style="left: 266.27px; top: 445.399px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.03581); border-left: 50px solid blue;" yquantized="440" class="highlight4" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_19" data-canvas-width="70.43520000000001" style="left: 266.27px; top: 445.399px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.03581); border-left: 50px solid blue;" yquantized="440" class="highlight4" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_19" style="left: 480.595px; top: 465.695px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="460" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 206.57px; top: 502.494px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="500" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" data-canvas-width="59.23200000000001" style="left: 265.843px; top: 548.471px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03916); border-left: 50px solid blue;" yquantized="540" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 383.04px; top: 573.69px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="570" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 382.771px; top: 590.49px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="590" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 382.771px; top: 607.29px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="600" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 383.04px; top: 624.09px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="620" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 383.309px; top: 640.89px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="640" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 382.502px; top: 657.69px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="650" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_19" style="left: 382.771px; top: 674.394px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="670" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 714.667px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="710" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Unbalanced treeHABCDEFGBalanced treeABCDEFGH </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Balanced and unbalanced trees </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To get to behavior H, the first tree needs 8 decisions, whereas the second tree only needs 3. </p>
<span origfont="g_font_7" style="left: 576.248px; top: 108.028px; font-size: 11.6114px; font-family: serif; border-left: none;" yquantized="100" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1 </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">In fact, if all behaviors were equally likely, then the first tree would need an average of nearly 4 </span>
<span origfont="g_font_7" style="left: 576.248px; top: 117.103px; font-size: 11.6114px; font-family: serif; border-left: 50px solid blue;" yquantized="110" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> decisions, whereas the second tree would always only need 3. </p><span origfont="g_font_7" style="font-family: serif; font-size: 8.36856px; font-style: normal; font-weight: 400; display: inline;">At its worst, with a severely unbalanced tree, the decision tree algorithm goes from beingO(log </span><span origfont="g_font_8" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 2 </span></pre>
<span origfont="g_font_8" style="left: 157.356px; top: 153.512px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="150" class="highlight4"></span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">)toO( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clearly, we’d like to make sure we stay as balanced as possible, with the same number of leaves resulting from each decision. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although a balanced tree is theoretically optimal,in practice the fastest tree structure is slightly more complex. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In reality, the different results of a decision are not equally likely.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Consider the example trees in Figure 5.9 again.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we were likely to end up in behavior A the majority of the time, then the first tree would be more efficient; it gets to A in one step.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The second tree takes 3 decisions to arrive at A. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Not all decisions are equal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A decision that is very time consuming to run (such as one that searchesforthedistancetothenearestenemy)shouldonlybetakenif absolutelynecessary.Having this further down the tree, even at the expense of having an unbalanced tree, is a good idea. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Structuring the tree for maximum performance is a black art.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Since decision trees are very fast anyway, it is rarely important to squeeze out every ounce of speed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Use these general guidelines: balance the tree, but make commonly used branches shorter than rarely used ones and put the most expensive decisions late. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 393.49px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="390" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.9 </span>
<span origfont="g_font_7" data-canvas-width="459.126819504" style="left: 122.615px; top: 426.827px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00018); border-left: none;" yquantized="420" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Beyond the Tree </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we have kept a strict branching pattern for our tree.We can extend the tree to allow multiple branches to merge into a new decision.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 5.10 shows an example of this. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm we developed earlier will support this kind of tree without modification.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> It is simply a matter of assigning the same decision to more than one </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">trueNode </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">or </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">falseNode </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">in the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can then be reached in more than one way.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is just the same as assigning a single action to more than one leaf. </p>
<span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 714.668px; font-size: 18.2466px; font-family: serif; transform: scaleX(0.946425); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.10 </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Merging branches </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.11 </span>
<span origfont="g_font_7" data-canvas-width="441.46073868" style="left: 126.998px; top: 291.923px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06029); border-left: none;" yquantized="290" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Pathological treeYou need to take care not to introduce possible loops in the tree.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> In Figure 5.11, the third decision in the tree has a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">falseNode </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">earlier in the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The decision process can loop around forever, never finding a leaf. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Strictly, the valid decision structure is called a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">directed acyclic graph </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(DAG).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the context of this algorithm, it still is always called a decision tree. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 393.775px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94441); border-left: none;" yquantized="390" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.2.10 </span>
<span origfont="g_font_7" data-canvas-width="458.74186463999985" style="left: 109.415px; top: 427.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07488); border-left: none;" yquantized="420" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Random Decision Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Often, we don’t want the choice of behavior to be completely predictable.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some element of random behavior choice adds unpredictability, interest, and variation. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is simple to add a decision into the decision tree that has a random element.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could generate a random number, for example, and choose a branch based on its value. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because decision trees are intended to run frequently, reacting to the immediate state of the world, random decisions cause problems.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Imagine running the tree in Figure 5.12 for every frame. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As long as the agent isn’t under attack, the stand still and patrol behaviors will be chosen at random.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This choice is made at every frame, so the character will appear to vacillate between standing and moving.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is likely to appear odd and unacceptable to the player. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tointroducerandomchoicesinthedecisiontree,thedecisionmakingprocessneedstobecome stable—if there is no relevant change in world state, there should be no change in decision.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Note thatthisisn’tthesameassayingtheagentshouldmakethesamedecisioneverytimeforaparticular world state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Faced with the same state at very different times, it can make different decisions, but at consecutive frames it should stay with one decision. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the previous tree, every time the agent is not under attack it can stand still or patrol.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We don’t care which it does, but once it has chosen, it should continue doing that. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is achieved by allowing the random decision to keep track of what it did last time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the decision is first considered, a choice is made at random, and that choice is stored.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The next time the decision is considered, there is no randomness, and the previous choice is automatically taken. </p>
<span origfont="g_font_7" data-canvas-width="28.936172447999997" style="left: 109.415px; top: 715.003px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03343); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_19" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">DefendYe sUnder attack? </p><span origfont="g_font_19" data-canvas-width="23.472" style="left: 332.84px; top: 208.728px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02052); border-left: 50px solid blue;" yquantized="200" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 275.502px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="270" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">PatrolHNoFlip aT coinStand still </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.12 </span><span origfont="g_font_7" data-canvas-width="441.1116491760002" style="left: 140.616px; top: 308.63px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02584); border-left: none;" yquantized="300" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.1116491760002" style="left: 140.616px; top: 308.63px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02584); border-left: none;" yquantized="300" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Random treeIf the decision tree is run again, and the same decision is not considered, it means that some other decision went a different way—something in the world must have changed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case we need to get rid of the choice we made. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 122.615px; top: 377.181px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="370" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="257.96757936000006" style="left: 122.615px; top: 407.625px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01562); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_35" data-canvas-width="177.53472000000002" style="left: 150.59px; top: 439.719px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">This is the pseudo-code for a random binary decision: </p>
<span origfont="g_font_35" data-canvas-width="177.53472000000002" style="left: 150.59px; top: 439.719px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> struct RandomDecision (Decision): </p><span origfont="g_font_7" style="left: 125.724px; top: 457.654px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="450" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">lastFrame = -1 lastDecision = false </p><span origfont="g_font_7" style="left: 125.724px; top: 486.454px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def test(): </p><span origfont="g_font_7" style="left: 125.724px; top: 515.254px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="510" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 529.654px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># check if our stored decision is too old </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 125.724px; top: 544.054px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="540" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if frame() &gt; lastFrame + 1: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><span origfont="g_font_7" style="left: 125.724px; top: 558.454px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Make a new decision and store it </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 572.854px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">lastDecision = randomBoolean() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 587.254px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="580" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Either way we need to update the frame value lastFrame = frame() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 616.054px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We return the stored value </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 644.854px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><span origfont="g_font_7" data-canvas-width="440.8689602400002" style="left: 140.615px; top: 671.912px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01078); border-left: none;" yquantized="670" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return lastDecision </p></pre>
<span origfont="g_font_7" data-canvas-width="440.8689602400002" style="left: 140.615px; top: 671.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01078); border-left: none;" yquantized="670" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To avoid having to go through each unused decision and remove its previous value, we store the frame number at which a stored decision is made.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the test method is called,and the previous stored value was stored on the previous frame, we use it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it was stored prior to that, then we create a new value. </p>
<span origfont="g_font_7" data-canvas-width="89.1254196" style="left: 122.622px; top: 715.094px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00141); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">This code relies on two functions: </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> frame() </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">returns the number of the current frame.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> This should increment by one each frame. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">If the decision tree isn’t called every frame, then </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">frame </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">should be replaced by a function that increments each time the decision tree is called. </p>
<span origfont="g_font_35" data-canvas-width="80.69760000000001" style="left: 127.415px; top: 170.958px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> randomBoolean() </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">returns a random Boolean value, either true or false. </p>
<span origfont="g_font_7" data-canvas-width="441.02915884800007" style="left: 127.418px; top: 199.002px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02804); border-left: none;" yquantized="190" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This algorithm for a random decision can be used with the decision tree algorithm provided above. </p>
<span origfont="g_font_13" data-canvas-width="69.972350976" style="left: 109.415px; top: 256.046px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05228); border-left: none;" yquantized="250" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0789990240002" style="left: 109.415px; top: 286.49px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06881); border-left: none;" yquantized="280" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Timing Out </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the agent continues to do the same thing forever, it may look strange.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The decision tree in our example above, for example, could leave the agent standing still forever, as long as we never attack. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Random decisions that are stored can be set with time-out information, so the agent changes behavior occasionally. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 394.118px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The pseudo-code for the decision now looks like the following: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 394.118px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 408.518px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct RandomDecisionWithTimeOut (Decision): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">lastFrame = -1 firstFrame = -1 </p><span origfont="g_font_7" style="left: 112.524px; top: 437.318px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 451.718px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="450" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">lastDecision = false </p><span origfont="g_font_7" style="left: 112.524px; top: 466.118px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 480.518px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">timeOut = 1000 # Time out after this number of frames </p><span origfont="g_font_7" style="left: 112.524px; top: 494.918px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 112.524px; top: 509.318px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="500" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def test(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 523.718px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="520" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># check if our stored decision is too old, or if </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 538.118px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># we’ve timed out </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if frame() &gt; lastFrame+1or frame() &gt; firstFrame + timeOut: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 566.918px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Make a new decision and store it </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 595.718px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 610.118px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">lastDecision = randomBoolean() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 624.518px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 638.918px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="630" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Set when we made the decision </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 653.318px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">firstFrame = frame() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 667.718px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Either way we need to update the frame value lastFrame = frame() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 696.518px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We return the stored value </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 23 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Again, this decision structure can be used directly with the previous decision tree algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There can be any number of more sophisticated timing schemes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For example, make the stop time random so there is extra variation, or alternate behaviors when they time out so the agent doesn’t happen to stand still multiple times in a row.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Use your imagination. </p>
<span origfont="g_font_13" data-canvas-width="90.10873344" style="left: 122.615px; top: 173.859px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02569); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9271689999999" style="left: 122.615px; top: 204.303px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.989963); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Random Decision Tree program available on the website is a modified version of the previousDecisionTreeprogram.Itreplacessomeof thedecisionsinthefirstversionwithrandomdecisions and others with a timed-out version.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> As before, it provides copious amounts of output, so you </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">can see what is going on behind the scenes. </p>
<span origfont="g_font_13" data-canvas-width="177.75278284800004" style="left: 122.615px; top: 282.251px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01286); border-left: none;" yquantized="280" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.2200694399999" style="left: 122.376px; top: 312.694px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03418); border-left: none;" yquantized="310" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using Random Decision Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve included this section on random decision trees as a simple extension to the decision tree algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It isn’t a common technique.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In fact, we’ve come across it just once. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is the kind of technique,however,that can breathe a lot more life into a simple algorithm for very little implementation cost.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> One perennial problem with decision trees is their predictability; they have a reputation for giving AI that is overly simplistic and prone to exploitation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Intro- ducing just a simple random element in this way goes a long way toward rescuing the technique. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Therefore, we think it deserves to be used more widely. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 435.242px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="430" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.3 </p>
<span origfont="g_font_7" data-canvas-width="459.11247336" style="left: 122.615px; top: 477.067px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06031); border-left: none;" yquantized="470" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State Machines </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Often, characters in a game will act in one of a limited set of ways.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> They will carry on doing the same thing until some event or influence makes them change.  </p>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A Covenant warrior in </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Halo </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> [Bungie Software, 2001], for example, will stand at its post until it notices the player, then it will switch into attack mode, taking cover and firing. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can support this kind of behavior using decision trees, and we’ve gone some way toward doing that using random decisions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most cases,however,it is easier to use a technique designed for this purpose: state machines. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State machines are the technique most often used for this kind of decision making and, along with scripting (see Section 5.10), make up the vast majority of decision making systems used in current games. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State machines take account of both the world around them (like decision trees) and their internal makeup (their state). </p>
<span origfont="g_font_13" data-canvas-width="130.051534848" style="left: 122.328px; top: 670.215px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.99276); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.02878752" style="left: 122.615px; top: 700.658px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00395); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Basic State Machine </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a state machine each character occupies one state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Normally,actions or behaviors are associated with each state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, as long as the character remains in that state, it will continue carrying out the </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_43" style="font-family: sans-serif; font-size: 9.60008px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_43" style="font-family: sans-serif; font-size: 9.60008px; font-style: normal; font-weight: 400; display: inline;">On Guard[See small enemy]Fight </p><span origfont="g_font_43" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [See big enemy] </span><span origfont="g_font_43" data-angle="33.43580973799385" data-canvas-width="42.69101322559144" style="left: 299.726px; top: 190.071px; font-size: 9.59996px; font-family: sans-serif; transform: rotate(33.4358deg) scaleX(1.01645); border-left: 50px solid blue;" yquantized="190" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_43" style="font-family: sans-serif; font-size: 9.59996px; font-style: normal; font-weight: 400;"> [Losing fight] </p><span origfont="g_font_43" data-canvas-width="43.7472" style="left: 403.628px; top: 225.827px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0215); border-left: 50px solid blue;" yquantized="220" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_43" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [Escaped] </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 292.302px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="290" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Run Away </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.13 </span><span origfont="g_font_7" data-canvas-width="441.5025816000001" style="left: 127.415px; top: 324.725px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03029); border-left: none;" yquantized="320" class="highlight2"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.5025816000001" style="left: 127.415px; top: 324.725px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03029); border-left: none;" yquantized="320" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A simple state machineStates are connected together by transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each transition leads from one state to another, the target state, and each has a set of associated conditions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the game determines that the conditions of a transition are met, then the character changes state to the transition’s target state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When a transition’s conditions are met, it is said to trigger, and when the transition is followed to a new state, it has fired. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.13 shows a simple state machine with three states: On Guard, Fight, and Run Away. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that each state has its own set of transitions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The state machine diagrams in this chapter are based on the Unified Modeling Language (UML) state chart diagram format, a standard notation used throughout software engineering. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">States are shown as curved corner boxes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Transitions are arrowed lines, labeled by the condition that triggers them.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Conditions are contained in square brackets. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The solid circle in Figure 5.13 has only one transition without a trigger condition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The tran- sition points to the initial state that will be entered when the state machine is first run. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">You won’t need an in-depth understanding of UML to understand this chapter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you want to find out more about UML, we’d recommend Pilone and Pitman [2005]. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a decision tree, the same set of decisions is always used, and any action can be reached through the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a state machine, only transitions from the current state are considered, so not every action can be reached. </p>
<span origfont="g_font_13" data-canvas-width="126.95418163199999" style="left: 109.415px; top: 605.442px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02382); border-left: none;" yquantized="600" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.08617209599976" style="left: 109.415px; top: 635.885px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03398); border-left: none;" yquantized="630" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Finite State Machines </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In game AI any state machine with this kind of structure is usually called a finite state machine (FSM).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This and the following sections will cover a range of increasingly powerful state machine implementations, all of which are often referred to as FSMs. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This causes confusion with non-games programmers, for whom the term FSM is more com- monly used for a particular type of simple state machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An FSM in computer science normally refers to an algorithm used for parsing text.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Compilers use an FSM to tokenize the input code into </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Game FSM </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The basic state machine structure is very general and admits any number of implementations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We have seen tens of different ways to implement a game FSM,and it is rare to find any two developers using exactly the same technique.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> That makes it difficult to put forward a single algorithm as being the "state machine" algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Later in this section, we’ll look at a range of different implementation styles for the FSM, but we work through just one main algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We chose it for its flexibility and the cleanness of its implementation. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 246.469px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="240" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.1 </p>
<span origfont="g_font_7" data-canvas-width="459.2439796800001" style="left: 122.376px; top: 279.806px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00923); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Problem </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We would like a general system that supports arbitrary state machines with any kind of transition condition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The state machine will conform to the structure given above and will occupy only one state at a time. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 344.016px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="340" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.2 </span>
<span origfont="g_font_7" data-canvas-width="459.3993962400001" style="left: 122.376px; top: 377.354px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.989993); border-left: none;" yquantized="370" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will use a generic state interface that can be implemented to include any specific code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The state machine keeps track of the set of possible states and records the current state it is in.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Alongside each state,a series of transitions is maintained.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each transition is again a generic interface that can be implemented with the appropriate conditions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It simply reports to the state machine whether it is triggered or not. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At each iteration (normally each frame), the state machine’s update function is called.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This checks to see if any transition from the current state is triggered.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first transition that is triggered is scheduled to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The method then compiles a list of actions to perform from the currently active state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a transition has been triggered, then the transition is fired. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This separation of the triggering and firing of transitions allows the transitions to also have their own actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Often, transitioning from one state to another also involves carrying out some action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case, a fired transition can add the action it needs to those returned by the state. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 571.164px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="570" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.3 </span>
<span origfont="g_font_7" data-canvas-width="459.1363836000001" style="left: 122.615px; top: 604.502px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05307); border-left: none;" yquantized="600" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The state machine holds a list of states, with an indication of which one is the current state.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 668.93px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> It has an update function for triggering and firing transitions and a function that returns a set of actions to carry out: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 668.93px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 683.33px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class StateMachine: </p><span origfont="g_font_7" style="left: 125.724px; top: 697.73px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Holds a list of states for the machine states </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 4 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"># Holds the initial state </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">initialState </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Holds the current state </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentState = initialState </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Checks and applies transitions, returning a list of # actions. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def update(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Assume no transition is triggered </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 272.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">triggeredTransition = None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Check through each transition and store the first # one that triggers. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 301.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for transition in currentState.getTransitions(): if transition.isTriggered(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">triggeredTransition = transition </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">break </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check if we have a transition to fire if triggeredTransition: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Find the target state targetState = triggeredTransition.getTargetState() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 30 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Add the exit action of the old state, the </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 31 32 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># transition action and the entry for the new state. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 33 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions = currentState.getExitAction() actions += triggeredTransition.getAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 34 35 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 532.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions += targetState.getEntryAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 36 37 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Complete the transition and return the action list currentState = targetState </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 38 39 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 589.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return actions </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 604.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 40 41 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 618.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Otherwise just return the current state’s actions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 42 </span><span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 681.776px; font-size: 16.7372px; font-family: serif; transform: scaleX(0.94541); border-left: 50px solid orange;" yquantized="680" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_15" style="font-family: serif; font-size: 16.7372px; font-style: normal; font-weight: 400; display: inline;">else: return currentState.getAction() </p><span origfont="g_font_12" style="font-family: sans-serif; font-size: 16.7372px; font-style: normal; font-weight: 400;"> 5.3.4 </span></pre>
<span origfont="g_font_12" data-canvas-width="277.7377605599999" style="left: 138.209px; top: 685.692px; font-size: 23.2229px; font-family: sans-serif; transform: scaleX(1.22405); border-left: none;" yquantized="680" class="highlight3"></span>
<span origfont="g_font_7" data-canvas-width="397.4647015679999" style="left: 109.415px; top: 715.113px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02439); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The state machine relies on having states and transitions with a particular interface. </p>
<span origfont="g_font_7" data-canvas-width="397.4647015679999" style="left: 109.415px; top: 715.113px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02439); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">The state interface has the following form: </p>
<span origfont="g_font_35" data-canvas-width="64.55808" style="left: 150.59px; top: 128.004px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class State: </p><span origfont="g_font_7" style="left: 125.724px; top: 145.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getAction() def getEntryAction() </p><span origfont="g_font_7" style="left: 125.724px; top: 174.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 189.14px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getExitAction() </p><span origfont="g_font_7" style="left: 125.724px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_62" style="left: 219.049px; top: 229.522px; font-size: 10.7597px; font-family: monospace; border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_62" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">def getTransitions() </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">X </p></pre>
<span origfont="g_font_7" data-canvas-width="57.583030992" style="left: 140.615px; top: 231.794px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.08647); border-left: none;" yquantized="230" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Each of the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getAction </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">methods should return a list of actions to carry out.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> As we will see below, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">getEntryAction </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">is only called when the state is entered from a transition, and the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getExitAction </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is only called when the state is exited.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The rest of the time that the state is active, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getAction </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is called.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getTransitions </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method should return a list of transitions that are outgoing from this state. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 339.423px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The transition interface has the following form: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 339.423px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 353.823px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Transition: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 368.223px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="360" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def isTriggered() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getTargetState() def getAction() </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 410.877px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="410" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 4 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 410.877px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="410" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">isTriggered </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">method returns true if the transition can fire, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">getTargetState </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">method reports which state to transition to, and the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getAction </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method returns a list of actions to carry out when the transition fires. </p>
<span origfont="g_font_13" data-canvas-width="162.40804454399998" style="left: 122.615px; top: 483.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.07203); border-left: none;" yquantized="480" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.05030673600027" style="left: 122.615px; top: 513.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03157); border-left: none;" yquantized="510" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Transition Implementation </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Only one implementation of the state class should be required: it can simply hold the three lists of actions and the list of transitions as data members, returning them in the corresponding get methods. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">In the same way, we can store the target state and a list of actions in the transition class and have its methods return the stored values.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">isTriggered </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method is more difficult to generalize. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each transition will have its own set of conditions, and much of the power in this method is allowing the transition to implement any kind of tests it likes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because state machines are often defined in a data file and read into the game at runtime, it is a common requirement to have a set of generic transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The state machine can then be set up from the data file by using the appropriate transitions for each state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the previous section on decision trees, we saw generic testing decisions that operated on basic data types.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same principle can be used with state machine transitions: we have generic transitions that trigger when data they are looking at are in a given range. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unlike decision trees, state machines don’t provide a simple way of combining these tests together to make more complex queries.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we need to transition based on the condition that </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">the enemy is far away AND health is low, then we need some way of combining triggers together. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In keeping with our polymorphic design for the state machine, we can accomplish this with the addition of another interface: the condition interface.  </p>
<span origfont="g_font_35" data-canvas-width="91.45728000000001" style="left: 137.39px; top: 187.996px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> We can use a general transition class of the following form: </p>
<span origfont="g_font_35" data-canvas-width="91.45728000000001" style="left: 137.39px; top: 187.996px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Transition: </p><span origfont="g_font_7" style="left: 112.524px; top: 205.931px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> actions </p><span origfont="g_font_7" style="left: 112.524px; top: 234.731px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 249.131px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getAction(): return actions </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> targetState </p><span origfont="g_font_7" style="left: 112.524px; top: 277.931px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 292.331px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="290" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getTargetState(): return targetState </p><span origfont="g_font_7" style="left: 112.524px; top: 306.731px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">condition def isTriggered(): return condition.test() </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 350.581px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="350" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 10 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 350.581px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="350" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">isTriggered </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function now delegates the testing to its condition member. </p>
<span origfont="g_font_35" data-canvas-width="86.07744" style="left: 137.39px; top: 399.465px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Conditions have the following simple format: </p>
<span origfont="g_font_35" data-canvas-width="86.07744" style="left: 137.39px; top: 399.465px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Condition: </p><span origfont="g_font_7" style="left: 112.524px; top: 417.4px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" data-canvas-width="213.69777000000002" style="left: 127.176px; top: 446.849px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02227); border-left: none;" yquantized="440" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def test() </p></pre>
<span origfont="g_font_7" data-canvas-width="213.69777000000002" style="left: 127.176px; top: 446.849px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02227); border-left: none;" yquantized="440" class="highlight2"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">We can then make a set of sub-classes of the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Condition </span>
<span origfont="g_font_7" style="left: 112.524px; top: 496.376px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">class for particular tests, just like we did for decision trees: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 496.376px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class FloatCondition (Condition): minValue </p><span origfont="g_font_7" style="left: 112.524px; top: 525.176px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 539.576px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">maxValue </p><span origfont="g_font_7" style="left: 112.524px; top: 553.976px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 568.376px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="560" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">testValue # Pointer to the game data we’re interested in </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def test(): </p><span origfont="g_font_7" style="left: 112.524px; top: 597.176px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" data-canvas-width="441.66278020799984" style="left: 127.176px; top: 626.625px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.09824); border-left: none;" yquantized="620" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return minValue &lt;= testValue &lt;= maxValue </p></pre>
<span origfont="g_font_7" data-canvas-width="441.66278020799984" style="left: 127.176px; top: 626.625px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09824); border-left: none;" yquantized="620" class="highlight2"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 673.761px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">We can combine conditions together using Boolean sub-classes, such as AND, NOT, and OR: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 673.761px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock4"></span>
<pre markupfor="codeBlock4" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 688.16px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class AndCondition (Condition): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">conditionA conditionB </p><span origfont="g_font_7" style="left: 112.524px; top: 716.96px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight4" markup="codeBlock4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 3 4 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">def test(): </p>
<span origfont="g_font_7" style="left: 125.724px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 125.724px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return conditionA.test() and conditionB.test() </p><span origfont="g_font_7" style="left: 125.724px; top: 143.356px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class NotCondition (Condition): condition </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def test(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return not condition.test() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 16 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class OrCondition (Condition): conditionA </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 301.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">conditionB </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def test(): return conditionA.test() or conditionB.test() </p><span origfont="g_font_7" data-canvas-width="236.56791455999996" style="left: 122.615px; top: 357.615px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.998177); border-left: none;" yquantized="350" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 21 </p></pre>
<span origfont="g_font_7" data-canvas-width="236.56791455999996" style="left: 122.615px; top: 357.615px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.998177); border-left: none;" yquantized="350" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> and so on, for any level of sophistication we need. </p>
<span origfont="g_font_8" data-canvas-width="62.9799936" style="left: 122.242px; top: 392.691px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.91472); border-left: none;" yquantized="390" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.035960592" style="left: 122.615px; top: 419.549px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04037); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Weaknesses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach to transitions gives a lot of flexibility, but at the price of lots of method calls.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> InC++ these method calls have to be polymorphic, which can slow down the call and confuse the processor.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> All this adds time, which may make it unsuitable for use in every frame on lots of characters. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Several developers we have come across use a homegrown scripting language to express con- ditions for transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This still allows designers to create the state machine rules but can be slightly more efficient.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In practice, however, the speed up over this approach is quite small, unless the scripting language includes some kind of compilation into machine code (i.e., just-in-time compiling).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For all but the simplest code, interpreting a script is at least as time consuming as calling polymorphic functions. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 595.375px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.5 </span>
<span origfont="g_font_7" data-canvas-width="459.024005472" style="left: 122.615px; top: 628.713px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04284); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To get a sense of what is happening during an iteration, run the State Machine program that is available from the website.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a command line program that allows you to manually trigger transitions. </p>
<span origfont="g_font_48" data-canvas-width="38.065197600000005" style="left: 66.2152px; top: 673.502px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.18954); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The software displays the current state (states have letters from A to G), and lets you select a transition to trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The program clearly shows what is happening at each stage.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You see the transition triggered, then which methods are being called, and finally the transition fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You can also select no transition and see the state’s regular action being returned. </p>
<span origfont="g_font_7" data-canvas-width="344.755773" style="left: 122.615px; top: 715.095px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01896); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;">5.3.6 </span>
<span origfont="g_font_7" data-canvas-width="458.96422987200003" style="left: 109.415px; top: 125.853px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02447); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Performance </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The state machine algorithm only requires memory to hold a triggered transition and the current state.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It is O(1) in memory, and O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of transitions per state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm calls other functions in both the state and the transition classes, and in most cases the execution time of these functions accounts for most of the time spent in the algorithm. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 220.476px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="220" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.7 </span>
<span origfont="g_font_7" data-canvas-width="407.2798550879999" style="left: 109.176px; top: 253.814px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01434); border-left: none;" yquantized="250" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementation Notes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As we mentioned earlier, there are any number of ways to implement a state machine. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The state machine described in this section is as flexible as possible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve tried to aim for an implementation that allows you to experiment with any kind of state machine and add interesting features.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In many cases, it may be too flexible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you’re only planning to use a small subset of its flexibility, then it is very likely to be unnecessarily inefficient. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 348.436px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="340" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.8 </p>
<span origfont="g_font_7" data-canvas-width="459.2702809440001" style="left: 109.176px; top: 381.773px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03907); border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Hard-Coded FSM </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A few years back, almost all state machines were hard coded.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The rules for transitions and the execution of actions were part of the game code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has become less common as level designers get more control over building the state machine logic, but it is still an important approach. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 109.415px; top: 451.685px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="450" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.02878752000004" style="left: 109.415px; top: 482.128px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02234); border-left: none;" yquantized="480" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a hard-coded FSM, the state machine consists of an enumerated value, indicating which state is currently occupied, and a function that checks if a transition should be followed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Here, we’ve combined the two into a class definition (although hard-coded FSMs tend to be associated with developers still working in C). </p>
<span origfont="g_font_35" data-canvas-width="64.55808" style="left: 137.39px; top: 557.422px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<span origfont="g_font_35" data-canvas-width="64.55808" style="left: 137.39px; top: 557.422px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class MyFSM: </p><span origfont="g_font_7" style="left: 112.524px; top: 575.357px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="570" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 589.757px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 604.157px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Defines the names for each state </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 618.557px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">enum State: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">PATROLDEFEND </p><span origfont="g_font_7" style="left: 112.524px; top: 647.357px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 661.757px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">SLEEP </p><span origfont="g_font_7" style="left: 112.524px; top: 676.157px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Holds the current state myState </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 704.957px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> def update(): </p></pre>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Find the correct state </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 143.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if myState == PATROL: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Example transitions if canSeePlayer(): myState = DEFEND </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if tired(): myState = SLEEP </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">elif myState == DEFEND: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Example transitions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 272.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not canSeePlayer(): myState = PATROL </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 301.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">elif myState == SLEEP: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Example transitions if not tired(): myState = PATROL </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 30 31 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def notifyNoiseHeard(volume): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if myState == SLEEP and volume &gt; 10: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 33 </span><span origfont="g_font_7" data-canvas-width="441.0961075200001" style="left: 140.615px; top: 415.215px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.09182); border-left: none;" yquantized="410" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">myState = DEFEND </p></pre>
<span origfont="g_font_7" data-canvas-width="441.0961075200001" style="left: 140.615px; top: 415.215px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09182); border-left: none;" yquantized="410" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that this is pseudo-code for a particular state machine rather than a type of state machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the update function there is a block of code for each state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In that block of code the conditions for each transition are checked in turn, and the state is updated if required.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The transitions in this example all call functions ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">tired </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">canSeePlayer </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">), which we are assuming have access to the current game state. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">In addition, we’ve added a state transition in a separate function, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">notifyNoiseHeard </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.Weare assuming that the game code will call this function whenever the character hears a loud noise.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This illustrates the difference between a polling (asking for information explicitly) and an event-based (waiting to be told information) approach to state transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Chapter 10 on world interfacing contains more details on this distinction. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The update function is called in each frame,as before,and the current state is used to generate an output action.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 626.034px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> To do this, the FSM might have a method containing conditional blocks of the following form: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 626.034px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getAction(): if myState == PATROL: return PatrolAction </p><span origfont="g_font_7" style="left: 125.724px; top: 654.834px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="650" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 669.234px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">elif myState == DEFEND: return DefendAction </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" data-canvas-width="441.04828704000005" style="left: 140.615px; top: 698.684px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03721); border-left: none;" yquantized="690" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">elif myState == SLEEP: return SleepAction </p></pre>
<span origfont="g_font_7" data-canvas-width="441.04828704000005" style="left: 140.615px; top: 698.684px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03721); border-left: none;" yquantized="690" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Often, the state machine simply carries out the actions directly, rather than returning details of the action for another piece of code to execute. </p>
<span origfont="g_font_7" data-canvas-width="235.71431899200002" style="left: 122.622px; top: 713.078px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02041); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">This approach requires no memory and is O( </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">+ </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">), where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of states, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of transitions per state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although this appears to perform worse than the flexible implementation, it is usually faster in practice for all but huge state machines (i.e., thousands of states). </p>
<span origfont="g_font_13" data-canvas-width="69.8661888" style="left: 109.128px; top: 206.425px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01473); border-left: none;" yquantized="200" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.33603410399985" style="left: 109.176px; top: 236.87px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02124); border-left: none;" yquantized="230" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Weaknesses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although hard-coded state machines are easy to write, they are notoriously difficult to maintain. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State machines in games can often get fairly large, and this can appear as ugly and unclear code. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most developers, however, find that the main drawback is the need for programmers to write the AI behaviors for each character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This implies a need to recompile the game each time the behavior changes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While it may not be a problem for a hobby game writer, it can become critical in a large game project that takes many minutes or hours to rebuild. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">More complex structures, such as hierarchical state machines (see below), are also difficult to coordinate using hard-coded FSMs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With a more flexible implementation, debugging output can easily be added to all state machines, making it easier to track down problems in the AI. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 386.548px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.9 </p>
<span origfont="g_font_7" data-canvas-width="459.0024862559998" style="left: 109.415px; top: 419.885px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993976); border-left: none;" yquantized="410" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Hierarchical State Machines </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On its own, one state machine is a powerful tool, but it can be difficult to express some behaviors. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">One common source of difficulty is "alarm behaviors." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Imagine a service robot that moves around a facility cleaning the floors.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has a state machine allowing it to do this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It might search around for objects that have been dropped, pick one up when it finds it, and carry it off to the trash compactor.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be simply implemented using a normal state machine (see Figure 5.14). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unfortunately, the robot can run low on power, whereupon it has to scurry off to the nearest electrical point and get recharged.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Regardless of what it is doing at the time, it needs to stop, and when it is fully charged again it needs to pick up where it left off.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The recharging periods could allow the player to sneak by unnoticed, for example, or allow the player to disable all electricity to the area and thereby disable the robot. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is an alarm mechanism: something that interrupts normal behavior to respond to some- thing important.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Representing this in a state machine leads to a doubling in the number of states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With one level of alarm this isn’t a problem, but what would happen if we wanted the robot to hide when fighting breaks out in the corridor.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If its hiding instinct is more important than its refueling instinct, then it will have to interrupt refueling to go hide.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> After the battle it will need to pick up refueling where it left off, after which it will pick up whatever it was doing before that. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For just 2 levels of alarm, we would have 16 states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rather than combining all the logic into a single state machine, we can separate it into several. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each alarm mechanism has its own state machine, along with the original behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are arranged in a hierarchy, so the next state machine down is only considered when the higher level </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60018px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60018px; font-style: normal; font-weight: 400;">Search [Seen trash]Head for trash </p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [Trash disposed] </p><span origfont="g_font_25" data-canvas-width="36.528000000000006" style="left: 417.025px; top: 237.241px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01467); border-left: 50px solid blue;" yquantized="230" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 305.502px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="300" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;"> [Got item]Head for compactor </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.14 </span><span origfont="g_font_25" data-canvas-width="44.0448" style="left: 286.412px; top: 365.426px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0243); border-left: 50px solid blue;" yquantized="360" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">The basic cleaning robot state machine </p><span origfont="g_font_25" data-angle="-30.876306129629803" data-canvas-width="52.29258909727756" style="left: 224.117px; top: 426.876px; font-size: 9.60026px; font-family: sans-serif; transform: rotate(-30.8763deg) scaleX(1.02534); border-left: 50px solid blue;" yquantized="420" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60026px; font-style: normal; font-weight: 400;">Get powerGet power (search)(head for trash) </p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.59998px; font-style: normal; font-weight: 400;"> [Recharged][Recharged] </p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [No power][No power] </p><span origfont="g_font_25" data-canvas-width="44.0448" style="left: 461.603px; top: 482.23px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0243); border-left: 50px solid blue;" yquantized="480" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_25" data-angle="36.01736782635964" data-canvas-width="69.94717161707034" style="left: 269.529px; top: 498.769px; font-size: 9.59909px; font-family: sans-serif; transform: rotate(36.0174deg) scaleX(1.00435); border-left: 50px solid blue;" yquantized="490" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.59909px; font-style: normal; font-weight: 400; display: inline;">Search [Seen trash]Head for trashGet power </p><span origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [Trash disposed] </span><span origfont="g_font_25" data-angle="-90" data-canvas-width="41.61600000000001" style="left: 370.462px; top: 545.128px; font-size: 9.6px; font-family: sans-serif; transform: rotate(-90deg) scaleX(0.990857); border-left: 50px solid blue;" yquantized="540" class="highlight2" markup="figureBlock"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60026px; font-style: normal; font-weight: 400;">(head for compactor) [Got item] </span><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.59998px; font-style: normal; font-weight: 400;">[Recharged] </p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [No power] </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 636.097px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="630" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Head for compactor </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.15 </span><span origfont="g_font_7" data-canvas-width="418.06098230399994" style="left: 140.615px; top: 679.088px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00738); border-left: none;" yquantized="670" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="418.06098230399994" style="left: 140.615px; top: 679.088px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00738); border-left: none;" yquantized="670" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An alarm mechanism in a standard state machineFigure 5.15 shows one alarm mechanism and corresponds exactly to the diagram above. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will nest one state machine inside another to indicate a hierarchical state machine (Figure 5.16).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The solid circle again represents the start state of the machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a composite </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60018px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60018px; font-style: normal; font-weight: 400;">Clean upSearch [Seen trash]Head for trash[Recharged]Get power [No power] </p><span origfont="g_font_25" data-angle="-90" data-canvas-width="41.61600000000001" style="left: 343.936px; top: 236.923px; font-size: 9.6px; font-family: sans-serif; transform: rotate(-90deg) scaleX(0.990857); border-left: 50px solid blue;" yquantized="230" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [Trash disposed] </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 343.902px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="340" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;"> [Got item]H*Head for compactor </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.16 </span><span origfont="g_font_7" data-canvas-width="440.84265897599994" style="left: 127.415px; top: 383.916px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01111); border-left: none;" yquantized="380" class="highlight2"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="440.84265897599994" style="left: 127.415px; top: 383.916px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01111); border-left: none;" yquantized="380" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A hierarchical state machine for the robotIf the composite state has already been entered,then the previous sub-state is returned to.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> TheH* node is called the "history state" for this reason. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The details of why there’s an asterisk after the H, and some of the other vagaries of the UML state chart diagram, are beyond the scope of this chapter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Refer back to Pilone and Pitman [2005] for more details. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rather than having separate states to keep track of the non-alarm state, we introduce nested states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We still keep track of the state of the cleaning state machine, even if we are in the process of refueling.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the refueling is over, the cleaning state machine will pick up where it left off. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In effect, we are in more than one state at once.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might be in the "Refuel" state in the alarm mechanism, while at the same time we are also in the"Pick Up Object"state in the cleaning machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because there is a strict hierarchy, there is never any confusion about which state wins out: the highest state in the hierarchy is always in control. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Toimplementthis,wecouldsimplyarrangethestatemachinesinourprogramsothatonestate machine calls another if it needs to.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So if the refueling state machine is in its "Clean Up" state, it calls the cleaning state machine and asks it for the action to take.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When it is in the "Refuel" state, it returns the refueling action directly. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whilethiswouldleadtoslightlyuglycode,itwouldimplementourscenario.Mosthierarchical state machines, however, support transitions between levels of the hierarchy, and for that we’ll need more complex algorithms. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For example, let’s expand our robot so that it can do something useful if there are no objects to collect.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It makes sense that it will use the opportunity to go and recharge, rather than standing around waiting for its battery to go flat.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The new state machine is shown in Figure 5.17. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Noticethatwe’veaddedonemoretransition:fromthe"Search"staterightoutintothe"Refuel" state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This transition is triggered when there are no objects to collect.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because we transitioned </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60018px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.60018px; font-style: normal; font-weight: 400;">[No trash found]Clean upSearch [Seen trash]Head for trash[Recharged]Get power [No power] </p><span origfont="g_font_25" data-angle="-90" data-canvas-width="41.61600000000001" style="left: 357.136px; top: 268.123px; font-size: 9.6px; font-family: sans-serif; transform: rotate(-90deg) scaleX(0.990857); border-left: 50px solid blue;" yquantized="260" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> [Trash disposed] </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 375.102px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="370" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;"> [Got item]H*Head for compactor </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.17 </span><span origfont="g_font_7" data-canvas-width="459.00009523199986" style="left: 122.611px; top: 415.594px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0625); border-left: none;" yquantized="410" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="459.00009523199986" style="left: 122.611px; top: 415.594px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0625); border-left: none;" yquantized="410" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A hierarchical state machine with a cross-hierarchy transition directly out of this state, the inner state machine no longer has any state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the robot has refueled and the alarm system transitions back to cleaning, the robot will not have a record of where to pick up from, so it must start the state machine again from its initial node ("Search"). </p>
<span origfont="g_font_13" data-canvas-width="77.11103999999999" style="left: 122.615px; top: 484.507px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04204); border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1579028160002" style="left: 122.376px; top: 514.951px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01574); border-left: none;" yquantized="510" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Problem </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’d like an implementation of a state machine system that supports hierarchical state machines. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’d also like transitions that pass between different layers of the machine. </p>
<span origfont="g_font_13" data-canvas-width="88.04000563199999" style="left: 122.615px; top: 569.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03576); border-left: none;" yquantized="560" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.200941248" style="left: 122.615px; top: 599.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.08815); border-left: none;" yquantized="590" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a hierarchical state machine, each state can be a complete state machine in its own right. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We therefore rely on recursive algorithms to process the whole hierarchy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As with most recursive algorithms,thiscanbeprettytrickytofollow.Thesimplestimplementationcoveredhereisdoubly tricky because it recurses up and down the hierarchy at different points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’d encourage you to use the informal discussion and examples in this section alongside the pseudo-code in the next section and play with the Hierarchical State Machine program that is available on the website to get a feel for how it is all working. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The first part of the system returns the current state.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> The result is a list of states, from highest </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">to lowest in the hierarchy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The state machine asks its current state to return its hierarchy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">State LState AState BState MH*State C </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.18 </span><span origfont="g_font_7" data-canvas-width="458.698826208" style="left: 109.412px; top: 383.916px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02388); border-left: none;" yquantized="380" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="458.698826208" style="left: 109.412px; top: 383.916px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02388); border-left: none;" yquantized="380" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Current state in a hierarchy state is a terminal state, it returns itself; otherwise, it returns itself and adds to it the hierarchy of state from its own current state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In Figure 5.18 the current state is [State L, State A]. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The second part of the hierarchical state machine is its update.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the original state machine we assumed that each state machine started off in its initial state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because the state machine always transitioned from one state to another, there was never any need to check if there was no state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State machines in a hierarchy can be in no state; they may have a cross-hierarchy transition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first stage of the update, then, is to check if the state machine has a state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If not, it should enter its initial state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Next, we check if the current state has a transition it wants to execute.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Transitions at higher levels in the hierarchy always take priority, and the transitions of sub-states will not be considered if the super-state has one that triggers. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A triggered transition may be one of three types: it might be a transition to another state at the current level of the hierarchy, it might be a transition to a state higher up in the hierarchy, or it might be a transition to a state lower in the hierarchy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clearly, the transition needs to provide more data than just a target state.We allow it to return a relative level; how many steps up or down the hierarchy the target state is. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Wecouldsimplysearchthehierarchyforthetargetstateandnotrequireanexplicitlevel.While this would be more flexible (we wouldn’t have to worry about the level values being wrong), it would be considerably more time consuming.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A hybrid, but fully automatic, extension could search the hierarchy once offline and store all appropriate level values. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So the triggered transition has a level of zero (state is at the same level), a level greater than zero (state is higher in the hierarchy), or a level less than zero (state is lower in the hierarchy).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It acts differently depending on which category the level falls into. </p>
<span origfont="g_font_7" data-canvas-width="302.55898144799994" style="left: 109.412px; top: 714.977px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0059); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the level is zero, then the transition is a normal state machine transition and can be performed at the current level, using the same algorithm used in the finite state machine. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the level is greater than zero,then the current state needs to be exited and nothing else needs to be done at this level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The exit action is returned, along with an indication to whomever called the update function that the transition hasn’t been completed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We will return the exit action, the transition outstanding, and the number of levels higher to pass the transition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This level value is decreased by one as it is returned.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As we will see, the update function will be returning to the next highest state machine in the hierarchy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the level is less than zero, then the current state needs to transition to the ancestor of the target state on the current level in the hierarchy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In addition, each of the children of that state also needs to do the same, down to the level of the final destination state.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> To achieve this we use a separate function, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">updateDown </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, that recursively performs this transition from the level of the target state back up to the current level and returns any exit and entry actions along the way. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The transition is then complete and doesn’t need to be passed on up.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> All the accumulated actions can be returned. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So we’ve covered all possibilities if the current state has a transition that triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it does not have a transition that triggers, then its action depends on whether the current state is a state machine itself.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If not, and if the current state is a plain state, then we can return the actions associated with being in that state, just as before. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the current state is a state machine, then we need to give it the opportunity to trigger any transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can do this by calling its update function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The update function will handle any triggers and transitions automatically.As we saw above,a lower level transition that fires may have its target state at a higher level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The update function will return a list of actions, but it may also return a transition that it is passing up the hierarchy and that hasn’t yet been fired. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If such a transition is received,its level is checked.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the level is zero,then the transition should be acted on at this level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The transition is honored, just as if it were a regular transition for the current state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the level is still greater than zero (it should never be less than zero, because we are passing up the hierarchy at this point), then the state machine should keep passing it up.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It does this, as before, by exiting the current state and returning the following pieces of information: the exit action, any actions provided by the current state’s update function, the transition that is still pending, and the transition’s level, less one. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If no transition is returned from the current state’s update function,then we can simply return its list of actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are at the top level of the hierarchy, the list alone is fine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are lower down, then we are also within a state, so we need to add the action for the state we’re in to the list we return. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fortunately, this algorithm is at least as difficult to explain as it is to implement.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To see how and why it works, let’s work through an example. </p>
<span origfont="g_font_8" data-canvas-width="53.09543424" style="left: 122.615px; top: 645.055px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.948133); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="368.9350031999999" style="left: 122.615px; top: 671.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.999824); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Examples </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.19 shows a hierarchical state machine that we will use as an example. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To clarify the actions returned for each example, we will say S-entry is the set of entry actions for state S and similarly S-active and S-exit for active and exit actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In transitions, we use the same format: 1-actions for the actions associated with transition 1. </p>
<span origfont="g_font_7" data-canvas-width="317.49092632799994" style="left: 122.615px; top: 715.094px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02087); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">State LState AState C 2State M 4 157H*State B 3State N 6 </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.19 </span><span origfont="g_font_7" data-canvas-width="441.1558831199998" style="left: 127.416px; top: 383.916px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.993594); border-left: none;" yquantized="380" class="highlight2"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.1558831199998" style="left: 127.416px; top: 383.916px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993594); border-left: none;" yquantized="380" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Hierarchical state machine exampleThese examples can appear confusing if you skim through them.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you’re having trouble with the algorithm, we urge you to follow through step by step with both the diagram above and the pseudo-code from the next section. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Suppose we start just in State L, and no transition triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We will transition into State [L,A], because L’s initial state is A.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The update function will return L-active and A-entry, because we are staying in L and just entering A. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Now suppose transition 1 is the only one that triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The top-level state machine will detect no valid transitions, so it will call state machine L to see if it has any.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> L finds that its current state (A)hasatriggeredtransition.Transition1isatransitionatthecurrentlevel,soitishandledwithinL and not passed anywhere.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A transitions to B, and L’s update function returns A-exit, 1-actions,B-entry.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The top-level state machine accepts these actions and adds its own active action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because we have stayed in State L throughout, the final set of actions is A-exit, 1-actions, B-entry, L-active. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The current state is [L, B]. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">From this state,transition 4 triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The top-level state machine sees that transition 4 triggers, and because it is a top-level transition it can be honored immediately.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The transition leads toState M, and the corresponding actions are L-exit, 4-actions, M-entry.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The current state is [M]. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Note that L is still keeping a record of being in State B, but because the top-level state machine is in State M, this record isn’t used at the moment. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll go from State M to State N in the normal way through transition 5.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The procedure is exactly the same as for the previous example and the non-hierarchical state machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now transition 6 triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because it is a level zero transition, the top-level state machine can honor it immediately.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It transitions into State L and returns the actions N-exit,6-actions,L-entry.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But nowL’s record of being in State B is important; we end up in State [L, B] again.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our implementation we don’t return the B-entry action,because we didn’t return the B-exit action when we left State L </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">previously.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a personal preference on our part and isn’t fixed in stone.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you want to exit and reenter State B, then you can modify your algorithm to return these extra actions at the appropriate time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Now suppose from State [L, B] transition 3 triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The top-level state machine finds no triggers, so it will call state machine L to see if it has any.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> L finds that State B has a triggered transition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This transition has a level of one; its target is one level higher in the hierarchy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This means that State B is being exited, and it means that we can’t honor the transition at this level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We return B-exit, along with the uncompleted transition, and the level minus one (i.e., zero, indicating that the next level up needs to handle the transition).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, control returns to the top-level update function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It sees that L returned an outstanding transition, with zero level, so it honors it, transitioning in the normal way to State N.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It combines the actions thatL returned (namely, B-exit) with the normal transition actions to give a final set of actions:B-exit, L-exit, 3-actions, N-entry.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Note that, unlike in our third example, L is no longer keeping track of the fact that it is in State B, because we transitioned out of that state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we fire transi- tion 6 to return to State L, then State L’s initial state (A) would be entered, just like in the first example. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our final example covers transitions with level less than zero.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Suppose we moved from State N to State M via transition 7.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now we make transition 2 trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The top-level state machine looks at its current state (M) and finds transition 2 triggered.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It has a level of minus one, because it is descending one level in the hierarchy.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Because it has a level of minus one, the state machine calls the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">updateDown </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">function to perform the recursive transition.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">updateDown </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function starts at the state machine (L) that contains the final target state (C), asking it to perform the tran- sition at its level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> State machine L, in turn, asks the top-level state machine to perform the transition at its level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The top-level state machine changes from State M to State L, returningM-exit, L-entry as the appropriate actions.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Control returns to state machine L’s </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">updateDown </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">func- tion.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> State machine L checks if it is currently in any state (it isn’t, since we left State B in the last example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It adds its action (C-entry) to those returned by the top-level machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Con- trol then returns to the top-level state machine’s update function: the descending transition has been honored; it adds the transition’s actions to the result and returns M-exit, C-entry, L-entry, 2-actions. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">If state machine L had still been in State B, then when L’s </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">updateDown </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function was called it would transition out of B and into C.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It would add B-exit and C-entry to the actions that it received from the top-level state machine. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 122.615px; top: 598.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="590" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.6223134399999" style="left: 122.615px; top: 628.713px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.08166); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The hierarchical state machine implementation is made up of five classes and forms one of the longest algorithms in this book.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">State </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Transition </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">classes are similar to those in the regular finite state machine.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">HierarchicalStateMachine </span>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">class runs state transitions, and </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">SubMachineState </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">combines the functionality of the state machine and a state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It is used for state machines that aren’t at the top level of the hierarchy.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> All classes but </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Transition </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">inherit from a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">HSMBase </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">class, which simplifies the algorithm by allowing functions to treat anything in the hierarchy in the same way. </p>
<span origfont="g_font_7" data-canvas-width="125.51202283200001" style="left: 122.616px; top: 715.107px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0023); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">HSMBase </span>
<span origfont="g_font_35" data-canvas-width="75.31775999999999" style="left: 137.39px; top: 128.004px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">has the following form: </p>
<span origfont="g_font_35" data-canvas-width="75.31775999999999" style="left: 137.39px; top: 128.004px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class HSMBase: </p><span origfont="g_font_7" style="left: 112.524px; top: 145.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># The structure returned by update struct UpdateResult: </p><span origfont="g_font_7" style="left: 112.524px; top: 174.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 189.14px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">actions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">transition </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 217.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">level </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def getAction(): return [] </p><span origfont="g_font_7" style="left: 112.524px; top: 246.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def update(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 275.54px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 289.94px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">UpdateResult result </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 304.34px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">result.actions = getAction() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 318.74px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">result.transition = None </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result.level = 0 return result </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 347.54px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def getStates() # unimplemented function </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 388.999px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="380" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 17 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 388.999px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="380" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">HierarchicalStateMachine </span>
<span origfont="g_font_7" style="left: 112.524px; top: 424.626px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">class has the following implementation: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 424.626px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 439.026px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class HierarchicalStateMachine (HSMBase): </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # List of states at this level of the hierarchy </p><span origfont="g_font_7" style="left: 112.524px; top: 467.826px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 482.226px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">states </p><span origfont="g_font_7" style="left: 112.524px; top: 496.628px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># The initial state for when the machine has no # current state. </p><span origfont="g_font_7" style="left: 112.524px; top: 511.028px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="510" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 525.428px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 112.524px; top: 539.828px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">initialState </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 554.228px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># The current state of the machine. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 568.628px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="560" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 583.028px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentState = initialState </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 597.428px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Gets the current state stack def getStates(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 626.228px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if currentState: return currentState.getStates() else: return [] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 655.028px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="650" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 669.428px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 18 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Recursively updates the machine. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 683.827px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="680" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 698.227px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def update(): </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # If we’re in no state, use the initial state </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 21 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">if not currentState: </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">currentState = initialState </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 143.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="140" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return currentState.getEntryAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Try to find a transition in the current state triggeredTransition = None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for transition in currentState.getTransitions(): if transition.isTriggered(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 30 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">triggeredTransition = transition </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 31 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">break </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 33 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># If we’ve found one, make a result structure for it if triggeredTransition: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 34 35 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result = UpdateResult() result.actions = [] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 36 37 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result.transition = triggeredTransition result.level = triggeredTransition.getLevel() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 38 39 40 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Otherwise recurse down for a result </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">else: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 42 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 402.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result = currentState.update() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 43 44 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check if the result contains a transition if result.transition: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 45 46 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Act based on its level </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 47 48 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if result.level == 0: </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 49 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Its on our level: honor it </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 50 51 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">targetState = result.transition.getTargetState() result.actions += currentState.getExitAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 52 53 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result.actions += result.transition.getAction() result.actions += targetState.getEntryAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 589.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 54 55 56 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 604.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Set our current state </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 57 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 618.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentState = targetState </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 58 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Add our normal action (we may be a state) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 647.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 59 60 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 661.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result.actions += getAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 676.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 61 62 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Clear the transition, so nobody else does it result.transition = None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 704.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 63 64 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> else if result.level &gt; 0: </p></pre>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">66 67 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Its destined for a higher level </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 68 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Exit our current state result.actions += currentState.getExitAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 69 70 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentState = None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 71 72 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Decrease the number of levels to go result.level -= 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 73 74 75 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 76 77 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># It needs to be passed down targetState = result.transition.getTargetState() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 78 79 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">targetMachine = targetState.parent result.actions += result.transition.getAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 80 81 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result.actions += targetMachine.updateDown( targetState, -result.level </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 82 83 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 84 85 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Clear the transition, so nobody else does it </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 86 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 402.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result.transition = None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 87 88 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># If we didn’t get a transition else: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 89 90 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We can simply do our normal action </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 91 92 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result.action += getAction() </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 93 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Return the accumulated result </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 94 95 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 532.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return result </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 96 97 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Recurses up the parent hierarchy, transitioning into # each state in turn for the given number of levels </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 98 99 </span><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 106.785px; top: 589.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def updateDown(state, level): </p><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 106.785px; top: 604.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 100 101 </span><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 106.785px; top: 618.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># If we’re not at top level, continue recursing </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 102 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if level &gt; 0: # Pass ourself as the transition state to our parent </p><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 106.785px; top: 647.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 103 104 </span><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 106.785px; top: 661.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions = parent.updateDown(this, level-1) </p><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 106.785px; top: 676.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 105 106 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Otherwise we have no actions to add to else: actions = [] </p><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 106.785px; top: 704.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 107 108 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # If we have a current state, exit it </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">if currentState: </p>
<span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 119.985px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.980547); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 119.985px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(1.00593); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 110 111 </span><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 119.985px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.980547); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions += currentState.getExitAction() </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 112 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Move to the new state, and return all the actions </p><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 119.985px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.980547); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 113 114 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentState = state actions += state.getEntryAction() </p><span origfont="g_font_7" data-canvas-width="8.607686399999999" style="left: 119.985px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.980547); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 115 116 </span><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 217.201px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="210" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">return actions </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 217.201px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="210" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">State </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">class is substantially the same as before,but adds an implementation for </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getStates </span>
<span origfont="g_font_7" style="left: 125.724px; top: 257.612px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 257.612px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 272.012px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class State (HSMBase): </p><span origfont="g_font_7" style="left: 125.724px; top: 286.412px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getStates(): # If we’re just a state, then the stack is just us </p><span origfont="g_font_7" style="left: 125.724px; top: 315.212px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 329.612px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return [this] </p><span origfont="g_font_7" style="left: 125.724px; top: 344.012px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># As before... </p><span origfont="g_font_7" style="left: 125.724px; top: 358.412px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getAction() def getEntryAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 387.212px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getExitAction() def getTransitions() </p><span origfont="g_font_7" data-canvas-width="64.036404768" style="left: 140.615px; top: 433.453px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02913); border-left: none;" yquantized="430" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 11 </p></pre>
<span origfont="g_font_7" data-canvas-width="64.036404768" style="left: 140.615px; top: 433.453px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02913); border-left: none;" yquantized="430" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Similarly, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Transition </span>
<span origfont="g_font_7" style="left: 125.724px; top: 485.369px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">class is the same but adds a method to retrieve the level of the transition: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 485.369px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 499.769px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class Transition: </p><span origfont="g_font_7" style="left: 125.724px; top: 514.169px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="510" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 528.569px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Returns the difference in levels of the hierarchy from </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># the source to the target of the transition. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def getLevel() </p><span origfont="g_font_7" style="left: 125.724px; top: 557.369px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # As before... </p><span origfont="g_font_7" style="left: 125.724px; top: 571.769px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 586.169px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="580" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def isTriggered() def getTargetState() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 614.969px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="52.039441847999996" style="left: 140.615px; top: 646.81px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.996467); border-left: none;" yquantized="640" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def getAction() </p></pre>
<span origfont="g_font_7" data-canvas-width="52.039441847999996" style="left: 140.615px; top: 646.81px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.996467); border-left: none;" yquantized="640" class="highlight2"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Finally, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">SubMachineState </span>
<span origfont="g_font_7" style="left: 125.724px; top: 686.024px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight2" markup="codeBlock4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">class merges the functionality of a state and a state machine: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 686.024px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight2" markup="codeBlock4"></span>
<pre markupfor="codeBlock4" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 700.424px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight4" markup="codeBlock4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class SubMachineState (State, HierarchicalStateMachine): </p><span origfont="g_font_7" style="left: 125.724px; top: 714.824px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight2" markup="codeBlock4"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Route get action to the state </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">def getAction(): return State::getAction() </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Route update to the state machine def update(): return HierarchicalStateMachine::update() </p><span origfont="g_font_7" style="left: 112.524px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We get states by adding ourself to our active children </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getStates(): if currentState: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">return [this] + currentState.getStates() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">else: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 </span><span origfont="g_font_13" data-canvas-width="134.11725926399998" style="left: 109.415px; top: 282.385px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.06442); border-left: none;" yquantized="280" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">return [this] </p></pre>
<span origfont="g_font_13" data-canvas-width="134.11725926399998" style="left: 109.415px; top: 282.385px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06442); border-left: none;" yquantized="280" class="highlight4"></span>
<span origfont="g_font_7" data-canvas-width="217.452873192" style="left: 109.176px; top: 312.829px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01593); border-left: none;" yquantized="310" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Implementation Notes </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">We’ve used multiple inheritance to implement </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">SubMachineState </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> For languages (or programmers) that don’t support multiple inheritance,there are two options.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">SubMachineState </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">could encap- sulate </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">HierarchicalStateMachine </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">, or the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">HierarchicalStateMachine </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">can be converted so that it is a sub-class of </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The downside with the latter approach is that the top-level state machine will always return its active action from the update function, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getStates </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">will always have it as the head of the list. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve elected to use a polymorphic structure for the state machine again.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is possible to implement the same algorithm without any polymorphic method calls.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Given that it is complex enough already, however, we’ll leave that as an exercise.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our experience deploying a hierarchical state machine involved an implementation using polymorphic method calls (provided on the website).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In-game profiling on both PC and PS2 showed that the method call overhead was not a bottleneck in the algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a system with hundreds or thousands of states, it may well be, as cache efficiency issues come into play. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some implementations of hierarchical state machines are significantly simpler than this by making it a requirement that transitions can only occur between states at the same level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With this requirement, all the recursion code can be eliminated.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you don’t need cross-hierarchy transitions, then the simpler version will be easier to implement.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is unlikely to be any faster, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because the recursion isn’t used when the transition is at the same level, the code above will run about as fast if all the transitions have a zero level. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 612.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="610" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="96.92015784000002" style="left: 109.415px; top: 643.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04215); border-left: none;" yquantized="640" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in memory, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of layers in the hierarchy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It requires temporary storage for actions when it recurses down and up the hierarchy. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Similarly,it is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nt </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time,where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">t </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of transitions per state.  </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To find the correct transition to fire, it potentially needs to search each transition at each level of the hierarchy and </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> &lt;&gt; </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nt </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) process.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The recursion, both for a transition level0 and for a level0isO( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">), so it does not affect the O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nt </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) for the whole algorithm. </p>
<span origfont="g_font_7" data-canvas-width="123.51551779200001" style="left: 199.951px; top: 715.082px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02079); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Following hierarchical state machines, especially when they involve transitions across hierarchies, can be confusing at first.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve tried to be as apologetic as possible for the complexity of the algorithm, even though we’ve made it as simple as we can.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Nonetheless, it is a powerful technique to have in your arsenal and worth the effort to master. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Hierarchical State Machine program that is available on the webiste lets you step through a state machine, triggering any transition at each step.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It works in the same way as the StateMachine program,giving you plenty of feedback on transitions.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> We hope it will help give a clearer </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">picture, alongside the content of this chapter. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 97.5154px; top: 273.287px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94441); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.3.10 </span>
<span origfont="g_font_7" data-canvas-width="459.0479157120001" style="left: 122.615px; top: 306.625px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02466); border-left: none;" yquantized="300" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Combining Decision Trees and State Machines </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The implementation of transitions bears more than a passing resemblance to the implementation of decision trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is no coincidence, but we can take it even further. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decision trees are an efficient way of matching a series of conditions, and this has application in state machines for matching transitions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can combine the two approaches by replacing transitions from a state with a decision tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The leaves of the tree, rather than being actions as before, are transitions to new states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A simple state machine might look like Figure 5.20. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The diamond symbol is also part of the UML state chart diagram format, representing a decision.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In UML there is no differentiation between decisions and transitions, and the decisions themselves are usually not labeled. </p>
<span origfont="g_font_25" data-canvas-width="51.446400000000004" style="left: 465.55px; top: 512.01px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02893); border-left: 50px solid blue;" yquantized="510" class="highlight3" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_25" data-canvas-width="51.446400000000004" style="left: 465.55px; top: 512.01px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02893); border-left: 50px solid blue;" yquantized="510" class="highlight3" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_25" data-canvas-width="35.7504" style="left: 299.47px; top: 558.205px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02144); border-left: 50px solid blue;" yquantized="550" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Raise alarmCan seePlayer the player? </p><p origfont="g_font_25" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Alertnearby? </p><span origfont="g_font_25" data-canvas-width="20.5344" style="left: 411.55px; top: 620.596px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.972331); border-left: 50px solid blue;" yquantized="620" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_25" data-canvas-width="30.662399999999998" style="left: 473.345px; top: 642.81px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02208); border-left: 50px solid blue;" yquantized="640" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;"> [No] [Yes] [Yes]Defend </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.20 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">State machine with decision tree transitions </p></pre>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Raise alarm [Player in sight AND player is far away]AlertDefend [Player in sight AND player is close by] </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.21 </span><span origfont="g_font_7" data-canvas-width="440.9311268640001" style="left: 127.416px; top: 301.034px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02542); border-left: none;" yquantized="300" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="440.9311268640001" style="left: 127.416px; top: 301.034px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02542); border-left: none;" yquantized="300" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State machine without decision tree transitionsIn this book we’ve labeled the decisions with the test that they perform, which is clearer for our needs. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When in the "Alert" state, a sentry has only one possible transition: via the decision tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It quickly ascertains whether the sentry can see the player.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the sentry is not able to see the player, then the transition ends and no new state is reached.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the sentry is able to see the player, then the decision tree makes a choice based on the distance of the player.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Depending on the result of this choice, two different states may be reached:"Raise Alarm"or"Defend." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">"The latter can only be reached if a further test (distance to the player) passes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To implement the same state machine without the decision nodes, the state machine inFigure 5.21 would be required.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Note that now we have two very complex conditions and both have to evaluate the same information (distance to the player and distance to the alarm point).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the condition involved a time-consuming algorithm (such as the line of sight test in our example), then the decision tree implementation would be significantly faster. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 109.415px; top: 509.675px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="500" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="439.33033629600004" style="left: 109.176px; top: 540.118px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01139); border-left: none;" yquantized="540" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">We can incorporate a decision tree into the state machine framework we’ve developed so far. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The decision tree, as before, consists of </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">DecisionTreeNode </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">s.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> These may be decisions (using the same </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Decision </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">class as before) or </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">TargetState </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">s (which replace the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">class in the basic decision tree). </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">TargetState </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">s hold the state to transition to and can contain actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As before, if a branch of the decision tree should lead to no result, then we can have some null value at the leaf of the tree. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 644.854px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="left: 112.524px; top: 644.854px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 659.254px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class TargetState (DecisionTreeNode): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 673.654px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">getAction() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="343.38691176000003" style="left: 127.415px; top: 700.712px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02504); border-left: none;" yquantized="700" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">getTargetState() </p></pre>
<span origfont="g_font_7" data-canvas-width="343.38691176000003" style="left: 127.415px; top: 700.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02504); border-left: none;" yquantized="700" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The decision making algorithm needs to change.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Rather than testing for </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Action </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">s to return, it now tests for </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">TargetState </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">instances: </p>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">1 </span><span origfont="g_font_7" style="left: 125.724px; top: 114.3px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def makeDecision(node): </p><span origfont="g_font_7" style="left: 125.724px; top: 128.7px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check if we need to make a decision if not node or node is_instance_of TargetState: </p><span origfont="g_font_7" style="left: 125.724px; top: 157.5px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We’ve got the target (or a null target); return it </p><span origfont="g_font_7" style="left: 125.724px; top: 186.3px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 125.724px; top: 200.7px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return node </p><span origfont="g_font_7" style="left: 125.724px; top: 215.1px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.5px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">else: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 243.9px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Make the decision and recurse based on the result </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.3px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if node.test(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return makeDecision(node.trueNode) else </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.1px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="208.00115531999998" style="left: 140.376px; top: 315.355px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02442); border-left: none;" yquantized="310" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">return makeDecision(node.falseNode) </p></pre>
<span origfont="g_font_7" data-canvas-width="208.00115531999998" style="left: 140.376px; top: 315.355px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02442); border-left: none;" yquantized="310" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">We can then build an implementation of the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Transition </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">interface that supports these decision trees.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 366.579px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="360" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> It has the following algorithm: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 366.579px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="360" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 380.979px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class DecisionTreeTransition (Transition): </p><span origfont="g_font_7" style="left: 125.724px; top: 395.379px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 409.779px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Holds the target state at the end of the decision </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 424.179px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># tree, when a decision has been made </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 438.579px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">targetState = None </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Holds the root decision in the tree </p><span origfont="g_font_7" style="left: 125.724px; top: 467.379px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 125.724px; top: 481.779px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">decisionTreeRoot </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 496.179px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getAction(): if targetState: return targetState.getAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 524.979px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 539.379px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else: return None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 553.779px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="550" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 568.179px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def getTargetState(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if targetState: return targetState.getTargetState() else: return None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 596.979px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def isTriggered(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 625.779px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Get the result of the decision tree and store it </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 654.579px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 668.979px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">targetState = makeDecision(decisionTreeRoot) </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Return true if the target state points to a </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 697.778px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># destination, otherwise assume that we don’t trigger return targetState != None </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 25 </p></pre>
</html></html><html><html><p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;">5.4 </p>
<span origfont="g_font_7" data-canvas-width="333.88378687200003" style="left: 109.415px; top: 129.701px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02418); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Behavior Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Behavior trees have become a popular tool for creating AI characters. </p>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Halo 2 </span>
<span origfont="g_font_7" data-canvas-width="459.03237405600015" style="left: 109.427px; top: 144.095px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.991431); border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span>
<span origfont="g_font_7" data-canvas-width="279.563308128" style="left: 109.427px; top: 158.489px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00925); border-left: none;" yquantized="150" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">[Bungie Software, 2004] was one of the first high-profile games for which the use of behavior trees was described in detail and since then many more games have followed suit. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">They are a synthesis of a number of techniques that have been around in AI for a while:Hierarchical State Machines, Scheduling, Planning, and Action Execution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Their strength comes from their ability to interleave these concerns in a way that is easy to understand and easy for non-programmers to create.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Despite their growing ubiquity, however, there are things that are difficult to do well in behavior trees, and they aren’t always a good solution for decision making. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Behavior trees have a lot in common with Hierarchical State Machines but, instead of a state, the main building block of a behavior tree is a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">task </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A task can be something as simple as looking up the value of a variable in the game state, or executing an animation. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tasks are composed into sub-trees to represent more complex actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In turn, these complex actionscanagainbecomposedintohigherlevelbehaviors.Itisthiscomposabilitythatgivesbehav- ior trees their power.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because all tasks have a common interface and are largely self-contained, they can be easily built up into hierarchies (i.e., behavior trees) without having to worry about the details of how each sub-task in the hierarchy is implemented. </p>
<span origfont="g_font_13" data-canvas-width="79.43513088" style="left: 109.415px; top: 396.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.980712); border-left: none;" yquantized="390" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.01683239999977" style="left: 109.415px; top: 427.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0288); border-left: none;" yquantized="420" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Types of Task </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tasks in a behavior tree all have the same basic structure.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> They are given some CPU time to do their thing, and when they are ready they return with a status code indicating either success or failure (a Boolean value would suffice at this stage).  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Some developers use a larger set of return values, including an </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">error </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">status, when something unexpected went wrong, or a </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">need more time </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> status for integration with a scheduling system. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">While tasks of all kinds can contain arbitrarily complex code,the most flexibility is provided if each task can be broken into the smallest parts that can usefully be composed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is especially so because, while powerful just as a programming idiom, behavior trees really shine when coupled with a graphical user interface (GUI) to edit the trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> That way, designers, technical artists and level designers can potentially author complex AI behavior. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At this stage,our simple behavior trees will consist of three kinds of tasks:Conditions,Actions, and Composites. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Conditions test some property of the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There can be tests for proximity (is the character within X units of an enemy?), tests for line of sight, tests on the state of the character (am I healthy?, do I have ammo?), and so on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each of these kinds of tests needs to be implemented as a separate task, usually with some parameterization so they can be easily reused.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each Condition returns the success status code if the Condition is met and returns failure otherwise. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions alter the state of the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There can be Actions for animation, for character move- ment,tochangetheinternalstateof thecharacter(restingraiseshealth,forexample),toplayaudio samples, to engage the player in dialog, and to engage specialized AI code (such as pathfinding). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Just like Conditions, each Action will need to have its own implementation, and there may be a </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">large number of them in your engine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most of the time Actions will succeed (if there’s a chance they might not, it is better to use Conditions to check for that before the character starts trying to act).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is possible to write Actions that fail if they can’t complete, however. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If Conditions and Actions seem familiar from our previous discussion on decision trees and state machines, they should.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They occupy a similar role in each technique (and we’ll see more techniques with the same features later in this chapter).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The key difference in behavior trees, however, is the use of a single common interface for all tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This means that arbitraryConditions,Actions, and groups can be combined together without any of them needing to know what else is in the behavior tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Both Conditions and Actions sit at the leaf nodes of the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most of the branches are made up of Composite nodes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As the name suggests, these keep track of a collection of child tasks (Conditions, Actions, or other Composites), and their behavior is based on the behavior of their children.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unlike Actions and Conditions, there are normally only a handful of Composite tasks because with only a handful of different grouping behaviors we can build very sophisticated behaviors. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For our simple behavior tree we’ll consider two types of Composite tasks: Selector andSequence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Both of these run each of their child behaviors in turn.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a child behavior is complete and returns its status code the Composite decides whether to continue through its children or whether to stop there and then and return a value. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Selector will return immediately with a success status code when one of its children runs successfully.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As long as its children are failing, it will keep on trying.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it runs out of children completely, it will return a failure status code. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Sequence will return immediately with a failure status code when one of its children fails. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As long as its children are succeeding, it will keep going.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it runs out of children, it will return in success. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Selectors are used to choose the first of a set of possible actions that is successful.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A Selector might represent a character wanting to reach safety.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There may be multiple ways to do that (take cover, leave a dangerous area, find backup).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Selector will first try to take cover; if that fails, it will leave the area.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If that succeeds, it will stop—there’s no point also finding backup, as we’ve solved the character’s goal of reaching safety.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we exhaust all options without success, then theSelector itself has failed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Selector task is depicted graphically in Figure 5.22.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> First the Selector tries a task representing attacking the player; if it succeeds, it is done.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the attack task fails, the Selector node will go on to try a taunting animation instead.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As a final fall back, if all else fails, the character can just stare menacingly. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Sequences represent a series of tasks that need to be undertaken.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each of our reaching-safety actions in the previous example may consist of a Sequence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To find cover we’ll need to choose a cover point, move to it, and, when we’re in range, play a roll animation to arrive behind it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If any of the steps in the sequence fails, then the whole sequence has failed: if we can’t reach our desired cover point, then we haven’t reached safety.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Only if all the tasks in the Sequence are successful can we consider the Sequence as a whole to be successful. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.23 shows a simple example of using a Sequence node.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this behavior tree the first child task is a condition that checks if there is a visible enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the first child task fails, then theSequence task will also immediately fail.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the first child task succeeds then we know there is a </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;">Attack            Taunt             Stare </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.22 </p><span origfont="g_font_26" data-canvas-width="29.971199999999996" style="left: 265.818px; top: 351.401px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03349); border-left: 50px solid blue;" yquantized="350" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Example of a selector node in a behavior tree </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">EnemyTurnRun visible? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 404.839px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="400" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">awayaway </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.23 </span><span origfont="g_font_7" data-canvas-width="459.3958097039999" style="left: 109.412px; top: 446.957px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.9934); border-left: none;" yquantized="440" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="459.3958097039999" style="left: 109.412px; top: 446.957px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.9934); border-left: none;" yquantized="440" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Example of a sequence node in a behavior tree visible enemy, and the Sequence task goes on to execute the next child task, which is to turn away, followed by the running task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Sequence task will then terminate successfully. </p>
<span origfont="g_font_13" data-canvas-width="107.92676352000001" style="left: 109.128px; top: 497.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.999322); border-left: none;" yquantized="490" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.13160155200006" style="left: 109.176px; top: 527.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03166); border-left: none;" yquantized="520" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Simple Example </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can use the tasks in the previous example to build a simple but powerful behavior tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The behavior tree in this example represents an enemy character trying to enter the room in which the player is standing. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll build the tree in stages, to emphasize how the tree can be built up and extended.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This process of refining the behavior tree is part of its attraction, as simple behaviors can be roughed in and then refined in response to play testing and additional development resources. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our first stage, Figure 5.24, shows a behavior tree made up of a single task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a move action, to be carried out using whatever steering system our engine provides. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To run this task we give it CPU time, and it moves into the room.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This was state-of-the-artAI for entering rooms before Half-Life, of course, but wouldn’t go down well in a shooter now! </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The simple example does make a point, however.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> When you’re developing your AI using behavior trees, just a single naive behavior is all you need to get </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">something </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">working. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our case, the enemy is too stupid: the player can simply close the door and confound the incoming enemy. </p>
<span origfont="g_font_7" data-canvas-width="82.02407831999999" style="left: 109.403px; top: 715.033px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02244); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;">Move (into room) </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.24 </p><span origfont="g_font_26" style="left: 310.001px; top: 232.909px; font-size: 14.4px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="230" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;">The simplest behavior tree </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;"> ? </p><span origfont="g_font_26" data-canvas-width="20.8032" style="left: 196.403px; top: 349.874px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04016); border-left: 50px solid blue;" yquantized="340" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">DoorMoveMoveOpenMove open? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 403.313px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="400" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">(into room)(to door)door(into room) </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.25 </span><span origfont="g_font_7" data-canvas-width="441.1152357119999" style="left: 140.615px; top: 441.51px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.995745); border-left: none;" yquantized="440" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.1152357119999" style="left: 140.615px; top: 441.51px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.995745); border-left: none;" yquantized="440" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A behavior tree with composite nodesSo, we’ll need to make the tree a little more complex.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In Figure 5.25, the behavior tree is made up of a Selector, which has two different things it can try, each of which is a Sequence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the first case, it checks to see if the door is open, using a Condition task; then it moves into the room.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the second case, it moves to the door, plays an animation, opens the door, and then moves into the room. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Let’s think about how this behavior tree is run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Imagine the door is open.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When it is givenCPU time, the Selector tries its first child.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> That child is made up of the Sequence task for moving through the open door.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Condition checks if the door is open.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is, so it returns success.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, the Sequence task moves on to its next child—moving through the door.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This, like most actions, always succeeds, so the whole of the Sequence has been successful.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Back at the top level, theSelector has received a success status code from the first child it tried, so it doesn’t both trying its other child: it immediately returns in success. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whathappenswhenthedoorisclosed?AsbeforetheSelectortriesitsfirstchild.ThatSequence tries the Condition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This time, however, the Condition task fails.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Sequence doesn’t bother continuing; one failure is enough, so it returns in failure.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At the top level, the Selector isn’t fazed by a failure; it just moves onto its next child.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, the character moves to the door, opens it, then enters. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Thisexampleshowsanimportantfeatureof behaviortrees:aConditiontaskinaSequenceacts like an IF-statement in a programming language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the Condition is not met, then the Sequence will not proceed beyond that point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the Sequence is in turn placed within a Selector, then we </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">get the effect of IF-ELSE-statements: the second child is only tried if the Condition wasn’t met for the first child.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 145.809px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> In pseudo-code the behavior of this tree is: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 145.809px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if is_locked(door): move_to(door) </p><span origfont="g_font_7" style="left: 112.524px; top: 174.609px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 189.009px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">open(door) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">move_to(room) else: </p><span origfont="g_font_7" style="left: 112.524px; top: 217.809px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" data-canvas-width="441.04828704000005" style="left: 127.415px; top: 244.868px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05514); border-left: none;" yquantized="240" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">move_to(room) </p></pre>
<span origfont="g_font_7" data-canvas-width="441.04828704000005" style="left: 127.415px; top: 244.868px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05514); border-left: none;" yquantized="240" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The pseudo-code and diagram show that we’re using the final move action in both cases. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There’s nothing wrong with this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Later on in the section we’ll look at how to reuse existing sub- trees efficiently.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 323.564px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> For now it is worth saying that we could refactor our behavior tree to be more like the simpler pseudo-code: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 323.564px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 337.964px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if is_locked(door): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">move_to(door) open(door) </p><span origfont="g_font_7" style="left: 112.524px; top: 366.764px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="360" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" data-canvas-width="440.93710442399987" style="left: 127.415px; top: 393.823px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0574); border-left: none;" yquantized="390" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">move_to(room) </p></pre>
<span origfont="g_font_7" data-canvas-width="440.93710442399987" style="left: 127.415px; top: 393.823px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0574); border-left: none;" yquantized="390" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The result is shown in Figure 5.26.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Notice that it is deeper than before; we’ve had to add another layer to the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While some people do like to think about behavior trees in terms of source code, it doesn’t necessarily give you any insight in how to create simple or efficient trees. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our final example in this section we’ll deal with the possibility that the player has locked the door.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case, it won’t be enough for the character to just assume that the door can be opened.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Instead, it will need to try the door first.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 5.27 shows a behavior tree for dealing with this situation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Notice that the Condition used to check if the door is locked doesn’t appear at the same point where we check if the door is closed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most people can’t tell if a door is locked just by looking at it, so we want the enemy to go up to the door, try it, and then change behavior if it is locked.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the example, we have the character shoulder charging the door. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We won’t walk through the execution of this behavior tree in detail.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Feel free to step through it yourself and make sure you understand how it would work if the door is open, if it is closed, and if it is locked. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At this stage we can start to see another common feature of behavior trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Often they are made up of alternating layers of Sequences and Selectors.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> As long as the only Composite tasks we have are Sequence and Selector, it will always be possible to write the tree in this way. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">1 </span>
<span origfont="g_font_13" data-canvas-width="7.029628199999999" style="left: 95.1856px; top: 656.811px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.00423); border-left: none;" yquantized="650" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">Even with </p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> 1. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">The reason for this may not immediately be obvious.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> If you think about a tree in which a Selector has another Selector as a child—its behavior will be exactly the same as if the child’s children were inserted in the parent Selector.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> If one of the grandchildren returns in success, then its parent immediately returns in success, and so does the grandparent.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> The same is true for Sequence tasks inside other Sequence tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> This means there is no functional reason for having two levels with the same kind of Composite task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> There may, however, be non-functional reasons for using another grouping such as grouping related tasks together to more clearly understand what the overall tree is trying to achieve. </p>
<span origfont="g_font_7" data-canvas-width="388.992845052" style="left: 109.417px; top: 716.826px; font-size: 13.2702px; font-family: serif; transform: scaleX(0.992329); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_26" style="font-family: sans-serif; font-size: 19.98px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 19.98px; font-style: normal; font-weight: 400;">? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_26" data-canvas-width="20.8032" style="left: 297.676px; top: 243.679px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04016); border-left: 50px solid blue;" yquantized="240" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Door open? </p><span origfont="g_font_26" data-canvas-width="23.472" style="left: 323.538px; top: 301.279px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02052); border-left: 50px solid blue;" yquantized="300" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 354.718px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="350" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">MoveOpen (to door)door </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.26 </span><span origfont="g_font_26" style="left: 323.401px; top: 417.848px; font-size: 14.4px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="410" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;">A more complicated refactored tree </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;"> ? </p><span origfont="g_font_26" data-canvas-width="20.8032" style="left: 194.603px; top: 540.412px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04016); border-left: 50px solid blue;" yquantized="540" class="highlight3" markup="figureBlock"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;">DoorMoveMove </span><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400; display: inline;"> ? </p><span origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> </span><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Move open? </p><span origfont="g_font_26" data-canvas-width="20.8032" style="left: 308.996px; top: 661.208px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04016); border-left: 50px solid blue;" yquantized="660" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">(into room)(to door)(into room)DoorOpenBargeDoor locked? </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">doordooropen? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 714.65px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight2" markup="figureBlock"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.27 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">A behavior tree for a minimally acceptable enemy </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">the other kinds of Composite tasks we’ll see later in the section, Sequence and Selector are still the most common, so this alternating structure is quite common. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’re probably just about at the point where our enemy’s room-entering behavior would be acceptable in a current generation game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There’s plenty more we can do here.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could add additional checks to see if there are windows to smash through.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could add behaviors to allow the character to use grenades to blow the door, we could have it pick up objects to barge the door, and we could have it pretend to leave and lie in wait for the player to emerge. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whatever we end up doing, the process of extending the behavior tree is exactly as we’ve shown it here, leaving the character AI playable at each intermediate stage. </p>
<span origfont="g_font_13" data-canvas-width="222.89753088" style="left: 109.415px; top: 244.886px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02015); border-left: none;" yquantized="240" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="371.685876312" style="left: 109.415px; top: 275.33px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.047); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Behavior Trees and Reactive Planning </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Behavior trees implement a very simple form of planning, sometimes called </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">reactive planning </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Selectors allow the character to try things, and fall back to other behaviors if they fail.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This isn’t a very sophisticated form of planning: the only way characters can think ahead is if you manually add the correct conditions to their behavior tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Nevertheless, even this rudimentary planning can give a good boost to the believability of your characters. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The behavior tree represents all possible Actions that your character can take.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> The route from </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 2 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> the top level to each leaf represents one course of action,and the behavior tree algorithm searches among those courses of action in a left-to-right manner.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In other words, it performs a depth-first search. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is nothing about behavior trees or depth-first reactive planning that is unique, of course; we could do the same thing using other techniques, but typically they are much harder. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The behavior of trying doors and barging through them if they are locked, for example, can be implemented using a finite state machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But most people would find it quite unintuitive to create.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You’d have to encode the fall-back behavior explicitly in the rules for state transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It would be fairly easy to write a script for this particular effect, but we’ll soon see behavior trees that are difficult to turn into scripts without writing lots of infrastructure code to support the way behavior trees naturally work. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 537.807px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="530" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.4.1 </p>
<span origfont="g_font_7" data-canvas-width="458.95705680000003" style="left: 109.415px; top: 571.143px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.08245); border-left: none;" yquantized="570" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementing Behavior Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Behaviortreesaremadeupof independenttasks,eachwithitsownalgorithmandimplementation. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">All of them conform to a basic interface which allows them to call one another without knowing how they are implemented.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this section, we’ll look at a simple implementation based on the tasks we’ve introduced above. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 645.225px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.4.2 </span>
<span origfont="g_font_7" data-canvas-width="458.9451016799999" style="left: 109.415px; top: 678.562px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01303); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Behavior trees are easy to understand at the code level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll begin by looking at a possible base class for a task that all nodes in the tree can inherit from.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The base class specifies a method used </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">to run the task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The method should return a status code showing whether it succeeded or failed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this implementation we will use the simplest approach and use the Boolean values True andFalse.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 178.196px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> The implementation of that method is normally not defined in the base class (i.e., it is a pure virtual function): </p>
<span origfont="g_font_7" style="left: 125.724px; top: 178.196px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class Task: # Holds a list of the children (if any) of this task </p><span origfont="g_font_7" style="left: 125.724px; top: 206.996px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 221.396px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">children </p><span origfont="g_font_7" style="left: 125.724px; top: 235.796px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Always terminates with either success (True) or # failure (False) </p><span origfont="g_font_7" style="left: 125.724px; top: 264.596px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" data-canvas-width="347.45165255999996" style="left: 140.615px; top: 295.24px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00711); border-left: none;" yquantized="290" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">def run() </p></pre>
<span origfont="g_font_7" data-canvas-width="347.45165255999996" style="left: 140.615px; top: 295.24px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00711); border-left: none;" yquantized="290" class="highlight4"></span>
<span origfont="g_font_7" style="left: 125.724px; top: 334.455px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Here is an example of a simple task that asserts there is an enemy nearby: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 334.455px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 348.855px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class EnemyNear (Task): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): if distanceToEnemy &lt; 10: </p><span origfont="g_font_7" style="left: 125.724px; top: 377.655px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 392.055px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return True </p><span origfont="g_font_7" style="left: 125.724px; top: 406.455px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Task failure, there is no enemy nearby return False </p><span origfont="g_font_7" data-canvas-width="307.4354748959999" style="left: 140.376px; top: 451.499px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.018); border-left: none;" yquantized="450" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 7 </p></pre>
<span origfont="g_font_7" data-canvas-width="307.4354748959999" style="left: 140.376px; top: 451.499px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.018); border-left: none;" yquantized="450" class="highlight3"></span>
<span origfont="g_font_35" data-canvas-width="145.25568" style="left: 150.59px; top: 488.375px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Another example of a simple task could be to play an animation: </p>
<span origfont="g_font_35" data-canvas-width="145.25568" style="left: 150.59px; top: 488.375px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class PlayAnimation (Task): </p><span origfont="g_font_7" style="left: 125.724px; top: 506.31px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">animation_id speed </p><span origfont="g_font_7" style="left: 125.724px; top: 535.11px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 549.51px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 563.91px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def Attack(animation_id, loop=False, speed=1.0): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 578.31px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="570" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">this.animation = animation </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 125.724px; top: 592.71px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">this.speed = speed </p><span origfont="g_font_7" style="left: 125.724px; top: 607.11px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): if animationEngine.ready(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 635.91px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="630" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">animationEngine.play(animation, speed) return True </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 664.71px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 679.11px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 14 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Task failure, the animation could not be played. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # The parent node will worry about the consequences </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 707.91px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">return False </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This task is parameterized to play one particular animation, and it checks to see if the animation engine is available before it does so. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Onereasontheanimationenginemightnotbereadyisif itwasalreadybusyplayingadifferent animation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a real game we’d want more control than this over the animation (we could still play a head-movement animation while the character was running, for example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll look at a more comprehensive way to implement resource-checking later in this section. </p>
<span origfont="g_font_35" data-canvas-width="118.35648" style="left: 137.39px; top: 216.796px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">The Selector task can be implemented simply: </p>
<span origfont="g_font_35" data-canvas-width="118.35648" style="left: 137.39px; top: 216.796px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Selector (Task): </p><span origfont="g_font_7" style="left: 112.524px; top: 234.731px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 249.131px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def run(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for c in children: if c.run(): </p><span origfont="g_font_7" style="left: 112.524px; top: 277.931px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 292.331px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="290" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return True </p><span origfont="g_font_7" style="left: 112.524px; top: 306.731px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" data-canvas-width="216.76306276799997" style="left: 127.415px; top: 336.181px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01767); border-left: none;" yquantized="330" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return False </p></pre>
<span origfont="g_font_7" data-canvas-width="216.76306276799997" style="left: 127.415px; top: 336.181px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01767); border-left: none;" yquantized="330" class="highlight4"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 374.2px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The Sequence node is implemented similarly: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 374.2px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 388.6px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Sequence (Task): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): for c in children: </p><span origfont="g_font_7" style="left: 112.524px; top: 417.4px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not c.run(): return False </p><span origfont="g_font_7" style="left: 112.524px; top: 446.2px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> return True </p><span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 506.405px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="500" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;"> 7 </p></pre>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 506.405px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="500" class="highlight3"></span>
<span origfont="g_font_7" data-canvas-width="458.87337096000005" style="left: 109.415px; top: 536.848px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997551); border-left: none;" yquantized="530" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Performance </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The performance of a behavior tree depends on the tasks within it.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> A tree made up of just Selector and Sequence nodes and leaf tasks (Conditions and Actions) that are O(1) in performance and memory will be O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in memory and O(log </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in speed, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of nodes in the tree. </p>
<span origfont="g_font_13" data-canvas-width="134.11725926399998" style="left: 109.415px; top: 627.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06442); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.02400547200006" style="left: 109.415px; top: 657.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0133); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementation Notes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the pseudo-code we’ve used Boolean values to represent the success and failure return values for tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In practice, it is a good idea to use a more flexible return type than Boolean values (an enum in C-based languages is ideal),because you may find yourself needing more than two return values, and it can be a serious drag to work through tens of task class implementations changing the return values. </p>
<span origfont="g_font_7" data-canvas-width="83.238718512" style="left: 109.415px; top: 715.088px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02764); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Non-Deterministic Composite Tasks </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Before we leave Selectors and Sequences for a while, it is worth looking at some simple variations of them that can make your AI more interesting and varied.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The implementations above run each of their children in a strict order.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The order is defined in advance by the person defining the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is necessary in many cases: in our simple example above we absolutely have to check if the door is open before trying to move through it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Swapping that order would look very odd. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Similarly for Selectors, there’s no point trying to barge through the door if it is already open, we need to try the easy and obvious solutions first. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In some cases, however, this can lead to predictable AIs who always try the same things in the same order.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In many Sequences there are some Actions that don’t need to be in a particular order.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If our room-entering enemy decided to smoke the player out, they might need to get matches and gasoline, but it wouldn’t matter in which order as long as both matches and gasoline were in place before they tried to start the fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the player saw this behavior several times, it would be nice if the different characters acting this way didn’t always get the components in the same order. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For Selectors, the situation can be even more obvious.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Let’s say that our enemy guard has five ways to gain entry.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They can walk through the open door, open a closed door, barge through a locked door, smoke the player out, or smash through the window.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We would want the first two of these to always be attempted in order, but if we put the remaining three in a regular Selector then the player would know what type of forced entry is coming first.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the forced entry actions normally worked (e.g., the door couldn’t be reinforced, the fire couldn’t be extinguished, the window couldn’t be barricaded), then the player would never see anything but the first strategy in the list—wasting the AI effort of the tree builder. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">These kinds of constraints are called "partial-order" constraints in the AI literature.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some parts may be strictly ordered, and others can be processed in any order.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To support this in our behavior tree we use variations of Selectors and Sequences that can run their children in a random order. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 538.274px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The simplest would be a Selector that repeatedly tries a single child: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 538.274px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class RandomSelector (Task): children </p><span origfont="g_font_7" style="left: 125.724px; top: 567.074px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): while True: </p><span origfont="g_font_7" style="left: 125.724px; top: 595.874px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">child = random.choice(children) result = child.run() </p><span origfont="g_font_7" style="left: 125.724px; top: 624.674px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 125.724px; top: 639.074px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if result: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><span origfont="g_font_7" data-canvas-width="441.37107527999996" style="left: 140.615px; top: 669.718px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03366); border-left: none;" yquantized="660" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return True </p></pre>
<span origfont="g_font_7" data-canvas-width="441.37107527999996" style="left: 140.615px; top: 669.718px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03366); border-left: none;" yquantized="660" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This gives us randomness but has two problems: it may try the same child more than once, even several times in a row, and it will never give up, even if all its children repeatedly fail.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For these reasons, this simple implementation isn’t widely useful, but it can still be used, especially in combination with the parallel task we’ll meet later in this section. </p>
<span origfont="g_font_7" data-canvas-width="310.574889408" style="left: 122.622px; top: 712.9px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02163); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A better approach would be to walk through all the children in some random order.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can do this for either Selectors or Sequences.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 168.578px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="160" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> Using a suitable random shuffling procedure, we can implement this as: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 168.578px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="160" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 182.978px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class NonDeterministicSelector (Task): </p><span origfont="g_font_7" style="left: 112.524px; top: 197.378px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="190" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 211.778px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">children </p><span origfont="g_font_7" style="left: 112.524px; top: 226.178px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): shuffled = random.shuffle(children) </p><span origfont="g_font_7" style="left: 112.524px; top: 254.978px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 269.378px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">for child in shuffled: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><span origfont="g_font_7" style="left: 112.524px; top: 283.778px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if child.run(): break </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 </span><span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 127.415px; top: 319.204px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="310" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return result </p></pre>
<span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 127.415px; top: 319.204px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="310" class="highlight3"></span>
<span origfont="g_font_35" data-canvas-width="204.43392" style="left: 137.39px; top: 356.772px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> and </p>
<span origfont="g_font_35" data-canvas-width="204.43392" style="left: 137.39px; top: 356.772px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class NonDeterministicSequence (Task): </p><span origfont="g_font_7" style="left: 112.524px; top: 374.708px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 389.108px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 403.508px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">children </p><span origfont="g_font_7" style="left: 112.524px; top: 417.908px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): shuffled = random.shuffle(children) </p><span origfont="g_font_7" style="left: 112.524px; top: 446.708px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for child in shuffled: if not child.run(): break </p><span origfont="g_font_7" style="left: 112.524px; top: 475.508px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="470" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><span origfont="g_font_7" data-canvas-width="440.89047945600015" style="left: 127.415px; top: 510.935px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00024); border-left: none;" yquantized="510" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return result </p></pre>
<span origfont="g_font_7" data-canvas-width="440.89047945600015" style="left: 127.415px; top: 510.935px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00024); border-left: none;" yquantized="510" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In each case, just add a shuffling step before running the children.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This keeps the randomness but guarantees that all the children will be run and that the node will terminate when all the children have been exhausted. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many standard libraries do have a random shuffle routine for their vector or list data types.  </p>
<span origfont="g_font_35" data-canvas-width="118.35647999999999" style="left: 137.39px; top: 608.997px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="600" class="highlight4" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> If yours doesn’t it is fairly easy to implement Durstenfeld’s shuffle algorithm: </p>
<span origfont="g_font_35" data-canvas-width="118.35647999999999" style="left: 137.39px; top: 608.997px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="600" class="highlight4" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def shuffle(original): </p><span origfont="g_font_7" style="left: 112.524px; top: 626.932px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">list = original.copy() n = list.length </p><span origfont="g_font_7" style="left: 112.524px; top: 655.732px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="650" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">whilen&gt;1: k = random.integer_less_than(n) </p><span origfont="g_font_7" style="left: 112.524px; top: 684.532px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 698.932px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">n--; </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">list[n], list[k] = list[k], list[n]btPartia return list </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 8 </p></pre>
</html></html><html><html><p origfont="g_font_26" style="font-family: sans-serif; font-size: 19.98px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 19.98px; font-style: normal; font-weight: 400;">? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_26" data-canvas-width="43.75680000000001" style="left: 169.304px; top: 195.298px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0176); border-left: 50px solid blue;" yquantized="190" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Entering... </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400; display: inline;">Open door... </p><span origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;"> </span><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;">? </p><span origfont="g_font_26" data-canvas-width="55.497600000000006" style="left: 325.036px; top: 258.494px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03791); border-left: 50px solid blue;" yquantized="250" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Barge door... </p><span origfont="g_font_26" data-canvas-width="129.888" style="left: 423.944px; top: 323.064px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.991511); border-left: 50px solid blue;" yquantized="320" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_26" data-canvas-width="54.4224" style="left: 308.764px; top: 386.27px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.00782); border-left: 50px solid blue;" yquantized="380" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 433.902px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="430" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Douse door             Ignite doorGet matchesGet gasoline </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.28 </span><span origfont="g_font_7" data-canvas-width="255.89336604000002" style="left: 140.377px; top: 470.066px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0195); border-left: none;" yquantized="470" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="255.89336604000002" style="left: 140.377px; top: 470.066px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0195); border-left: none;" yquantized="470" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Example behavior tree with partial orderingAn implementation of this is included on the website. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So we have fully ordered Composites, and we have non-deterministic Composites.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To make a partially ordered AI strategy we put them together into a behavior tree.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> Figure 5.28 shows the </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">tree for the previous example: an enemy AI trying to enter a room.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Non-deterministic nodes are shown with a wave in their symbol and are shaded gray. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although the figure only shows the low-level details for the strategy to smoke the player out, each strategy will have a similar form, being made up of fixed-order Composite tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is very common; non-deterministic tasks usually sit within a framework of fixed-order tasks, both above and below. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 616.948px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="610" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.4.3 </p>
<span origfont="g_font_7" data-canvas-width="459.1746399839999" style="left: 122.615px; top: 650.285px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00476); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decorators </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we’ve met three families of tasks in a behavior tree: Conditions, Actions, and Composites. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is a fourth that is significant: Decorators. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The name "decorator" is taken from object-oriented software engineering.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The decorator pattern refers to a class that wraps another class, modifying its behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the decorator has the same interface as the class it wraps, then the rest of the software doesn’t need to know if it is </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the context of a behavior tree, a Decorator is a type of task that has one single child task and modifies its behavior in some way.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You could think of it like a Composite task with a single child.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unlike the handful of Composite tasks we’ll meet, however, there are many different types of useful Decorators. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">One simple and very common category of Decorators makes a decision whether to allow their child behavior to run or not (they are sometimes called"filters").  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If they allow the child behavior to run, then whatever status code it returns is used as the result of the filter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If they don’t allow the child behavior to run, then they normally return in failure, so a Selector can choose an alternative action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are several standard filters that are useful.  </p>
<span origfont="g_font_35" data-canvas-width="123.73632" style="left: 137.39px; top: 269.112px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="260" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> For example, we can limit the number of times a task can be run: </p>
<span origfont="g_font_35" data-canvas-width="123.73632" style="left: 137.39px; top: 269.112px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="260" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Limit (Decorator) </p><span origfont="g_font_7" style="left: 112.524px; top: 287.048px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">runLimit runSoFar = 0 </p><span origfont="g_font_7" style="left: 112.524px; top: 315.848px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def run(): </p><span origfont="g_font_7" style="left: 112.524px; top: 344.648px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 359.048px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if runSoFar &gt;= runLimit: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 373.448px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return False </p><span origfont="g_font_7" style="left: 112.524px; top: 387.848px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">runSoFar++ return child.run() </p><span origfont="g_font_7" data-canvas-width="459.20572329600003" style="left: 109.415px; top: 429.305px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0423); border-left: none;" yquantized="420" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 10 </p></pre>
<span origfont="g_font_7" data-canvas-width="459.20572329600003" style="left: 109.415px; top: 429.305px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0423); border-left: none;" yquantized="420" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> which could be used to make sure that a character doesn’t keep trying to barge through a door that the player has reinforced. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 493.734px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">We can use a Decorator to keep running a task until it fails: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 493.734px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 508.134px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class UntilFail (Decorator): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): while True: </p><span origfont="g_font_7" style="left: 112.524px; top: 536.934px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 551.334px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result = child.run() </p><span origfont="g_font_7" style="left: 112.524px; top: 565.734px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 580.134px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not result: break </p><span origfont="g_font_7" style="left: 112.524px; top: 594.534px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" data-canvas-width="441.21326769599995" style="left: 127.176px; top: 621.593px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0504); border-left: none;" yquantized="620" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return True </p></pre>
<span origfont="g_font_7" data-canvas-width="441.21326769599995" style="left: 127.176px; top: 621.593px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0504); border-left: none;" yquantized="620" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can combine this Decorator with other tasks to build up a behavior tree like the one inFigure 5.29.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 686.021px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> The code to create this behavior tree will be a sequence of calls to the task constructors that will look something like: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 686.021px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">ex = Selector(Sequence(Visible,UntilFail(Sequence(Conscious, </p><span origfont="g_font_7" style="left: 112.524px; top: 714.821px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">Hit, </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">Pause, </p>
<span origfont="g_font_7" style="left: 125.724px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 125.724px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">Hit)), </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">Restrain),Selector(Sequence(Audible, </p><span origfont="g_font_7" style="left: 125.724px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">Creep),Move)) </p><span origfont="g_font_7" data-canvas-width="440.9514505679999" style="left: 140.615px; top: 199.215px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02786); border-left: none;" yquantized="190" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 9 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.9514505679999" style="left: 140.615px; top: 199.215px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02786); border-left: none;" yquantized="190" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The basic behavior of this tree is similar to before.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Selector node at the root, labeled (a) in the figure, will initially try its first child task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This first child is a Sequence node, labeled (b). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If there is no visible enemy, then the Sequence node (b) will immediately fail and the Selector node (a) at the root will try its second child. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The second child of the root node is another Selector node, labeled (c).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Its first child (d) will succeed if there is an audible enemy, in which case the character will creep.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Sequence node (d) will then terminate successfully, causing Selector node (c) to also terminate successfully.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This, in turn, will cause the root node (a) to terminate successfully. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far, we haven’t reached the Decorator, so the behavior is exactly what we’ve seen before. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the case where there is a visible enemy, Sequence node (b) will continue to run its children, arriving at the decorator.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Decorator will execute Sequence node (e) until it fails.  </p>
<span origfont="g_font_26" style="left: 375.077px; top: 409.073px; font-size: 19.98px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="400" class="highlight4" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 19.98px; font-style: normal; font-weight: 400;"> Node (e) can </p>
<span origfont="g_font_26" style="left: 375.077px; top: 409.073px; font-size: 19.98px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="400" class="highlight4" markup="figureBlock"></span>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 19.98px; font-style: normal; font-weight: 400;"> ? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_26" data-canvas-width="14.933226660000003" style="left: 371.613px; top: 437.069px; font-size: 11.2002px; font-family: sans-serif; transform: scaleX(1.06666); border-left: 50px solid blue;" yquantized="430" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;"> (a) (b)(c) </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 14.4px; font-style: normal; font-weight: 400;"> ? </p><span origfont="g_font_26" data-canvas-width="14.933226660000003" style="left: 454.909px; top: 516.747px; font-size: 11.2002px; font-family: sans-serif; transform: scaleX(1.06666); border-left: 50px solid blue;" yquantized="510" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_26" data-canvas-width="19.2" style="left: 299.077px; top: 535.242px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01053); border-left: 50px solid blue;" yquantized="530" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> (d) </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">UntilVisible? </p><span origfont="g_font_26" data-canvas-width="14.933226660000003" style="left: 266.645px; top: 584.833px; font-size: 11.2002px; font-family: sans-serif; transform: scaleX(1.06666); border-left: 50px solid blue;" yquantized="580" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 11.2002px; font-style: normal; font-weight: 400;"> failRestrainMove </p><span origfont="g_font_26" data-canvas-width="94.944" style="left: 398.802px; top: 605.802px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.989); border-left: 50px solid blue;" yquantized="600" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> (e) </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Audible?  </p><span origfont="g_font_26" data-canvas-width="100.5408" style="left: 185.202px; top: 663.402px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.976124); border-left: 50px solid blue;" yquantized="660" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">            CreepConscious?  </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">              HitPauseHit </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.29 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Example behavior tree </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">only fail when the character is no longer conscious,so the character will continually hit the enemy until it loses consciousness, after which the Selector node will terminate successfully.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Sequence node (b) will then finally execute the task to tie up the unconscious enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Node (b) will now terminate successfully, followed by the immediate successful termination of the root node (a). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that the Sequence node (e) includes a fixed repetition of hit, pause, hit.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, if the enemy happens to lose consciousness after the first hit in the sequence,then the character will still hit the subdued enemy one last time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This may give the impression of a character with a brutal personality.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is precisely this level of fine-grained control over potentially important details that is another key reason for the appeal of behavior trees. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 276.736px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">In addition to filters that modify when and how often to call tasks, other Decorators can usefully modify the status code returned by a task: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 276.736px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class Inverter (Decorator): def run() </p><span origfont="g_font_7" style="left: 112.524px; top: 305.536px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" data-canvas-width="441.32564582400005" style="left: 127.176px; top: 333.79px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04076); border-left: none;" yquantized="330" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return not child.run() </p></pre>
<span origfont="g_font_7" data-canvas-width="441.32564582400005" style="left: 127.176px; top: 333.79px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04076); border-left: none;" yquantized="330" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve given just a few simple Decorators here.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are many more we could implement and we’ll see some more below.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each of the Decorators above have inherited from a base class "Decorator".  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The base class is simply designed to manage its child task.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 413.682px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> In terms of our simple implementation this would be </p>
<span origfont="g_font_7" style="left: 112.524px; top: 413.682px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 428.082px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Decorator (Task): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Stores the child this task is decorating. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> child </p><span origfont="g_font_7" data-canvas-width="441.1224087840002" style="left: 127.415px; top: 470.737px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05029); border-left: none;" yquantized="470" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 3 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.1224087840002" style="left: 127.415px; top: 470.737px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05029); border-left: none;" yquantized="470" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Despite the simplicity it is a good implementation decision to keep this code in a common base class.When you come to build a practical behavior tree implementation you’ll need to decide when child tasks can be set and by whom.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Having the child – task management code in one place is useful.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same advice goes for Composite tasks—it is wise to have a common base class below both Selector and Sequence. </p>
<span origfont="g_font_13" data-canvas-width="218.50614681600004" style="left: 109.415px; top: 569.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03557); border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.05508878400025" style="left: 109.415px; top: 599.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.998414); border-left: none;" yquantized="590" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Guarding Resources with Decorators </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Before we leave Decorators there is one important Decorator type that isn’t as trivial to implement as the example above.We’ve already seen why we need it when we implemented the </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">PlayAnimation </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> task above. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Often, parts of a behavior tree need to have access to some limited resource.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the example this was the skeleton of the character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The animation engine can only play one animation on each part of the skeleton at any time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the character’s hands are moving through the reload animation, they can’t be asked to wave.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are other code resources that can be scarce.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might have a limited number of pathfinding instances available.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Once they are all spoken for, other characters can’t use them and should choose behaviors that avoid cluing the player into the limitation. </p>
<span origfont="g_font_7" data-canvas-width="434.87227204800007" style="left: 109.415px; top: 715.076px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02134); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">AnimationPlay engine available? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 227.502px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="220" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">animation </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.30 </span><span origfont="g_font_7" data-canvas-width="440.83309488000003" style="left: 140.616px; top: 278.443px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.09295); border-left: none;" yquantized="270" class="highlight2"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="440.83309488000003" style="left: 140.616px; top: 278.443px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09295); border-left: none;" yquantized="270" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Guarding a resource using a Condition and SelectorThereareothercaseswhereresourcesarelimitedinpurelygameterms.There’snothingtostop us playing two audio samples at the same time, but it would be odd if they were both supposed to be exclamations from the same character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, if one character is using a wall-mounted health station, no other character should be able to use it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same goes for cover points in a shooter, although we might be able to fit a maximum of two or three characters in some cover points and only one in others. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In each of these cases, we need to make sure that a resource is available before we run some action.  </p>
<span origfont="g_font_7" data-canvas-width="270.9986601599999" style="left: 122.612px; top: 407.953px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00548); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We could do this in three ways: 1.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> By hard-coding the test in the behavior, as we did with </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">PlayAnimation </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 2.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By creating a Condition task to perform the test and using a Sequence 3.  </p>
<span origfont="g_font_7" data-canvas-width="441.1200177600001" style="left: 140.619px; top: 470.323px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07853); border-left: none;" yquantized="470" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By using a Decorator to guard the resourceThe first approach we’ve seen.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The second would be to build a behavior tree that looks something like Figure 5.30.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Here, the Sequence first tries the Condition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If that fails, then the whole Sequence fails.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it succeeds, then the animation action is called. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is a completely acceptable approach, but it relies on the designer of the behavior tree creating the correct structure each time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When there are lots of resources to check, this can be overly laborious. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The third option, building a Decorator, is somewhat less error prone and more elegant. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The version of the Decorator we’re going to create will use a mechanism called a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">semaphore </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Semaphores are associated with parallel or multithreaded programming (and it is no coincidence that we’re interested in them, as we’ll see in the next section).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They were originally invented byEdsger Dijkstra, of the Dijkstra algorithm fame. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Semaphores are a mechanism for ensuring that a limited resource is not over subscribed. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Unlike our </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">PlayAnimation </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">example,semaphores can cope with resources that aren’t limited to one single user at a time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might have a pool of ten pathfinders, for example, meaning at most ten characters can be pathfinding at a time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Semaphores work by keeping a tally of the number of resources there are available and the number of current users.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Before using the resource, a piece of code must ask the semaphore if it can "acquire" it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the code is done it should notify the semaphore that it can be "released." </p>
<span origfont="g_font_7" data-canvas-width="170.28872927999996" style="left: 122.61px; top: 715.082px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01969); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To be properly thread safe, semaphores need some infrastructure, usually depending on low- leveloperatingsystemprimitivesforlocking.Mostprogramminglanguageshavegoodlibrariesfor semaphores, so you’re unlikely to need to implement one yourself.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 174.74px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> We’ll assume that semaphores are provided for us and have the following interface: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 174.74px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 189.14px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Semaphore: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Creates a semaphore for a resource </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># with the given maximum number of users. </p><span origfont="g_font_7" style="left: 112.524px; top: 217.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 232.34px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def Semaphore(maximum_users) </p><span origfont="g_font_7" style="left: 112.524px; top: 246.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Returns true if the acquisition is # successful, and false otherwise. </p><span origfont="g_font_7" style="left: 112.524px; top: 261.14px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 275.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 112.524px; top: 289.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def acquire() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 304.34px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Has no return value. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 318.74px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="356.114332512" style="left: 127.176px; top: 345.799px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01886); border-left: none;" yquantized="340" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">def release() </p></pre>
<span origfont="g_font_7" data-canvas-width="356.114332512" style="left: 127.176px; top: 345.799px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01886); border-left: none;" yquantized="340" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="177.53472000000002" style="left: 137.39px; top: 377.76px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">With a semaphore implementation we can create our Decorator as follows: </p>
<span origfont="g_font_35" data-canvas-width="177.53472000000002" style="left: 137.39px; top: 377.76px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class SemaphoreGuard (Decorator): </p><span origfont="g_font_7" style="left: 112.524px; top: 395.696px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Holds the semaphore that we’re using to </p><span origfont="g_font_7" style="left: 112.524px; top: 424.496px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># guard a resource. </p><span origfont="g_font_7" style="left: 112.524px; top: 438.896px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 453.296px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="450" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">semaphore </p><span origfont="g_font_7" style="left: 112.524px; top: 467.696px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def SemaphoreGuard(semaphore): this.semaphore = semaphore </p><span origfont="g_font_7" style="left: 112.524px; top: 496.496px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def run(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 525.296px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 539.696px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if semaphore.acquire() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 554.096px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">result = child.run() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 568.496px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">semaphore.release() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return result else: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 597.296px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><span origfont="g_font_7" data-canvas-width="441.05426460000007" style="left: 127.415px; top: 624.355px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.06793); border-left: none;" yquantized="620" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return False </p></pre>
<span origfont="g_font_7" data-canvas-width="441.05426460000007" style="left: 127.415px; top: 624.355px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06793); border-left: none;" yquantized="620" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Decorator returns its failure status code when it cannot acquire the semaphore.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This allows a select task higher up the tree to find a different action that doesn’t involve the contested resource. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that the guard doesn’t need to have any knowledge of the actual resource it is guarding. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It just needs the semaphore.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This means with this one single class, and the ability to create semaphores, we can guard any kind of resource, whether it is an animation engine, a health- station, or a pathfinding pool. </p>
<span origfont="g_font_7" data-canvas-width="142.739350752" style="left: 109.41px; top: 710.718px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0269); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this implementation we expect the semaphore to be used in more than one guard Decorator at more than one point in the tree (or in the trees for several characters if it represents some shared resource like a cover point). </p>
<span origfont="g_font_7" style="left: 125.724px; top: 189.14px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">To make it easy to create and access semaphores in several Decorators, it is common to see a factory that can create them by name: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 189.14px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">semaphore_hashtable = {} </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 217.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def getSemaphore(name, maximum_users): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not semaphore_hashtable.has(name): semaphore_hashtable[name] = </p><span origfont="g_font_7" style="left: 125.724px; top: 246.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">Semaphore(maximum_users) return semaphore_hashtable.get(name) </p><span origfont="g_font_7" data-canvas-width="441.0482870399998" style="left: 140.615px; top: 288.199px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.980107); border-left: none;" yquantized="280" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 6 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.0482870399998" style="left: 140.615px; top: 288.199px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.980107); border-left: none;" yquantized="280" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">It is easy then for designers and level creators to create new semaphore guards by simply speci- fyingauniquenameforthem.Anotherapproachwouldbetopassinanametothe </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">SemaphoreGuard </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> constructor, and have it look up or create the semaphore from that name. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This Decorator gives us a powerful way of making sure that a resource isn’t over-subscribed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">But, so far this situation isn’t very likely to arise.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve assumed that our tasks run until they return a result, so only one task gets to be running at a time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a major limitation, and one that would cripple our implementation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To lift it we’ll need to talk about concurrency, parallel programming, and timing. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 436.975px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="430" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.4.4 </p>
<span origfont="g_font_7" data-canvas-width="459.0168323999998" style="left: 122.615px; top: 470.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00222); border-left: none;" yquantized="470" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Concurrency and Timing </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far in this chapter we’ve managed to avoid the issue of running multiple behaviors at the same time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Decision trees are intended to run quickly—giving a result that can be acted upon.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> State machines are long-running processes,but their state is explicit,so it is easy to run them for a short time each frame (processing any transitions that are needed). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Behavior trees are different.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We may have Actions in our behavior tree that take time to complete.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Moving to a door, playing a door opening animation, and barging through the locked door all take time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When our game comes back to the AI on subsequent frames, how will it know what to do?  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We certainly don’t want to start from the top of the tree again, as we might have left off midway through an elaborate sequence. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The short answer is that behavior trees as we have seen them so far are just about useless.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They simply don’t work unless we can assume some sort of concurrency: the ability of multiple bits of code to be running at the same time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">One approach to implementing this concurrency is to imagine each behavior tree is running in its own thread.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> That way an Action can take seconds to carry out: the thread just sleeps while it is happening and wakes again to return True back to whatever task was above it in the tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A more difficult approach is to merge behavior trees with the kind of cooperative multitasking and scheduling algorithms we will look at in Chapter 9.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In practice, it can be highly wasteful to run lots of threads at the same time, and even on multi-core machines we might need to use a </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">cooperative multitasking approach, with one thread running on each core and any number of lightweight or software threads running on each. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although this is the most common practical implementation, we won’t go into detail here. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The specifics depend greatly on the platform you are targeting, and even the simplest approaches containconsiderablymorecodeformanagingthedetailsof threadmanagementthanthebehavior tree algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The website contains an implementation of behavior trees using cooperative multitasking inActionScript 3 for the Adobe Flash platform.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Flash doesn’t support native threads, so there is no alternative but to write behavior trees in this way. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To avoid this complexity we’ll act as if the problem didn’t exist; we’ll act as if we have a multithreaded implementation with as many threads as we need. </p>
<span origfont="g_font_13" data-canvas-width="46.99828224" style="left: 109.128px; top: 286.125px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04786); border-left: none;" yquantized="280" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0694349279999" style="left: 109.415px; top: 316.569px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04097); border-left: none;" yquantized="310" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Waiting </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a previous example we met a Pause task that allowed a character to wait a moment betweenActions to strike the player.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a very common and useful task.  </p>
<span origfont="g_font_35" data-canvas-width="96.83712000000001" style="left: 137.39px; top: 377.462px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> We can implement it by simply putting the current thread to sleep for a while: </p>
<span origfont="g_font_35" data-canvas-width="96.83712000000001" style="left: 137.39px; top: 377.462px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Wait (Task): </p><span origfont="g_font_7" style="left: 112.524px; top: 395.397px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 409.797px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">duration </p><span origfont="g_font_7" style="left: 112.524px; top: 424.197px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 438.597px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def run(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">sleep(duration) return result </p><span origfont="g_font_7" data-canvas-width="440.9789473440002" style="left: 127.415px; top: 480.056px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02543); border-left: none;" yquantized="480" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 6 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.9789473440002" style="left: 127.415px; top: 480.056px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02543); border-left: none;" yquantized="480" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are more complex things we can do with waiting, of course.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use it to time out a long-running task and return a value prematurely.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could create a version of our Limit task that prevents an Action being run again within a certain time frame or one that waits a random amount of time before returning to give variation in our character’s behavior. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is just the start of the tasks we could create using timing information.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> None of these ideas is particularly challenging to implement, but we will not provide pseudo-code here.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some are given in the source code on the website. </p>
<span origfont="g_font_13" data-canvas-width="100.86124032000001" style="left: 109.415px; top: 612.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.00863); border-left: none;" yquantized="610" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.649258248" style="left: 109.415px; top: 643.113px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02372); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Parallel Task </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our new concurrent world, we can make use of a third Composite task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is called "Parallel," and along with Selector and Sequence it forms the backbone of almost all behavior trees. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Parallel task acts in a similar way to the Sequence task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has a set of child tasks, and it runs them until one of them fails.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At that point, the Parallel task as a whole fails.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If all of the child tasks complete successfully, the Parallel task returns with success.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this way, it is identical to theSequence task and its non-deterministic variations. </p>
<span origfont="g_font_7" data-canvas-width="243.72185836799997" style="left: 109.415px; top: 715.083px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02404); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The difference is the way it runs those tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rather than running them one at a time, it runs them all simultaneously.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can think of it as creating a bunch of new threads, one per child, and setting the child tasks off together. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When one of the child tasks ends in failure,Parallel will terminate all of the other child threads that are still running.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Just unilaterally terminating the threads could cause problems, leaving the game inconsistent or failing to free resources (such as acquired semaphores).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The termination procedure is usually implemented as a request rather than a direct termination of the thread.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In order for this to work,all the tasks in the behavior tree also need to be able to receive a termination request and clean up after themselves accordingly. </p>
<span origfont="g_font_35" data-canvas-width="59.17824" style="left: 150.59px; top: 257.606px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">In systems we’ve developed, tasks have an additional method for this: </p>
<span origfont="g_font_35" data-canvas-width="59.17824" style="left: 150.59px; top: 257.606px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Task: </p><span origfont="g_font_7" style="left: 125.724px; top: 275.541px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 289.941px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def run() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="458.973793968" style="left: 122.615px; top: 316.999px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04312); border-left: none;" yquantized="310" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">def terminate() </p></pre>
<span origfont="g_font_7" data-canvas-width="458.973793968" style="left: 122.615px; top: 316.999px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04312); border-left: none;" yquantized="310" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> and the code on the website uses the same pattern.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a fully concurrent system, this terminate method will normally set a flag, and the run method is responsible for periodically checking if this flag is set and shutting down if it is.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> The code below simplifies this process, placing the actual </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> termination code in the terminate method. </p>
<span origfont="g_font_35" data-canvas-width="118.35648" style="left: 150.59px; top: 406.692px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">With a suitable thread handling API, our Parallel task might look like: </p>
<span origfont="g_font_35" data-canvas-width="118.35648" style="left: 150.59px; top: 406.692px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Parallel (Task): </p><span origfont="g_font_7" style="left: 125.724px; top: 424.628px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 439.028px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">children </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # Holds all the children currently running. </p><span origfont="g_font_7" style="left: 125.724px; top: 453.428px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="450" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 467.828px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 482.228px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">runningChildren </p><span origfont="g_font_7" style="left: 125.724px; top: 496.628px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Holds the final result for our run method. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> result </p><span origfont="g_font_7" style="left: 125.724px; top: 525.428px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 539.828px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 554.228px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="550" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def run(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 568.628px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result = undefined </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Start all our children running </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 597.428px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for child in children: thread = new Thread() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 626.228px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 640.628px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">thread.start(runChild, child) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 655.028px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><span origfont="g_font_13" data-canvas-width="7.029628199999999" style="left: 108.386px; top: 680.81px; font-size: 9.56412px; font-family: serif; transform: scaleX(1.00423); border-left: 50px solid orange;" yquantized="680" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 9.56412px; font-style: normal; font-weight: 400;"># Wait until we have a result to return </p><p origfont="g_font_13" style="font-family: serif; font-size: 9.56412px; font-style: normal; font-weight: 400; display: inline;"> 3. </p><span origfont="g_font_7" style="font-family: serif; font-size: 9.56412px; font-style: normal; font-weight: 400;"> </span></pre>
<span origfont="g_font_7" data-canvas-width="459.060544584" style="left: 122.617px; top: 680.81px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.00269); border-left: none;" yquantized="680" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">This isn’t the best approach in practice because the termination code will rely on the current state of the run method and should therefore be run in the same thread.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> The terminate method, on the other hand, will be called from our Parallel thread, so should do as little as possible to change the state of its child tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> Setting a Boolean flag is the bare minimum, so that is the best approach. </p>
<span origfont="g_font_7" data-canvas-width="105.89393663999999" style="left: 122.617px; top: 716.819px; font-size: 13.2702px; font-family: serif; transform: scaleX(0.998999); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">while result == undefined: </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">sleep() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 143.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="140" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return result </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def runChild(child): runningChildren.add(child) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 25 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">returned = child.run() runningChildren.remove(child) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 27 28 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if returned == False: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">terminate() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 272.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="270" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result = False </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 31 32 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else if runningChildren.length == 0: result = True </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 33 34 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def terminate(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 35 36 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">for child in runningChildren: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 37 </span><span origfont="g_font_7" data-canvas-width="27.81956424" style="left: 127.415px; top: 386.415px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03035); border-left: none;" yquantized="380" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">child.terminate() </p></pre>
<span origfont="g_font_7" data-canvas-width="27.81956424" style="left: 127.415px; top: 386.415px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03035); border-left: none;" yquantized="380" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">In the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">method,we create one new thread for each child.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> We’re assuming the thread’s </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">start </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> method takes a first argument that is a function to run and additional arguments that are fed to that function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The threading libraries in a number of languages work that way.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In languages such as Java where functions can’t be passed to other functions, you’ll need to create another class (an inner class, probably) that implements the correct interface. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">After creating the threads the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method then keeps sleeping, waking only to see if the result variable has been set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Many threading systems provide more efficient ways to wait on a variable change using condition variables or by allowing one thread to manually wake another (our child threads could manually wake the parent thread when they change the value of the result).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Check your system documentation for more details. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">runChild </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">method is called from our newly created thread and is responsible for calling the child task’s </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method to get it to do its thing.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Before starting the child, it registers itself with the list of running children.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If the Parallel task gets terminated, it can terminate the correct set of still-running threads.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Finally </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">runChild </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">checks to see if the whole Parallel task should return False, or if not whether this child is the last to finish and the Parallel should return True.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> If neither of these conditions holds, then the result variable will be left unchanged, and the while loop in theParallel’s </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method will keep sleeping. </p>
<span origfont="g_font_8" data-canvas-width="104.32442265600001" style="left: 109.415px; top: 645.001px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.923225); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.35755331999985" style="left: 109.176px; top: 671.859px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.091); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Policies for Parallel </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">We’llseeParallelinuseinamoment.First,itisworthsayingthatherewe’veassumedoneparticular </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> policy </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">for Parallel.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A policy, in this case, is how the Parallel task decides when and what to return. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our policy we return failure as soon as one child fails, and we return success when all children succeed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As mentioned above, this is the same policy as the Sequence task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Although this is the </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could also configure Parallel to have the policy of the Selector task so it returns success whenitsfirstchildsucceedsandfailureonlywhenallhavefailed.Wecouldalsousehybridpolicies, where it returns success or failure after some specific number or proportion of its children have succeeded or failed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is much easier to brainstorm possible task variations than it is to find a set of useful tasks that designers and level designers intuitively understand and that can give rise to entertaining behaviors.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Having too many tasks or too heavily parameterized tasks is not good for productivity. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve tried in this book to stick to the most common and most useful variations, but you will come across others in studios, books, and conferences. </p>
<span origfont="g_font_13" data-canvas-width="82.767762432" style="left: 122.615px; top: 252.307px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02182); border-left: none;" yquantized="250" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.06465288000004" style="left: 122.615px; top: 282.751px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0246); border-left: none;" yquantized="280" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using Parallel </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Parallel task is most obviously used for sets of Actions that can occur at the same time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might, for example, use Parallel to have our character roll into cover at the same time as shouting an insult and changing primary weapon.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These three Actions don’t conflict (they wouldn’t use the same semaphore, for example), and so we could carry them out simultaneously.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a quite low-level use of parallel—it sits low down in the tree controlling a small sub-tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At a higher level, we can use Parallel to control the behavior of a group of characters, such as a fire team in a military shooter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While each member of the group gets its own behavior tree for its individual Actions (shooting,taking cover,reloading,animating,and playing audio,for example), these group Actions are contained in Parallel blocks within a higher level Selector that chooses the group’s behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If one of the team members can’t possibly carry out their role in the strategy, then the Parallel will return in failure and the Selector will have to choose another option.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is shown abstractly in Figure 5.31.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The sub-trees for each character would be complex in their own right, so we haven’t shown them in detail here. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Both groups of uses discussed above use Parallel to combine Action tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is also possible to use Parallel to combine Condition tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is particularly useful if you have certain Condition tests that take time and resources to complete.  </p>
<span origfont="g_font_26" style="left: 210.928px; top: 563.179px; font-size: 12.3145px; font-family: sans-serif; border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 12.3145px; font-style: normal; font-weight: 400;"> By starting a group of Condition tests together, </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 12.3145px; font-style: normal; font-weight: 400;"> ? </p>
<span origfont="g_font_26" data-canvas-width="24.678" style="left: 125.249px; top: 603.781px; font-size: 8.325px; font-family: sans-serif; transform: scaleX(0.98712); border-left: none;" yquantized="600" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Retreat... </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Take cover... </p>
<span origfont="g_font_26" data-canvas-width="25.343400000000003" style="left: 83.9208px; top: 677.611px; font-size: 8.325px; font-family: sans-serif; transform: scaleX(1.05598); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Soldier 1:Soldier 1:Soldier 2:Soldier 2:Soldier 2:Soldier 3:Soldier 3:Soldier 3:Has ammo? </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">attack... </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Has ammo? </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">In cover? </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Sniper attack... </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Has ammo? </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Exit route? </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 8.325px; font-style: normal; font-weight: 400;">Guard exit... </p>
<span origfont="g_font_26" data-canvas-width="32.683200000000014" style="left: 524.021px; top: 684.811px; font-size: 8.325px; font-family: sans-serif; transform: scaleX(0.9904); border-left: none;" yquantized="680" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">failures in any of them will immediately terminate the others, reducing the resources needed to complete the full package of tests. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can do something similar with Sequences,of course,putting the quick Condition tests first to act as early outs before committing resources to more complex tests (this is a good approach for complex geometry tests such as sight testing).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Often, though, we might have a series of complex tests with no clear way to determine ahead of time which is most likely to fail.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In that case, placing the Conditions in a Parallel task allows any of them to fail first and interrupt the others. </p>
<span origfont="g_font_13" data-canvas-width="244.78989312000002" style="left: 109.415px; top: 221.233px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01996); border-left: none;" yquantized="220" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9714029440002" style="left: 109.415px; top: 251.678px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04312); border-left: none;" yquantized="250" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Parallel Task for Condition Checking </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">One final common use of the Parallel task is continually check whether certain Conditions are met while carrying out an Action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For example, we might want an ally AI character to manipulate a computer bank to open a door for the player to progress.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character is happy to continue its manipulation as long as the play guards the entrance from enemies.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could use a Parallel task to attempt an implementation as shown in Figures 5.32 and 5.33. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In both figures the Condition checks if the player is in the correct location.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In Figure 5.32, we use Sequence, as before, to make sure the AI only carries out their Actions if the player is in position.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The problem with this implementation is that the player can move immediately when the character begins work.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In Figure 5.33, the Condition is constantly being checked.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it ever fails (because the player moves), then the character will stop what it is doing.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We could embed this tree in a Selector that has the character encouraging the player to return to his post. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">To make sure the Condition is repeatedly checked we have used the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">UntilFail </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decorator to continually perform the checking, returning only if the Decorator fails.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Based on our implemen- tation of Parallel above, there is still a problem in Figure 5.33 which we don’t have the tools to solve yet.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll return to it shortly.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As an exercise, can you follow the execution sequence of the tree and see what the problem is? </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using Parallel blocks to make sure that Conditions hold is an important use-case in behavior trees.Withitwecangetmuchof thepowerof astatemachine,andinparticularthestatemachine’s ability to switch tasks when important events occur and new opportunities arise.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rather than events triggering transitions between states, we can use sub-trees as states and have them running in parallel with a set of conditions.  </p>
<span origfont="g_font_26" data-canvas-width="179.49120000000002" style="left: 249.988px; top: 663.403px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(0.986215); border-left: 50px solid blue;" yquantized="660" class="highlight3" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> In the case of a state machine, when the condition is met, the </p>
<span origfont="g_font_26" data-canvas-width="179.49120000000002" style="left: 249.988px; top: 663.403px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(0.986215); border-left: 50px solid blue;" yquantized="660" class="highlight3" markup="figureBlock"></span>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Player in position?  </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">              Use computers </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.32 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Using Sequence to enforce a Condition </p></pre>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Until fail                Use computersPlayer in position? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 299.502px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="290" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.33 </p><span origfont="g_font_7" data-canvas-width="458.9690119200001" style="left: 122.612px; top: 344.585px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05142); border-left: none;" yquantized="340" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="458.9690119200001" style="left: 122.612px; top: 344.585px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05142); border-left: none;" yquantized="340" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using Parallel to keep track of Conditions transition is triggered.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With a behavior tree the behavior runs as long as the Condition is met. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A state-machine-like behavior is shown using a state machine in Figure 5.34. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Thisisasimplifiedtreeforthejanitorrobotwemetearlierinthechapter.Hereithastwosetsof behaviors: it can be in tidy-up mode, as long there is trash to tidy, or it can be in recharging mode. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that each"state"is represented by a sub-tree headed by a Parallel node.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Condition for each tree is the opposite of what you’d expect for a state machine: they list the Conditions needed to stay in the state, which is the logical complement of all the conditions for all the state machine transitions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The top Repeat and Select nodes keep the robot continually doing something.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’re assuming the repeat Decorator will never return,either in success or failure.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So the robot keeps trying either of its behaviors, switching between them as the criteria are met. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At this level the Conditions aren’t too complex, but for more states the Conditions needed to hold the character in a state would rapidly get unwieldy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> This is particularly the case if your agents need a couple of levels of alarm behaviors—behaviors that interrupt others to take immediate, reactive action to some important event in the game.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It becomes counter-intuitive to code these in terms of Parallel tasks and Conditions, because we tend to think of the event </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">causing </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">a change of action, rather than the lack of the event allowing the lack of a change of action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So,whileitistechnicallypossibletobuildbehaviortreesthatshowstate-machine-likebehavior, we can sometimes only do so by creating unintuitive trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll return to this issue when we look at the limitations of behavior trees at the end of this section. </p>
<span origfont="g_font_13" data-canvas-width="119.093876736" style="left: 122.615px; top: 655.868px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03561); border-left: none;" yquantized="650" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0299830320001" style="left: 122.615px; top: 686.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04376); border-left: none;" yquantized="680" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Intra-Task Behavior </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The example in Figure 5.33 showed a difficulty that often arises with using Parallel alongside behavior trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As it stands, the tree shown would never return as long as the player didn’t move out of position.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character would perform its actions, then stand around waiting for </p>
</html></html><html><html><p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.3198px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.3198px; font-style: normal; font-weight: 400;">? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_26" data-canvas-width="34.13717328" style="left: 160.807px; top: 255.131px; font-size: 9.59988px; font-family: sans-serif; transform: scaleX(1.00403); border-left: 50px solid blue;" yquantized="250" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.59988px; font-style: normal; font-weight: 400;">Until failTidy trash... </p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.59988px; font-style: normal; font-weight: 400;">Until failRecharge... </p><span origfont="g_font_26" data-canvas-width="59.21205984000001" style="left: 148.271px; top: 326.705px; font-size: 9.59988px; font-family: sans-serif; transform: scaleX(1.0272); border-left: 50px solid blue;" yquantized="320" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.59988px; font-style: normal; font-weight: 400;">Trash visible? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 438.702px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="430" class="highlight4" markup="figureBlock"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.34 </span><span origfont="g_font_7" data-canvas-width="15.08736144" style="left: 109.411px; top: 490.002px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.07767); border-left: none;" yquantized="490" class="highlight3"></span><p class="after_vGap" style="display: inline;"></p></pre>
<span origfont="g_font_26" data-canvas-width="32.543593200000004" style="left: 369.96px; top: 326.708px; font-size: 13.3198px; font-family: sans-serif; transform: scaleX(1.01699); border-left: none;" yquantized="320" class="highlight2"></span>
<span origfont="g_font_26" data-canvas-width="59.211099852000004" style="left: 356.632px; top: 391.121px; font-size: 13.3198px; font-family: sans-serif; transform: scaleX(1.02718); border-left: 50px solid blue;" yquantized="390" class="highlight3" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_26" data-canvas-width="59.211099852000004" style="left: 356.632px; top: 391.121px; font-size: 13.3198px; font-family: sans-serif; transform: scaleX(1.02718); border-left: 50px solid blue;" yquantized="390" class="highlight3" markup="figureBlock"></span>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.3198px; font-style: normal; font-weight: 400;">InverterTrash visible? </p>
<span origfont="g_font_7" data-canvas-width="15.08736144" style="left: 109.411px; top: 490.002px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07767); border-left: none;" yquantized="490" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">A behavior tree version of a state machine the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">UntilFail </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Decorator to finish, which, of course, it won’t do as long as the player stays put. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could add an Action to the end of the Sequence where the character tells the player to head for the door, or we could add a task that returns False.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Both of these would certainly terminate theParallel task, but it would terminate in failure, and any nodes above it in the tree wouldn’t know if it had failed after completion or not. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">To solve this issue we need behaviors to be able to affect one another directly.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> We need to have the Sequence end with an Action that disables the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">UntilFail </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">behavior and has it return True. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Then, the whole Action can complete. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can do this using two new tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first is a Decorator.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It simply lets its child node run normally.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the child returns a result, it passes that result on up the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But, if the child is still working, it can be asked to terminate itself, whereupon it returns a predetermined result.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We will need to use concurrency again to implement this. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">4 </span>
<span origfont="g_font_13" data-canvas-width="7.029628199999999" style="left: 95.1856px; top: 684.396px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.00423); border-left: none;" yquantized="680" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">We could define this as: </p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> 4. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">Some programming languages provide"continuations"—the ability to jump back to arbitrary pieces of code and to return from one function from inside another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> If they sound difficult to manage, it’s because they are.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> Unfortunately, a lot of the thread-based machinations in this section are basically trying to do the job that continuations could do natively.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> In a </p>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">1 </span><span origfont="g_font_7" style="left: 125.724px; top: 114.3px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Interrupter (Decorator): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Is our child running? </p><span origfont="g_font_7" style="left: 125.724px; top: 128.7px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 143.1px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">isRunning </p><span origfont="g_font_7" style="left: 125.724px; top: 157.5px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Holds the final result for our run method. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> result </p><span origfont="g_font_7" style="left: 125.724px; top: 186.3px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def run(): </p><span origfont="g_font_7" style="left: 125.724px; top: 215.1px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.5px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result = undefined </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 243.9px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.3px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Start all child </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">thread = new Thread() thread.start(runChild, child) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.1px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Wait until we have a result to return </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 315.9px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">while result == undefined: sleep() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 344.7px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 359.1px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return result </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def runChild(child): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 387.9px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">isRunning = True result = child.run() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 416.7px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 431.1px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">isRunning = False </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 445.5px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 25 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 459.9px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="450" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def terminate(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 474.3px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if isRunning: child.terminate() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 488.7px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def setResult(desiredResult): result = desiredResult </p><span origfont="g_font_7" data-canvas-width="441.04828704000005" style="left: 140.615px; top: 538.527px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.99366); border-left: none;" yquantized="530" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 29 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.04828704000005" style="left: 140.615px; top: 538.527px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.99366); border-left: none;" yquantized="530" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If this task looks familiar, that’s because it shares the same logic as Parallel.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is the equivalent of Parallel for a single child, with the addition of a single method that can be called to set the result from an external source, which is our second task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When it is called, it simply sets a result in an external Interrupter, then returns with success. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 624.398px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="left: 125.724px; top: 624.398px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 638.798px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class PerformInterruption (Task): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># The interrupter we’ll be interrupting interrupter </p><span origfont="g_font_7" style="left: 125.724px; top: 667.598px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # The result we want to insert. </p><span origfont="g_font_7" style="left: 125.724px; top: 681.997px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 696.397px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 710.797px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">desiredResult </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 7 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">def run(): </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">interrupter.setResult(desiredResult) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 </span><span origfont="g_font_7" data-canvas-width="440.994489" style="left: 127.415px; top: 160.797px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03596); border-left: none;" yquantized="160" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return True </p></pre>
<span origfont="g_font_7" data-canvas-width="440.994489" style="left: 127.415px; top: 160.797px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03596); border-left: none;" yquantized="160" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Together, these two tasks give us the ability to communicate between any two points in the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Effectively they break the strict hierarchy and allow tasks to interact horizontally. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With these two tasks, we can rebuild the tree for our computer-using AI character to look likeFigure 5.35. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In practice there are a number of other ways in which pairs of behaviors can collaborate, but they will often have this same pattern: a Decorator and an Action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could have a Decorator that can stop its child from being run, to be enabled and disabled by another Action task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could have a Decorator that limits the number of times a task can be repeated but that can be reset by another task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could have a Decorator that holds onto the return value of its child and only returns to its parent when another task tells it to.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are almost unlimited options, and behavior tree systems can easily bloat until they have very large numbers of available tasks, only a handful of which designers actually use. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Eventually this simple kind of inter-behavior communication will not be enough.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Certain behavior trees are only possible when tasks have the ability to have richer conversations with one another. </p>
<span origfont="g_font_26" data-canvas-width="44.28480000000001" style="left: 211.861px; top: 507.475px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02988); border-left: 50px solid blue;" yquantized="500" class="highlight2" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_26" data-canvas-width="44.28480000000001" style="left: 211.861px; top: 507.475px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02988); border-left: 50px solid blue;" yquantized="500" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_26" data-canvas-width="34.1376" style="left: 216.936px; top: 579.475px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.00405); border-left: 50px solid blue;" yquantized="570" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_26" data-canvas-width="78.43200000000002" style="left: 194.789px; top: 644.275px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.032); border-left: 50px solid blue;" yquantized="640" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">InterrupterUse computersPerform interruptionUntil failPlayer in position? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 691.953px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="690" class="highlight4" markup="figureBlock"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.35 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Using Parallel and Interrupter to keep track of Conditions </p></pre>
</html></html><html><html><p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;">5.4.5 </span>
<span origfont="g_font_7" data-canvas-width="459.16866242400005" style="left: 122.615px; top: 125.853px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02739); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Adding Data to Behavior Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To move beyond the very simplest inter-behavior communication we need to allow tasks in our behavior tree to share data with one another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you try to implement an AI using the behavior tree implementations we’ve seen so far you’ll quickly encounter the problem of a lack of data. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our example of an enemy trying to enter a room, there was no indication of which room the character was trying to enter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could just build big behavior trees with separate branches for each area of our level, but this would obviously be wasteful. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a real behavior tree implementation, tasks need to know what to work on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You can think of a task as a sub-routine or function in a programming language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might have a sub-tree that represents smoking the player out of a room, for example.  </p>
<span origfont="g_font_35" data-canvas-width="107.5968" style="left: 150.59px; top: 287.547px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> If this were a sub-routine it would take an argument to control which room to smoke: </p>
<span origfont="g_font_35" data-canvas-width="107.5968" style="left: 150.59px; top: 287.547px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def smoke_out(room): </p><span origfont="g_font_7" style="left: 125.724px; top: 305.482px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 319.882px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">matches = fetch_matches() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 334.282px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">gas = fetch_gasoline() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 348.682px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">douse_door(room.door, gas) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><span origfont="g_font_7" data-canvas-width="441.1702292640002" style="left: 140.615px; top: 375.741px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05291); border-left: none;" yquantized="370" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">ignite(room.door, matches) </p></pre>
<span origfont="g_font_7" data-canvas-width="441.1702292640002" style="left: 140.615px; top: 375.741px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05291); border-left: none;" yquantized="370" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our behavior tree we need some similar mechanism to allow one sub-tree to be used in many related scenarios.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Of course,the power of sub-routines is not just that they take parameters, but also that we can reuse them again and again in multiple contexts (we could use the "ignite" action to set fire to anything and use it from within lots of strategies).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll return to the issue of reusing behavior trees as sub-routines later.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For now, we’ll concentrate on how they get their data. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although we want data to pass between behavior trees, we don’t want to break their elegant and consistent API.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We certainly don’t want to pass data into tasks as parameters to their run method.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This would mean that each task needs to know what arguments its child tasks take and how to find these data. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could parameterize the tasks at the point where they are created,since at least some part of the program will always need to know what nodes are being created,but in most implementations this won’t work, either.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Behavior nodes get assembled into a tree typically when the level loads (again, we’ll finesse this structure soon).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We aren’t normally building the tree dynamically as it runs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even implementations that do allow some dynamic tree building still rely on most of the tree being specified before the behavior begins. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The most sensible approach is to decouple the data that behaviors need from the tasks them- selves.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We will do this by using an external data store for all the data that the behavior tree needs. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">We’ll call this data store a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">blackboard </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Later in this chapter, in the section on blackboard architec- tures,we’ll see a representation of such a data structure and some broader implications for its use. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For now it is simply important to know that the blackboard can store any kind of data and that interested tasks can query it for the data they need. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using this external blackboard, we can write tasks that are still independent of one another but can communicate when needed. </p>
<span origfont="g_font_7" data-canvas-width="172.64149689599998" style="left: 122.622px; top: 692.42px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03378); border-left: none;" yquantized="690" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Enemy visible? </p>
<span origfont="g_font_26" data-canvas-width="58.156800000000004" style="left: 265.6px; top: 180.466px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02029); border-left: 50px solid blue;" yquantized="180" class="highlight3" markup="figureBlock"></span>
<span origfont="g_font_26" style="left: 383.209px; top: 186.224px; font-size: 13.32px; font-family: sans-serif; border-left: none;" yquantized="180" class="highlight4"></span>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Select enemy ? </p>
<span origfont="g_font_26" data-canvas-width="64.56960000000001" style="left: 449.593px; top: 180.466px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.04145); border-left: 50px solid blue;" yquantized="180" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_26" data-canvas-width="68.82239999999999" style="left: 393.067px; top: 249.426px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01209); border-left: 50px solid blue;" yquantized="240" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_26" data-canvas-width="98.17920000000004" style="left: 227.989px; top: 307.024px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04446); border-left: 50px solid blue;" yquantized="300" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_26" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Engage enemy (write to blackboard)(read from blackboard)Always succeedHigh ground available? </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 354.702px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="350" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Move to high ground </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.36 </span><span origfont="g_font_7" data-canvas-width="441.1176267360001" style="left: 127.415px; top: 385.809px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00027); border-left: none;" yquantized="380" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.1176267360001" style="left: 127.415px; top: 385.809px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00027); border-left: none;" yquantized="380" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A behavior tree communicating via blackboardIn a squad-based game, for example, we might have a collaborative AI that can autonomously engage the enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could write one task to select an enemy (based on proximity or a tactical analysis, for example) and another task or sub-tree to engage that enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The task that selects the enemy writes down the selection it has made onto the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The task or tasks that engage the enemy query the blackboard for a current enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The behavior tree might look likeFigure 5.36.  </p>
<span origfont="g_font_35" data-canvas-width="96.83711999999998" style="left: 137.39px; top: 489.898px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> The enemy detector could write: </p>
<span origfont="g_font_35" data-canvas-width="96.83711999999998" style="left: 137.39px; top: 489.898px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> target: enemy-10f9 </p><span origfont="g_font_7" data-canvas-width="459.7700049600001" style="left: 109.415px; top: 520.492px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00875); border-left: none;" yquantized="520" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="459.7700049600001" style="left: 109.415px; top: 520.492px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00875); border-left: none;" yquantized="520" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> to the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Move and Shoot At tasks would ask the blackboard for its current"target" values and use these to parameterize their behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The tasks should be written so that, if the blackboard had no target, then the task fails, and the behavior tree can look for something else to do. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 613.721px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">In pseudo-code this might look like: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 613.721px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 628.121px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class MoveTo (Task): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># The blackboard we’re using blackboard </p><span origfont="g_font_7" style="left: 112.524px; top: 656.92px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def run(): </p><span origfont="g_font_7" style="left: 112.524px; top: 685.721px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">target = blackboard.get(’target’) if target: </p><span origfont="g_font_7" style="left: 112.524px; top: 714.521px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">character = blackboard.get(’character’) </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">return True </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">else: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><span origfont="g_font_7" data-canvas-width="200.5710482399999" style="left: 140.615px; top: 156.015px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01813); border-left: none;" yquantized="150" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return False </p></pre>
<span origfont="g_font_7" data-canvas-width="200.5710482399999" style="left: 140.615px; top: 156.015px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01813); border-left: none;" yquantized="150" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="139.87583999999998" style="left: 150.59px; top: 188.108px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> where the enemy detector might look like: </p>
<span origfont="g_font_35" data-canvas-width="139.87583999999998" style="left: 150.59px; top: 188.108px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class SelectTarget (Task): </p><span origfont="g_font_7" style="left: 125.724px; top: 206.043px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> blackboard </p><span origfont="g_font_7" style="left: 125.724px; top: 234.843px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 249.243px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 263.643px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def run(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 278.043px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">character = blackboard.get(’character’) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">candidates = enemies_visible_to(character) if candidates.length &gt; 0: </p><span origfont="g_font_7" style="left: 125.724px; top: 306.843px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">target = biggest_threat(candidates, character) blackboard.set(’target’, target) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 335.643px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="330" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return True else: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 364.443px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="360" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><span origfont="g_font_7" data-canvas-width="441.0267678240001" style="left: 140.615px; top: 391.502px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02326); border-left: none;" yquantized="390" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return False </p></pre>
<span origfont="g_font_7" data-canvas-width="441.0267678240001" style="left: 140.615px; top: 391.502px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02326); border-left: none;" yquantized="390" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In both these cases we’ve assumed that the task can find which character it is controlling by looking that information up in the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most games we’ll want some behavior trees to be used by many characters, so each will require its own blackboard. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some implementations associate blackboards with specific sub-trees rather than having just one for the whole tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This allows sub-trees to have their own private data-storage area.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is shared between nodes in that sub-tree,but not between sub-trees.  </p>
<span origfont="g_font_35" data-canvas-width="193.67423999999997" style="left: 150.59px; top: 509.994px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="500" class="highlight4" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> This can be implemented using a particular Decorator whose job is to create a fresh blackboard before it runs its child: </p>
<span origfont="g_font_35" data-canvas-width="193.67423999999997" style="left: 150.59px; top: 509.994px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="500" class="highlight4" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class BlackboardManager (Decorator): </p><span origfont="g_font_7" style="left: 125.724px; top: 527.93px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 542.33px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">blackboard = null </p><span origfont="g_font_7" style="left: 125.724px; top: 556.73px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def run(): blackboard = new Blackboard() </p><span origfont="g_font_7" style="left: 125.724px; top: 585.53px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 599.93px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">result = child.run() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 125.724px; top: 614.33px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">delete blackboard </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><span origfont="g_font_7" data-canvas-width="440.931126864" style="left: 140.615px; top: 641.389px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.999844); border-left: none;" yquantized="640" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return result </p></pre>
<span origfont="g_font_7" data-canvas-width="440.931126864" style="left: 140.615px; top: 641.389px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.999844); border-left: none;" yquantized="640" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using this approach gives us a hierarchy of blackboards.  </p>
<span origfont="g_font_35" data-canvas-width="91.45728000000001" style="left: 150.59px; top: 699.389px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> When a task comes to look up some data, we want to start looking in the nearest blackboard, then in the blackboard above that, and so on until we find a result or reach the last blackboard in the chain: </p>
<span origfont="g_font_35" data-canvas-width="91.45728000000001" style="left: 150.59px; top: 699.389px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock4"></span>
<pre markupfor="codeBlock4" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Blackboard: </p><span origfont="g_font_7" style="left: 125.724px; top: 717.324px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight3" markup="codeBlock4"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># The blackboard to fall back to </p></pre>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">4 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">data </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def get(name): </p><span origfont="g_font_7" style="left: 112.524px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if name in data: return data[name] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else if parent: return parent.get(name) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="441.093716496" style="left: 127.415px; top: 242.415px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01634); border-left: none;" yquantized="240" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">else return null </p></pre>
<span origfont="g_font_7" data-canvas-width="441.093716496" style="left: 127.415px; top: 242.415px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01634); border-left: none;" yquantized="240" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Having blackboards fall back in this way allows blackboards to work in the same way that a programming language does.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> In programming languages this kind of structure would be called a </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 5 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> "scope chain." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The final element missing from our implementation is a mechanism for behavior trees to find their nearest blackboard.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The easiest way to achieve this is to pass the blackboard down the tree as an argument to the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But didn’t we say that we didn’t want to change the interface? </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Well, yes, but what we wanted to avoid was having different interfaces for different tasks, so tasks would have to know what parameters to pass.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By making all tasks accept a blackboard as their only parameter, we retain the anonymity of our tasks. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 404.75px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The task API now looks like this: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 404.75px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 419.15px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Task: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 433.55px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def run(blackbaord) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="37.5988524" style="left: 109.415px; top: 460.609px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04441); border-left: none;" yquantized="460" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def terminate() </p></pre>
<span origfont="g_font_7" data-canvas-width="37.5988524" style="left: 109.415px; top: 460.609px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04441); border-left: none;" yquantized="460" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> and our </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">BlackboardManager </span>
<span origfont="g_font_35" data-canvas-width="193.67423999999997" style="left: 137.39px; top: 507.101px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="500" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">task can then simply introduce a new blackboard to its child, making the blackboard fall back to the one it was given: </p>
<span origfont="g_font_35" data-canvas-width="193.67423999999997" style="left: 137.39px; top: 507.101px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="500" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class BlackboardManager (Decorator): </p><span origfont="g_font_7" style="left: 112.524px; top: 525.036px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 539.436px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def run(blackboard): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 553.836px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">new_bb = new Blackboard() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 568.236px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">new_bb.parent = blackboard </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">result = child.run() free new_bb </p><span origfont="g_font_7" style="left: 112.524px; top: 597.036px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_13" data-canvas-width="7.029628199999999" style="left: 95.1856px; top: 642.463px; font-size: 9.56412px; font-family: serif; transform: scaleX(1.00423); border-left: 50px solid orange;" yquantized="640" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 9.56412px; font-style: normal; font-weight: 400;">return result </p><p origfont="g_font_13" style="font-family: serif; font-size: 9.56412px; font-style: normal; font-weight: 400; display: inline;"> 5. </p><span origfont="g_font_7" style="font-family: serif; font-size: 9.56412px; font-style: normal; font-weight: 400; display: inline;"> </span></pre>
<span origfont="g_font_7" data-canvas-width="267.093353592" style="left: 109.417px; top: 642.463px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.01556); border-left: none;" yquantized="640" class="highlight2"></span>
<span origfont="g_font_8" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;">It is worth noting that the scope chain we’re building here is called a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">dynamic scope chain </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> In programming languages, dynamic scopes were the original way that scope chains were implemented,but it rapidly became obvious that they caused serious problems and were very difficult to write maintainable code for.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> Modern languages have all now moved over to static scope chains.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> For behavior trees, however, dynamic scope isn’t a big issue and is probably more intuitive.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> We’re not aware of any developers who have thought in such formal terms about data sharing,however,so we’re not aware of anyone who has practical experience of both approaches. </p>
<span origfont="g_font_7" data-canvas-width="187.55430602400008" style="left: 109.417px; top: 702.478px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.00296); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Another approach to implementing hierarchies of blackboards is to allow tasks to query the task above them in the tree.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> This query moves up the tree recursively until it reaches a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">BlackboardManager </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">task that can provide the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This approach keeps the original no-argument API for our task’s run method, but adds a lot of extra code complexity. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some developers use completely different approaches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some in-house technology we know already have mechanisms in their scheduling system for passing around data along with bits of code to run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These systems can be repurposed to provide the blackboard data for a behavior tree, giving them automatic access to the data-debugging tools built into the game engine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It would be a duplication of effort to implement either scheme above in this case. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whichever scheme you implement, blackboard data allow you to have communication between parts of your tree of any complexity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the section on concurrency, above, we had pairs of tasks where one task calls methods on another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This simple approach to communication is fine in the absence of a richer data-exchange mechanism but should probably not be used if you are going to give your behavior tree tasks access to a full blackboard. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In that case,it is better to have them communicate by writing and reading from the blackboard rather than calling methods.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Having all your tasks communicate in this way allows you to easily write new tasks to use existing data in novel ways, making it quicker to grow the functionality of your implementation. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 378.804px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="370" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.4.6 </p>
<span origfont="g_font_7" data-canvas-width="458.93912412" style="left: 122.615px; top: 412.142px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.991229); border-left: none;" yquantized="410" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Reusing Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the final part of this section we’ll look in more detail at how behavior trees get to be constructed in the first place, how we can reuse them for multiple characters, and how we can use sub-trees multiple times in different contexts.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These are three separate but important elements to consider. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">They have related solutions, but we’ll consider each in turn. </p>
<span origfont="g_font_13" data-canvas-width="111.71130163199997" style="left: 122.615px; top: 497.522px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04897); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.08617209599987" style="left: 122.615px; top: 527.966px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06764); border-left: none;" yquantized="520" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Instantiating Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Chances are, if you’ve taken a course on object-oriented programming, you were taught the dichotomy between instances of things and classes of things.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might have a class of soda machines, but the particular soda machine in the office lobby is an instance of that class.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Classes are abstract concepts; instances are the concrete reality.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This works for many situations, but not all.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In particular, in game development, we regularly see situations where there are three, not two, levels of abstraction.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So far in this chapter we’ve been ignoring this distinction, but if we want to reliably instantiate and reuse behavior trees we have to face it now. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At the first level we have the classes we’ve been defining in pseudo-code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They represent abstract ideas about how to achieve some task.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might have a task for playing an animation, for example, or a condition that checks whether a character is within range of an attack. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At the second level we have instances of these classes arranged in a behavior tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The examples we’ve seen so far consist of instances of each task class at a particular part of the tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, in the behavior tree example of Figure 5.29, we have two Hit tasks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These are two instances of the Hit </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">class.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Each instance has some parameterization: the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">PlayAnimation </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">task gets told what animation to play, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">EnemyNear </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">condition gets given a radius, and so on. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">But now we’re meeting the third level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A behavior tree is a way of defining a set of behaviors, but those behaviors can belong to any number of characters in the game at the same or different times.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The behavior tree needs to be instantiated for a particular character at a particular time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This three layers of abstraction don’t map easily onto most regular class-based languages, and you’ll need to do some work to make this seamless.  </p>
<span origfont="g_font_7" data-canvas-width="323.95027766399994" style="left: 109.406px; top: 211.034px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01234); border-left: none;" yquantized="210" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are a few approaches: 1.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Use a language that supports more than two layers of abstraction. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 2.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Use a cloning operation to instantiate trees for characters. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Create a new intermediate format for the middle layer of abstraction. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Use behavior tree tasks that don’t keep local state and use separate state objects. </p>
<span origfont="g_font_7" data-canvas-width="440.86896024000004" style="left: 127.41px; top: 290.177px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09942); border-left: none;" yquantized="290" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The first approach is probably not practical.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> There is another way of doing object ori- entation (OO) that doesn’t use classes.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It is called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">prototype-based </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">object orientation, and it allows you to have any number of different layers of abstraction.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Despite being strictly more powerful than class-based OO, it was discovered much later, and unfortunately has had a hard time breaking into developers’ mindsets.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The only widespread language to support it isJavaScript. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">6 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Thesecondapproachistheeasiesttounderstandandimplement.Theideaisthat,atthesecond layer of abstraction, we build a behavior tree from the individual task classes we’ve defined.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We then use that behavior tree as an"archetype"; we keep it in a safe place and never use it to run any behaviors on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Any time we need an instance of that behavior tree we take a copy of the archetype and use the copy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> That way we are getting all of the configuration of the tree, but we’re getting our owncopy.Onemethodof achievingthisistohaveeachtaskhaveaclonemethodthatmakesacopy of itself.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can then ask the top task in the tree for a clone of itself and have it recursively build us a copy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This presents a very simple API but can cause problems with fragmented memory. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The code on the website uses this approach, as does the pseudo-code examples below.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve chosen this for simplicity only, not to suggest it is the right way to do this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In some languages, "deep-copy" operations are provided by the built-in libraries that can do this for us.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even if we don’t have a deep copy, writing one can potentially give better memory coherence to the trees it creates. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Approach three is useful when the specification for the behavior tree is held in some data format.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is common—the AI author uses some editing tool that outputs some data structure saying what nodes should be in the behavior tree and what properties they should have.  </p>
<span origfont="g_font_13" data-canvas-width="7.029628199999999" style="left: 95.1856px; top: 642.463px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.00423); border-left: none;" yquantized="640" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> If we have this specification for a tree we don’t need to keep a whole tree around as an archetype; we can just </p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> 6. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">The story of prototype-based OO in JavaScript isn’t a pretty one.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> Programmers taught to think in class-based OO can find it hard to adjust, and the web is littered with people making pronouncements about how JavaScript’s object-oriented model is "broken." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">" This has been so damaging to JavaScript’s reputation that the most recent versions of the JavaScript specificationhaveretrofittedtheclass-basedmodel.ActionScript3,whichisanimplementationof thatrecentspecification, leans heavily this way,andAdobe’s libraries for Flash and Flex effectively lock you into Java-style class-based programming, wasting one of the most powerful and flexible aspects of the language. </p>
<span origfont="g_font_7" data-canvas-width="266.301444456" style="left: 109.417px; top: 702.478px; font-size: 13.2702px; font-family: serif; transform: scaleX(0.986302); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">store the specification, and build an instance of it each time it is needed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Here, the only classes in our system are the original task classes, and the only instances are the final behavior trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve effectively added a new kind of intermediate layer of abstraction in the form of our custom data structure, which can be instantiated when needed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Approach four is somewhat more complicated to implement but has been reported by some developers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The idea is that we write all our tasks so they never hold any state related to a specific use of that task for a specific character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They can hold any data at the middle level of abstraction: things that are the same for all characters at all times, but specific to that behavior tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, aComposite node can hold the list of children it is managing, for example (as long as we don’t allow children to be dynamically added or removed at runtime).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But, our Parallel node can’t keep track of the children that are currently running.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The current list of active children will vary from time to time and from character to character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These data do need to be stored somewhere, however, otherwise the behavior tree couldn’t function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So this approach uses a separate data structure, similar to our blackboard, and requires all character-specific data to be stored there. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach treats our second layer of abstraction as the instances and adds a new kind of data structure to represent the third layer of abstraction.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is the most efficient, but it also requires a lot of bookkeeping work. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This three-layer problem isn’t unique to behavior trees, of course.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It arises any time we have some base classes of objects that are then configured,and the configurations are then instantiated. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Allowing the configuration of game entities by non-programmers is so ubiquitous in large-scale gamedevelopment(usuallyitiscalled"data-driven"development)thatthisproblemkeepscoming up,so much so that it is possible that whatever game engine you’re working with already has some tools built in to cope with this situation,and the choice of approach we’ve outlined above becomes moot—you go with whatever the engine provides.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you are the first person on your project to hit the problem, it is worth really taking time to consider the options and build a system that will work for everyone else, too. </p>
<span origfont="g_font_13" data-canvas-width="123.38340249599999" style="left: 122.615px; top: 500.953px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.991064); border-left: none;" yquantized="500" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.2619123600001" style="left: 122.376px; top: 531.398px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07424); border-left: none;" yquantized="530" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Reusing Whole Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With a suitable mechanism to instantiate behavior trees, we can build a system where many characters can use the same behavior. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">During development, the AI authors create the behavior trees they want for the game and assign each one a unique name.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A factory function can then be asked for a behavior tree matching a name at any time. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 639.026px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">We might have a definition for our generic enemy character: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 639.026px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">Enemy Character (goon): model = ‘‘enemy34.model’’ </p><span origfont="g_font_7" style="left: 125.724px; top: 667.826px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">texture = ‘‘enemy34-urban.tex’’ weapon = pistol-4 </p><span origfont="g_font_7" style="left: 125.724px; top: 696.626px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">behavior = goon-behavior </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When we create a new goon, the game requests a fresh goon behavior tree.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 145.94px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> Using the cloning approach to instantiating behavior trees, we might have code that looks like: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 145.94px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def createBehaviorTree(type): archetype = behavior_tree_library[type] </p><span origfont="g_font_7" style="left: 112.524px; top: 174.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" data-canvas-width="441.0160082160002" style="left: 127.415px; top: 201.799px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03041); border-left: none;" yquantized="200" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return archetype.clone() </p></pre>
<span origfont="g_font_7" data-canvas-width="441.0160082160002" style="left: 127.415px; top: 201.799px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03041); border-left: none;" yquantized="200" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Clearly not onerous code!  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this example, we’re assuming the behavior tree library will be filled with the archetypes for all the behavior trees that we might need.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This would normally be done during the loading of the level, making sure that only the trees that might be needed in that level are loaded and instantiated into archetypes. </p>
<span origfont="g_font_13" data-canvas-width="106.53517824000001" style="left: 109.415px; top: 279.548px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01462); border-left: none;" yquantized="270" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1794220320001" style="left: 109.176px; top: 309.992px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03999); border-left: none;" yquantized="300" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Reusing Sub-trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With our behavior library in place, we can use it for more than simply creating whole trees for characters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can also use it to store named sub-trees that we intend to use in multiple contexts. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Take the example shown in Figure 5.37. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Thisshowstwoseparatebehaviortrees.Noticethateachof themhasasub-treethatisdesigned to engage an enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we had tens of behavior trees for tens of different kinds of character, it would be incredibly wasteful to have to specify and duplicate these sub-trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It would be great to reuse them.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By reusing them we’d also be able to come along later and fix bugs or add more sophisticated functionality and know that every character in the game instantly benefits from the update. </p>
<span origfont="g_font_26" style="left: 193.762px; top: 497.276px; font-size: 13.32px; font-family: sans-serif; border-left: none;" yquantized="490" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> ? </p>
<span origfont="g_font_26" data-canvas-width="70.9728" style="left: 210.115px; top: 558.718px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.0139); border-left: none;" yquantized="550" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Until failBuild defences... </p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">? </p>
<span origfont="g_font_26" data-canvas-width="41.08800000000001" style="left: 500.243px; top: 608.99px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.00215); border-left: none;" yquantized="600" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Go to lastEnemy visible? </p>
<span origfont="g_font_26" data-canvas-width="64.55136000000002" style="left: 332.57px; top: 665.159px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02462); border-left: none;" yquantized="660" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_26" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Select enemyEngage enemy known positionEnemy visible? </p>
<span origfont="g_font_7" data-canvas-width="175.583651928" style="left: 136.838px; top: 711.93px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01493); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Select enemyEngage enemy </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Common sub-trees across characters </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can certainly store partial sub-trees in our behavior tree library.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because every tree has a single root task, and because every task looks just the same, our library doesn’t care whether it is storing sub-trees or whole trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The added complication for sub-trees is how to get them out of the library and embedded in the full tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The simplest solution is to do this lookup when you create a new instance of your behavior tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To do this you add a new "reference" task in your behavior tree that tells the game to go and find a named sub-tree in the library.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This task is never run—it exists just to tell the instantiation mechanism to insert another sub-tree at this point. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 246.741px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">For example, this class is trivial to implement using recursive cloning: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 246.741px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 261.141px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class SubtreeReference (Task): </p><span origfont="g_font_7" style="left: 125.724px; top: 275.541px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># What named subtree are we referring to. </p><span origfont="g_font_7" style="left: 125.724px; top: 289.941px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 304.341px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">reference_name </p><span origfont="g_font_7" style="left: 125.724px; top: 318.741px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">def run(): throw Error("This task isn’t meant to be run!" </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">") </p><span origfont="g_font_7" style="left: 125.724px; top: 347.541px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def clone(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 376.34px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="440.978947344" style="left: 140.615px; top: 403.399px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03516); border-left: none;" yquantized="400" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return createBehaviorTree(reference_name) </p></pre>
<span origfont="g_font_7" data-canvas-width="440.978947344" style="left: 140.615px; top: 403.399px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03516); border-left: none;" yquantized="400" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this approach our archetype behavior tree contains these reference nodes, but as soon as we instantiate our full tree it replaces itself with a copy of the sub-tree, built by the library. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that the sub-tree is instantiated when the behavior tree is created,ready for a character’s use.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In memory-constrained platforms, or for games with thousands of AI characters, it may be worth holding off on creating the sub-tree until it is needed, saving memory in cases where parts of a large behavior tree are rarely used.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This may be particularly the case where the behavior tree has a lot of branches for special cases: how to use a particular rare weapon,for example,or what to do if the player mounts some particularly clever ambush attempt.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These highly specific sub-trees don’t need to be created for every character, wasting memory; instead, they can be created on demand if the rare situation arises. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can implement this using a Decorator.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 594.534px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> The Decorator starts without a child but creates that child when it is first needed: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 594.534px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 608.934px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class SubtreeLookupDecorator (Decorator): </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> subtree_name </p><span origfont="g_font_7" style="left: 125.724px; top: 637.734px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def SubtreeLookupDecorator(subtree_name): </p><span origfont="g_font_7" style="left: 125.724px; top: 666.534px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">this.subtree_name = subtree_name this.child = null </p><span origfont="g_font_7" style="left: 125.724px; top: 695.334px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 709.734px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 9 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">def run(): </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">if child == null: </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">child = createBehaviorTree(subtree_name) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><span origfont="g_font_7" data-canvas-width="441.22163628000027" style="left: 127.415px; top: 156.015px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04555); border-left: none;" yquantized="150" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return child.run() </p></pre>
<span origfont="g_font_7" data-canvas-width="441.22163628000027" style="left: 127.415px; top: 156.015px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04555); border-left: none;" yquantized="150" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Obviously we could extend this further to delete the child and free the memory after it has been used, if we really want to keep the behavior tree as small as possible. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With the techniques we’ve now met, we have the tools to build a comprehensive behavior tree system with whole trees and specific components that can be reused by lots of characters in the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is a lot more we can do with behavior trees, in addition to tens of interesting tasks we could write and lots of interesting behaviors we could build.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Behavior trees are certainly an exciting technology, but they don’t solve all of our problems. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 278.575px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.4.7 </p>
<span origfont="g_font_7" data-canvas-width="458.9749894800001" style="left: 109.415px; top: 311.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.987043); border-left: none;" yquantized="310" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Limitations of Behavior Trees </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Over the last five years,behavior trees have come from nowhere to become something of the flavor of the month in game AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are some commentators who see them as a solution to almost every problem you can imagine in game AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is worth being a little cautious.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These fads do come and go.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Understanding what behavior trees are bad at is as important as understanding where they excel. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve already seen a key limitation of behavior trees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are reasonably clunky when rep- resenting the kind of state-based behavior that we met in the previous section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If your character transitions between types of behavior based on the success or failure of actions, however (so they get mad when they can’t do something, for example), then behavior trees work fine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But it is much harder if you have a character who needs to respond to external events—interrupting a patrol route to suddenly go into hiding or to raise an alarm, for example—or a character than needs to switch strategies when its ammo is looking low.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Notice that we’re not claim- ing those behaviors can’t be implemented in behavior trees, just that it would be cumbersome to do so. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because behavior trees make it more difficult to think and design in terms of states, AI based solelyonbehaviortreestendstoavoidthesekindsof behavior.If youlookatabehaviortreecreated by an artist or level designer, they tend to avoid noticeable changes of character disposition or alarm behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a shame, since those cues are simple and powerful and help raise the level of the AI. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can build a hybrid system, of course, where characters have multiple behavior trees and use a state machine to determine which behavior tree they are currently running.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Using the approach of having behavior tree libraries that we saw above, this provides the best of both worlds.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unfortunately, it also adds considerable extra burden to the AI authors and toolchain developers, since they now need to support two kinds of authoring: state machines and behavior trees. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An alternative approach would be to create tasks in the behavior tree that behave like state machines—detecting important events and terminating the current sub-tree to begin another. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This merely moves the authoring difficulty, however, as we still need to build a system for AI authors to parameterize these relatively complex tasks. </p>
<span origfont="g_font_7" data-canvas-width="258.999306216" style="left: 109.415px; top: 714.979px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01568); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Behavior trees on their own have been a big win for game AI, and developers will still be exploring their potential for a few years.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As long as they are pushing forward the state of the art, we suspect that there will not be a strong consensus on how best to avoid these limitations, with developers experimenting with their own approaches. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 176.214px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.5 </p>
<span origfont="g_font_7" data-canvas-width="458.9092363200001" style="left: 122.615px; top: 218.039px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.984784); border-left: none;" yquantized="210" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy Logic </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far the decisions we’ve made have been very cut and dried.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Conditions and decisions have been true or false, and we haven’t questioned the dividing line.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Fuzzy logic is a set of mathematical techniques designed to cope with gray areas. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Imagine we’re writing AI for a character moving through a dangerous environment.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a finite state machine approach, we could choose two states:"Cautious"and"Confident." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">"When the character is cautious, it sneaks slowly along, keeping an eye out for trouble.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the character is confident, it walks normally.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As the character moves through the level, it will switch between the two states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This may appear odd.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might think of the character getting gradually braver, but this isn’t shown until suddenly it stops creeping and walks along as if nothing had ever happened. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy logic allows us to blur the line between cautious and confident, giving us a whole spectrum of confidence levels.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With fuzzy logic we can still make decisions like"walk slowly when cautious," but both "slowly" and "cautious" can include a range of degrees. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 411.639px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.5.1 </span>
<span origfont="g_font_7" data-canvas-width="458.93075553600033" style="left: 122.615px; top: 444.976px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05501); border-left: none;" yquantized="440" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Warning </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy logic is relatively popular in the games industry and is used in several games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For that reason, we have decided to include a section on it in this book.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> However, you should be aware that fuzzy logic has, for valid reasons, been largely discredited within the mainstream academicAI community. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">You can read more details in Russell and Norvig [2002] but the executive summary is that it is always better to use probability to represent any kind of uncertainity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The slightly longer version is that it has been proven (a long time ago, as it turns out) that if you play any kind of betting game then any player who is not basing their decisions on probability theory can expect to eventually lose his money.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The reason is that flaws in any other theory of uncertainty, besides probability theory, can potentially be exploited by an opponent. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Part of the reason why fuzzy logic ever became popular was the perception that using prob- abilistic methods can be slow.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With the advent of Bayes nets and other graphical modeling techniques, this is no longer such an issue.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While we won’t explicitly cover Bayes nets in this book, we will look at various other related approaches such as Markov systems. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 667.375px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="660" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.5.2 </p>
<span origfont="g_font_7" data-canvas-width="459.0275920079999" style="left: 122.615px; top: 700.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00885); border-left: none;" yquantized="700" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Introduction to Fuzzy Logic </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This section will give a quick overview of the fuzzy logic needed to understand the techniques in this chapter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Fuzzy logic itself is a huge subject, with many subtle features, and we don’t have the </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">space to cover all the interesting and useful bits of the theory.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you want a broad grounding,we’d recommend Buckley and Eslami [2002], a widely used text on the subject. </p>
<span origfont="g_font_13" data-canvas-width="61.25987942399999" style="left: 109.415px; top: 144.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.988063); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.05269776000006" style="left: 109.415px; top: 175.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06756); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy Sets </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In traditional logic we use the notion of a "predicate," a quality or description of something. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A character might be hungry,for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case,"hungry"is a predicate,and every character either does or doesn’t have it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, a character might be hurt.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no sense of how hurt; each character either does or doesn’t have the predicate.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can view these predicates as sets. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Everything to which the predicate applies is in the set, and everything else is outside. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">These sets are called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">classical sets </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, and traditional logic can be completely formulated in terms of them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy logic extends the notion of a predicate by giving it a value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So a character can be hurt with a value of 0.5, for example, or hungry with a value of 0.9.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character with a hurt value of 0.7 will be more hurt than one with a value of 0.3.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> So, rather than belonging to a set or being excluded from it, everything can partially belong to the set, and some things can belong to more than others. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">In the terminology of fuzzy logic, these sets are called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">fuzzy sets </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, and the numeric value is called the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">degree of membership </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, a character with a hungry value of 0.9 is said to belong to the hungry set with a 0.9 degree of membership. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For each set, a degree of membership of 1 is given to something completely in the fuzzy set. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is equivalent to membership of the classical set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, the value of 0 indicates something completely outside the fuzzy set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When we look at the rules of logic, below, you’ll find that all the rules of traditional logic still work when set memberships are either 0 or 1. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In theory, we could use any range of numeric values to represent the degree of membership. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We are going to use consistent values from 0 to 1 for degree of membership in this book, in common with almost all fuzzy logic texts.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is quite common, however, to implement fuzzy logic using integers (oscale, for example) because integer arithmetic is faster and morena0to255 accurate than using floating point values. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whatever value we use doesn’t mean anything outside fuzzy logic.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A common mistake is to interpret the value as a probability or a percentage.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Occasionally, it helps to view it that way, but the results of applying fuzzy logic techniques will rarely be the same as if you applied probability techniques, and that can be confusing. </p>
<span origfont="g_font_13" data-canvas-width="171.60685363200002" style="left: 109.415px; top: 598.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01543); border-left: none;" yquantized="590" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.22724251199975" style="left: 109.176px; top: 628.713px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04846); border-left: none;" yquantized="620" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Membership of Multiple Sets </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Anything can be a member of multiple sets at the same time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character may be both hungry and hurt, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is the same for both classical and fuzzy sets. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Often, in traditional logic we have a group of predicates that are mutually exclusive.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A char- acter cannot be both hurt and healthy, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In fuzzy logic this is no longer the case. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A character can be hurt and healthy, it can be tall and short, and it can be confident and curious. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The character will simply have different degrees of membership for each set (e.g., it may be 0.5 hurt and 0.5 healthy). </p>
<span origfont="g_font_7" data-canvas-width="103.73457624000001" style="left: 109.415px; top: 715.089px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02708); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The fuzzy equivalent of mutual exclusion is the requirement that membership degrees sum to 1.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, if the sets of hurt and healthy characters are mutually exclusive, it would be invalid to have a character who is hurt 0.4 and healthy 0.7.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, if we had three mutually exclusive sets—confident, curious, and terrified—a character who is confident 0.2 and curious 0.4 will be terrified 0.4. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is rare for implementations of fuzzy decision making to enforce this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most implementations allow any sets of membership values, relying on the fuzzification method (see the next section) to give a set of membership values that approximately sum to 1.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In practice, values that are slightly off make very little difference to the results. </p>
<span origfont="g_font_13" data-canvas-width="77.389357056" style="left: 122.615px; top: 252.432px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0458); border-left: none;" yquantized="250" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.10888682399985" style="left: 122.615px; top: 282.875px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00071); border-left: none;" yquantized="280" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzification </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy logic only works with degrees of membership of fuzzy sets.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Since this isn’t the format that most games keep their data in, some conversion is needed.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Turning regular data into degrees of membership is called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">fuzzification </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">; turning it back is, not surprisingly, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">defuzzification </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_8" data-canvas-width="123.31454054399998" style="left: 122.615px; top: 342.285px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.970981); border-left: none;" yquantized="340" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.6761114799999" style="left: 122.615px; top: 369.142px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05686); border-left: none;" yquantized="360" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Numeric Fuzzification </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The most common fuzzification technique is turning a numeric value into the membership of one or more fuzzy sets.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Characters in the game might have a number of hit points, for example, which we’d like to turn into the membership of the "healthy" and "hurt" fuzzy sets. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is accomplished by a membership function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For each fuzzy set,a function maps the input value (hit points, in our case) to a degree of membership.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 5.38 shows two membership functions, one for the "healthy" set and one for the "hurt" set. </p>
<span origfont="g_font_42" data-canvas-width="51.12000000000001" style="left: 271.946px; top: 498.22px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.0224); border-left: 50px solid blue;" yquantized="490" class="highlight2" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_42" data-canvas-width="51.12000000000001" style="left: 271.946px; top: 498.22px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.0224); border-left: 50px solid blue;" yquantized="490" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_42" data-canvas-width="51.120960000000004" style="left: 304.942px; top: 516.815px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02242); border-left: 50px solid blue;" yquantized="510" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_42" style="left: 247.188px; top: 545.317px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="540" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_42" style="left: 245.086px; top: 645.215px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="640" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_42" data-canvas-width="53.11776000000001" style="left: 321.271px; top: 672.815px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0215); border-left: 50px solid blue;" yquantized="670" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Character BCharacter A 1HurtHealthy 0 0%100%Health value </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.38 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Membership functions </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">From this set of functions,we can read off the membership values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Two characters are marked: character A is healthy 0.8 and hurt 0.2, while character B is healthy 0.3 and hurt 0.7.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Note that in this case we’ve made sure the values output by the membership functions always sum to 1. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is no limit to the number of different membership functions that can rely on the same input value, and their values don’t need to add up to 1, although in most cases it is convenient if they do. </p>
<span origfont="g_font_8" data-canvas-width="186.231410688" style="left: 109.415px; top: 198.918px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.959962); border-left: none;" yquantized="190" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9881401120001" style="left: 109.415px; top: 225.775px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06002); border-left: none;" yquantized="220" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzification of Other Data Types </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a game context we often also need to fuzzify Boolean values and enumerations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The most common approach is to store pre-determined membership values for each relevant set. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A character might have a Boolean value to indicate if it is carrying a powerful artifact.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The membership function has a stored value for both true and false, and the appropriate value is chosen.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the fuzzy set corresponds directly to the Boolean value (if the fuzzy set is "possession of powerful artifact," for example), then the membership values will be 0 and 1. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The same structure holds for enumerated values,where there are more than two options: each possible value has a pre-determined stored membership value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a kung fu game, for example, characters might possess one of a set of sashes indicating their prowess.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To determine the degree of membership in the"fearsome fighter"fuzzy set, the membership function in Figure 5.39 could be used. </p>
<span origfont="g_font_13" data-canvas-width="91.53474969599999" style="left: 109.415px; top: 411.945px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05212); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.13160155200006" style="left: 109.176px; top: 442.39px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.98105); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Defuzzification </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">After applying whatever fuzzy logic we need, we are left with a set of membership values for fuzzy sets.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To turn it back into useful data, we need to use a defuzzification technique. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The fuzzification technique we looked at in the last section is fairly obvious and almost ubiquitous.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unfortunately, there isn’t a correspondingly obvious defuzzification method.  </p>
<span origfont="g_font_42" style="left: 220.217px; top: 546.81px; font-size: 13.32px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="540" class="highlight4" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_42" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> There </p>
<span origfont="g_font_42" style="left: 220.217px; top: 546.81px; font-size: 13.32px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="540" class="highlight4" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_42" style="left: 220.217px; top: 644.01px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="640" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_42" data-canvas-width="60.547200000000004" style="left: 308.537px; top: 672.215px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.02622); border-left: 50px solid blue;" yquantized="670" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;"> 1 0White    Gold    Green    Blue     Red    Brown  BlackKung Fu Sash </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.39 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Membership function for enumerated value </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">are several possible defuzzification techniques, and there is no clear consensus on which is the best to use.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> All have a similar basic structure, but differ in efficiency and stability of results. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Defuzzification involves turning a set of membership values into a single output value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The output value is almost always a number.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It relies on having a set of membership functions for the output value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We are trying to reverse the fuzzification method: to find an output value that would lead to the membership values we know we have. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is rare for this to be directly possible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In Figure 5.40, we have membership values of 0.2, 0.4, and 0.7 for the fuzzy sets "creep,""walk," and "run." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The membership functions show that there is no possible value for movement speed which would give us those membership values, if we fed it into the fuzzification system.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We would like to get as near as possible, however, and each method approaches the problem in a different way. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Itisworthnotingthatthereisconfusioninthetermsusedtodescribedefuzzificationmethods. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">You’lloftenfinddifferentalgorithmsdescribedunderthesamename.Thelackof anyrealmeaning in the degree of membership values means that different but similar methods often produce equally useful results, encouraging confusion and a diversity of approaches. </p>
<span origfont="g_font_8" data-canvas-width="170.09619455999996" style="left: 122.615px; top: 329.274px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.950258); border-left: none;" yquantized="320" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.26788991999973" style="left: 122.376px; top: 356.131px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04369); border-left: none;" yquantized="350" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using the Highest Membership </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can simply choose the fuzzy set that has the greatest degree of membership and choose an output value based on that.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our example above, the"run"membership value is 0.7, so we could choose a speed that is representative of running. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are four common points chosen: the minimum value at which the function returns 1 (i.e., the smallest value that would give a value of 1 for membership of the set), the maximum value (calculated the same way), the average of the two, and the bisector of the function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The bisector of the function is calculated by integrating the area under the curve of the membership function and choosing the point which bisects this area.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 5.41 shows this, along with other methods, for a single membership function. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although the integration process may be time consuming, it can be carried out once, possibly offline.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The resulting value is then always used as the representative point for that set. </p>
<span origfont="g_font_42" style="left: 218.617px; top: 563.592px; font-size: 13.32px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="560" class="highlight2" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_42" style="left: 218.617px; top: 563.592px; font-size: 13.32px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="560" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_42" data-canvas-width="43.61280000000001" style="left: 428.982px; top: 590.914px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01425); border-left: 50px solid blue;" yquantized="590" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_42" data-canvas-width="48.65279999999999" style="left: 417.923px; top: 623.314px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.992914); border-left: 50px solid blue;" yquantized="620" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_42" data-canvas-width="53.6064" style="left: 431.718px; top: 645.211px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01144); border-left: 50px solid blue;" yquantized="640" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_42" style="left: 218.617px; top: 663.01px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="660" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;"> 1Creep                       Walk                                  Run 0.7 for run 0.4 for walk 0.2 for creep 0Movement speed </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.40 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Impossible defuzzification </p></pre>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Average of the maximumBisectorMinimum of the maximum             Maximum of the maximum </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.41 </span><span origfont="g_font_7" data-canvas-width="234.61205692799996" style="left: 127.416px; top: 334.018px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.985765); border-left: none;" yquantized="330" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="234.61205692799996" style="left: 127.416px; top: 334.018px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.985765); border-left: none;" yquantized="330" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Minimum, average bisector, and maximum of the maximumFigure 5.41 shows all four values for the example. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is a very fast technique and simple to implement.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unfortunately,it provides only a coarse defuzzification.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character with membership values of 0 creep, 0 walk, 1 run will have exactly the same output speed as a character with 0.33 creep, 0.33 walk, 0.34 run. </p>
<span origfont="g_font_8" data-canvas-width="175.08868608" style="left: 109.415px; top: 414.708px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.946425); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.3157104" style="left: 109.176px; top: 441.566px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09101); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Blending Based on Membership </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Asimplewayaroundthislimitationistoblendeachcharacteristicpointbasedonitscorresponding degree of membership.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> So, a character with 0 creep, 0 walk, 1 run will use the characteristic speed for the run set (calculated in any of the ways we saw above: minimum, maximum, bisector, or average).  </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> A character with 0.33 creep, 0.33 walk, 0.34 run will have a speed given by (0.33 * characteristic creep speed) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">+ </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> (0.33 * characteristic walk speed) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">+ </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (0.34 * characteristic run speed). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The only proviso is to make sure that the multiplication factors are normalized.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is possible to have a character with 0.6 creep, 0.6 walk, 0.7 run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Simply multiplying the membership values by the characteristic points will likely give an output speed faster than running. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When the minimum values are blended, the resulting defuzzification is often called a Smallest of Maximum method, or Left of Maximum (LM).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, a blend of the maximums may be called Largest of Maximum (also occasionally LM!), or Right of Maximum.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The blend of the average values can be known as Mean of Maximum (MoM). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unfortunately, some references are based on having only one membership function involved in defuzzification.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In these references you will find the same method names used to repre- sent the unblended forms.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Nomenclature among defuzzification methods is often a matter of guesswork. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In practice, it doesn’t matter what they are called, as long as you can find one that works for you. </p>
<span origfont="g_font_7" data-canvas-width="37.38963780000001" style="left: 109.427px; top: 700.669px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.983938); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Center of Gravity </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">This technique is also known as </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">centroid of area </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This method takes into account all the member- ship values, rather than just the largest. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">First, each membership function is cropped at the membership value for its corresponding set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So,if a character has a run membership of 0.4,the membership function is cropped above 0.4. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is shown in Figure 5.42 for one and for the whole set of functions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The center of mass of the cropped regions is then found by integrating each in turn.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This point is used as the output value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The center of mass point is labeled in the figure. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using this method takes time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unlike the bisector of area method, we can’t do the integration offline because we don’t know in advance what level each function will be cropped at.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The resulting integration (often numeric, unless the membership function has a known integral) can take time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is worth noting that this center of gravity method, while often used, differs from the identi- cally named method in the Institute of Electrical and Electronics Engineers (IEEE) specification for fuzzy control.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The IEEE version doesn’t crop each function before calculating its center of gravity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The resulting point is therefore constant for each membership function and so would come under a blended points approach in our categorization. </p>
<span origfont="g_font_8" data-canvas-width="205.25452492799997" style="left: 122.615px; top: 375.735px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.954672); border-left: none;" yquantized="370" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.08139004799995" style="left: 122.376px; top: 402.593px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03397); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Choosing a Defuzzification Approach </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although the center of gravity approach is favored in many fuzzy logic applications, it is fairly complex to implement and can make it harder to add new membership functions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The results provided by the blended points approach is often just as good and is much quicker to calculate. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It also supports an implementation speed up that removes the need to use membership functions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rather than calculating the representative points of each function, you can simply specify values directly.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These values can then be blended in the normal way.  </p>
<span origfont="g_font_42" data-canvas-width="39.4848" style="left: 409.212px; top: 646.464px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.01243); border-left: 50px solid blue;" yquantized="640" class="highlight4" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_42" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> In our example we </p>
<span origfont="g_font_42" data-canvas-width="39.4848" style="left: 409.212px; top: 646.464px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.01243); border-left: 50px solid blue;" yquantized="640" class="highlight4" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 696.735px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="690" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Center of gravity </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.42 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Membership function cropped, and all membership functions cropped </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">can specify that a creep speed is 0.2 meters per second, while a walk is 1 meter per second, and a run is 3 meters per second.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The defuzzification is then simply a weighted sum of these values, based on normalized degrees of membership. </p>
<span origfont="g_font_8" data-canvas-width="190.46355148799995" style="left: 109.415px; top: 155.432px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.959947); border-left: none;" yquantized="150" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.64024612000014" style="left: 109.415px; top: 182.289px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07172); border-left: none;" yquantized="180" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Defuzzification to a Boolean Value </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To arrive at a Boolean output, we use a single fuzzy set and a cut-off value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the degree of membership for the set is less than the cut-off value,the output is considered to be false;otherwise, it is considered to be true. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If several fuzzy sets need to contribute to the decision, then they are usually combined using a fuzzy rule (see below) into a single set, which can then be defuzzified to the output Boolean. </p>
<span origfont="g_font_8" data-canvas-width="221.04256204799995" style="left: 109.415px; top: 270.609px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.976291); border-left: none;" yquantized="270" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9271690000001" style="left: 109.415px; top: 297.467px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.08806); border-left: none;" yquantized="290" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Defuzzification to an Enumerated Value </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Themethodfordefuzzifyinganenumeratedvaluedependsonwhetherthedifferentenumerations form a series or if they are independent categories.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our previous example of kung fu belts forms a series: the belts are in order, and they fall in increasing order of prowess.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By contrast, a set of enumerated values might represent different actions to carry out: a character may be deciding whether to eat, sleep, or watch a movie.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These cannot easily be placed in any order. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Enumerations that can be ordered are often defuzzified as a numerical value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each of the enumerated values corresponds to a non-overlapping range of numbers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The defuzzification is carriedoutexactlyasforanyothernumericaloutput,andthenanadditionalstepplacestheoutput into its appropriate range, turning it into one of the enumerated options.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 5.43 shows this in action for the kung fu example: the defuzzification results in a "prowess" value, which is then converted into the appropriate belt color. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Enumerations that cannot be ordered are usually defuzzified by making sure a fuzzy set corresponds to each possible option.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There may be a fuzzy set for "eat," another for "sleep," and another for "watch movie." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">" The set that has the highest membership value is chosen, and its corresponding enumerated value is output. </p>
<span origfont="g_font_13" data-canvas-width="101.24141568" style="left: 109.415px; top: 540.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03308); border-left: none;" yquantized="540" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.98455357600017" style="left: 109.415px; top: 571.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.995628); border-left: none;" yquantized="570" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Combining Facts </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Now that we’ve covered fuzzy sets and their membership, and how to get data in and out of fuzzy logic, we can look at the logic itself.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Fuzzy logic is similar to traditional logic; logical operators (such as AND, OR, and NOT) are used to combine the truth of simple facts to understand the truth of complex facts.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we know the two separate facts "it is raining" and "it is cold," then we know the statement "it is raining and cold" is also true. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unlike traditional logic,now each simple fact is not true or false,but is a numerical value—the degree of membership of its corresponding fuzzy set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It might be partially raining (membership of 0.5) and slightly cold (membership of 0.2).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need to be able to work out the truth value for compound statements such as "it is raining and cold." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In traditional logic we use a truth table,which tells us what the truth of a compound statement is based on the different possible truth values of its constituents.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So AND is represented as: </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.43 </span>
<span origfont="g_font_8" data-canvas-width="134.78202288" style="left: 140.616px; top: 442.791px; font-size: 16.5877px; font-family: serif; transform: scaleX(5.18392); border-left: none;" yquantized="440" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Enumerated defuzzification in a range </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">ABA </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">AND </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">B </p>
<span origfont="g_font_7" data-canvas-width="440.9885114400001" style="left: 140.615px; top: 540.979px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06777); border-left: none;" yquantized="540" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> false    false    false false    true    false true    false    false true    true    trueIn fuzzy logic each operator has a numerical rule that lets us calculate the degree of truth based on the degrees of truth of each of its inputs.  </p>
<span origfont="g_font_8" style="left: 285.547px; top: 578.135px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="570" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The fuzzy rule for AND is </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> m </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">), </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">AND </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">) </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">AB </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the degree of membership of set </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">(i.e., the truth value of </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">).  </p>
<span origfont="g_font_8" data-canvas-width="95.1627552" style="left: 140.608px; top: 641.072px; font-size: 16.5877px; font-family: serif; transform: scaleX(3.66011); border-left: none;" yquantized="640" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> As promised, the truth table for traditional logic corresponds to this rule, when 0 is used for false and 1 is used for true: </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">ABA </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">AND </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">B </p>
<span origfont="g_font_7" data-canvas-width="95.1627552" style="left: 140.615px; top: 658.832px; font-size: 16.5877px; font-family: serif; transform: scaleX(5.28682); border-left: 50px solid orange;" yquantized="650" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 000 010 100 111 </p></pre>
</html></html><html><html><p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The corresponding rule for OR is </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">(,) </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">OR </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">max </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">m </span>
<span origfont="g_font_7" data-canvas-width="82.09222250400002" style="left: 109.418px; top: 148.617px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00112); border-left: none;" yquantized="140" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">B </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> and for NOT it is </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> () </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1 </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> m </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_7" data-canvas-width="17.31455064" style="left: 304.051px; top: 172.144px; font-size: 11.6114px; font-family: serif; transform: scaleX(1.0185); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">NOT </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">AA </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that just like traditional logic, the NOT operator only relates to a single fact, whereasAND and OR relate to two facts. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The same correspondences present in traditional logic are used in fuzzy logic.  </p>
<span origfont="g_font_9" style="left: 283.976px; top: 238.686px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="230" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> So, </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(). </p>
<span origfont="g_font_8" style="left: 244.201px; top: 242.153px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="240" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">OR </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">NOTNOT </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">AND NOT </span>
<span origfont="g_font_7" data-canvas-width="381.7389367199999" style="left: 127.412px; top: 268.502px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.994112); border-left: none;" yquantized="260" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">B </p>
<span origfont="g_font_7" data-canvas-width="256.451670144" style="left: 127.412px; top: 295.987px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.17101); border-left: none;" yquantized="290" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Using these correspondences, we get the following table of fuzzy logic operators:Expression     Equivalent         Fuzzy EquationNOT </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">1 </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> m </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> (,) </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">AND </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">min </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">OR </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">max </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> m </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">) </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">AB </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">XOR </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">NOT( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) AND </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">min </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1 </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) ( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">,) </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">NOT( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) AND </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">min1 </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">NOR </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">NOT( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">OR </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">)1 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> max </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> m </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">) </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">AB </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">NAND </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">NOT( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">AND </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">)1 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">B </span>
<span origfont="g_font_7" data-canvas-width="440.586819408" style="left: 127.415px; top: 444.381px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02101); border-left: none;" yquantized="440" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">These definitions are, by far, the most common.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some researchers have proposed the use of alternative definitions for AND and OR and therefore also for the other operators.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is reasonably safe to use these definitions; alternative formulations are almost always made explicit when they are used. </p>
<span origfont="g_font_13" data-canvas-width="69.90922752" style="left: 109.415px; top: 526.376px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.984637); border-left: none;" yquantized="520" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.05150224799985" style="left: 109.415px; top: 556.82px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03158); border-left: none;" yquantized="550" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy Rules </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The final element of fuzzy logic we’ll need is the concept of a fuzzy rule.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Fuzzy rules relate the known membership of certain fuzzy sets to generate new membership values for other fuzzy sets. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We might say, for example,"If we are close to the corner and we are traveling fast, then we should brake." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This rule relates two input sets: "close to the corner" and "traveling fast." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">" It determines the degree of membership of the third set,"should brake." </p>
<span origfont="g_font_9" style="left: 265.952px; top: 668.499px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="660" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">"Using the definition for AND given above, we can see that: </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(,). </p>
<span origfont="g_font_8" style="left: 201.422px; top: 671.936px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">Should Brake </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">min </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">Close to the Corner </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">Traveling Quickly </span>
<span origfont="g_font_7" data-canvas-width="441.6675622559998" style="left: 127.422px; top: 700.718px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01767); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we knew that we were "close to the corner" with a membership of 0.6 and "traveling fast" with a membership of 0.9, then we would know that our membership of "should brake" is 0.6. </p>
<span origfont="g_font_7" data-canvas-width="447.39645576" style="left: 109.417px; top: 715.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00313); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;">5.5.3 </span>
<span origfont="g_font_7" data-canvas-width="458.9391241200001" style="left: 122.615px; top: 125.853px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0501); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy Logic Decision Making </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are several things we can do with fuzzy logic in order to make decisions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use it in any system where we’d normally have traditional logic AND, NOT, and OR.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can be used to determine if transitions in a state machine should fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can be used also in the rules of the rule-based system discussed later in the chapter. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this section,we’ll look at a different decision making structure that uses only rules involving the fuzzy logic AND operator. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm doesn’t have a name.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Developers often simply refer to it as "fuzzy logic." </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">" It is taken from a sub-field of fuzzy logic called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">fuzzy control </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">and is typically used to build industrial controllers that take action based on a set of inputs. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Some pundits call it a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">fuzzy state machine </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, a name given more often to a different algorithm that we’ll look at in the next section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Inevitably, we could say that the nomenclature for these algorithms is somewhat fuzzy. </p>
<span origfont="g_font_13" data-canvas-width="77.11103999999999" style="left: 122.615px; top: 325.239px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04204); border-left: none;" yquantized="320" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.95227475199977" style="left: 122.615px; top: 355.683px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05611); border-left: none;" yquantized="350" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Problem </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In many problems a set of different actions can be carried out, but it isn’t always clear which one is best.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Often, the extremes are very easy to call, but there are gray areas in the middle.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is particularly difficult to design a solution when the set of actions is not on/off but can be applied with some degree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Take the example mentioned above of driving a car.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The actions available to the car include steering and speed control (acceleration and braking), both of which can be done to a range of degrees.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is possible to brake sharply to a halt or simply tap the brake to shed some speed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the car is traveling headlong at high speed into a tight corner, then it is pretty clear we’d like to brake.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the car is out of a corner at the start of a long straightaway, then we’d like to floor the accelerator.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These extremes are clear, but exactly when to brake and how hard to hit the pedal are gray areas that differentiate the great drivers from the mediocre. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The decision making techniques we’ve used so far will not help us very much in these circum- stances.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could build a decision tree or finite state machine, for example, to help us brake at the right time, but it would be an either/or process. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A fuzzy logic decision maker should help to represent these gray areas.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use fuzzy rules written to cope with the extreme situations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These rules should generate sensible (although not necessarily optimal) conclusions about which action is best in any situation. </p>
<span origfont="g_font_13" data-canvas-width="88.04000563199999" style="left: 122.615px; top: 627.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03576); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.8673933999999" style="left: 122.615px; top: 657.513px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05004); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The decision maker has any number of crisp inputs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These may be numerical, enumerated, orBoolean values. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each input is mapped into fuzzy states using membership functions as described earlier. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some implementations require that an input be separated into two or more fuzzy states so that the sum of their degrees of membership is 1.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In other words, the set of states represents all </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;">In coverExposedAngle of exposureHurtHealthyHit points leftEmptyHas ammoOverloadedAmmo </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.44 </p><span origfont="g_font_7" data-canvas-width="458.9283645120001" style="left: 109.412px; top: 441.237px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0312); border-left: none;" yquantized="440" class="highlight2"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="458.9283645120001" style="left: 109.412px; top: 441.237px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0312); border-left: none;" yquantized="440" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Exclusive mapping to states for fuzzy decision making possible states for that input.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We will see how this property allows us optimizations later in the section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 5.44 shows an example of this with three input values: the first and second have two corresponding states, and the third has three states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So the set of crisp inputs is mapped into lots of states, which can be arranged in mutually inclusive groups. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In addition to these input states, we have a set of output states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These output states are normal fuzzy states, representing the different possible actions that the character can take. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Linking the input and output states is a set of fuzzy rules.  </p>
<span origfont="g_font_7" data-canvas-width="86.91133137599999" style="left: 194.652px; top: 565.964px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.998981); border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Typically, rules have the structure: input 1 state AND </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">... </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">AND input </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<span origfont="g_font_7" data-canvas-width="376.8732028800001" style="left: 127.416px; top: 589.934px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997019); border-left: none;" yquantized="580" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="269.42775739200005" style="left: 195.453px; top: 615.686px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.991415); border-left: none;" yquantized="610" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="440.828312832" style="left: 127.416px; top: 657.481px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0001); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">state THEN output stateFor example, using the three inputs in Figure 5.44, we might have rules such as: chasing AND corner-entry AND going-fast THEN brake leading AND mid-corner AND going-slow THEN accelerateRules are structured so that each clause in a rule is a state from a different crisp input.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clauses are always combined with a fuzzy AND.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our example, there are always three clauses because we had three crisp inputs, and each clause represents one of the states from each input. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">It is a common requirement to have a complete set of rules: one for each combination of states from each input.  </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> For our example, this would produce 18 rules (2 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">× </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 3 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">× </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3). </p>
<span origfont="g_font_7" data-canvas-width="13.2701832" style="left: 455.405px; top: 715.057px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02078); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To generate the output, we go through each rule and calculate the degree of membership for the output state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is simply a matter of taking the minimum degree of membership for the input states in that rule (since they are combined using AND).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The final degree of membership for each output state will be the maximum output from any of the applicable rules. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For example,in an oversimplified version of the previous example,we have two inputs (corner position and speed), each with two possible states.  </p>
<span origfont="g_font_7" data-canvas-width="202.94772609600003" style="left: 238.444px; top: 197.22px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00092); border-left: none;" yquantized="190" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="253.68047332799998" style="left: 140.376px; top: 277.151px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0065); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="83.84125656" style="left: 310.222px; top: 306.489px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02545); border-left: none;" yquantized="300" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="166.21801092000004" style="left: 122.61px; top: 386.421px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01974); border-left: none;" yquantized="380" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_9" style="left: 325.178px; top: 409.399px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="400" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The rule block looks like the following: corner-entry AND going-fast THEN brake corner-exit AND going-fast THEN accelerate corner-entry AND going-slow THEN accelerate corner-exit AND going-slow THEN accelerateWe might have the following degrees of membership:Corner-entry: 0.1Corner-exit: 0.9Going-fast: 0.4Going-slow: 0.6Then the results from each rule are </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">,. </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_7" data-canvas-width="27.293538959999996" style="left: 295.015px; top: 412.866px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.974769); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Brakemin010401 </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">,. </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_7" data-canvas-width="48.28672968" style="left: 273.879px; top: 430.141px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.985443); border-left: none;" yquantized="430" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Acceleratemin090404Accelerate </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 6 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1Accelerate </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 9 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 6 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="440.9837293919999" style="left: 140.567px; top: 492.798px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03761); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 6So, the final value for brake is 0.1, and the final value for accelerate is the maximum of the degrees given by each rule, namely, 0.6. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The pseudo-code below includes a shortcut that means we don’t need to calculate all the values for all the rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When considering the second acceleration rule, for example, we know that the accelerate output will be at least 0.4 (the result from the first accelerate rule).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As soon as we see the 0.1 value, we know that this rule will have an output of no more than 0.1 (since it takes the minimum).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With a value of 0.4 already, the current rule cannot possibly be the maximum value for acceleration, so we may as well stop processing this rule. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">After generating the correct degrees of membership for the output states, we can perform defuzzification to determine what to do (in our example, we might output a numeric value to indicate how hard to accelerate or break—in this case, a reasonable acceleration). </p>
<span origfont="g_font_8" data-canvas-width="79.691928576" style="left: 122.615px; top: 673.855px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.960144); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.15312076800006" style="left: 122.615px; top: 700.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01135); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule Structure </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is worth being clear about the rule structure we’ve used above.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a structure that makes it efficient to calculate the degree of membership of the output state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rules can be stored simply as </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">a list of states, and they are always treated the same way because they are the same size (one clause per input variable), and their clauses are always combined using AND. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve come across several misleading papers,articles,and talks that have presented this struc- ture as if it were somehow fundamental to fuzzy logic itself.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is nothing wrong with using any rule structure involving any kind of fuzzy operation (AND, OR, NOT, etc.) and any number of clauses.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For very complex decision making with lots of inputs, parsing general fuzzy logic rules can be faster. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With the restriction that the set of fuzzy states for one input represents all possible states, and with the added restriction that all possible rule combinations are present (we’ll call these block format rules), the system has a neat mathematical property.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Any general rules using any number of clauses combined with any fuzzy operators can be expressed as a set of block format rules. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If you are having trouble seeing this, observe that with a complete set of ANDed rules we can specify any truth table we like (try it).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Any set of consistent rules will have its own truth table, and we can directly model this using the block format rules. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In theory, any set of (non-contradictory) rules can be transformed into our format.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Although there are transformations for this purpose,they are only of practical use for converting an existing set of rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For developing a game, it is better to start by encoding rules in the format they are needed. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 109.415px; top: 379.739px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="370" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="324.24676463999987" style="left: 109.415px; top: 410.182px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01011); border-left: none;" yquantized="410" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 112.524px; top: 445.81px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The fuzzy decision maker can be implemented in the following way: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 445.81px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 460.21px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def fuzzyDecisionMaker(inputs, membershipFns, rules): </p><span origfont="g_font_7" style="left: 112.524px; top: 474.61px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="470" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 489.01px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Will hold the degrees of membership for each input </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># state and output state, respectively inputDom = [] </p><span origfont="g_font_7" style="left: 112.524px; top: 517.81px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 532.21px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">outputDom = [0,0,...,0] </p><span origfont="g_font_7" style="left: 112.524px; top: 546.61px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Convert the inputs into state values for i in 0..len(inputs): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 575.41px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 589.81px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Get the input value </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 604.21px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">input = inputs[i] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 618.61px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Get the membership functions for this input membershipFnList = membershipFns[i] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 647.411px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Go through each membership function </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 676.211px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 690.611px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for membershipFn in membershipFnList: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 705.01px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Convert the input into a degree of membership </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">inputDom[membershipFn.stateId] = </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">membershipFn.dom(input) </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Go through each rule </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for rule in rules: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Get the current output d.o.m.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> for the conclusion state best = outputDom[rule.conclusionStateId] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 29 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Hold the minimum of the inputDoms seen so far </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">min=1 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 31 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Go through each state in the input of the rule </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 33 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 301.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for state in rule.inputStateIds: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 34 35 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Get the d.o.m.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> for this input state dom = inputDom[state] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 36 37 38 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># If we’re smaller than the best conclusion so </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 39 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># far, we may as well exit now, because even if </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 40 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># we are the smallest in this rule, the # conclusion will not be the best overall </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 42 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if dom &lt; best: break continue # i.e., go to next rule </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 43 44 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # Check if we’re the lowest input d.o.m.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> so far </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 45 46 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if dom &lt; min: min = dom </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 47 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # min now holds the smallest d.o.m.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> of the inputs, </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 48 49 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># and because we didn’t break above, we know it is # larger than the current best, so write the current </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 50 51 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># best. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> outputDom[rule.conclusionStateId] = min </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 589.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 52 53 54 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 604.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Return the output state degrees of membership </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 55 </span><span origfont="g_font_7" data-canvas-width="441.17979335999996" style="left: 140.615px; top: 631.215px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02125); border-left: none;" yquantized="630" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return outputDom </p></pre>
<span origfont="g_font_7" data-canvas-width="441.17979335999996" style="left: 140.615px; top: 631.215px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02125); border-left: none;" yquantized="630" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The function takes as input the set of input variables, a list of lists of membership functions, and a list of rules. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The membership functions are organized in lists where each function in the list operates on the same input variable.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> These lists are then combined in an overall list with one element per input variable.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">inputs </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">membershipFns </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">lists therefore have the same number of elements. </p>
<span origfont="g_font_7" data-canvas-width="45.219045888" style="left: 122.62px; top: 703.209px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02771); border-left: none;" yquantized="700" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<span origfont="g_font_35" data-canvas-width="139.87584" style="left: 137.39px; top: 156.752px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="150" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">We have treated the membership functions as structures with the following form: </p>
<span origfont="g_font_35" data-canvas-width="139.87584" style="left: 137.39px; top: 156.752px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="150" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> struct MembershipFunction: </p><span origfont="g_font_7" style="left: 112.524px; top: 174.687px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 189.087px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">stateId </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 216.145px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="210" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def dom(input) </p></pre>
<span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 216.145px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="210" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">stateId </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the unique integer identifier of the fuzzy state for which the function calculates degree of membership.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If membership functions define a zero-based continuous set of identifiers, then the corresponding degrees of membership can be simply stored in an array. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 294.974px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="290" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Rules also act as structures in the code above and have the following form: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 294.974px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="290" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 309.374px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct FuzzyRule: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 323.774px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">inputStateIds </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="46.794730704" style="left: 109.415px; top: 350.833px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01728); border-left: none;" yquantized="350" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">conclusionStateId </p></pre>
<span origfont="g_font_7" data-canvas-width="46.794730704" style="left: 109.415px; top: 350.833px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01728); border-left: none;" yquantized="350" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> where the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">inputStateIds </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">is a list of the identifiers for the states on the left-hand side of the rule, and the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">conclusionStateId </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is an integer identifier for the output state on the right-hand side of the rule. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The conclusion state id is also used to allow the newly generated degree of membership to be written to an array.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The id numbers for input and output states should both begin from 0 and be continuous (i.e., there is an input 0 and an output 0, an input 1 and an output 1, and so on).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are treated as indices into two separate arrays. </p>
<span origfont="g_font_13" data-canvas-width="134.11725926399998" style="left: 109.415px; top: 470.142px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06442); border-left: none;" yquantized="470" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0263964959999" style="left: 109.415px; top: 500.585px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01478); border-left: none;" yquantized="500" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementation Notes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The code illustrated above can often be implemented for SIMD hardware, such as the PC’s SSE extensions or (less beneficially) a vector unit on PS2.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case the short circuit code illustrated will be omitted; such heavy branching isn’t suitable for parallelizing the algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a real implementation, it is common to retain the degrees of membership for input values that stay the same from frame to frame, rather than sending them through the membership functions each time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The rule block is large, but predictable.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because every possible combination is present, it is possible to order the rules so they do not need to store the list of input state ids.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A single array containing conclusions can be used, which is indexed by the offsets for each possible input state combination. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 670.269px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_9" style="left: 210.555px; top: 697.246px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="690" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Performance </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> + </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in memory,where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of input states,and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of output states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It simply holds the degree of membership for each. </p>
<span origfont="g_font_7" data-canvas-width="322.618477296" style="left: 109.415px; top: 715.107px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01452); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Outside the algorithm itself, the rules need to be stored.  </p>
<span origfont="g_font_7" style="left: 319.906px; top: 135.268px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="130" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> This requires:O </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> k k </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">... </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="76.08238368" style="left: 122.615px; top: 175.354px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03904); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> i </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> memory, where </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> i </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of states per input variable, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">i </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of input variables.  </p>
<span origfont="g_font_8" style="left: 320.699px; top: 216.012px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="210" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> So, </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> n </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_8" style="left: 375.384px; top: 220.359px; font-size: 11.6114px; font-family: serif; border-left: none;" yquantized="220" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> k k </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">... </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="78.97074067199999" style="left: 140.616px; top: 253.629px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02559); border-left: none;" yquantized="250" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </p>
<span origfont="g_font_7" style="left: 317.934px; top: 290.511px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="290" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm isO </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">in </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> k k </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">... </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="84.93515004000001" style="left: 122.621px; top: 328.099px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03579); border-left: none;" yquantized="320" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> i </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> in time.  </p>
<span origfont="g_font_8" style="left: 359.666px; top: 354.371px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="350" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> There are </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> n </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> k </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">... </p>
<span origfont="g_font_8" style="left: 333.469px; top: 371.56px; font-size: 11.6114px; font-family: serif; border-left: none;" yquantized="370" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> k </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">0 </span>
<span origfont="g_font_7" data-canvas-width="109.808972712" style="left: 122.615px; top: 391.977px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00742); border-left: none;" yquantized="390" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">i </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> rules, and each one has </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">i </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">clauses.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each clause needs to be evaluated in the algorithm. </p>
<span origfont="g_font_13" data-canvas-width="69.8661888" style="left: 122.328px; top: 438.038px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01473); border-left: none;" yquantized="430" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.84946071999985" style="left: 122.615px; top: 468.482px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02371); border-left: none;" yquantized="460" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Weaknesses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The overwhelming weakness of this approach is its lack of scalability.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It works well for a small number of input variables and a small number of states per variable.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To process a system with 10 input variables, each with 5 states, would require almost 10 million rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is well beyond the ability of anyone to create. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For larger systems of this kind, we can either use a small number of general fuzzy rules, or we can use the Combs method for creating rules, where the number of rules scales linearly with the number of input states. </p>
<span origfont="g_font_13" data-canvas-width="91.84462848" style="left: 122.615px; top: 600.944px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03196); border-left: none;" yquantized="600" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="395.922491088" style="left: 122.615px; top: 631.388px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01001); border-left: none;" yquantized="630" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Combs Method </p>
<span origfont="g_font_7" data-canvas-width="97.93634304" style="left: 303.185px; top: 660.14px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.941306); border-left: none;" yquantized="660" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="94.44186146400001" style="left: 122.615px; top: 688.892px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.983769); border-left: none;" yquantized="680" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_39" style="left: 562.376px; top: 709.299px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Combs method relies on a simple result from classical logic: a rule of the form: a AND b ENTAILS c can be expressed as: </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> , </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (a ENTAILS c) OR (b ENTAILS c) </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">where ENTAILS is a Boolean operator with its own truth table: a       b       a ENTAILS b true    true    true true    false    false false    true    true false    false    trueAs an exercise you can create the truth tables for the previous two logical statements and check that they are equal. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The ENTAILS operator is equivalent to "IF </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">a </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">THEN </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">b </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">." </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">" It says that should </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">a </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">be true, then </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">b </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> must be true.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">a </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is not true, then it doesn’t matter if </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">b </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is true or not. </p>
<span origfont="g_font_7" data-canvas-width="91.76750112000002" style="left: 273.702px; top: 314.003px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.965536); border-left: none;" yquantized="310" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">At first glance it may seem odd that: false ENTAILS true </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> true </span>
<span origfont="g_font_7" data-canvas-width="211.04731989599998" style="left: 109.415px; top: 342.755px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.995506); border-left: none;" yquantized="340" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> but this is quite logical.  </p>
<span origfont="g_font_39" style="left: 419.112px; top: 368.041px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="360" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Suppose we say that: </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<span origfont="g_font_7" data-canvas-width="163.63690051199998" style="left: 255.507px; top: 371.508px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0101); border-left: none;" yquantized="370" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="441.029158848" style="left: 127.42px; top: 400.26px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02327); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">IF I’m-in-the-bath THEN I’m-wetSo, if I’m in the bath then you are going to be wet (ignoring the possibility that you’re in an empty bath, of course).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But you can be wet for many other reasons: getting caught in the rain, being in the shower, and so on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So you’re-wet can be true and you’re-in-the-bath can be false, and the rule would still be valid. </p>
<span origfont="g_font_7" data-canvas-width="97.21903584000002" style="left: 290.344px; top: 487.066px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.962565); border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="12.325728719999999" style="left: 109.415px; top: 515.34px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.948133); border-left: none;" yquantized="510" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_39" style="left: 415.167px; top: 538.628px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="530" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">What this means is that we can write:IF a AND b THEN c as: </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<span origfont="g_font_7" data-canvas-width="155.660444448" style="left: 259.464px; top: 542.095px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.991468); border-left: none;" yquantized="540" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="441.05546011200005" style="left: 127.42px; top: 568.851px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02156); border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="60.51681744000001" style="left: 306.579px; top: 611.65px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.976078); border-left: none;" yquantized="610" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (IF a THEN c) or (IF b THEN c)Previously, we said that the conclusions of rules are ORed together, so we can split the new format rule into two separate rules:IF a THEN cIF b THEN c </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_7" data-canvas-width="441.0530690880001" style="left: 127.42px; top: 656.231px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04928); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For the purpose of this discussion, we’ll call this the Combs format (although that’s not a widely used term). </p>
<span origfont="g_font_7" data-canvas-width="10.173807120000001" style="left: 263.564px; top: 715.576px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.924892); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The same thing works for larger rules:IF </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">a </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">AND </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">... </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">AND </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">a </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">THEN c </p>
</html></html><html><html><p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">can be rewritten as:IF </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">a </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">THEN c </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> . </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">IF </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">a </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">THEN c </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_8" style="left: 335.982px; top: 164.131px; font-size: 11.6114px; font-family: serif; border-left: none;" yquantized="160" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="441.001662072" style="left: 140.619px; top: 184.467px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.995489); border-left: none;" yquantized="180" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> n </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So, we’ve gone from having rules involving all possible combinations of states to a simple set of rules with only one state in the IF-clause and one in the THEN-clause. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because we no longer have any combinations, there will be the same number of rules as there are input states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our example of 10 inputs with 5 states each gives us 50 rules only, rather than 10 million. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If rules can always be decomposed into this form, then why bother with the block format rules at all?  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Well, so far we’ve only looked at decomposing one rule, and we’ve hidden a problem. </p>
<span origfont="g_font_7" data-canvas-width="215.864037744" style="left: 238.28px; top: 313.247px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.995863); border-left: none;" yquantized="310" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="182.21276596799993" style="left: 140.619px; top: 357.434px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01229); border-left: none;" yquantized="350" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="137.559197256" style="left: 277.433px; top: 385.576px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01325); border-left: none;" yquantized="380" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="440.97655632000004" style="left: 140.619px; top: 464.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04057); border-left: none;" yquantized="460" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Consider the pair of rules:IF corner-entry AND going-fast THEN brakeIF corner-exit AND going-fast THEN accelerateThese get decomposed into four rules:IF corner-entry THEN brakeIF going-fast THEN brakeIF corner-exit THEN accelerateIF going-fast THEN accelerateThis is an inconsistent set of rules; we can’t both brake and accelerate at the same time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So when we’re going fast, which is it to be?  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The answer, of course, is that it depends on where we are in the corner. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So, while one rule can be decomposed, more than one rule cannot.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unlike for block format rules, we cannot represent any truth table using Combs format rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because of this, there is no possible transformation that converts a general set of rules into this format.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It may just so happen that a particular set of rules can be converted into the Combs format, but that is simply a happy coincidence. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Combs method instead starts from scratch: the fuzzy logic designers build up rules, limiting themselves to the Combs format only.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The overall sophistication of the fuzzy logic system will inevitably be limited, but the tractability of creating the rules means they can be tweaked more easily. </p>
<span origfont="g_font_7" data-canvas-width="202.94772609600003" style="left: 238.447px; top: 665.254px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00092); border-left: none;" yquantized="660" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our running example, which in block format was corner-entry AND going-fast THEN brake corner-exit AND going-fast THEN accelerate corner-entry AND going-slow THEN accelerate corner-exit AND going-slow THEN accelerate </p>
</html></html><html><html><p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">could be expressed as: corner-entry THEN brake corner-exit THEN accelerate going-fast THEN brake going-slow THEN accelerateWith inputs of:Corner-entry: 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1Corner-exit: 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 9 </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<span origfont="g_font_7" data-canvas-width="61.968169008" style="left: 310.095px; top: 262.499px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.983622); border-left: none;" yquantized="260" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Going-fast: 04Going-slow: 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="189.67395635999998" style="left: 109.428px; top: 304.975px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.998284); border-left: none;" yquantized="300" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="27.293538959999996" style="left: 321.177px; top: 335.509px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.974769); border-left: none;" yquantized="330" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 6 the block format rules give us results of:Brake </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0.1 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </p>
<span origfont="g_font_7" data-canvas-width="145.11602860800002" style="left: 109.428px; top: 382.086px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993945); border-left: none;" yquantized="380" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="27.293538959999996" style="left: 321.177px; top: 408.531px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.974769); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Accelerate0.6 while Combs method gives us:Brake </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0.4Accelerate </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<span origfont="g_font_7" data-canvas-width="441.2395689600002" style="left: 127.193px; top: 451.007px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00282); border-left: none;" yquantized="450" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0.9When both sets of results are defuzzified, they are both likely to lead to a modest acceleration. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Combs method is surprisingly practical in fuzzy logic systems.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the Combs method were used in classical logic (building conditions for state transitions, for example), it would end up hopelessly restrictive.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But, in fuzzy logic, multiple fuzzy states can be active at the same time, and this means they can interact with one another (we can both brake and accelerate,for example,but the overall speed change depends on the degree of membership of both states).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This interaction means that the Combs method produces rules that are still capable of producing interaction effects between states, even though those interactions are no longer explicit in the rules. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 595.375px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.5.4 </span>
<span origfont="g_font_7" data-canvas-width="459.2176784160002" style="left: 109.176px; top: 628.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00975); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fuzzy State Machines </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although developers regularly talk about fuzzy state machines, they don’t always mean the same thing by it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A fuzzy state machine can be any state machine with some element of fuzziness.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can have transitions that use fuzzy logic to trigger,or it might use fuzzy states rather than conventional states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It could even do both. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although we’ve seen several approaches, with none of them particularly widespread, as an example we’ll look at a simple state machine with fuzzy states, but with crisp triggers for transitions. </p>
<span origfont="g_font_7" data-canvas-width="54.10887311999999" style="left: 109.415px; top: 715.076px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04056); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Problem </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Regular state machines are suitable when the character is clearly in one state or another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As we have seen, there are many situations in which gray areas exist.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’d like to be able to have a state machine that can sensibly handle state transitions while allowing a character to be in multiple states at the same time. </p>
<span origfont="g_font_13" data-canvas-width="88.04000563199999" style="left: 122.615px; top: 202.511px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03576); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1602938399998" style="left: 122.615px; top: 232.954px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00253); border-left: none;" yquantized="230" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the conventional state machine we kept track of the current state as a single value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now we can be in any or even all states with some degree of membership (DOM).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each state therefore has its own DOM value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To determine which states are currently active (i.e., have a DOM greater than zero), we can simply look through all states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most practical applications, only a subset of the states will be active at one time,so it can be more efficient to keep a separate list of all active states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At each iteration of the state machine, the transitions belonging to all active states are given the chance to trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first transition in each active state is fired.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This means that multiple transitions can happen in one iteration.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is essential for keeping the fuzziness of the machine. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unfortunately,because we’ll implement the state machine on a serial computer,the transitions can’tbesimultaneous.Itispossibletocacheallfiringtransitionsandexecutethemsimultaneously. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our algorithm we will use a simpler process: we will fire transitions belonging to each state in decreasing order of DOM. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If a transition fires, it can transition to any number of new states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The transition itself also has an associated degree of transition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The DOM of the target state is given by the DOM of the current state ANDed with the degree of transition. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For example, state A has a DOM of 0.4, and one of its transitions, T, leads to another state,B, with a degree of transition 0.6.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Assume for now that the DOM of B is currently zero.  </p>
<span origfont="g_font_8" style="left: 255.197px; top: 498.035px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="490" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The newDOM of B will be: </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 6 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4 </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">, </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">AND </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">T </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the DOM of the set </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">x </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, as before. </p>
<span origfont="g_font_8" style="left: 164.758px; top: 522.849px; font-size: 11.6114px; font-family: serif; border-left: none;" yquantized="520" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> x </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the current DOM of state B is not zero, then the new value will be ORed with the existing value.  </p>
<span origfont="g_font_8" style="left: 240.417px; top: 574.842px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="570" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Suppose it is 0.3 currently, we have: </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">B </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">OR </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">AND </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">T </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">)) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> max </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 3 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_8" style="left: 250.904px; top: 580.62px; font-size: 11.6114px; font-family: serif; border-left: none;" yquantized="580" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="441.27782534399984" style="left: 140.361px; top: 602.417px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01131); border-left: none;" yquantized="600" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">B </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At the same time, the start state of the transition is ANDed with NOT T; that is, the degree to which we don’t leave the start state is given by one minus the degree of transition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our example, the degree of transition is 0.6.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is equivalent to saying 0.6 of the transition happens, so 0.4 of the transition doesn’t happen.  </p>
<span origfont="g_font_9" style="left: 254.592px; top: 669.695px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="660" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The DOM for state A is given by: </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> == </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">(. </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_8" style="left: 235.405px; top: 673.156px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">AND NOT </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">T </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) </span>
<span origfont="g_font_7" data-canvas-width="441.0004665599999" style="left: 140.595px; top: 700.718px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02797); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">min0410604If you convert this into crisp logic, it is equivalent to the normal state machine behavior: the start state being on AND the transition firing causes the end state to be on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because any such </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">transition will cause the end state to be on, there may be several possible sources (i.e., they areORed together).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, when the transition has fired the start state is switched off, because the transition has effectively taken its activation and passed it on. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Transitions are triggered in the same way as for finite state machines.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We will hide this functionalitybehindamethodcall,soanykindof testscanbeperformed,includingtestsinvolving fuzzy logic, if required. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The only other modification we need is to change the way actions are performed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because actions in a fuzzy logic system are typically associated with defuzzified values, and because defuzzification typically uses more than one state, it doesn’t make sense to have states directly request actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Instead, we separate all action requests out of the state machine and assume that there is an additional, external defuzzification process used to determine the action required. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 109.415px; top: 295.729px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="290" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.16029383999984" style="left: 109.415px; top: 326.173px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05714); border-left: none;" yquantized="320" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm is simpler than the state machines we saw earlier.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 376.202px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> It can be implemented in the following way: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 376.202px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 390.602px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class FuzzyStateMachine: </p><span origfont="g_font_7" style="left: 112.524px; top: 405.002px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 419.402px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Holds a state along with its current degree </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 433.802px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># of membership </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 448.202px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct StateAndDOM: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">state dom </p><span origfont="g_font_7" style="left: 112.524px; top: 477.002px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="470" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Holds a list of states for the machine </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 505.802px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 520.202px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">states </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 534.602px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 549.002px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Holds the initial states, along with DOM values </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 563.402px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">initialStates </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 577.802px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Holds the current states, with DOM values currentStates = initialStates </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 606.602px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Checks and applies transitions </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 635.402px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="630" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 649.802px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def update(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 664.202px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 678.602px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Sorts the current states into DOM order </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 693.002px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">states = currentStates.sortByDecreasingDOM() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 707.402px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Go through each state in turn </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">for state in states: </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 27 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Go through each transition in the state for transition in currentState.getTransitions(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 28 29 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check for triggering </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 31 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if transition.isTriggered(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 33 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Get the transition’s degree of transition </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 34 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">dot = transition.getDot() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 35 36 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># We have a transition, process each target for endState in transition.getTargetStates(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 37 38 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Update the state </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 39 40 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">end = currentStates.get(endState) end.dom = max(end.dom, min(state.dom, dot)) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 42 43 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Check if we need to add the state </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 44 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if end.dom &gt; 0 and not end in currentStates: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 45 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 402.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentStates.append(end) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 46 47 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Update the start state from the transition state.dom = min(state.dom, 1 - dot) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 48 49 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check if we need to remove the start state </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 50 51 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if state.dom &lt;= 0.0: currentStates.remove(state) </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 52 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We don’t look at any more transitions for this </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 53 54 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># active state break </p><span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 122.615px; top: 575.447px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="570" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;"> 55 </p></pre>
<span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 122.615px; top: 575.447px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="570" class="highlight4"></span>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 122.615px; top: 605.89px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="600" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Data Structures and Interfaces </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">currentStates </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">member is a list of </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">StateAndDom </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">instances.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In addition to its normal list-style operations (i.e.,iteration,removal of an element,testing for membership,addition of an element), it supports two operations specific for this algorithm. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">sortByDecreasingDOM </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">method returns a copy of the list sorted in order of decreasingDOM values.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> It does not make copies of any of the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">StateAndDom </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">instances in the list.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need a copy, since we’ll be making changes to the original while we iterate through its contents.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can cause problems or infinite loops (although no infinite loops will be caused in this algorithm), so it is to be avoided as good programming practice. </p>
<span origfont="g_font_7" data-canvas-width="235.71192796799997" style="left: 122.613px; top: 706.672px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.016); border-left: none;" yquantized="700" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">It therefore has the following form: </p>
<span origfont="g_font_35" data-canvas-width="193.67423999999997" style="left: 137.39px; top: 128.004px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class StateAndDomList (VanillaList): </p><span origfont="g_font_7" style="left: 112.524px; top: 145.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def get(state) def sortByDecreasingDOM() </p><span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 187.399px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="180" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 3 </p></pre>
<span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 187.399px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="180" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">VanillaList </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is whatever data structure normally handles growable arrays. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 237.428px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Transitions have the following form: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 237.428px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class Transition: def isTriggered() </p><span origfont="g_font_7" style="left: 112.524px; top: 266.228px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getTargetStates() def getDot() </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 307.685px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="300" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 4 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 307.685px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="300" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">isTriggered </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">method returns true if the transition can fire, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">getTargetStates </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">returns a list of states to transition to, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getDot </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">returns the degree of transition. </p>
<span origfont="g_font_13" data-canvas-width="134.11725926399998" style="left: 109.415px; top: 353.042px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06442); border-left: none;" yquantized="350" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 109.415px; top: 383.486px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="380" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Implementation Notes </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">isTriggered </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">method of the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Transition </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">class can be implemented in the same way as for a standard state machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can use the infrastructure we developed earlier in the chapter,including decision trees. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It can also contain fuzzy logic to determine transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The degree of transition provides a mechanism to expose this fuzzy logic to the state machine. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Suppose, for example, that the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">isTriggered </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method uses some fuzzy logic to determine that its transition conditions are met with a DOM of 0.5.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can then expose 0.5 as the degree of transition, and the transition will have approximately half of its normal action on the state of the machine. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 529.641px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="520" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="389.64127103999994" style="left: 109.415px; top: 560.085px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02); border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm requires temporary storage for each active state and therefore is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">)inmemory, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of active states (i.e., those with DOM </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">&gt; </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0). </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm looks at each transition for each active state and therefore is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of transitions per state. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As in all previous decision making tools, the performance and memory requirements can easily be much higher if the algorithms in any of its data structures are not O(1) in both time and memory. </p>
<span origfont="g_font_13" data-canvas-width="182.08534732799998" style="left: 109.415px; top: 677.442px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02586); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1579028160001" style="left: 109.415px; top: 707.886px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03282); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Multiple Degrees of Transition </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is possible to have a different degree of transition per target state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The degree of membership </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The degree of membership of the start state is more complex.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We take the current value andAND it with the NOT of the degree of transition,as before.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case,however,there are multiple degrees of transition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To get a single value, we take the maximum of the degrees of transition (i.e., we OR them together first). </p>
<span origfont="g_font_7" data-canvas-width="67.34319096" style="left: 303.754px; top: 184.021px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.962046); border-left: none;" yquantized="180" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">For example, say we have the following states:State A: DOM </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 5 </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_7" data-canvas-width="66.87694128" style="left: 304.221px; top: 201.296px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.969231); border-left: none;" yquantized="200" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">State B: DOM06State C: DOM </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="139.762525872" style="left: 122.598px; top: 247.873px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03528); border-left: none;" yquantized="240" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="93.33362183999999" style="left: 237.858px; top: 276.625px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.15227); border-left: none;" yquantized="270" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4Then applying the transition:FromAtoB(DOT </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0.2) AND C (DOT </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<span origfont="g_font_7" data-canvas-width="42.243416520000004" style="left: 122.598px; top: 305.366px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.960078); border-left: none;" yquantized="300" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_9" style="left: 299.51px; top: 327.028px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="320" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0.7) will give: </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">,(. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">,. </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_7" data-canvas-width="66.87694128" style="left: 229.764px; top: 330.495px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.969231); border-left: none;" yquantized="330" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">State B: DOMmax06min020506State C: DOM </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> max0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 7 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 5 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 5State A: DOM </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> min0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 5 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> max </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 2 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 7 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="441.1391459519999" style="left: 140.328px; top: 388.932px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00717); border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3Again, if you unpack this in terms of the crisp logic, it matches with the behavior of the finite state machine. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With different degrees of transition to different states, we effectively have completely fuzzy transitions: the degrees of transition represent gray areas between transitioning fully to one state or another. </p>
<span origfont="g_font_13" data-canvas-width="90.10873344" style="left: 122.615px; top: 484.386px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02569); border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0407426399999" style="left: 122.615px; top: 514.829px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04804); border-left: none;" yquantized="510" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Fuzzy State Machine program that is available on the website illustrates this kind of state machine, with multiple degrees of transition.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As in the previous state machine program, you can select any transition to fire.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> In this version you can also tailor the degrees of transition to see the </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">effects of fuzzy transitions. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 594.06px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.6 </p>
<span origfont="g_font_7" data-canvas-width="459.167466912" style="left: 122.615px; top: 635.885px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00036); border-left: none;" yquantized="630" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Markov Systems </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The fuzzy state machine could simultaneously be in multiple states,each with an associated degree of membership.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Being proportionally in a whole set of states is useful outside fuzzy logic.Whereas fuzzy logic does not assign any outside meaning to its degrees of membership (they need to be defuzzified into any useful quantity),it is sometimes useful to work directly with numerical values for states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We might have a set of priority values,for example,controlling which of a group of characters </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">safety of each sniping position in a level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Both of these applications benefit from dynamic values. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Different characters might lead in different tactical situations or as their relative health fluctuates during battle.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The safety of sniping positions may vary depending on the position of enemies and whether protective obstacles have been destroyed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This situation comes up regularly, and it is relatively simple to create an algorithm similar to a state machine to manipulate the values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no consensus as to what this kind of algorithm is called, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most often it is called a fuzzy state machine, with no distinction between implementations that use fuzzy logic and those that do not.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this book, we’ll reserve"fuzzy state machine"for algorithms involving fuzzy logic.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The mathematics behind our implementation is aMarkov process, so we’ll refer to the algorithm as a Markov state machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Bear in mind that this nomenclature isn’t widespread. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Before we look at the state machine, we’ll give a brief introduction to Markov processes. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 292.378px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="290" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.6.1 </span>
<span origfont="g_font_7" data-canvas-width="459.2583258239998" style="left: 109.176px; top: 325.714px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03194); border-left: none;" yquantized="320" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Markov Processes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can represent the set of numerical states as a vector of numbers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Each position in the vector corresponds to a single state (e.g., a single priority value or the safety of a particular location). </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The vector is called the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">state vector </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is no constraint on what values appear in the vector.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There can be any number of zeros, and the entire vector can sum to any value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The application may put its own constraints on allowed values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the values represent a distribution (what proportion of the enemy force is in each territory of a continent, for example), then they will sum to 1.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Markov processes in mathematics are almost always concerned with the distribution of random variables.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So much of the literature assumes that the state vector sums to 1. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The values in the state vector change according to the action of a transition matrix.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> First-orderMarkov processes (the only ones we will consider) have a single transition matrix that generates a new state vector from the previous values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Higher order Markov processes also take into account the state vector at earlier iterations. </p>
<span origfont="g_font_39" style="left: 401.275px; top: 509.369px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="500" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (,) </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Transition matrices are always square.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The element at </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">ij </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">in the matrix represents the proportion of element </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">i </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">in the old state vector that is added to element </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">j </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">in the new vector.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> One iteration of the Markov process consists of multiplying the state vector by the transition matrix, using normal matrix multiplication rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The result is a state vector of the same size as the original.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each element in the new state vector has components contributed by every element in the old vector. </p>
<span origfont="g_font_13" data-canvas-width="186.55420108799996" style="left: 109.415px; top: 627.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01388); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.2427841680001" style="left: 109.176px; top: 657.513px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04137); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Conservative Markov Processes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A conservative Markov process ensures that the sum of the values in the state vector does not change over time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is essential for applications where the sum of the state vector should always be fixed (where it represents a distribution, for example, or if the values represent the number of some object in the game).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The process will be conservative if all the rows in the transition matrix sumto1. </p>
<span origfont="g_font_7" data-canvas-width="47.127083039999995" style="left: 109.415px; top: 715.089px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.24019); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Iterated Processes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is normally assumed that the same transition matrix applies over and over again to the state vector.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are techniques to calculate what the final, stable values in the state vector will be (it is an eigenvector of the matrix, as long as such a vector exists). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This iterative process forms a Markov chain. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In game applications,however,it is common for there to be any number of different transition matrices.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Different transition matrices represent different events in the game,and they update the state vector accordingly. </p>
<p origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Returning to our sniper example, let’s say that we have a state vector representing the safety of four sniping positions: </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ⎡⎤ </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0 </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> ⎢ </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">⎥ </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">V </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ⎣ </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">05 </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> ⎦ </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<span origfont="g_font_7" style="left: 355.608px; top: 301.056px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="300" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 15 which sums to 4.0. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Taking a shot from the first position will alert the enemy to its existence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The safety of that position will diminish.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But, while the enemy is focusing on the direction of the attack, the other positions will be correspondingly safer.  </p>
<p origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could use the transition matrix: </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ⎡⎤ </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 10 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 30 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 30 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 3 </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ⎢ </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 80 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">⎥ </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> ⎣ </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">⎦ </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00000800 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="395.300824848" style="left: 122.591px; top: 448.379px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.994414); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 8 to represent this case.  </p>
<p origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Applying this to the state vector, we get the new safety values: </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ⎡ </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </span>
<span origfont="g_font_9" style="left: 333.396px; top: 488.141px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">⎤ </p>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> = </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">⎢ ⎣ </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 7 </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">⎥ ⎦ </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">V </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<span origfont="g_font_7" style="left: 355.596px; top: 513.08px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="510" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="88.92816012" style="left: 122.591px; top: 534.527px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.988091); border-left: none;" yquantized="530" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 15 which sums to 3.4. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So the total safety has gone down (from 4.0 to 3.4).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The safety of sniping point 1 has been decimated (from 1.0 to 0.1), but the safety of the other three points has marginally increased. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There would be similar matrices for shooting from each of the other sniping points. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that if each matrix had the same kind of form,the overall safety would keep decreasing. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">After a while, nowhere would be safe.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This might be realistic (after being sniped at for a while, the enemyis likely to make sure that nowhere is safe), but in a game we might want the safety values to increase if no shots are fired.  </p>
<p origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A matrix such as: </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ⎡⎤ </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 10 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 10 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1 </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ⎢ </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 11 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 00 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 10 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">⎥ </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">M </span>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> ⎣ </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_40" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">⎦ </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 01011001 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 10 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 10 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 11 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="399.78160382399994" style="left: 122.603px; top: 718.68px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00701); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 would achieve this, if it is applied once for every minute that passes without gunfire. </p>
<span origfont="g_font_7" data-canvas-width="399.78160382399994" style="left: 122.603px; top: 718.68px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00701); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unless you are dealing with known probability distributions, the values in the transition matrix will be created by hand.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Tuning values to give the desired effect can be difficult.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It will depend on what the values in the state vector are used for.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In applications we have worked on (related to steering behaviors and priorities in a rule-based system, both of which are described elsewhere in the book), the behavior of the final character has been quite tolerant of a range of values and tuning was not too difficult. </p>
<span origfont="g_font_13" data-canvas-width="227.56436275200002" style="left: 109.415px; top: 209.867px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0114); border-left: none;" yquantized="200" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.99053113600013" style="left: 109.415px; top: 240.31px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07492); border-left: none;" yquantized="240" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Markov Processes in Math and Science </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Inmathematics,afirst-orderMarkovprocessisanyprobabilisticprocesswherethefuturedepends only on the present and not on the past.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is used to model changes in probability distribution over time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The values in the state vector are probabilities for a set of events, and the transition matrix determines what probability each event will have at the next trial given their probabilities at the last trial.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The states might be the probability of sun or probability of rain, indicating the weather on one day.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The initial state vector indicates the known weather on one day (e.g., [1  0] if it was sunny), and by applying the transition we can determine the probability of the following day being sunny.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By repeatedly applying the transition we have a Markov chain,and we can determine the probability of each type of weather for any time in the future. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In AI, Markov chains are more commonly found in prediction: predicting the future from the present.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are the basis of a number of techniques for speech recognition, for example, where it makes sense to predict what the user will say next to aid disambiguation of similar-sounding words. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are also algorithms to do learning with Markov chains (by calculating or approximating thevaluesof thetransitionmatrix).Inthespeechrecognitionexample,theMarkovchainsundergo learning to better predict what a particular user is about to say. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 508.577px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="500" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.6.2 </p>
<span origfont="g_font_7" data-canvas-width="459.02400547199994" style="left: 109.415px; top: 541.913px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0292); border-left: none;" yquantized="540" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Markov State Machine </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using Markov processes, we can create a decision making tool that uses numeric values for its states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The state machine will need to respond to conditions or events in the game by executing a transition on the state vector.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If no conditions or events occur for a while,then a default transition can occur. </p>
<span origfont="g_font_13" data-canvas-width="88.04000563199999" style="left: 109.415px; top: 641.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03576); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.2248514879999" style="left: 109.176px; top: 671.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0004); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We store a state vector as a simple list of numbers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The rest of the game code can use these values in whatever way is required. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Westoreasetof transitions.Transitionsconsistof asetof triggeringconditionsandatransition matrix.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The trigger conditions are of exactly the same form as for regular state machines. </p>
<span origfont="g_font_7" data-canvas-width="422.5321971839999" style="left: 109.415px; top: 715.094px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0157); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The transitions belong to the whole state machine, not to individual states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At each iteration, we examine the conditions of each transition and determine which of them trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first transition that triggers is then asked to fire, and it applies its transition matrix to the state vector to give a new value. </p>
<span origfont="g_font_8" data-canvas-width="106.92252672" style="left: 122.615px; top: 169.375px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.967661); border-left: none;" yquantized="160" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.24158865600026" style="left: 122.376px; top: 196.232px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02641); border-left: none;" yquantized="190" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Default Transitions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We would like a default transition to occur after a while if no other transitions trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could do this by implementing a type of transition condition that relies on time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The default transition would then be just another transition in the list, triggering when the timer counts down.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The transition would have to keep an eye on the state machine, however, and make sure it resets the clock every time another transition triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To do this, it may have to directly ask the transitions for their trigger state, which is a duplication of effort, or the state machine would have to expose that information through a method. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Since the state machine already knows if no transitions trigger, it is more common to bring the default transition into the state machine as a special case.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The state machine has an internal timer and a default transition matrix.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If any transition triggers, the timer is reset.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If no transitions trigger,then the timer is decremented.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the timer reaches zero,then the default transition matrix is applied to the state vector, and the timer is reset again. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Note that this can also be done in a regular state machine if a transition should occur after a period of inactivity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve seen it more often in numeric state machines, however. </p>
<span origfont="g_font_8" data-canvas-width="40.743321599999994" style="left: 122.443px; top: 413.695px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.925985); border-left: none;" yquantized="410" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9367330960001" style="left: 122.615px; top: 440.552px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01087); border-left: none;" yquantized="440" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unlike a finite state machine,we are in no particular state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Therefore,states cannot directly control which action the character takes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the finite state machine algorithm,the state class could return actions to perform for as long as the state was active.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Transitions also returned actions that could be carried out when the transition was active. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the Markov state machine, transitions still return actions, but states do not.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There will be some additional code that uses the values in the state vector in some way.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our sniper example we can simply pick the largest safety value and schedule a shot from that position.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> However the numbers are interpreted, a separate piece of code is needed to turn the value into action. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 122.615px; top: 581.285px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="580" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="241.00326407999992" style="left: 122.615px; top: 611.728px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00838); border-left: none;" yquantized="610" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 125.724px; top: 647.356px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The Markov state machine has the following form: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 647.356px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 661.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class MarkovStateMachine: </p><span origfont="g_font_7" style="left: 125.724px; top: 676.156px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># The state vector state </p><span origfont="g_font_7" style="left: 125.724px; top: 704.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # The period to wait before using the default transition </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">resetTime </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># The default transition matrix defaultTransitionMatrix </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # The current countdown </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentTime = resetTime </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># List of transitions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">transitions </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 272.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def update(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check each transition for a trigger for transition in transitions: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if transition.isTriggered(): triggeredTransition = transition </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">break </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># No transition is triggered </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 402.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">triggeredTransition = None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 28 29 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check if we have a transition to fire if triggeredTransition: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 31 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Reset the timer </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 33 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentTime = resetTime </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 34 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Multiply the matrix and the state vector </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 35 36 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">matrix = triggeredTransition.getMatrix() state = matrix * state </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 37 38 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Return the triggered transition’s action list </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 39 40 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 589.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return triggeredTransition.getAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 604.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 42 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 618.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">else: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 43 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Otherwise check the timer currentTime -= 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 647.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 44 45 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> if currentTime &lt;= 0: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 676.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 46 47 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Do the default transition state = state * defaultTransitionMatrix </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 704.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 48 49 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Reset the timer currentTime = reset Time </p></pre>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">51 52 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Return no actions, since no transition triggered </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 53 </span><span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 122.615px; top: 168.717px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="160" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">return [] </p></pre>
<span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 122.615px; top: 168.717px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="160" class="highlight4"></span>
<span origfont="g_font_7" data-canvas-width="400.4367443999999" style="left: 122.615px; top: 199.161px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01892); border-left: none;" yquantized="190" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<span origfont="g_font_7" style="left: 125.724px; top: 234.789px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The transitions list in the state machine holds instances with the following interface: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 234.789px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 249.189px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class MarkovTransition: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 263.589px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def isTriggered() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 277.989px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def getMatrix() </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_13" data-canvas-width="90.10873344" style="left: 122.615px; top: 317.75px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.02569); border-left: none;" yquantized="310" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">def getAction() </p></pre>
<span origfont="g_font_13" data-canvas-width="90.10873344" style="left: 122.615px; top: 317.75px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02569); border-left: none;" yquantized="310" class="highlight2"></span>
<span origfont="g_font_7" data-canvas-width="459.090954144" style="left: 122.615px; top: 348.194px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00678); border-left: none;" yquantized="340" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Markov State Machine program that is available on the website demonstrates a Markov state machine in action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At each iteration you can select one of the transitions to fire or no transition. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The internal time for the state machine will run down after a period of inactivity, and the default transition will be applied.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> The software is a command line demonstration that outputs copious </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">detail, such as what it is doing at each iteration, when a transition triggers, and the results of the transition on the state vector. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 457.287px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="450" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.7 </p>
<span origfont="g_font_7" data-canvas-width="458.98096703999994" style="left: 122.615px; top: 499.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01652); border-left: none;" yquantized="490" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal-Oriented Behavior </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we have focused on approaches that react: a set of inputs is provided to the character, and a behavior selects an appropriate action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no implementation of desires or goals.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The character merely reacts to input. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">It is possible, of course, to make the character </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">seem </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">like it has goals or desires, even with the simplest decision making techniques.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character whose desire is to kill an enemy will hunt one down, will react to the appearance of an enemy by attacking, and will search for an enemy when there is a lack of one.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same character may also have the apparent desire to stay alive, in which case it will take account of its own protection, reacting to low health or the presence of danger. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The underlying structure may be reacting to input, but the character doesn’t need to appear that way.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our experience, this is a fundamental misunderstanding that academic AI folk often have about game AI: it doesn’t matter what is controlling the character, as long as it looks right. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">There are techniques we can use to make the character more flexible in its goal seeking, however, and in some game genres this is a useful approach.  </p>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It is particularly visible in people simulation games, such as </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Sims </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">[Maxis Software, Inc., 2000]. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Here, only a few characters are on-screen at one time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each has a range of emotional and physical parameters that change over time in relation to its environment and its actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">player can often control the character’s actions directly, although the character is always capable of independent action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">In a game such as The Sims, there is no overall goal to the game.  </p>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In other titles such as </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">GhostMaster </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">[Sick Puppies Studio and International Hobo Ltd., 2003], there is a definite aim (you try to scare the inhabitants out of a house using various ghosts and supernatural powers). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this kind of game a wide range of different actions is available to characters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Actions might include boiling the kettle, sitting on a sofa, or talking to another character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The action itself is represented by a canned animation. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Characters need to demonstrate their emotional and physical state by choosing appropriate actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They should eat when hungry, sleep when tired, chat to friends when lonely, and hug when in need of love.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could simply run a decision tree that selects available actions based on the current emotional and physical parameters of the character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a game such as The Sims, this would lead to a very big decision tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are literally hundreds of parameterized actions to choose from for every character. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A better approach would be to present the character with a suite of possible actions and have it choose the one that best meets its immediate needs. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is goal-oriented behavior (GOB),explicitly seeking to fulfill the character’s internal goals. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Like many algorithms in this book,the name can only be loosely applied.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> GOB may mean different things to different people, and it is often used either vaguely to refer to any goal seeking decision maker or to specific algorithms similar to those here.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll use it as a general term. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll look at a very simple GOB framework and a utility-based GOB decision maker.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll also look at goal-oriented action planning (GOAP), an extension to the basic GOB system that can plan sequences of actions to achieve its goal. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 450.778px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="450" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.7.1 </span>
<span origfont="g_font_7" data-canvas-width="459.1949636880001" style="left: 109.415px; top: 484.114px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06542); border-left: none;" yquantized="480" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal-Oriented Behavior </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal-oriented behavior is a blanket term that covers any technique taking into account goals or desires.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There isn’t a single technique for GOB, and some of the other techniques in this chapter, notably rule-based systems, can be used to create goal-seeking characters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Goal-oriented behavior is still fairly rare in games, so it is also difficult to say what the most popular techni- ques are. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this section we will look at a utility-based decision making system that can choose from a range of actions based on its current goals.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a system based on one we’ve implemented ourselves and that we’ve seen used in two other companies. </p>
<span origfont="g_font_13" data-canvas-width="33.87147264" style="left: 109.415px; top: 627.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02641); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="247.08363811200007" style="left: 109.176px; top: 657.513px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0085); border-left: none;" yquantized="650" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Goals </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A character may have one or more goals, also called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">motives </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There may be hundreds of possible goals, and the character can have any number of them currently active.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They might have goals such as eat, regenerate health, or kill enemy.  </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Each goal has a level of importance (often called </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> insistence </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">among GOB aficionados) represented by a number.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A goal with a high insistence will tend to influence the character’s behavior more strongly. </p>
<span origfont="g_font_7" data-canvas-width="268.37331580800003" style="left: 109.415px; top: 715.089px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01653); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The character will try to fulfill the goal or to reduce its insistence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some games allow goals to be completely satisfied (such as killing an enemy).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Other games have a fixed set of goals that are always there, and they simply reduce the insistence when the goal is fulfilled (a character might always have a goal of "get healthy," for example, but at a low insistence when they are already healthy).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A zero value for insistence is equivalent to a completely satisfied goal. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve deliberately conflated goals and motives here.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For the purpose of making great game characters, goals and motives can usually be treated as the same thing or at least blurred together somewhat.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In some AI research they are quite distinct, but their definitions vary from researcher to researcher: motives might give rise to goals based on a character’s beliefs, for example (i.e., we may have a goal of killing our enemy motivated by revenge for our colleagues, out of the belief that our enemy killed them).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is an extra layer we don’t need for this algorithm, so we’ll treat motives and goals as largely the same thing and normally refer to them as goals. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could easily implement goals without insistence values, but it makes it more difficult to choose which goals to focus on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve chosen to use real numbers rather than Booleans, because the resulting algorithms are no more complex.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If your game has thousands of characters with hundreds of goals, it might be worth just using on/off goals and saving storage space. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a game like The Sims, the character’s physical and emotional parameters can be interpreted as goal values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character might have a hunger motive: the higher the hunger value, the more eating becomes a pressing goal. </p>
<span origfont="g_font_13" data-canvas-width="44.77461503999999" style="left: 122.328px; top: 396.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0176); border-left: none;" yquantized="390" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.069434928" style="left: 122.615px; top: 427.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997977); border-left: none;" yquantized="420" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In addition to a set of goals, we need a suite of possible actions to choose from.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These actions can be generated centrally, but it is also common for them to be generated by objects in the world.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> InThe Sims world, a kettle adds a "boil kettle" action and an empty oven adds an "insert raw food" action to the list of possibilities.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In an action game an enemy might introduce an "attack me" action, while a door might expose a "lock" action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The actions available depend on the current state of the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The empty oven might check if the character is carrying raw food before positing its"insert"action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An oven containing raw food does not allow more food to be added; it exposes a"cook food"action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, the door exposes an "unlock" action if it is already locked or maybe an "insert key" action first before unlocking is allowed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As the actions are added to the list of options, they are rated against each motive the character has.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This rating shows how much impact the action would have on a particular motive.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So the "playing with the games console" action might increase happiness a lot but also decrease energy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a shooter the actions are more atomic.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each action gives a list of goals that can be achieved. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A "shoot" action, for example, can fulfill a kill enemy goal, as can a "spring-trap" action, and so on. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The goal that an action promises to fulfill might be several steps away.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A piece of raw food mightoffertofulfillhunger,forexample.If thecharacterpicksitup,itwillnotbecomelesshungry, but now the empty oven will offer the "insert" action, again promising to feed the character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same thing continues through a"cook food"action,a"remove food from oven"action,and finally an"eat"action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In some games, the single action is made up of a sequence of actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The"shoot" </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">action might be made up of "draw weapon," "aim," and "fire" actions, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The action execution section at the end of this chapter has more details about this kind of combined action. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 147.477px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.7.2 </p>
<span origfont="g_font_7" data-canvas-width="459.0395471280001" style="left: 109.415px; top: 180.814px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03671); border-left: none;" yquantized="180" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Simple Selection </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So, we have a set of possible actions and a set of goals.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The actions promise to fulfill different goals.  </p>
<span origfont="g_font_7" data-canvas-width="43.872899376" style="left: 256.774px; top: 225.742px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997111); border-left: none;" yquantized="220" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Continuing with the people simulation example, we might have:Goal: Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4 Goal: Sleep </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> − </p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action: Get-Raw-Food (Eat3) </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> − </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Action: Get-Snack (Eat2)Action: Sleep-In-Bed (Sleep </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4)Action: Sleep-On-Sofa (Sleep </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<span origfont="g_font_7" data-canvas-width="441.27184778399993" style="left: 127.18px; top: 324.144px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03332); border-left: none;" yquantized="320" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 2)We can use a range of decision making tools to select an action and give intelligent-looking behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A simple approach would be to choose the most pressing goal (the one with the largest insistence) and find an action that either fulfills it completely or provides it with the largest decrease in insistence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the example above, this would be the "get raw-food" action (which in turn might lead to cooking and eating the food).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The change in goal insistence that is promised by an action is a heuristic estimate of its utility—the use that it might be to a character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character naturally wants to choose the action with the highest utility, and the change in goal is usedtodoso. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If more than one action can fulfill a goal, we could choose between them at random or simply select the first one we find. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 109.415px; top: 495.015px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="490" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="135.106006632" style="left: 109.176px; top: 525.46px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0232); border-left: none;" yquantized="520" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_35" data-canvas-width="177.53471999999996" style="left: 137.39px; top: 557.421px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="550" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">We could implement this as: </p>
<span origfont="g_font_35" data-canvas-width="177.53471999999996" style="left: 137.39px; top: 557.421px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="550" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def chooseAction(actions, goals): </p><span origfont="g_font_7" style="left: 112.524px; top: 575.356px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="570" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 589.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 604.156px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Find the goal to try and fulfil </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 618.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">topGoal = goals[0] </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for goal in goals[1..]: if goal.value &gt; topGoal.value: </p><span origfont="g_font_7" style="left: 112.524px; top: 647.356px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 661.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">topGoal = goal </p><span origfont="g_font_7" style="left: 112.524px; top: 676.156px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Find the best action to take bestAction = actions[0] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 704.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="700" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">bestUtility = -actions[0].getGoalChange(topGoal) for action in actions[1..]: </p></pre>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># We invert the change because a low change value </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># is good (we want to reduce the value for the goal) # but utilities are typically scaled so high values </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># are good. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> utility = -action.getGoalChange(topGoal) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We look for the lowest change (highest utility) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if thisUtility &gt; bestUtility: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">bestUtility = thisUtility </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bestAction = action </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Return the best action, to be carried out </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </span><span origfont="g_font_7" data-canvas-width="94.43588390400002" style="left: 122.615px; top: 314.415px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.983707); border-left: none;" yquantized="310" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">return bestAction </p></pre>
<span origfont="g_font_7" data-canvas-width="94.43588390400002" style="left: 122.615px; top: 314.415px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.983707); border-left: none;" yquantized="310" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> which is simply two </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">max() </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">-style blocks of code, one for the goal and one for the action. </p>
<span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 122.615px; top: 358.279px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="350" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="350.79549962399994" style="left: 122.615px; top: 388.723px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.999417); border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<span origfont="g_font_7" style="left: 125.724px; top: 424.352px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">In the code above, we’ve assumed that goals have an interface of the form: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 424.352px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 438.752px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct Goal: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">name value </p><span origfont="g_font_7" data-canvas-width="126.70992585600001" style="left: 122.615px; top: 480.211px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02185); border-left: none;" yquantized="480" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 3 </p></pre>
<span origfont="g_font_7" data-canvas-width="126.70992585600001" style="left: 122.615px; top: 480.211px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02185); border-left: none;" yquantized="480" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="75.31775999999999" style="left: 150.59px; top: 509.41px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> and actions have the form: </p>
<span origfont="g_font_35" data-canvas-width="75.31775999999999" style="left: 150.59px; top: 509.41px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> struct Action: </p><span origfont="g_font_7" style="left: 125.724px; top: 527.345px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" data-canvas-width="81.132226368" style="left: 140.615px; top: 554.404px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01415); border-left: none;" yquantized="550" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def getGoalChange(goal) </p></pre>
<span origfont="g_font_7" data-canvas-width="81.132226368" style="left: 140.615px; top: 554.404px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01415); border-left: none;" yquantized="550" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Given a goal, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getGoalChange </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function returns the change in insistence that carrying out the action would provide. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 122.615px; top: 612.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="610" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_9" style="left: 235.615px; top: 639.646px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="630" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Performance </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> + </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of goals, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the num- ber of possible actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It is O(1) in memory, requiring only temporary storage.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> If goals are identified by an associated zero-based integer (it is simple do, since the full range of goals is normally known before the game runs), then the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getGoalChange </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method of the action structure can be simply implemented by looking up the change in an array, a constant time operation. </p>
<span origfont="g_font_7" data-canvas-width="49.60179287999999" style="left: 122.613px; top: 715.101px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05536); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Weaknesses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach is simple, fast, and can give surprisingly sensible results, especially in games with a limited number of actions available (such as shooters, third-person action or adventure games, or RPGs). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It has two major weaknesses,however: it fails to take account of side effects that an action may have, and it doesn’t incorporate any timing information.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll resolve these issues in turn. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 216.415px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="210" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.7.3 </p>
<span origfont="g_font_7" data-canvas-width="458.9570568" style="left: 109.415px; top: 249.752px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01092); border-left: none;" yquantized="240" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Overall Utility </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The previous algorithm worked in two steps.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It first considered which goal to reduce, and then it decided the best way to reduce it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unfortunately, dealing with the most pressing goal might have side effects on others. </p>
<span origfont="g_font_9" style="left: 277.409px; top: 319.869px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="310" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Here is another people simulation example,where insistence is measured on a five-point scale: </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> == </p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal: Eat4 Goal: Bathroom3 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> −+ </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Action: Drink-Soda (Eat2; Bathroom3)Action: Visit-Bathroom (Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<span origfont="g_font_7" data-canvas-width="441.20848564799996" style="left: 127.18px; top: 387.188px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03328); border-left: none;" yquantized="380" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4)A character that is hungry and in need of the bathroom, as shown in the example, probably doesn’t want to drink a soda.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The soda may stave off the snack craving, but it will lead to the situation where the need for the toilet is at the top of the five-point scale.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clearly, human beings know that snacking can wait a few minutes for a bathroom break. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This unintentional interaction might end up being embarrassing,but it could equally be fatal. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A character in a shooter might have a pressing need for a health pack, but running right into an ambush to get it isn’t a sensible strategy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clearly, we often need to consider side effects of actions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can do this by introducing a new value: the discontentment of the character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is calculated based on all the goal insistence values, where high insistence leaves the character more discontent. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The aim of the character is to reduce its overall discontentment level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It isn’t focusing on a single goal any more, but on the whole set. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could simply add together all the insistence values to give the discontentment of the character.Abettersolutionistoscaleinsistencesothathighervaluescontributedisproportionately high discontentment values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This accentuates highly valued goals and avoids a bunch of medium values swamping one high goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> From our experimentation, squaring the goal value is sufficient. </p>
<span origfont="g_font_7" data-canvas-width="43.872899376" style="left: 196.604px; top: 647.893px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997111); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">For example,Goal: Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4 Goal: Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 3Action: Drink-Soda (Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 2; Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">+ </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 2) </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> === </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> afterwards: Eat2, Bathroom5: Discontentment29Action: Visit-Bathroom (Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4) afterwards: Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4, Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0: Discontentment </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 16 </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To make a decision,each possible action is considered in turn.A prediction is made of the total discontentment after the action is completed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The action that leads to the lowest discontentment is chosen.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The list above shows this choice in the same example as we saw before.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now the "visit bathroom" action is correctly identified as the best one. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Discontentment is simply a score we are trying to minimize; we could call it anything.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In search literature (where GOB and GOAP are found in academic AI), it is known as an </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">energy metric </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is because search theory is related to the behavior of physical processes (particularly, the formation of crystals and the solidification of metals),and the score driving them is equivalent to the energy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll stick with discontentment in this section, and we’ll return to energy metrics in the context of learning algorithms in Chapter 7. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 122.615px; top: 260.882px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="260" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="208.68020613599998" style="left: 122.615px; top: 291.326px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00327); border-left: none;" yquantized="290" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 125.724px; top: 326.954px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The algorithm now looks like the following: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 326.954px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 341.354px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def chooseAction(actions, goals): </p><span origfont="g_font_7" style="left: 125.724px; top: 355.754px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Go through each action, and calculate the # discontentment. </p><span origfont="g_font_7" style="left: 125.724px; top: 370.154px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 384.554px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 398.954px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">bestAction =  actions[0] </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><span origfont="g_font_7" style="left: 125.724px; top: 413.354px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bestValue = calculateDiscontentment(actions[0], goals) </p><span origfont="g_font_7" style="left: 125.724px; top: 427.754px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for action in actions: thisValue = calculateDiscontentment(action, goals) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 456.554px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="450" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if thisValue &lt; bestValue: bestValue = thisValue </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 485.354px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 499.754px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bestAction = action </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 514.154px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 528.554px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># return the best action </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 542.954px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return bestAction </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 557.354px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="550" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 571.754px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def calculateDiscontentment(action, goals): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 586.154px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Keep a running total discontentment = 0 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 614.955px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 629.355px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 643.754px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Loop through each goal </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 658.154px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">for goal in action: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Calculate the new value after the action newValue = goal.value + action.getGoalChange(goal) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 686.954px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Get the discontentment of this value </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 715.754px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="710" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">discontentment += goal.getDiscontentment(value) </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Here we’ve split the process into two functions.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> The second function calculates the total discontentmentresultingfromtakingoneparticularaction.It,inturn,callsthe </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">getDiscontentment </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> method of the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">structure. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Having the goal calculate its discontentment contribution gives us extra flexibility,rather than always using the square of its insistence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some goals may be really important and have very high discontentment values for large values (such as the stay-alive goal, for example); they can return their insistence cubed, for example, or to a higher power.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Others may be relatively unimportant and make a tiny contribution only.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In practice, this will need some tweaking in your game to get it right. </p>
<span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 109.415px; top: 251.594px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="250" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="254.33322287999997" style="left: 109.415px; top: 282.038px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02554); border-left: none;" yquantized="280" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Data Structures and Interfaces </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The action structure stays the same as before, but the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Goal </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">structure adds its </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getDiscontentment </p>
<span origfont="g_font_35" data-canvas-width="64.55808" style="left: 137.39px; top: 328.532px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> method, implemented as the following: </p>
<span origfont="g_font_35" data-canvas-width="64.55808" style="left: 137.39px; top: 328.532px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> struct Goal: </p><span origfont="g_font_7" style="left: 112.524px; top: 346.467px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 360.867px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="360" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">value </p><span origfont="g_font_7" style="left: 112.524px; top: 375.267px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 389.667px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def getDiscontentment(newValue): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 427.737px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="420" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">return newValue * newValue </p></pre>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 427.737px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="420" class="highlight2"></span>
<span origfont="g_font_7" data-canvas-width="270.81813784800005" style="left: 109.415px; top: 458.181px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04071); border-left: none;" yquantized="450" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">This algorithm remains O(1) in memory, but is now O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of goals, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of actions, as before.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has to consider the discontentment factor of each goal for each possible action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For large numbers of actions and goals, it can be significantly slower than the original version. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For small numbers of actions and goals, with the right optimizations, it can actually be much quicker.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This optimization speed up is because the algorithm is suitable for SIMD optimizations, where the discontentment values for each goal are calculated in parallel.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The original algorithm doesn’t have the same potential. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 595.375px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="590" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.7.4 </span>
<span origfont="g_font_7" data-canvas-width="458.906845296" style="left: 109.415px; top: 628.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04535); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Timing </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In order to make an informed decision as to which action to take, the character needs to know how long the action will take to carry out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It may be better for an energy-deficient character to get a smaller boost quickly (by eating a chocolate bar, for example), rather than spending eight hours sleeping.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Actions expose the time they take to complete, enabling us to work that into the decision making. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions that are the first of several steps to a goal will estimate the total time to reach the goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The "pick up raw food" action, for example, may report a 30-minute duration.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The picking </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">up action is almost instantaneous, but it will take several more steps (including the long cooking time) before the food is ready. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Timing is often split into two components.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Actions typically take time to complete, but in some games it may also take significant time to get to the right location and start the action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because game time is often extremely compressed in some games, the length of time it takes to begin an action becomes significant.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It may take 20 minutes of game time to walk from one side of the level to the other.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a long journey to make to carry out a 10-minute-long action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If it is needed, the length of journey required to begin an action cannot be directly provided by the action itself.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It must be either provided as a guess (a heuristic such as "the time is propor- tional to the straight-line distance from the character to the object") or calculated accurately (by pathfinding the shortest route; see Chapter 6 for how). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is significant overhead for pathfinding on every possible action available.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For a game levelwithhundredsof objectsandmanyhundredsorthousandsof possibleactions,pathfindingto calculate the timing of each one is impractical.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A heuristic must be used.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An alternative approach to this problem is given by the "Smelly" GOB extension, described at the end of this section. </p>
<span origfont="g_font_13" data-canvas-width="132.40144896" style="left: 122.615px; top: 333.594px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02244); border-left: none;" yquantized="330" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.05628429600006" style="left: 122.615px; top: 364.037px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01749); border-left: none;" yquantized="360" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Utility Involving Time </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">To use time in our decision making we have two choices: we could incorporate the time into our discontentment or utility calculation, or we could prefer actions that are short over those that are long, with all other things being equal.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> This is relatively easy to add to the previous structure by modifying the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">calculateDiscontentment </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function to return a lower value for shorter actions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll not go into details here. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A more interesting approach is to take into account the consequences of the extra time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In some games,goal values change over time: a character might get increasingly hungry unless it gets food, a character might tend to run out of ammo unless it finds an ammo pack, or a character might gain more power for a combo attack the longer it holds its defensive position. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When goal insistences change on their own,not only does an action directly affect some goals, but also the time it takes to complete an action may cause others to change naturally.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be factored into the discontentment calculation we looked at previously.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we know how goal values will change over time (and that is a big "if" that we’ll need to come back to), then we can factor those changes into the discontentment calculation. </p>
<span origfont="g_font_7" data-canvas-width="43.872899376" style="left: 198.329px; top: 596.104px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997111); border-left: none;" yquantized="590" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Returning to our bathroom example, here is a character who is in desperate need of food:Goal: Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4 changing at </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">+ </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4 per hour </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> =+ </p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal: Bathroom3 changing at2 per hour </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> − </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Action: Eat-Snack (Eat2) 15 minutes afterwards: Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 2, Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 3.5: Discontentment </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 16.25Action: Eat-Main-Meal (Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4) 1 hour </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> === </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> afterwards: Eat0, Bathroom5: Discontentment25Action: Visit-Bathroom (Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4) 15 minutes afterwards: Eat </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 5, Bathroom </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0: Discontentment </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 25 </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The character will clearly be looking for some food before worrying about the bathroom.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can choose between cooking a long meal and taking a quick snack.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The quick snack is now the action of choice.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The long meal will take so long that by the time it is completed, the need to go to the bathroom will be extreme.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The overall discontentment with this action is high.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On the other hand,the snack action is over quickly and allows ample time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Going directly to the bathroom isn’t the best option, because the hunger motive is so pressing. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a game with many shooters, where goals are either on or off (i.e., any insistence values are only there to bias the selection; they don’t represent a constantly changing internal state for the character), this approach will not work so well. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 109.415px; top: 253.892px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="250" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="42.219506280000004" style="left: 109.415px; top: 284.337px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02974); border-left: none;" yquantized="280" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Pseudo-Code </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Only the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">calculateDiscontentment </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function needs to be changed from our previous version of the algorithm.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 337.952px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> It now looks like the following: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 337.952px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 352.352px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def calculateDiscontentment(action, goals): </p><span origfont="g_font_7" style="left: 112.524px; top: 366.752px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="360" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Keep a running total discontentment = 0 </p><span origfont="g_font_7" style="left: 112.524px; top: 395.552px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 409.952px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 424.352px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Loop through each goal </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 438.752px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">for goal in action: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Calculate the new value after the action newValue = goal.value + action.getGoalChange(goal) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 467.552px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="460" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Calculate the change due to time alone </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 496.352px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 510.752px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">newValue += action.getDuration() * goal.getChange() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 525.152px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 539.552px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Get the discontentment of this value </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><span origfont="g_font_7" data-canvas-width="440.9861204159998" style="left: 127.415px; top: 570.196px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01844); border-left: none;" yquantized="570" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">discontentment += goal.getDiscontentment(newValue) </p></pre>
<span origfont="g_font_7" data-canvas-width="440.9861204159998" style="left: 127.415px; top: 570.196px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01844); border-left: none;" yquantized="570" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It works by modifying the expected new value of the goal by both the action (as before) and the normal rate of change of the goal, multiplied by the action’s duration. </p>
<span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 109.415px; top: 627.378px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="161.771901792" style="left: 109.176px; top: 657.821px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0108); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Data Structures and Interfaces </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">We’ve added a method to both the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Goal </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">and the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">class.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 704.956px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> The goal class now has the following format: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 704.956px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">struct Goal: value </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">def getDiscontentment(newValue) </p>
<span origfont="g_font_7" style="left: 125.724px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 125.724px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 141.615px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="140" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def getChange() </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 141.615px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="140" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getChange </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method returns the amount of change that the goal normally experiences, per unit of time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll come back to how this might be done below. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 206.043px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The action has the following interface: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 206.043px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct Action: def getGoalChange(goal) </p><span origfont="g_font_7" style="left: 125.724px; top: 234.843px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" data-canvas-width="68.57217729599999" style="left: 122.615px; top: 261.902px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.9938); border-left: none;" yquantized="260" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def getDuration() </p></pre>
<span origfont="g_font_7" data-canvas-width="68.57217729599999" style="left: 122.615px; top: 261.902px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.9938); border-left: none;" yquantized="260" class="highlight2"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> where the new </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getDuration </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method returns the time it will take to complete the action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This may include follow-on actions, if the action is part of a sequence, and may include the time it would take to reach a suitable location to start the action. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 122.615px; top: 330.179px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="330" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.96901192000036" style="left: 122.615px; top: 360.622px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02448); border-left: none;" yquantized="360" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">This algorithm has exactly the same performance characteristics as before: O(1) in memory andO( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time (with </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">being the number of goals and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">the number of actions, as before). </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">If theandmethods simply return a stored value, then the </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal.getChangeAction.getDuration </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> algorithm can still be easily implemented on SIMD hardware, although it adds an extra couple of operations over the basic form. </p>
<span origfont="g_font_13" data-canvas-width="231.93566208" style="left: 122.615px; top: 457.699px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02402); border-left: none;" yquantized="450" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1686624240001" style="left: 122.615px; top: 488.144px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05314); border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Calculating the Goal Change over Time </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In some games the change in goals over time is fixed and set by the designers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Sims, for example, has a basic rate at which each motive changes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Even if the rate isn’t constant, but varies with circumstance, the game still knows the rate, because it is constantly updating each motive based on it.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> In both situations we can simply use the correct value directly in the </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getChange </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> method. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In some situations we may not have any access to the value, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a shooter, where the "hurt"motive is controlled by the number of hits being taken, we don’t know in advance how the value will change (it depends on what happens in the game).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case, we need to approximate the rate of change. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The simplest and most effective way to do this is to regularly take a record of the change in each goal.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Each time the GOB routine is run, we can quickly check each goal and find out how much it has changed (this is an O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) process, so it won’t dramatically affect the execution time of the algorithm).  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 696.572px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> The change can be stored in a recency-weighted average such as: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 696.572px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">rateSinceLastTime = changeSinceLastTime / timeSinceLast basicRate = 0.95 * basicRate + 0.05 * rateSinceLastTime </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 2 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">where the 0.95 and 0.05 can be any values that sum to 1.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">timeSinceLast </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">value is the number of units of time that has passed since the GOB routine was last run. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Thisgivesanaturalpatterntoacharacter’sbehavior.Itlendsafeelof context-sensitivedecision making for virtually no implementation effort, and the recency-weighted average provides a very simple degree of learning.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the character is taking a beating, it will automatically act more defensively (because it will be expecting any action to cost it more health), whereas if it is doing well it will start to get bolder. </p>
<span origfont="g_font_13" data-canvas-width="133.956581376" style="left: 109.415px; top: 224.652px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03044); border-left: none;" yquantized="220" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.94510168000016" style="left: 109.415px; top: 255.095px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03599); border-left: none;" yquantized="250" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Need for Planning </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">No matter what selection mechanism we use (within reason, of course), we have assumed that actions are only available for selection when the character can execute them.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We would therefore expect characters to behave fairly sensibly and not to select actions that are currently impossible. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We have looked at a method that considers the effects that one action has on many goals and have chosen an action to give the best overall result.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The final result is often suitable for use in a game without any more sophistication. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unfortunately, there is another type of interaction that our approach so far doesn’t solve. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because actions are situation dependent, it is normal for one action to enable or disable several others.Problemslikethishavebeendeliberatelydesignedoutof mostgamesusingGOB(includingThe Sims, a great example of the limitations of the AI technique guiding level design), but it is easy to think of a simple scenario where they are significant. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Let’s imagine a fantasy role-playing game, where a magic-using character has five fresh energy crystalsintheirwand.Powerfulspellstakemultiplecrystalsof energy.Thecharacterisindesperate need of healing and would also like to fend off the large ogre descending on her.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The motives and possible actions are shown below. </p>
<span origfont="g_font_7" data-canvas-width="50.515164047999995" style="left: 220.143px; top: 487.025px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.990493); border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Goal: Heal </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 4Goal: Kill-Ogre </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> − </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Action: Fireball (Kill-Ogre2) 3 energy-slotsAction: Lesser-Healing (Heal </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 2) 2 energy-slotsAction: Greater-Healing (Heal </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<span origfont="g_font_7" data-canvas-width="440.8629826800002" style="left: 127.408px; top: 585.427px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01348); border-left: none;" yquantized="580" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4) 3 energy-slotsThe best combination is to cast the"lesser healing"spell, followed by the"fireball"spell, using the five magic slots exactly.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Following the algorithm so far,however,the mage will choose the spell that gives the best result.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clearly,casting"lesser healing"leaves her in a worse health position than "greater healing," so she chooses the latter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now, unfortunately, she hasn’t enough juice left in the wand and ends up as ogre fodder.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this example, we could include the magic in the wand as part of the motives (we are trying to minimize the number of slots used), but in a game where there may be many hundreds of permanent effects (doors opening, traps sprung, routes guarded, enemies alerted), we might need many thousands of additional motives. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To allow the character to properly anticipate the effects and take advantage of sequences of actions, a level of planning must be introduced.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Goal-oriented action planning extends the basic </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">decision making process.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It allows characters to plan detailed sequences of actions that provide the overall optimum fulfillment of their goals. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 148.975px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.7.5 </p>
<span origfont="g_font_7" data-canvas-width="458.9761849919999" style="left: 122.615px; top: 182.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.08049); border-left: none;" yquantized="180" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Overall Utility GOAP </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The utility-based GOB scheme considers the effects of a single action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The action gives an indication of how it will change each of the goal values, and the decision maker uses that infor- mation to predict what the complete set of values, and therefore the total discontentment, will be afterward. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can extend this to more than one action in a series.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Suppose we want to determine the best sequence of four actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can consider all combinations of four actions and pre- dict the discontentment value after all are completed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The lowest discontentment value indi- cates the sequence of actions that should be preferred, and we can immediately execute the first of them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is basically the structure for GOAP: we consider multiple actions in sequence and try to find the sequence that best meets the character’s goals in the long term.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case, we are using the discontentment value to indicate whether the goals are being met.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a flexible approach and leads to a simple but fairly inefficient algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the next section we’ll also look at a GOAP algorithm that tries to plan actions to meet a single goal. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are two complications that make GOAP difficult.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> First, there is the sheer number of available combinations of actions.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The original GOB algorithm was O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) in time, but for </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">k </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> steps, a naive GOAP implementation would be O( </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">k </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> ) in time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For reasonable numbers of actions (remember The Sims may have hundreds of possibilities), and a reasonable number of steps to lookahead, this will be unacceptably long.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need to use either small numbers of goals and actions or some method to cut down some of this complexity. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Second, by combining available actions into sequences, we have not solved the problem of actions being enabled or disabled.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Not only do we need to know what the goals will be like after an action is complete, but we also need to know what actions will then be available.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can’t look for a sequence of four actions from the current set, because by the time we come to carry out the fourth action it might not be available to us. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To support GOAP, we need to be able to work out the future state of the world and use that to generate the action possibilities that will be present.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When we predict the outcome of an action, it needs to predict all the effects, not just the change in a character’s goals. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To accomplish this,we use a model of the world: a representation of the state of the world that can be easily changed and manipulated without changing the actual game state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For our purposes this can be an accurate model of the game world.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is also possible to model the beliefs and knowledge of a character by deliberately limiting what is allowed in its model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character that doesn’t know about a troll under the bridge shouldn’t have it in its model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Without modeling the belief, the character’s GOAP algorithm would find the existence of the troll and take account of it in its planning.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> That may look odd, but normally isn’t noticeable. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To store a complete copy of the game state for each character is likely to be overkill.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unless your game state is very simple, there will typically be many hundreds to tens of thousands of items of data to keep track of.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Instead, world models can be implemented as a list of </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">differences: the model only stores information when it is different from the actual game data. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This way if an algorithm needs to find out some piece of data in the model, it first looks in the difference list.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the data aren’t contained there, then it knows that it is unchanged from the game state and retrieves it from there. </p>
<span origfont="g_font_13" data-canvas-width="88.04000563199999" style="left: 109.415px; top: 180.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03576); border-left: none;" yquantized="180" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.29180016" style="left: 109.176px; top: 211.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.999541); border-left: none;" yquantized="210" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve described a relatively simple problem for GOAP.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are a number of different academic approaches to GOAP, and they allow much more complicated problem domains.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Features such as constraints (things about the world that must not be changed during a sequence of actions), partial ordering (sequences of actions, or action groups, that can be performed in any order), and uncertainty (not knowing what the exact outcome of an action will be) all add complexity that we don’t need in most games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The algorithm we’re going to give is about as simple as GOAP can be, but in our experience it is fine for normal game applications. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We start with a world model (it can match the current state of the world or represent the character’s beliefs).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> From this model we should be able to get a list of available actions for the character, and we should be able to simply take a copy of the model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The planning is controlled by a maximum depth parameter that indicates how many moves to lookahead. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm creates an array of world models, with one more element than the value of the depth parameter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These will be used to store the intermediate states of the world as the algorithm progresses.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first world model is set to the current world model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It keeps a record of the current depth of its planning, initially zero.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It also keeps a track of the best sequence of actions so far and the discomfort value it leads to. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm works iteratively,processing a single world model in an iteration.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the current depth is equal to the maximum depth, the algorithm calculates the discomfort value and checks it against the best so far.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the new sequence is the best, it is stored. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the current depth is less than the maximum depth, then the algorithm finds the next unconsidered action available on the current world model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It sets the next world model in the array to be the result of applying the action to the current world model and increases its current depth.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there are no more actions available, then the current world model has been completed, and the algorithm decreases the current depth by one.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the current depth eventually returns to zero, the search is over. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is a typical depth-first search technique, implemented without recursion.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The algorithm will examine all possible sequences of actions down to our greatest depth.As we mentioned above, this is wasteful and may take too long to complete for even modest problems.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unfortunately, it is the only way to guarantee that we get the best of all possible action sequences.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are prepared to sacrifice that guarantee for reasonably good results in most situations,we can reduce the execution time dramatically. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To speed up the algorithm we can use a heuristic: we demand that we never consider actions that lead to higher discomfort values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a reasonable assumption in most cases, although there are many cases where it breaks down.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Human beings often settle for momentary discomfort because it will bring them greater happiness in the long run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Nobody enjoys job interviews, for example, but it is worth it for the job afterward (or so you’d hope). </p>
<span origfont="g_font_7" data-canvas-width="317.0641285440001" style="left: 109.415px; top: 715.02px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00655); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the other hand, this approach does help avoid some nasty situations occurring in the middle of the plan.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Recall the bathroom-or-soda dilemma earlier.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we don’t look at the interme- diate discomfort values, we might have a plan that takes the soda, has an embarrassing moment, changes clothes, and ends up with a reasonable discomfort level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Human beings wouldn’t do this; they’d go for a plan that avoided the accident. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To implement this heuristic we need to calculate the discomfort value at every iteration and store it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the discomfort value is higher than that at the previous depth, then the current model can be ignored, and we can immediately decrease the current depth and try another action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the prototypes we built when writing this book, this leads to around a 100-fold increase in speed in a Sims-like environment with a maximum depth of 4 and a choice of around 50 actions per stage.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even a maximum depth of 2 makes a big difference in the way characters choose actions (and increasing depth brings decreasing returns in believability each time). </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 122.615px; top: 293.285px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="290" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="279.9147886559999" style="left: 122.376px; top: 323.728px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00312); border-left: none;" yquantized="320" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 125.724px; top: 359.356px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">We can implement depth-first GOAP in the following way: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 359.356px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 373.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def planAction(worldModel, maxDepth): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 388.156px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Create storage for world models at each depth, and </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># actions that correspond to them models = new WorldModel[maxDepth+1] </p><span origfont="g_font_7" style="left: 125.724px; top: 416.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 431.356px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions = new Action[maxDepth] </p><span origfont="g_font_7" style="left: 125.724px; top: 445.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Set up the initial data models[0] = worldModel </p><span origfont="g_font_7" style="left: 125.724px; top: 474.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="470" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 488.957px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth = 0 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Keep track of the best action </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 517.757px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bestAction = None bestValue = infinity </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 546.557px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Iterate until we have completed all actions at depth </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 575.357px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># zero. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 589.757px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 604.157px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">while currentDepth &gt;= 0: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 618.557px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Calculate the discontentment value, we’ll need it # in all cases </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 647.357px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentValue = models[currentDepth].calculateDiscontentment() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 676.157px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check if we’re at maximum depth </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 704.957px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 25 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">if currentDepth &gt;= maxDepth: </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"># If the current value is the best, store it </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if currentValue &lt; bestValue: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bestValue = currentValue bestAction = actions[0] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 31 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We’re done at this depth, so drop back </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 33 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth -= 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 34 35 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Jump to the next iteration </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 36 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">continue </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 37 38 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Otherwise, we need to try the next action nextAction = models[currentDepth].nextAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 39 40 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 301.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if nextAction: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 42 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># We have an action to apply, copy the current model models[currentDepth+1] = models[currentDepth] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 43 44 45 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># and apply the action to the copy </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 46 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">actions[currentDepth] = nextAction </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 47 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 402.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">models[currentDepth+1].applyAction(nextAction) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 48 49 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># and process it on the next iteration currentDepth += 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 50 51 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Otherwise we have no action to try, so we’re </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 52 53 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># done at this level </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 54 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 503.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 55 56 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Drop back to the next highest level currentDepth -= 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 57 58 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We’ve finished iterating, so return the result </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 59 60 </span><span origfont="g_font_7" data-canvas-width="117.68620127999999" style="left: 127.415px; top: 602.415px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01454); border-left: none;" yquantized="600" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">return bestAction </p></pre>
<span origfont="g_font_7" data-canvas-width="117.68620127999999" style="left: 127.415px; top: 602.415px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01454); border-left: none;" yquantized="600" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The assignment between </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">WorldModel </span>
<span origfont="g_font_7" style="left: 112.524px; top: 638.043px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">instances in the models array: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 638.043px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="459.05269776000006" style="left: 109.415px; top: 665.102px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01735); border-left: none;" yquantized="660" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">models[currentDepth+1] = models[currentDepth] </p></pre>
<span origfont="g_font_7" data-canvas-width="459.05269776000006" style="left: 109.415px; top: 665.102px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01735); border-left: none;" yquantized="660" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> assumes that this kind of assignment is performed by copy.  </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> If you are using references, then the models will point to the same data, themethod will apply the action to both, and the </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">applyAction </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> algorithm will not work. </p>
<span origfont="g_font_7" data-canvas-width="116.93302872000001" style="left: 109.413px; top: 693.896px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01681); border-left: none;" yquantized="690" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Data Structures and Interfaces </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The algorithm uses two data structures: </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Action </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">WorldModel </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Actions can be implemented as before.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">WorldModel </span>
<span origfont="g_font_7" style="left: 125.724px; top: 174.687px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">structure has the following format: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 174.687px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 189.087px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class WorldModel: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def calculateDiscontentment() def nextAction() </p><span origfont="g_font_7" style="left: 125.724px; top: 217.887px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 244.945px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="240" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def applyAction(action) </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 244.945px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="240" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">calculateDiscontentment </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">methodshouldreturnthetotaldiscontentmentassociatedwith the state of the world, as given in the model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> This can be implemented using the same goal value totaling method we used before. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">applyAction </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method takes an action and applies it to the world model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It predicts what effect the action would have on the world model and updates its contents appropriately. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nextAction </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method iterates through each of the valid actions that can be applied,in turn. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When an action is applied to the model (i.e., the model is changed), the iterator resets and begins to return the actions available from the new state of the world.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there are no more actions to return, it should return a null value. </p>
<span origfont="g_font_13" data-canvas-width="134.11725926399998" style="left: 122.615px; top: 402.825px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06442); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.10290926400006" style="left: 122.615px; top: 433.269px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05784); border-left: none;" yquantized="430" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementation Notes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This implementation can be converted into a class, and the algorithm can be split into a setup routine and a method to perform a single iteration.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The contents of the while loop in the function can then be called any number of times by a scheduling system (see Chapter 9 on execution management for a suitable algorithm).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Particularly for large problems, this is essential to allow decent planning without compromising frame rates. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice in the algorithm that we’re only keeping track of and returning the next action to take. </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">To return the whole plan, we need to expandto hold a whole sequence, then it can be </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">bestAction </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> assigned all the actions in the actions array, rather than just the first element. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 122.615px; top: 576.749px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="570" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="113.94424872" style="left: 122.615px; top: 607.193px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.982278); border-left: none;" yquantized="600" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Depth-first GOAP is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">k </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">)inmemoryandO( </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">k </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ) in time, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">k </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the maximum depth, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of goals (used to calculate the discontentment value), and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the mean number of actions available. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The addition of the heuristic can dramatically reduce the actual execution time (it has no effect on the memory use), but the order of scaling is still the same. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">If most actions do not change the value of most goals, we can get to O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nm </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">)intimebyonly recalculating the discontentment contribution of goals that actually change.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In practice this isn’t </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">a major improvement, since the additional code needed to check for changes will slow down the implementation anyway.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our experiments it provided a small speed up on some complex problems and worse performance on simple ones. </p>
<span origfont="g_font_13" data-canvas-width="69.8661888" style="left: 109.128px; top: 166.866px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01473); border-left: none;" yquantized="160" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.21767841599996" style="left: 109.176px; top: 197.309px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00266); border-left: none;" yquantized="190" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Weaknesses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although the technique is simple to implement,algorithmically this still feels like very brute force. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Throughout the book we’ve stressed that as game developers we’re allowed to do what works.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But, when we came to build a GOAP system ourselves, we felt that the depth-first search was a little naive (not to mention poor for our reputations as AI experts), so we succumbed to a more complicated approach.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In hindsight,the algorithm was overkill for the application,and we should have stuck to the simple version.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In fact, for this form of GOAP, there is no better solution than the depth-first search.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Heuristics, as we’ve seen, can bring some speed ups by pruning unhelpful options, but overall there is no better approach. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">All this presumes that we want to use the overall discontentment value to guide our plan- ning.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At the start of the section we looked at an algorithm that chose a single goal to fulfill (based on its insistence) and then chose appropriate actions to fulfill it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we abandon discon- tentment and return to this problem, then the A* algorithm we met in pathfinding becomes dominant. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 408.175px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.7.6 </p>
<span origfont="g_font_7" data-canvas-width="459.07660799999996" style="left: 109.415px; top: 441.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01791); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">GOAP with IDA* </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our problem domain consists of a set of goals and actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Goals have varying insistence levels that allow us to select a single goal to pursue.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Actions tell us which goals they fulfill. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the previous section we did not have a single goal; we were trying to find the best of all possible action sequences.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now we have a single goal, and we are interested in the best action sequence that leads to our goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need to constrain our problem to look for actions that completely fulfill a goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In contrast to previous approaches that try to reduce as much insistence as possible (with complete fulfillment being the special case of removing it all), we now need to have a single distinct goal to aim at, otherwise A* can’t work its magic. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We also need to define "best" in this case.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Ideally, we’d like a sequence that is as short as possible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This could be short in terms of the number of actions or in terms of the total duration of actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If some resource other than time is used in each action (such as magic power, money, or ammo), then we could factor this in also.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the same way as for pathfinding, the length of a plan may be a combination of many factors, as long as it can be represented as a single value. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will call the final measure the cost of the plan.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We would ideally like to find the plan with the lowest cost. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With a single goal to achieve and a cost measurement to try to minimize, we can use A* to drive our planner.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A* is used in its basic form in many GOAP applications, and modifications of it are found in most of the rest.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ve already covered A* in minute detail in Chapter 4, so we’ll avoid going into too much detail on how it works here.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You can go to Chapter 4 for a more intricate, step-by-step analysis of why this algorithm works. </p>
<span origfont="g_font_7" data-canvas-width="283.0709403359999" style="left: 109.415px; top: 715.057px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00025); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">IDA* </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The number of possible actions is likely to be large; therefore, the number of sequences is huge. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because goals may often be unachievable,we need to add a limit to the number of actions allowed in a sequence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is equivalent to the maximum depth in the depth-first search approach.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When using A* for pathfinding, we assume that there will be at least one valid route to the goal, so we allow A* to search as deeply as it likes to find a solution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Eventually, the pathfinder will run out of locations to consider and will terminate. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In GOAP the same thing probably won’t happen.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are always actions to be taken, and the computer can’t tell if a goal is unreachable other than by trying every possible combination of actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the goal is unreachable, the algorithm will never terminate but will happily use ever-increasing amounts of memory.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We add a maximum depth to curb this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Adding this depth limit makes our algorithm an ideal candidate for using the iterative deepening version of A*. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many of the A* variations we discussed in Chapter 4 work for GOAP.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You can use the fullA* implementation, node array A*, or even simplified memory-bounded A* (SMA*).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our experience, however, iterative deepening A* (IDA*) is often the best choice.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It handles huge numbers of actions without swamping memory and allows us to easily limit the depth of the search.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the context of this chapter, it also has the advantage of being similar to the previous depth-first algorithm. </p>
<span origfont="g_font_13" data-canvas-width="81.42925824" style="left: 122.615px; top: 396.642px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04396); border-left: none;" yquantized="390" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.30375528000025" style="left: 122.376px; top: 427.085px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01841); border-left: none;" yquantized="420" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Heuristic </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">All A* algorithms require a heuristic function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The heuristic estimates how far away a goal is.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It allows the algorithm to preferentially consider actions close to the goal. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will need a heuristic function that estimates how far a given world model is from having the goal fulfilled.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be a difficult thing to estimate, especially when long sequences of coordinated actions are required.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It may appear that no progress is being made, even though it is.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a heuristic is completely impossible to create, then we can use a null heuristic (i.e., one that always returns an estimate of zero).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As in pathfinding, this makes A* behave in the same way asDijkstra’s algorithm: checking all possible sequences. </p>
<span origfont="g_font_13" data-canvas-width="88.04000563199999" style="left: 122.615px; top: 569.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03576); border-left: none;" yquantized="560" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0060727920002" style="left: 122.615px; top: 599.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02457); border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">IDA* starts by calling the heuristic function on the starting world model.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The value is stored as the current search cut-off. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">IDA* then runs a series of depth-first searches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each depth-first search continues until either it finds a sequence that fulfills its goal or it exhausts all possible sequences.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The search is limited by both the maximum search depth and the cut-off value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the total cost of a sequence of actions is greater than the cut-off value, then the action is ignored. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If a depth-first search reaches a goal, then the algorithm returns the resulting plan.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the search fails to get there, then the cut-off value is increased slightly and another depth-first search is begun. </p>
<span origfont="g_font_7" data-canvas-width="42.729989904" style="left: 122.615px; top: 715.064px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993721); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The cut-off value is increased to be the smallest total plan cost greater than the cut-off that was found in the previous search. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With no OPEN and CLOSED lists in IDA*, we aren’t keeping track of whether we find a duplicate world state at different points in the search.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> GOAP applications tend to have a huge number of such duplications; sequences of actions in different orders, for example, often have the same result. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We want to avoid searching the same set of actions over and over in each depth-first search. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can use a transposition table to help do this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Transposition tables are commonly used in AI for board games, and we’ll return to them in some length in Chapter 8 on board game AI. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For IDA*, the transposition table is a simple hash.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each world model must be capable of generating a good hash value for its contents.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At each stage of the depth-first search,the algorithm hashes the world model and checks if it is already in the transposition table.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it is, then it is left there and the search doesn’t process it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If not, then it is added, along with the number of actions in the sequence used to get there. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is a little different from a normal hash table, with multiple entries per hash key.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A regular hash table can take unlimited items of data, but gradually gets slower as you load it up.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our case, we can store just one item per hash key.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If another world model comes along with the same hash key, then we can either process it fully without storing it or boot out the world model that’s in its spot.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This way we keep the speed of the algorithm high, without bloating the memory use. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To decide whether to boot the existing entry, we use a simple rule of thumb: we replace an entry if the current entry has a smaller number of moves associated with it. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.45 shows why this works.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> World models A and B are different, but both have exactly thesamehashvalue.Unlabeledworldmodelshavetheirownuniquehashvalues.TheworldmodelA appears twice.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we can avoid considering the second version, we can save a lot of duplication. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The world model B is found first, however, and also appears twice.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Its second appearance occurs later on, with fewer subsequent moves to process.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it was a choice between not processing the second A or the second B, we’d like to avoid processing A, because that would do more to reduce our overall effort. </p>
<span origfont="g_font_42" data-canvas-width="138" style="left: 329.954px; top: 600.846px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(11.5); border-left: 50px solid blue;" yquantized="600" class="highlight3" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_42" data-canvas-width="138" style="left: 329.954px; top: 600.846px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(11.5); border-left: 50px solid blue;" yquantized="600" class="highlight3" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_42" style="left: 250.764px; top: 660.241px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="660" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 701.517px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="700" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">AABB </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.45 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Why to replace transposition entries lower down </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">By using this heuristic, where clashing hash values are resolved in favor of the higher level world state, we get exactly the right behavior in our example. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 122.615px; top: 149.034px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="257.38775603999983" style="left: 122.615px; top: 179.477px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997627); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 125.724px; top: 215.105px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The main algorithm for IDA* looks like the following: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 215.105px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 229.505px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def planAction(worldModel, goal, heuristic, maxDepth): </p><span origfont="g_font_7" style="left: 125.724px; top: 243.905px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 258.305px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Initial cutoff is the heuristic from the start model </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 272.705px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">cutoff = heuristic.estimate(worldModel) </p><span origfont="g_font_7" style="left: 125.724px; top: 287.105px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Create a transposition table transpositionTable = new TranspositionTable() </p><span origfont="g_font_7" style="left: 125.724px; top: 315.905px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Iterate the depth first search until we have a valid </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 344.705px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 359.105px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># plan, or until we know there is none possible </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 373.505px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">while cutoff &gt;= 0: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 387.905px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Get the new cutoff, or best action from the search cutoff, action = doDepthFirst(worldModel, goal, </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 416.705px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 431.105px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">transpositionTable, heuristic, maxDepth, cutoff) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 445.505px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 459.905px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="450" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># If we have an action, return it </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 </span><span origfont="g_font_7" data-canvas-width="146.512386624" style="left: 140.615px; top: 486.964px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.983305); border-left: none;" yquantized="480" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">if bestAction: return action </p></pre>
<span origfont="g_font_7" data-canvas-width="146.512386624" style="left: 140.615px; top: 486.964px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.983305); border-left: none;" yquantized="480" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">Most of the work is done in the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">doDepthFirst </span>
<span origfont="g_font_7" style="left: 125.724px; top: 536.993px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">function,which is very similar to the depth-firstGOAP algorithm we looked at previously: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 536.993px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def doDepthFirst(worldModel, goal, heuristic, transpositionTable, maxDepth, cutoff): </p><span origfont="g_font_7" style="left: 125.724px; top: 565.793px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="560" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Create storage for world models at each depth, and </p><span origfont="g_font_7" style="left: 125.724px; top: 594.593px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 125.724px; top: 608.993px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># actions that correspond to them, with their cost </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">models = new WorldModel[maxDepth+1] actions = new Action[maxDepth] </p><span origfont="g_font_7" style="left: 125.724px; top: 637.793px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 125.724px; top: 652.193px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">costs = new float[maxDepth] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 666.593px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Set up the initial data models[0] = worldModel </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 695.393px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 709.793px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth = 0 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 13 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"># Keep track of the smallest pruned cutoff </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">smallestCutoff = infinity </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Iterate until we have completed all actions at depth </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># zero. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> while currentDepth &gt;= 0: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check if we have a goal </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if goal.isFulfilled(models[currentDepth]): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># We can return from the depth first search </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># immediately with the result return cutoff, actions[0] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 27 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check if we’re at maximum depth </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 28 29 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 330.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="330" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if currentDepth &gt;= maxDepth: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 31 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># We’re done at this depth, so drop back </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth -= 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 33 34 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Jump to the next iteration continue </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 35 36 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Calculate the total cost of the plan, we’ll need it </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 37 38 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># in all other cases cost = heuristic.estimate(models[currentDepth]) + </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 39 40 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">costs[currentDepth] </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check if we need to prune based on the cost </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 42 43 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 532.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if cost &gt; cutoff: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 44 45 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check if this is the lowest prune if cutoff &lt; smallestCutoff: smallestCutoff = cutoff </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 589.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 46 47 48 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 604.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># We’re done at this depth, so drop back </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 49 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 618.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth -= 1 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 50 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Jump to the next iteration </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 647.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 51 52 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 661.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">continue </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 676.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 53 54 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Otherwise, we need to try the next action nextAction = models[currentDepth].nextAction() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 704.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 55 56 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">if nextAction: </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"># We have an action to apply, copy the current model </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 58 59 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">models[currentDepth+1] = models[currentDepth] </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 60 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # and apply the action to the copy </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 61 62 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions[currentDepth] = nextAction models[currentDepth+1].applyAction(nextAction) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 63 64 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">costs[currentDepth+1] = costs[currentDepth] + nextAction.getCost() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 65 66 67 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Check if we’ve already seen this state </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 68 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not transitionTable.has(models[currentDepth+1]): </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 69 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Process the new state on the next iteration </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 70 71 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 301.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth += 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 72 73 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Otherwise, we don’t bother processing it, since # we have seen it before. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 330.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 74 75 76 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Set the new model in the transition table </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 77 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">transitionTable.add(models[currentDepth+1], </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 78 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 402.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 79 80 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Otherwise we have no action to try, so we’re # done at this level </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 81 82 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 460.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 83 84 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Drop back to the next highest level </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 85 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 503.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentDepth -= 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 86 87 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># We’ve finished iterating, and didn’t find an action, # return the smallest cutoff </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 88 89 </span><span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 122.615px; top: 598.268px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="590" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">return smallestCutoff, None </p></pre>
<span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 122.615px; top: 598.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="590" class="highlight4"></span>
<span origfont="g_font_7" data-canvas-width="247.97309903999994" style="left: 122.615px; top: 628.713px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02468); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The world model is exactly the same as before.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Action </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">class now requires a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">getCost </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">, which can be the same as the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getDuration </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">method used previously, if costs are controlled solely by time. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">We have added an </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">isFulfilled </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">method to the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">class.When given a world model,it returns true if the goal is fulfilled in the world model. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The heuristic object has one method, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">estimate </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, which returns an estimate of the cost of reaching the goal from the given world model. </p>
<span origfont="g_font_7" data-canvas-width="220.55761785599998" style="left: 122.619px; top: 715.107px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01173); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">We have added a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">TranspositionTable </span>
<span origfont="g_font_35" data-canvas-width="134.496" style="left: 137.39px; top: 128.004px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">data structure with the following interface: </p>
<span origfont="g_font_35" data-canvas-width="134.496" style="left: 137.39px; top: 128.004px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class TranspositionTable: </p><span origfont="g_font_7" style="left: 112.524px; top: 145.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def has(worldModel) def add(worldModel, depth) </p><span origfont="g_font_7" data-canvas-width="441.24674203199993" style="left: 127.176px; top: 187.399px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0214); border-left: none;" yquantized="180" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 3 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.24674203199993" style="left: 127.176px; top: 187.399px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0214); border-left: none;" yquantized="180" class="highlight2"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 237.428px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Assuming we have a hash function that can generate a hash integer from a world model, we can implement the transition table in the following way: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 237.428px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 251.828px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class TranspositionTable: </p><span origfont="g_font_7" style="left: 112.524px; top: 266.228px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Holds a single table entry struct Entry: </p><span origfont="g_font_7" style="left: 112.524px; top: 295.028px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="290" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 309.428px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 323.826px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Holds the world model for the entry, all entries </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 338.226px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># are initially empty </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><span origfont="g_font_7" style="left: 112.524px; top: 352.626px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">worldModel = None </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 367.026px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="360" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Holds the depth that the world model was found at. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # This is initially infinity, because the replacement </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 395.826px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="390" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># strategy we use in the add method can then treat # entries the same way whether they are empty or not. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 410.226px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 424.628px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="420" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 439.028px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">depth = infinity </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # A fixed size array of entries </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 467.828px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="460" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 482.228px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">entries </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 496.628px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># The number of entries in the array size </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 525.428px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="520" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 539.828px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 554.228px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def has(worldModel): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 568.628px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Get the hash value </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 583.028px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">hashValue = hash(worldModel) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 597.428px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Find the entry entry = entries[hashValue % size] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 626.228px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check if is the right one </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 655.028px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="650" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 30 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 669.428px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return entry.worldModel == worldModel </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 683.827px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 31 32 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 698.227px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def add(worldModel, depth) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 33 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Get the hash value hashValue = hash(worldModel) </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 34 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"># Find the entry </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 36 37 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">entry = entries[hashValue % size] </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 38 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check if it is the right world model </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 39 40 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if entry.worldModel == worldModel: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 42 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># If we have a lower depth, use the new one if depth &lt; entry.depth: entry.depth = depth </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 43 44 45 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Otherwise we have a clash (or an empty slot) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 46 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else: </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 47 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Replace the slot if our new depth is lower </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 48 49 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if depth &lt; entry.depth: entry.worldModel = worldModel </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 50 51 </span><span origfont="g_font_7" data-canvas-width="441.03394089600005" style="left: 140.615px; top: 343.215px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02193); border-left: none;" yquantized="340" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">entry.depth = depth </p></pre>
<span origfont="g_font_7" data-canvas-width="441.03394089600005" style="left: 140.615px; top: 343.215px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02193); border-left: none;" yquantized="340" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The transition table typically doesn’t need to be very large.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a problem with 10 actions at a time and a depth of 10,for example,we might only use a 1000-element transition table.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As always, experimentation and profiling are the key to getting your perfect trade-off between speed and memory use. </p>
<span origfont="g_font_13" data-canvas-width="134.11725926399998" style="left: 122.615px; top: 424.329px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06442); border-left: none;" yquantized="420" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 122.615px; top: 454.773px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="450" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Implementation Notes </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">doDepthFirst </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function returns two items of data: the smallest cost that was cut off and the action to try.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a language such as C++, where multiple returns are inconvenient, the cut-off value is normally passed by reference, so it can be altered in place.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> This is the approach taken by </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Library </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">the source code on the website. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 122.615px; top: 535.887px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="530" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="52.32756024" style="left: 122.615px; top: 566.331px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.95141); border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">IDA* is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">t </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in memory, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">t </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of entries in the transition table.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It is O( </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">d </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> )in time,where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of possible actions at each world model and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">d </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the maximum depth. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This appears to have the same time as an exhaustive search of all possible alternatives.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In fact, the extensive pruning of branches in the search means we will gain a great deal of speed from usingIDA*.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But, in the worst case (when there is no valid plan, for example, or when the only correct plan is the most expensive of all),we will need to do almost as much work as an exhaustive search. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 676.939px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.7.7 </p>
<span origfont="g_font_7" data-canvas-width="459.22963353599994" style="left: 122.376px; top: 710.277px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01825); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Smelly GOB </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An interesting approach for making believable GOB is related to the sensory perception simula- </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this model, each motive that a character can have (such as "eat" or "find information") is represented as a kind of smell; it gradually diffuses through the game level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Objects that have actions associated with them give out a cocktail of such "smells," one for each of the motives that its action affects.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An oven, for example, may give out the "I can provide food" smell, while a bed might give out the "I can give you rest" smell. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Goal-oriented behavior can be implemented by having a character follow the smell for the motive it is most concerned with fulfilling.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character that is extremely hungry, for example, would follow the "I can provide food" smell and find its way to the cooker. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach reduces the need for complex pathfinding in the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the character has three possible sources of food,then conventional GOB would use a pathfinder to see how difficult each source of food was to get to.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character would then select the source that was the most convenient. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The smell approach diffuses out from the location of the food.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It takes time to move around corners, it cannot move through walls, and it naturally finds a route through complicated levels. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It may also include the intensity of the signal: the smell is greatest at the food source and gets fainter the farther away you get. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To avoid pathfinding, the character can move in the direction of the greatest concentration of smell at each frame.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This will naturally be the opposite direction to the path the smell has taken to reach the character: it follows its nose right to its goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, because the intensity of the smell dies out, the character will naturally move toward the source that is the easiest to get to. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This can be extended by allowing different sources to emit different intensities.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Junk food, for example, can emit a small amount of signal, and a hearty meal can emit more.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This way the character will favor less nutritious meals that are really convenient, while still making an effort to cook a balanced meal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Without this extension the character would always seek out junk food in the kitchen. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This "smell" approach was used in The Sims to guide characters to suitable actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is rela- tivelysimpletoimplement(youcanusethesensemanagementalgorithmsprovidedinChapter 10,World Interfacing) and provides a good deal of realistic behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has some limitations,however, and requires modification before it can be relied upon in a game. </p>
<span origfont="g_font_13" data-canvas-width="115.92479232000002" style="left: 109.415px; top: 532.316px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04437); border-left: none;" yquantized="530" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.059870832" style="left: 109.415px; top: 562.76px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04332); border-left: none;" yquantized="560" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Compound Actions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many actions require multiple steps.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Cooking a meal, for example, requires finding some raw food, cooking it, and then eating it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Food can also be found that does not require cooking.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no point in having a cooker that emits the "I can provide food" signal if the character walks over to it and cannot cook anything because it isn’t carrying any raw food. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Significant titles in this genre have typically combined elements of two different solutions to this problem: allowing a richer vocabulary of signals and making the emission of these signals depend on the state of characters in the game. </p>
<span origfont="g_font_8" data-canvas-width="116.49003417599998" style="left: 109.243px; top: 678.637px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.939436); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0228099600001" style="left: 109.415px; top: 705.495px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06308); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action-Based Signals </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The number of "smells" in the game can be increased to allow different action nuances to be </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">food.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This reduces the elegance of the solution: characters can no longer easily follow the trail for the particular motive they are seeking.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Instead of the diffusing signals representing motives, they are now, effectively, representing individual actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is an"I can cook raw food"signal, rather than an "I can feed you" signal. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This means that characters need to perform the normal GOB decision making step of working out which action to carry out in order to best fulfill their current goals.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Their choice of action should depend not only on the actions they know are available but also on the pattern of action signals they can detect at their current location. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the other hand, the technique supports a huge range of possible actions and can be easily extended as new sets of objects are created. </p>
<span origfont="g_font_8" data-canvas-width="143.36484556799996" style="left: 122.615px; top: 259.554px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.944975); border-left: none;" yquantized="250" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.23202455999996" style="left: 122.376px; top: 286.411px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02507); border-left: none;" yquantized="280" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Character-Specific Signals </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Another solution is to make sure that objects only emit signals if they are capable of being used by the character at that specific time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character carrying a piece of raw food, for example, may be attracted by an oven (the oven is now giving out "I can give you food" signals).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the same character was not carrying any raw food, then it would be the fridge sending out "I can give you food" signals, and the oven would not emit anything. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach is very flexible and can dramatically reduce the amount of planning needed to achieve complex sequences of actions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It has a significant drawback in that the signals diffusing around the game are now dependent on one particular character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Two characters are unlikely to be carrying exactly the same object or capable of exactly the same set of actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This means that there needs to be a separate sensory simulation for each character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a game has a handful of slow-moving characters,this is not a problem (characters make decisions only every few hundred frames, and sensory simulation can easily be split over many frames).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For larger or faster simulations, this would not be practical. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 505.269px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="500" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.8 </p>
<span origfont="g_font_7" data-canvas-width="458.99531318400005" style="left: 122.615px; top: 547.094px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.982859); border-left: none;" yquantized="540" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule-Based Systems </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule-based systems were at the vanguard of AI research through the 1970s and early 1980s.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Many of the most famous AI programs were built with them, and in their "expert system" incarnation, they are the best known AI technique.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They have been used off and on in games for at least 15 years, despite having a reputation for being inefficient and difficult to implement.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They remain a fairly uncommon approach, partly because similar behaviors can almost always be achieved in a simpler way using decision trees or state machines. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">They do have their strengths, however, especially when characters need to reason about the world in ways that can’t easily be anticipated by a designer and encoded into a decision tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule-based systems have a common structure consisting of two parts: a database containing knowledge available to the AI and a set of if–then rules. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rules can examine the database to determine if their "if" condition is met.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rules that have their conditions met are said to trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A triggered rule may be selected to fire, whereupon its </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Ammo4 </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.46 </span><span origfont="g_font_7" data-canvas-width="441.3352099200002" style="left: 127.416px; top: 289.606px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00413); border-left: none;" yquantized="280" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.3352099200002" style="left: 127.416px; top: 289.606px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00413); border-left: none;" yquantized="280" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Schematic of a rule-based systemThis is the same nomenclature that we used in state machine transitions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case,however, the rules trigger based on the contents of the database, and their effects can be more general than causing a state transition. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many rule-based systems also add a third component: an arbiter that gets to decide which triggered rule gets to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll look at a simple rule-based system first, along with a common optimization, and return to arbiters later in the section. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 391.593px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="390" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.1 </span>
<span origfont="g_font_7" data-canvas-width="459.21648290400015" style="left: 109.176px; top: 424.929px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02038); border-left: none;" yquantized="420" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Problem </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll build a rule-based decision making system with many of the features typical of rule-based systems in traditional AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our specification is quite complex and likely to be more flexible than is required for many games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Any simpler, however, and it is likely that state machines or decision trees would be a simpler way to achieve the same effect. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this section we’ll survey some of the properties shared by many rule-based system imple- mentations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each property will be supported in the following algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’re going to introduce the contents of the database and rules using a very loose syntax.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is intended to illustrate the principles only.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The following sections suggest a structure for each component that can be implemented. </p>
<span origfont="g_font_13" data-canvas-width="114.42561024" style="left: 109.415px; top: 568.233px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04978); border-left: none;" yquantized="560" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.05269775999994" style="left: 109.415px; top: 598.677px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05529); border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Database Matching </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The "if" condition of the rule is matched against the database; a successful match triggers the rule.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The condition, normally called a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">pattern </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, typically consists of facts identical to those in the database, combined with Boolean operators such as AND, OR, and NOT. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Suppose we have a database containing information about the health of the soldiers in a fire team, for example.  </p>
<span origfont="g_font_7" data-canvas-width="100.76014238399999" style="left: 287.511px; top: 679.613px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.994272); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At one point in time the database contains the following information:Captain’s health is 51Johnson’s health is 38Sale’s health is 42 </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whisker, the communications specialist, needs to be relieved of her radio when her health drops to zero.  </p>
<span origfont="g_font_7" data-canvas-width="75.0781536" style="left: 304.066px; top: 139.058px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01457); border-left: none;" yquantized="130" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We might use a rule that triggers when it sees a pattern such as:Whisker: health </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<span origfont="g_font_7" data-canvas-width="441.11523571199996" style="left: 140.603px; top: 167.81px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06293); border-left: none;" yquantized="160" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0Of course, the rule should only trigger if Whisker still has the radio.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, first we need to add the appropriate information to the database.  </p>
<span origfont="g_font_7" data-canvas-width="100.76014238399999" style="left: 292.935px; top: 229.044px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.994272); border-left: none;" yquantized="220" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="303.97924970399987" style="left: 140.615px; top: 332.253px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0155); border-left: none;" yquantized="330" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The database now contains the following information:Captain’s health is 51Johnson’s health is 38Sale’s health is 42Whisker’s health is 15Radio is held by WhiskerNow our rule can use a Boolean operator.  </p>
<span origfont="g_font_7" data-canvas-width="246.33405208799996" style="left: 228.844px; top: 361.005px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.974484); border-left: none;" yquantized="360" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="441.43682844" style="left: 140.615px; top: 389.745px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03867); border-left: none;" yquantized="380" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The pattern becomes:Whisker’s health is 0 AND Radio is held by WhiskerIn practice we’d want more flexibility with the patterns that we can match.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our example, we want to relieve Whisker if she is very hurt, not just if she’s dead.  </p>
<span origfont="g_font_7" data-canvas-width="78.71848764" style="left: 226.417px; top: 453.872px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.986644); border-left: none;" yquantized="450" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> So the pattern should match a range:Whisker’s health </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">&lt; </span>
<span origfont="g_font_7" data-canvas-width="440.89645701599983" style="left: 140.627px; top: 486.964px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997503); border-left: none;" yquantized="480" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 15 AND Radio is held by WhiskerSo far we’re on familiar ground.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is similar to the kind of tests we made for triggering a state transition or for making a decision in a decision tree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To improve the flexibility of the system, it would be useful to add wild cards to the matching. </p>
<span origfont="g_font_39" style="left: 379.359px; top: 557.248px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="550" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We would like to be able to say, for example, </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> &lt; </p>
<span origfont="g_font_7" data-canvas-width="459.06704390399995" style="left: 122.623px; top: 588.989px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03809); border-left: none;" yquantized="580" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Anyone’s health15 and have this match if there was anyone in the database with health less than 15.  </p>
<span origfont="g_font_7" data-canvas-width="75.4368072" style="left: 235.156px; top: 638.734px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.975384); border-left: none;" yquantized="630" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Similarly, we could say,Anyone’s health </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">&lt; </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 15 AND Anyone’s health </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">&gt; </span>
<span origfont="g_font_7" data-canvas-width="458.9666208959999" style="left: 122.623px; top: 671.826px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00651); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 45 to make sure there was also someone who is healthy (maybe we want the healthy person to carry the weak one, for example). </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Many rule-based systems use a more advanced type of wild-card pattern matching, called </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> unification </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, which can include wild cards.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll return to unification later in this section, after </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Condition–Action Rules </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A condition–action rule causes a character to carry out some action as a result of finding a match in the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The action will normally be run outside of the rule-based system, although rules can be written that directly modify the state of the game. </p>
<span origfont="g_font_7" data-canvas-width="259.01604338399994" style="left: 209.432px; top: 193.591px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.970883); border-left: none;" yquantized="190" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="441.0243768" style="left: 127.42px; top: 235.386px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03284); border-left: none;" yquantized="230" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Continuing our fire team example, we could have a rule that states:IF Whisker’s health is 0 AND Radio is held by WhiskerTHEN Sale: pick up the radioIf the pattern matches, and the rule fires, then the rule-based system tells the game that Sale should pick up the radio. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This doesn’t directly change the information in the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can’t assume that Sale can actually pick up the radio.Whisker may have fallen from a cliff with no safe way to get down.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Sale’s action can fail in many different ways, and the database should only contain knowledge about the state of the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (In practice, it is sometimes beneficial to let the database contain the beliefs of the AI, in which case resulting actions are more likely to fail.)Picking up the radio is a game action:the rule-based system acting as a decision maker chooses to carry out the action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The game gets to decide whether the action succeeds, and updates the database if it does. </p>
<span origfont="g_font_13" data-canvas-width="152.31403008" style="left: 109.415px; top: 400.16px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02224); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1602938400002" style="left: 109.415px; top: 430.604px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07532); border-left: none;" yquantized="430" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Database Rewriting Rules </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are other situations in which the results of a rule can be incorporated directly into the database. </p>
<span origfont="g_font_7" data-canvas-width="109.701376632" style="left: 248.31px; top: 485.143px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997285); border-left: none;" yquantized="480" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="441.2634792000002" style="left: 127.42px; top: 561.489px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02381); border-left: none;" yquantized="560" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the AI for a fighter pilot, we might have a database with the following contents: 1500 kg fuel remaining 100 km from base enemies sighted: Enemy 42, Enemy 21 currently patrolingThe first three elements, fuel, distance to base, and sighted enemies, are all controlled by the game code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They refer to properties of the state of the game and can only be changed by the AI scheduling actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The last two items, however, are specific to the AI and don’t have any meaning to the rest of the game. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Suppose we want a rule that changes the goal of the pilot from "patrol zone" to "attack" if an enemy is sighted.  </p>
<span origfont="g_font_7" data-canvas-width="142.58871624" style="left: 200.394px; top: 674.799px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01127); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In this case we don’t need to ask the game code to schedule a "change goal" action; we could use a rule that says something like:IF number of sighted enemies </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">&gt; </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 and currently patrolingTHEN remove(currently patroling) </p>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">remove </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">function removes a piece of data from the database, and the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">add </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function adds a new one.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we didn’t remove the first piece of data, we would be left with a database containing both patrol zone and attack goals.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In some cases this might be the right thing to do (so the pilot can go back to patroling when the intruder is destroyed, for example). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We would like to be able to combine both kinds of effects: those that request actions to be carried out by the game and those that manipulate the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We would also like to execute arbitrary code as the result of a rule firing, for extra flexibility. </p>
<span origfont="g_font_13" data-canvas-width="196.38281011200002" style="left: 122.615px; top: 220.343px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03906); border-left: none;" yquantized="220" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9164093919999" style="left: 122.615px; top: 250.786px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02776); border-left: none;" yquantized="250" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Forward and Backward Chaining </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The rule-based system we’ve described so far, and the only one we’ve seen used in production code for games, is known as "forward chaining." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">" It starts with a known database of information and repeatedly applies rules that change the database contents (either directly or by changing the state of the game through character action). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Discussions of rule-based systems in other areas of AI will mention backward chaining. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Backward chaining starts with a given piece of knowledge, the kind that might be found in the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This piece of data is the goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The system then tries to work out a series of rule firings that would lead from the current database contents to the goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It typically does this by working backward, looking at the THEN components of rules to see if any could generate the goal.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it finds rules that can generate the goal, it then tries to work out how the conditions of those rules might be met, which might involve looking at the THEN component of other rules, and so on, until all the conditions are found in the database. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">While backward chaining is a very important technique in many areas (such as theorem proving and planning), we have not come across any production AI code using it for games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could visualize some contrived situations where it might be useful in a game, but for the purpose of this book, we’ll ignore it. </p>
<span origfont="g_font_13" data-canvas-width="185.73359616000002" style="left: 122.615px; top: 504.817px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04345); border-left: none;" yquantized="500" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.84946071999997" style="left: 122.615px; top: 535.261px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01215); border-left: none;" yquantized="530" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Format of Data in the Database </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The database contains the knowledge of a character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It must be able to contain any kind of game- relevant data, and each item of data should be identified.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we want to store the character’s health in the database, we need both the health value and some identifier that indicates what the value means.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The value on its own is not sufficient. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we are interested in storing a Boolean value, then the identifier on its own is enough.  </p>
<span origfont="g_font_7" data-canvas-width="20.28783864" style="left: 315.989px; top: 649.265px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.966088); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If theBoolean value is true, then the identifier is placed in the database; if it is false, then the identifier is not included:Fuel </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<span origfont="g_font_7" data-canvas-width="441.08415240000016" style="left: 140.607px; top: 695.842px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00626); border-left: none;" yquantized="690" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1500 kg patrol zoneIn this example, the patrol-zone goal is such an identifier.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is an identifier with no value, and we can assume it is a Boolean with a value of true.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The other example database entry had both an </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It consists of an identifier and a value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The value might not be needed (if it is a Boolean with the value of true), but we’ll assume it is explicit, for convenience’s sake. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A database containing only this kind of Datum object is inconvenient.  </p>
<span origfont="g_font_7" data-canvas-width="85.534101552" style="left: 248.239px; top: 169.631px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00227); border-left: none;" yquantized="160" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In a game where a character’s knowledge encompasses an entire fire team, we could have:Captain’s-weapon </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> rifleJohnson’s-weapon </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> machine-gunCaptain’s-rifle-ammo </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 36 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </p>
<span origfont="g_font_7" data-canvas-width="441.01242167999993" style="left: 127.42px; top: 250.759px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.99251); border-left: none;" yquantized="250" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Johnson’s-machine-gun-ammo229This nesting could go very deep.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are trying to find the Captain’s ammo,we might have to check several possible identifiers to see if any are present: Captain’s-rifle-ammo, Captain’s-RPG- ammo, Captain’s-machine-gun-ammo, and so on. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Instead,we would like to use a hierarchical format for our data.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We expand our Datum so that it either holds a value or holds a set of Datum objects.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each of these Datum objects can likewise contain either a value or further lists.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The data are nested to any depth. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Note that a Datum object can contain multiple Datum objects, but only one value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The value may be any type that the game understands, however, including structures containing many different variables or even function pointers, if required.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The database treats all values as opaque types it doesn’t understand, including built-in types. </p>
<span origfont="g_font_35" data-canvas-width="107.5968" style="left: 137.39px; top: 429.264px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Symbolically, we will represent one Datum in the database as: </p>
<span origfont="g_font_35" data-canvas-width="107.5968" style="left: 137.39px; top: 429.264px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="420" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (identifier content) </p><span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 462.249px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="460" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 109.415px; top: 462.249px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="460" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">content </span>
<span origfont="g_font_35" data-canvas-width="193.67424000000003" style="left: 137.39px; top: 496.733px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">iseitheravalueoralistof Datumobjects.Wecanrepresentthepreviousdatabaseas: </p>
<span origfont="g_font_35" data-canvas-width="193.67424000000003" style="left: 137.39px; top: 496.733px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (Captain’s-weapon (Rifle (Ammo 36))) </p><span origfont="g_font_7" style="left: 112.524px; top: 514.668px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" data-canvas-width="441.129581856" style="left: 127.415px; top: 544.118px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05533); border-left: none;" yquantized="540" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Johnson’s-weapon (Machine-Gun (Ammo 229))) </p></pre>
<span origfont="g_font_7" data-canvas-width="441.129581856" style="left: 127.415px; top: 544.118px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05533); border-left: none;" yquantized="540" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This database has two Datum objects.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Both contain one Datum object (the weapon type). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each weapon, in turn, contains one more Datum (ammo); in this case, the nesting stops, and the ammo has a value only. </p>
<span origfont="g_font_35" style="left: 137.39px; top: 619.412px; font-size: 14.9291px; font-family: monospace; border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">We could expand this hierarchy to hold all the data for one person in one identifier: </p>
<span origfont="g_font_35" style="left: 137.39px; top: 619.412px; font-size: 14.9291px; font-family: monospace; border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> ( </p><span origfont="g_font_7" style="left: 112.524px; top: 637.347px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">Captain (Weapon (Rifle (Ammo 36) (Clips 2))) (Health 65) </p><span origfont="g_font_7" style="left: 112.524px; top: 666.147px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(Position [21, 46, 92]) ) </p><span origfont="g_font_7" data-canvas-width="441.09610752000015" style="left: 127.415px; top: 707.605px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0306); border-left: none;" yquantized="700" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 5 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.09610752000015" style="left: 127.415px; top: 707.605px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0306); border-left: none;" yquantized="700" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Having this database structure will give us flexibility to implement more sophisticated rule- </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notation of Wild Cards </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The notation we have used is LISP-like, and because LISP was overwhelmingly the language of choice for AI up until the 1990s, it will be familiar if you read any papers or books on rule-based systems.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a simplified version for our needs.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 185.5px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> In this syntax wild cards are normally written as: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 185.5px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="93.162663624" style="left: 122.615px; top: 212.559px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02377); border-left: none;" yquantized="210" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">(?anyone (Health 0-15)) </p></pre>
<span origfont="g_font_7" data-canvas-width="93.162663624" style="left: 122.615px; top: 212.559px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02377); border-left: none;" yquantized="210" class="highlight2"></span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> and are often called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">variables </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 244.995px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="240" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.2 </span>
<span origfont="g_font_7" data-canvas-width="459.12442848000006" style="left: 122.376px; top: 278.332px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04574); border-left: none;" yquantized="270" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We start with a database containing data.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some external set of functions needs to transfer data from the current state of the game into the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Additional data may be kept in the database (such as the current internal state of the character using the rule-based system).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These functions are not part of this algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A set of rules is also provided.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The IF-clause of the rule contains items of data to match in the database joined by any Boolean operator (AND, OR, NOT, XOR, etc.).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We will assume matching is by absolute value for any value or by less-than, greater-than, or within-range operators for numeric types. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will assume that rules are condition–action rules: they always call some function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is easy to implement database rewriting rules in this framework by changing the values in the database within the action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This reflects the bias that rule-based systems used in games tend to contain more condition–action rules than database rewrites, unlike many industrial AI systems. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The rule-based system applies rules in iterations, and any number of iterations can be run consecutively.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The database can be changed between each iteration, either by the fired rule or because other code updates its contents. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The rule-based system simply checks each of its rules to see if they trigger on the current database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first rule that triggers is fired, and the action associated with the rule is run. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is the naive algorithm for matching: it simply tries every possibility to see if any works. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For all but the simplest systems, it is probably better to use a more efficient matching algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The naive algorithm is one of the stepping stones we mentioned in the introduction to the book, probably not useful on its own but essential for understanding how the basics work before going on to a more complete system.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Later in the section we will introduce Rete, an industry standard for faster matching. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 627.569px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="620" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.3 </p>
<span origfont="g_font_7" data-canvas-width="381.9278276160001" style="left: 122.615px; top: 660.907px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01039); border-left: none;" yquantized="660" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 125.724px; top: 696.534px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The rule-based system has an extremely simple algorithm of the following form: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 696.534px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 710.934px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def ruleBasedIteration(database, rules): </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 2 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">for rule in rules: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Create the empty set of bindings bindings = [] </p><span origfont="g_font_7" style="left: 112.524px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check for triggering </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if rule.ifClause.matches(database, bindings): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Fire the rule </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">rule.action(bindings) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># And exit: we’re done for this iteration return </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # If we get here, we’ve had no match, we could use </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># a fallback action, or simply do nothing return </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 357.615px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="350" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 20 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 357.615px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="350" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">matches </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function of the rule’s IF-clause checks through the database to make sure the clause matches. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 401.399px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="400" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.4 </span>
<span origfont="g_font_7" data-canvas-width="459.342011664" style="left: 109.176px; top: 434.735px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04748); border-left: none;" yquantized="430" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">With an algorithm so simple, it is hardly surprising that most of the work is being done in the data structures.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> In particular, the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">matches </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function is taking the main burden.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Before giving the pseudo-code for rule matching, we need to look at how the database is implemented and howIF-clauses of rules can operate on it. </p>
<span origfont="g_font_13" data-canvas-width="80.71194623999999" style="left: 109.415px; top: 510.212px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04821); border-left: none;" yquantized="510" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="381.85370587200015" style="left: 109.415px; top: 540.657px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09414); border-left: none;" yquantized="540" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The Database </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The database can simply be a list or array of data items, represented by the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">DataNode </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">class. </p>
<span origfont="g_font_35" data-canvas-width="48.41855999999999" style="left: 109.415px; top: 555.766px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: none;" yquantized="550" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">DataGroup </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">s in the database hold additional data nodes, so overall the database becomes a tree of information. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 619.485px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Each node in the tree has the following base structure: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 619.485px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 633.885px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="630" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct DataNode: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" data-canvas-width="396.2452793280001" style="left: 127.415px; top: 660.944px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01601); border-left: none;" yquantized="660" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">identifier </p></pre>
<span origfont="g_font_7" data-canvas-width="396.2452793280001" style="left: 127.415px; top: 660.944px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01601); border-left: none;" yquantized="660" class="highlight4"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 696.572px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Non-leaf nodes correspond to data groups in the data and have the following form: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 696.572px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct DataGroup (DataNode): children </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 2 </p></pre>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Leaves in the tree contain actual values and have the following form: </p>
<span origfont="g_font_35" data-canvas-width="129.11616" style="left: 150.59px; top: 128.004px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> struct Datum (DataNode): </p><span origfont="g_font_7" style="left: 125.724px; top: 145.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" data-canvas-width="441.021985776" style="left: 140.615px; top: 172.999px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.06015); border-left: none;" yquantized="170" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">value </p></pre>
<span origfont="g_font_7" data-canvas-width="441.021985776" style="left: 140.615px; top: 172.999px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06015); border-left: none;" yquantized="170" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The children of a data group can be any data node: either another data group or a Datum. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will assume some form of polymorphism for clarity, although in reality it is often better to implement this as a single structure combining the data members of all three structures (seeSection 5.8.5, Implementation Notes). </p>
<span origfont="g_font_13" data-canvas-width="32.40815616" style="left: 122.615px; top: 258.771px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.982065); border-left: none;" yquantized="250" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="165.127703976" style="left: 122.615px; top: 289.215px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00077); border-left: none;" yquantized="280" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rules </p>
<span origfont="g_font_7" style="left: 125.724px; top: 324.844px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Rules have the following structure: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 324.844px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 339.244px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Rule: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 353.644px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">ifClause </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 380.702px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="380" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def action(bindings) </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 380.702px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="380" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">ifClause </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is used to match against the database and is described below.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> The </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">action </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> function can perform any action required, including changing the database contents.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It takes a list of bindings which is filled with the items in the database that match any wild cards in theIF-clause. </p>
<span origfont="g_font_13" data-canvas-width="63.008686080000004" style="left: 122.615px; top: 466.475px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.00014); border-left: none;" yquantized="460" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0766079999998" style="left: 122.615px; top: 496.918px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04573); border-left: none;" yquantized="490" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">IF-Clauses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">IF-clauses consist of a set of data items, in a format similar to those in the database, joined byBoolean operators.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 558.454px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> They need to be able to match the database, so we use a general data structure as the base class of elements in an IF-clause: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 558.454px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class Match: def matches(database, bindings) </p><span origfont="g_font_7" data-canvas-width="440.959819152" style="left: 140.615px; top: 599.913px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00218); border-left: none;" yquantized="590" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 2 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.959819152" style="left: 140.615px; top: 599.913px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00218); border-left: none;" yquantized="590" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The bindings parameter is both input and output,so it can be passed by reference in languages that support it.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> It initially should be an empty list (this is initialized in the </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">ruleBasedIteration </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> driver function above).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When part of the IF-clause matches a"don’t care"value (a wild card), it is added to the bindings. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The data items in the IF-clause are similar to those in the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need two additional refinements, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> First, we need to be able to specify a "don’t care" value for an identifier to implement wild cards.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can simply be a pre-arranged identifier reserved for this purpose. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Second, we need to be able to specify a match of a range of values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Matching a single value, using a less-than operator or using a greater-than operator, can be performed by matching a </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">range; for a single value, the range is zero width, and for less-than or greater-than it has one of its bounds at infinity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We can use a range as the most general match. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The Datum structure at the leaf of the tree is therefore replaced by a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">DatumMatch </span>
<span origfont="g_font_7" style="left: 112.524px; top: 179.522px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">structure with the following form: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 179.522px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 193.922px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="190" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct DatumMatch(Match): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 208.322px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">identifier </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">minValue maxValue </p><span origfont="g_font_7" data-canvas-width="440.9789473439998" style="left: 127.415px; top: 254.563px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00049); border-left: none;" yquantized="250" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 4 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.9789473439998" style="left: 127.415px; top: 254.563px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00049); border-left: none;" yquantized="250" class="highlight4"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 309.242px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Boolean operators are represented in the same way as with state machines; we use a polymor- phic set of classes: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 309.242px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 323.642px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class And (Match): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 338.042px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">match1 </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">match2 def matches(database, bindings): </p><span origfont="g_font_7" style="left: 112.524px; top: 366.842px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="360" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># True if we match both sub-matches return match1.matches(database, bindings) and </p><span origfont="g_font_7" style="left: 112.524px; top: 395.642px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 410.042px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">match2.matches(database, bindings) </p><span origfont="g_font_7" style="left: 112.524px; top: 424.442px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 438.842px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Not (Match): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">match def matches(database, bindings): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 467.642px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="460" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># True if we don’t match our submatch.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> Note we pass in # new bindings list, because we’re not interested in </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 496.442px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># anything found: we’re making sure there are no # matches. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 510.842px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 525.242px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><span origfont="g_font_7" data-canvas-width="459.07899902399987" style="left: 109.415px; top: 557.083px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.09828); border-left: none;" yquantized="550" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return not match.matches(database, []) </p></pre>
<span origfont="g_font_7" data-canvas-width="459.07899902399987" style="left: 109.415px; top: 557.083px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09828); border-left: none;" yquantized="550" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> and so on for other operators.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Note that the same implementation caveats apply as for the polymorphic Boolean operators we covered in Section 5.3 on state machines.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same solutions can also be applied to optimizing the code. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Finally, we need to be able to match a data group.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need to support "don’t care" values for the identifier, but we don’t need any additional data in the basic data group structure.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 669.492px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> We have a data group match that looks like the following: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 669.492px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 683.892px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct DataGroupMatch(Match): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 698.292px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">identifier </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">children </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Item Matching </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This structure allows us to easily combine matches on data items together.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We are now ready to look at how matching is performed on the data items themselves. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The basic technique is to match the data item from the rule (called the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">test item </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) with any item in the database (called the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">database item </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because data items are nested, we will use a recursive procedure that acts differently for a data group and a Datum. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In either case, if the test data group or test Datum is the root of the data item (i.e., it isn’t contained in another data group), then it can match any item in the database; we will check through each database item in turn.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If it is not the root, then it will be limited to matching only a specific database item. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">matches </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">function can be implemented in the base class, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Match </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, only.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It simply tries to match each individual item in the database one at a time.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 304.287px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> It has the following algorithm: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 304.287px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 318.687px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct Match: </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # ...  </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> Member data as before </p><span origfont="g_font_7" style="left: 125.724px; top: 347.487px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def matches(database, bindings): </p><span origfont="g_font_7" style="left: 125.724px; top: 376.287px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Go through each item in the database </p><span origfont="g_font_7" style="left: 125.724px; top: 405.087px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 125.724px; top: 419.487px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for item in database: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 433.887px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 448.287px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># We’ve matched if we match any item </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 462.687px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if matchesItem(item, bindings): return true </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 477.087px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># We’ve failed to match all of them return false </p><span origfont="g_font_7" data-canvas-width="310.69683163199994" style="left: 140.615px; top: 518.545px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.06403); border-left: none;" yquantized="510" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 14 </p></pre>
<span origfont="g_font_7" data-canvas-width="310.69683163199994" style="left: 140.615px; top: 518.545px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06403); border-left: none;" yquantized="510" class="highlight3"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">This simply tries each individual item in the database against a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">matchesItem </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method.  </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> matchesItem </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">method should check a specific data node for matching.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The whole match succeeds if any item in the database matches. </p>
<span origfont="g_font_8" data-canvas-width="96.50428723200001" style="left: 122.615px; top: 588.643px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.00525); border-left: none;" yquantized="580" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.3802680479999" style="left: 122.376px; top: 615.5px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04881); border-left: none;" yquantized="610" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Datum Matching </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A test Datum will match if the database item has the same identifier and has a value within its bounds.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 665.397px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> It has the simple form: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 665.397px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="660" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 679.797px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct DatumMatch(DataNodeMatch): </p><span origfont="g_font_7" style="left: 125.724px; top: 694.197px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># ...  </p><span origfont="g_font_7" style="left: 125.724px; top: 708.597px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> Member data as before </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 4 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">def matchesItem(item, bindings): </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 7 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Is the item of the same type? </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> if not item insistence Datum: return false </p><span origfont="g_font_7" style="left: 112.524px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # Does the identifier match? </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if identifier.isWildcard() and identifier != item.identifier: return false </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 14 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Does the value fit? </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if minValue &lt;= item.value &lt;= maxValue: </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # Do we need to add to the bindings list? </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 272.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 301.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="300" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if identifier.isWildcard(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Add the binding bindings.appendBinding(identifier, item) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 23 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Return true, since we matched </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">return true </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 </span><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 419.997px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="410" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">else: return false </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 419.997px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="410" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Themethod should return true if the identifier is a wild card.  </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> If you used strings as </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">isWildcard </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> identifiers and wanted to use LISP-style wild-card names, you could check that the first character is a question mark, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The implementation on the website uses a 4-byte number as an identifier and reserves the first bit to indicate if the identifier is a wild card.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> The </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">isWildcard </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> method simply checks this bit. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The bindings list has been given an </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">appendBinding </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">method that adds an identifier (which is always a wild card) and the database item it was matched to.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> If we are using an STL list in C++, for example, we could have it be a list of </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">pair </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">templates and append a new identifier, item pair. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Alternatively, we could use a hash table indexed by identifier. </p>
<span origfont="g_font_8" data-canvas-width="123.242809344" style="left: 109.415px; top: 576.594px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.993894); border-left: none;" yquantized="570" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.2439796799997" style="left: 109.176px; top: 603.451px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0297); border-left: none;" yquantized="600" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Group Matching </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A test data group will match a database data group if its identifier matches and if all its children match at least one child of the database data group.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Not all the children of the database data group need to be matched to something. </p>
<span origfont="g_font_35" data-canvas-width="123.73631999999998" style="left: 137.39px; top: 678.744px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">For example, if we are searching for a match to: </p>
<span origfont="g_font_35" data-canvas-width="123.73631999999998" style="left: 137.39px; top: 678.744px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (?anyone (Health 0-54)) </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 1 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">we would like it to match: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 128.646px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="277.53332875199993" style="left: 122.615px; top: 155.705px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02872); border-left: none;" yquantized="150" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Captain (Health 43) (Ammo 140)) </p></pre>
<span origfont="g_font_7" data-canvas-width="277.53332875199993" style="left: 122.615px; top: 155.705px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02872); border-left: none;" yquantized="150" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> even though ammo isn’t mentioned in the test data group. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">matchesItem </span>
<span origfont="g_font_7" style="left: 125.724px; top: 205.734px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">function for data groups has the following form: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 205.734px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 220.134px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct DataGroupMatch(DataNodeMatch): </p><span origfont="g_font_7" style="left: 125.724px; top: 234.534px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># ...  </p><span origfont="g_font_7" style="left: 125.724px; top: 248.934px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> Member data as before </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def matchesItem(item, bindings): </p><span origfont="g_font_7" style="left: 125.724px; top: 277.734px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> # Is the item of the same type? </p><span origfont="g_font_7" style="left: 125.724px; top: 292.134px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="290" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 306.534px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 125.724px; top: 320.934px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not item insistence DataGroup: return false </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 335.334px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="330" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Does the identifier match? </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 349.734px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 364.134px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="360" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if identifier != WILDCARD and </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 378.534px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">identifier != item.identifier: return false </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Is every child present </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 407.334px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 421.734px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="420" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for child in self.children: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 436.134px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Use the children of the item as if it were a # database and call matches recursively </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 464.934px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="460" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 479.334px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if not child.matches(item.children): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 493.734px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return false </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 508.134px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="500" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 522.534px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># We must have matched all children </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 536.934px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Do we need to add to the bindings list? </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> if identifier.isWildcard(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 565.734px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 26 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Add the binding </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 594.534px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 28 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 608.934px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bindings.appendBinding(identifier, item) </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> return true </p><span origfont="g_font_13" data-canvas-width="58.40354303999998" style="left: 122.615px; top: 663.15px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.06188); border-left: none;" yquantized="660" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;"> 30 </p></pre>
<span origfont="g_font_13" data-canvas-width="58.40354303999998" style="left: 122.615px; top: 663.15px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06188); border-left: none;" yquantized="660" class="highlight2"></span>
<span origfont="g_font_7" data-canvas-width="299.97308899199993" style="left: 122.615px; top: 693.593px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993288); border-left: none;" yquantized="690" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Summary </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.47 shows all our classes and interfaces in one diagram. </p>
<span origfont="g_font_7" data-canvas-width="299.97308899199993" style="left: 122.615px; top: 693.593px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993288); border-left: none;" yquantized="690" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.47 </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">UML of the matching system </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The figure is in standard UML class diagram form.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We hope it is relatively obvious even if you’re not a UML expert.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Refer to Pilone and Pitman [2005] for more information on UML. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 148.576px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.5 </p>
<span origfont="g_font_7" data-canvas-width="458.95705680000003" style="left: 122.615px; top: 181.913px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.987463); border-left: none;" yquantized="180" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementation Notes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the listing above we used a list to hold all the children of a data group.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In C or C++ this isn’t the best data structure to hold such a tree.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In the code on the website we have used a first-child/next- sibling binary tree to represent data items (also called a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">filial-heir chain </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">or </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">doubly chained tree </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this kind of binary tree every node points to two others: the first is its first child and the second is its next sibling.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> This format of tree allows us to represent hierarchical structures where a node can </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Library </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> have any number of children.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has the advantage of not requiring a variable number of children to be stored in each node, making it more efficient to use. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 306.577px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="300" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.6 </p>
<span origfont="g_font_7" data-canvas-width="458.9331465600002" style="left: 122.615px; top: 339.915px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0267); border-left: none;" yquantized="330" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule Arbitration </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Several rules may trigger on the database at the same time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each rule is applicable, but only one can fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the algorithm described above we assumed that the first triggered rule is allowed to fire and no other rules are considered.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a simple rule arbitration algorithm:"first applicable." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">"It works fine as long as our rules are arranged in order of priority. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In general, an arbiter in a rule-based system is a chunk of code that decides which rules fire when more than one rule triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are a number of common approaches to arbitration, each with its own characteristics. </p>
<span origfont="g_font_13" data-canvas-width="93.90331392000002" style="left: 122.615px; top: 468.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02069); border-left: none;" yquantized="460" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.89967222399986" style="left: 122.615px; top: 499.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06015); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">First Applicable </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is the algorithm used so far.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The rules are provided in a fixed order, and the first rule in the list that triggers gets to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The ordering enforces strict priority: rules earlier in the list have priority over later rules. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A serious problem often occurs with this arbitration strategy, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the rule does not change the content of the database, and if no external changes are imposed, then the same rule will continue to fire every time the system is run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This might be what is required (if the rule indicates what action to take based on the content of the database, for example), but it can often cause problems with endless repetition. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is a simple extension used to reduce the severity of this issue.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rules that shouldn’t endlessly repeat are suspended as soon as they fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Their suspension is only lifted when the contents of the database change.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This involves keeping track of the suspended state of each rule and clearing it when the database is modified. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unfortunately, clearing the suspension whenever the database is modified can still allow the same situation to occur.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If some content in the database is constantly changing (and it usually will, if information from the game world is being written into it each frame), but the items of data causing the problem rule to trigger are stable, then the rule will continue to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">implementations keep track of the individual items of data that the rule is triggering on and suspend a fired rule until those particular items change. </p>
<span origfont="g_font_13" data-canvas-width="116.987848704" style="left: 109.415px; top: 148.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.991422); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.3324475679999" style="left: 109.176px; top: 178.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02869); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Least Recently Used </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A linked list holds all the rules in the system.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The list is considered in order, just as before, and the first triggered rule in the list gets to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a rule fires, it is removed from its position in the list and added to the end.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> After a while, the list contains rules in reverse order of use, and so picking the first triggered rule is akin to picking the least recently used rule. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach specifically combats the looping issue.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It makes sure that opportunities for firing are distributed as much as possible over all rules. </p>
<span origfont="g_font_13" data-canvas-width="80.6258688" style="left: 109.415px; top: 288.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02058); border-left: none;" yquantized="280" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="377.157734736" style="left: 109.415px; top: 319.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01791); border-left: none;" yquantized="310" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Random Rule </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If multiple rules trigger, then one rule is selected at random and allowed to fire. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unlike the previous algorithms, this kind of arbiter needs to check every rule and get a list of all triggered rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With such a list it can pick one member and fire it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Previous algorithms have only worked through the list until they found the first triggered rule.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This arbitration scheme is correspondingly less efficient. </p>
<span origfont="g_font_13" data-canvas-width="148.582573056" style="left: 109.415px; top: 414.668px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01077); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.93434207199994" style="left: 109.415px; top: 445.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0267); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most Specific Conditions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the conditions for a rule are very easy to meet, and the database regularly triggers it, then it is likely to be a general rule useful in lots of situations, but not specialized.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On the other hand, if a rule has difficult conditions to fulfill, and the system finds that it triggers, then it is likely to be very specific to the current situation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> More specific rules should therefore be preferred over more general rules. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a rule-based system where conditions are expressed as Boolean combined clauses, the number of clauses is a good indicator of the specificity of the rule. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Specificity can be judged based on the structure of the rules only.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The priority order can be calculated before the system is used, and the rules can be arranged in order.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The arbiter implementation is exactly the same, therefore, as the first applicable method.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We only need to add an offline step to automatically adjust the rule order based on the number of clauses in the condition. </p>
<span origfont="g_font_13" data-canvas-width="176.303812608" style="left: 109.415px; top: 641.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06207); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.21289636800003" style="left: 109.176px; top: 671.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00484); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Dynamic Priority Arbitration </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Any system of numerical priorities is identical to the first applicable method, if those priorities do not change when the system is running.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can simply arrange the rules in order of decreasing priority and run the first one that triggers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You will find some articles and books that misunder- stand priority-based arbitration and uselessly describe a priority arbitration algorithm for static </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">priorities, when a simple first-applicable approach would be identical in practice.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Priorities can be useful, however, if they are dynamic. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Dynamic priorities can be returned by each rule based on how important its action might be in the current situation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Suppose we have a rule that matches "no more health packs" and schedules an action to find health packs,for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the character’s health is high,the rule may return a very low priority.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there are any other rules that trigger, the health pack rule will be ignored, so the character will get on with what it is doing and only go hunting for health packs if it cannot think of an alternative.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the character is close to death, however, the rule returns a very high priority: the character will stop what it is doing and go to find health packs in order to stay alive. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could implement dynamic priorities using several rules (one for "no more health packsAND low health" and one for "no more health packs AND high health," for example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Using dynamicpriorities,however,allowstheruletograduallygetmoreimportant,ratherthansuddenly becoming the top priority. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The arbiter checks all the rules and compiles a list of those that trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It requests the priority from each rule in the list and selects the highest value to fire. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Just as for random rule selection, this approach involves searching all possible rules before deciding which to trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It also adds a method call, which may involve the rule searching the database for information to guide its priority calculating.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is the most flexible, but by far the most time-consuming, arbitration algorithm of the five described here. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 414.072px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="410" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.7 </span>
<span origfont="g_font_7" data-canvas-width="459.06704390399995" style="left: 122.615px; top: 447.409px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04924); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unification </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Suppose in our earlier example Whisker, the communications specialist, ended up dying.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Her colleague Sale takes over carrying the radio.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now suppose that Sale is severely hurt; somebody else needs to take the radio.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could simply have a rule for each person that matches when they are hurt and carrying the radio. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 544.092px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">We could instead introduce a rule whose pattern contains wild cards: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 544.092px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 558.492px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(?person (health 0-15)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">AND (Radio (held-by ?person)) </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 603.538px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="600" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 3 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 603.538px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="600" class="highlight2"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">?person </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">name matches any person.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These wild cards act slightly differently than conven- tional wild cards (the kind we introduced in the section on matching above).  </p>
<span origfont="g_font_35" data-canvas-width="112.97663999999999" style="left: 150.59px; top: 666.654px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> If they were normal wild cards, then the rule would match the database: </p>
<span origfont="g_font_35" data-canvas-width="112.97663999999999" style="left: 150.59px; top: 666.654px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (Johnson (health 38)) </p><span origfont="g_font_7" style="left: 125.724px; top: 684.59px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 698.99px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(Sale (health 15)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(Whisker (health 25)) (Radio (held-by Whisker)) </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 4 </p></pre>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The first </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">?person </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">would match Sale, while the second would match Whisker.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is not what we want; we want the same person for both. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In unification, a set of wild cards are matched so that they all refer to the same thing.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 174.74px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> In our case, the rule would not match the above database, but it would match the following: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 174.74px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 189.14px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(Johnson (health 38)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(Sale (health 42)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 217.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(Whisker (health 15)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" data-canvas-width="257.96997038399996" style="left: 109.415px; top: 244.999px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0103); border-left: none;" yquantized="240" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Radio (held-by Whisker)) </p></pre>
<span origfont="g_font_7" data-canvas-width="257.96997038399996" style="left: 109.415px; top: 244.999px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0103); border-left: none;" yquantized="240" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> where both wild cards match the same thing: Whisker. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we wanted to match different people with each wild card, we could request that by giving different names to each wild card.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 309.428px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> For example, we could use a pattern of the following form: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 309.428px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 323.826px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(?person-1 (health 0-15)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 338.226px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">AND </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="441.067415232" style="left: 127.415px; top: 365.285px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02773); border-left: none;" yquantized="360" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Radio (held-by ?person-2)) </p></pre>
<span origfont="g_font_7" data-canvas-width="441.067415232" style="left: 127.415px; top: 365.285px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02773); border-left: none;" yquantized="360" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unification is significant because it makes rule matching a great deal more powerful.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To get the same effect without unification would require four rules in our example.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 429.714px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight4" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> There are other situations, such as the following pattern: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 429.714px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight4" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 444.114px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="440" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(Johnson (health ?value-1)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 458.514px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="450" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">AND </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(Sale (health ?value-2))AND </p><span origfont="g_font_7" style="left: 112.524px; top: 487.314px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" data-canvas-width="459.06226185599985" style="left: 109.415px; top: 514.372px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00279); border-left: none;" yquantized="510" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">?value-1 &lt; ?value-2 </p></pre>
<span origfont="g_font_7" data-canvas-width="459.06226185599985" style="left: 109.415px; top: 514.372px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00279); border-left: none;" yquantized="510" class="highlight2"></span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> where an almost infinite number of regular rules would be required if unification wasn’t available (assuming that the health values are floating point numbers, it would require a little less than 2 </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">32 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> rules, certainly too many to be practical). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To take advantage of this extra power, we’d like our rule-based system to support pattern matching with unification. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 601.831px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="600" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0431336640001" style="left: 109.415px; top: 632.275px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02414); border-left: none;" yquantized="630" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Performance </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unfortunately, unification has a downside: the most obvious implementation is computationally complex to process.  </p>
<span origfont="g_font_35" data-canvas-width="107.5968" style="left: 137.39px; top: 678.637px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> To match a pattern such as: </p>
<span origfont="g_font_35" data-canvas-width="107.5968" style="left: 137.39px; top: 678.637px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock4"></span>
<pre markupfor="codeBlock4" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (Whisker (health 0)) </p><span origfont="g_font_7" style="left: 112.524px; top: 696.572px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight4" markup="codeBlock4"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">AND (Radio (held-by Whisker)) </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 3 </p></pre>
</html></html><html><html><p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">we can split the pattern into two parts, known as </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">clauses </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each clause can individually be checked against the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If both clauses find a match, then the whole pattern matches. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Each part of the expression requires at most an O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) search,where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of items in the database.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> So, a pattern with </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">clauses is, at worst, an O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nm </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) process.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We say at worst because, as we saw with decision trees, we might be able to avoid having to test the same thing multiple times and arrive at an O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">log </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) process. </p>
<span origfont="g_font_7" style="left: 268.54px; top: 173.77px; font-size: 11.6114px; font-family: serif; border-left: none;" yquantized="170" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 2 </p>
<span origfont="g_font_7" style="left: 125.724px; top: 217.809px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">In a pattern with connected wild cards, such as: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 217.809px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(?person (health &lt; 15))AND </p><span origfont="g_font_7" style="left: 125.724px; top: 246.609px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" data-canvas-width="459.01922342400013" style="left: 122.615px; top: 273.668px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00758); border-left: none;" yquantized="270" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Radio (held-by ?person)) </p></pre>
<span origfont="g_font_7" data-canvas-width="459.01922342400013" style="left: 122.615px; top: 273.668px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00758); border-left: none;" yquantized="270" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> we can’t split the two clauses up.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The results from the first clause directly affect the pattern in the second clause.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 323.696px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> So, if matching the first clause comes back: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 323.696px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="177.624390912" style="left: 122.615px; top: 350.755px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00353); border-left: none;" yquantized="350" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">?person = Whisker </p></pre>
<span origfont="g_font_7" data-canvas-width="177.624390912" style="left: 122.615px; top: 350.755px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00353); border-left: none;" yquantized="350" class="highlight4"></span>
<span origfont="g_font_35" data-canvas-width="134.49599999999998" style="left: 150.59px; top: 379.954px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> then the second clause is a search for: </p>
<span origfont="g_font_35" data-canvas-width="134.49599999999998" style="left: 150.59px; top: 379.954px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (Radio (held-by Whisker)) </p><span origfont="g_font_7" data-canvas-width="440.96221017600004" style="left: 140.615px; top: 410.548px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01371); border-left: none;" yquantized="410" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.96221017600004" style="left: 140.615px; top: 410.548px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01371); border-left: none;" yquantized="410" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The first clause might potentially match several items in the database, each of which needs to be tried with the second clause. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Using this approach, a two-clause search could take O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">2 </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ) time, and a pattern with </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">clauses could take O( </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> ) time.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> This is a dramatic increase from O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nm </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) for the original pattern.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Although there are O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">nm </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) linear algorithms for unification (at least the kind of unification we are doing here), they are considerably more complex than the simple divide-and-conquer approach used in patterns without wild cards. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will not take the time to go through a stand-alone unification algorithm here.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are not often used for this kind of rule-based system.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Instead, we can take advantage of a different approach to matching altogether, which allows us to perform unification at the same time as speeding up the firing of all rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This method is Rete. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 591.406px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.8 </span>
<span origfont="g_font_7" data-canvas-width="459.0395471279998" style="left: 122.615px; top: 624.743px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01783); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rete </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Rete algorithm is an AI industry standard for matching rules against a database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is not the fastest algorithm around; there are several papers detailing faster approaches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> But, because expert systems are commercially valuable, they don’t tend to give full implementation details. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_13" data-canvas-width="7.029628199999999" style="left: 108.386px; top: 680.81px; font-size: 13.2702px; font-family: serif; transform: scaleX(1.00423); border-left: none;" yquantized="680" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">7 </p>
<p origfont="g_font_13" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> 7. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;">You should also be careful of proprietary algorithms because many are patented.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> Just because an algorithm is published doesn’t mean it isn’t patented.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> You could end up having to pay a licence fee for your implementation, even if you wrote the source code from scratch.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> We’re not lawyers, so we’d advise you to see an intellectual property attorney if you have any doubts. </p>
<span origfont="g_font_7" data-canvas-width="28.703836944" style="left: 122.617px; top: 716.819px; font-size: 13.2702px; font-family: serif; transform: scaleX(0.989787); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most commercial expert systems are based on Rete,and some of the more complex rule-based systems we’ve seen in games use the Rete matching algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a relatively simple algorithm that provides the basic starting point for more complex optimizations. </p>
<span origfont="g_font_13" data-canvas-width="88.04000563199999" style="left: 109.415px; top: 162.705px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03576); border-left: none;" yquantized="160" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9068452959999" style="left: 109.415px; top: 193.149px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01304); border-left: none;" yquantized="190" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm works by representing the patterns for all rules in a single data structure: the Rete. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">The Rete is a directed acyclic graph </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">8 </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (see Chapter 4, Section 4.1 on the pathfinding graph for a complete description of this structure).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each node in the graph represents a single pattern in one or more rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each path through the graph represents the complete set of patterns for one rule. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At each node we also store a complete list of all the facts in the database that match that pattern. </p>
<span origfont="g_font_35" data-canvas-width="86.07744" style="left: 137.39px; top: 297.242px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="290" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Figure 5.48 shows a simple example of a Rete for the following rules: </p>
<span origfont="g_font_35" data-canvas-width="86.07744" style="left: 137.39px; top: 297.242px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="290" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">Swap Radio Rule: </p><span origfont="g_font_7" style="left: 112.524px; top: 315.177px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 329.577px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="320" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">IF </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 343.977px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(?person-1 (health &lt; 15)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 358.377px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">AND </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(radio (held-by ?person-1))AND </p><span origfont="g_font_7" style="left: 112.524px; top: 387.177px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="380" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(?person-2 (health &gt; 45))THEN </p><span origfont="g_font_7" style="left: 112.524px; top: 415.977px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="410" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">remove(radio (held-by ?person-1)) add(radio (held-by ?person-2)) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 444.777px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 459.177px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="450" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 473.577px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">Change Backup Rule: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 487.977px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">IF </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(?person-1 (health &lt; 15))AND </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 516.777px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(?person-2 (health &gt; 45))AND </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 545.577px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 559.977px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="550" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">(?person-2 (is-covering ?person-1)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 574.377px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">THEN </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 588.777px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">remove(?person-2 (is-covering ?person-1)) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 </span><span origfont="g_font_7" data-canvas-width="441.1176267360001" style="left: 127.415px; top: 615.836px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01875); border-left: none;" yquantized="610" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">add(?person-1 (is-covering ?person-2)) </p></pre>
<span origfont="g_font_7" data-canvas-width="441.1176267360001" style="left: 127.415px; top: 615.836px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01875); border-left: none;" yquantized="610" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The first rule is as before: if someone carrying the radio is close to death, then give the radio to someone who is relatively healthy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The second rule is similar: if a soldier leading a buddy pair is close to death,then swap them around and make the soldier’s buddy take the lead (if you’re feeling callous you could argue the opposite, we suppose: the weak guy should be sent out in front). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">There are three kinds of nodes in our Rete diagram.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> At the top of the network are nodes that represent individual clauses in a rule (known as </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">pattern nodes </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">).  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> These are combined nodes representing theAND operation (called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">join nodes </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Finally,the bottom nodes represent rules that </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_31" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_31" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">(radio (held-by ?person-1))(?person-1 (health &lt;15))(?person-2 (health &gt;45))(?person-2 (is-covering ?person-1)) </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 414.702px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="410" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Swap Radio rule Change Backup rule </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.48 </span><span origfont="g_font_7" data-canvas-width="459.0240054719998" style="left: 122.611px; top: 445.869px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04087); border-left: none;" yquantized="440" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="459.0240054719998" style="left: 122.611px; top: 445.869px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04087); border-left: none;" yquantized="440" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">ARete can be fired: many texts on Rete do not include these rule nodes in the network, although they must exist in your implementation.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 495.897px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> Notice that the clauses: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 495.897px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 122.615px; top: 522.956px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="520" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(?person-1 (health &lt; 15)) </p></pre>
<span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 122.615px; top: 522.956px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="520" class="highlight2"></span>
<span origfont="g_font_7" style="left: 125.724px; top: 555.69px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> and </p>
<span origfont="g_font_7" style="left: 125.724px; top: 555.69px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="458.91282285599993" style="left: 122.615px; top: 582.749px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0623); border-left: none;" yquantized="580" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(?person-2 (health &gt; 45)) </p></pre>
<span origfont="g_font_7" data-canvas-width="458.91282285599993" style="left: 122.615px; top: 582.749px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0623); border-left: none;" yquantized="580" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> are shared between both rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is one of the key speed features of the Rete algorithm; it doesn’t duplicate matching effort. </p>
<span origfont="g_font_8" data-canvas-width="128.738853888" style="left: 122.615px; top: 629.25px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.990299); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.847069696" style="left: 122.615px; top: 656.108px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06902); border-left: none;" yquantized="650" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Matching the Database </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Conceptually, the database is fed into the top of the network.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The pattern nodes try to find a match in the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They find all the facts that match and pass them down to the join nodes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the facts contain wild cards, the node will also pass down the variable bindings.  </p>
<span origfont="g_font_35" data-canvas-width="123.73631999999998" style="left: 150.59px; top: 717.001px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> So, if: </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> (?person (health &lt; 15)) </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">matches: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 128.794px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="263.38563974399995" style="left: 109.415px; top: 157.047px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02485); border-left: none;" yquantized="150" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Whisker (health 12)) </p></pre>
<span origfont="g_font_7" data-canvas-width="263.38563974399995" style="left: 109.415px; top: 157.047px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02485); border-left: none;" yquantized="150" class="highlight2"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 193.871px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="190" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> then the pattern node will pass on the variable binding: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 193.871px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="190" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="441.0004665600001" style="left: 127.415px; top: 222.125px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00227); border-left: none;" yquantized="220" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">?person = Whisker </p></pre>
<span origfont="g_font_7" data-canvas-width="441.0004665600001" style="left: 127.415px; top: 222.125px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00227); border-left: none;" yquantized="220" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The pattern nodes also keep a record of the matching facts they are given to allow incremental updating, discussed later in the section. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Notice that rather than finding </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">any </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">match, we now find </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">all </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">matches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there are wild cards in the pattern, we don’t just pass down one binding, but all sets of bindings. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 316.418px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">For example, if we have a fact: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 316.418px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="169.08484869600002" style="left: 109.415px; top: 344.672px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02476); border-left: none;" yquantized="340" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(?person (health &lt; 15)) </p></pre>
<span origfont="g_font_7" data-canvas-width="169.08484869600002" style="left: 109.415px; top: 344.672px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02476); border-left: none;" yquantized="340" class="highlight4"></span>
<span origfont="g_font_35" data-canvas-width="112.97663999999999" style="left: 137.39px; top: 377.961px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> and a database containing the facts: </p>
<span origfont="g_font_35" data-canvas-width="112.97663999999999" style="left: 137.39px; top: 377.961px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock4"></span>
<pre markupfor="codeBlock4" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (Whisker (health 12)) </p><span origfont="g_font_7" style="left: 112.524px; top: 395.896px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight4" markup="codeBlock4"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" data-canvas-width="207.502626816" style="left: 109.415px; top: 424.15px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00243); border-left: none;" yquantized="420" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Captain (health 9)) </p></pre>
<span origfont="g_font_7" data-canvas-width="207.502626816" style="left: 109.415px; top: 424.15px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00243); border-left: none;" yquantized="420" class="highlight3"></span>
<span origfont="g_font_35" data-canvas-width="91.45728" style="left: 137.39px; top: 458.634px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="450" class="highlight4" markup="codeBlock5"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> then there are two possible sets of bindings: </p>
<span origfont="g_font_35" data-canvas-width="91.45728" style="left: 137.39px; top: 458.634px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="450" class="highlight4" markup="codeBlock5"></span>
<pre markupfor="codeBlock5" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> ?person = Whisker </p><span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 109.415px; top: 491.619px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="490" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 109.415px; top: 491.619px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="490" class="highlight3"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 525.696px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock6"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> and </p>
<span origfont="g_font_7" style="left: 112.524px; top: 525.696px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock6"></span>
<pre markupfor="codeBlock6" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="440.97655632000016" style="left: 127.415px; top: 555.146px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00093); border-left: none;" yquantized="550" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">?person = Captain </p></pre>
<span origfont="g_font_7" data-canvas-width="440.97655632000016" style="left: 127.415px; top: 555.146px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00093); border-left: none;" yquantized="550" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Both can’t be true at the same time, of course, but we don’t yet know which will be useful, so we pass down both.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the pattern contains no wild cards, then we are only interested in whether or not it matches anything.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case we can move on as soon as we find the first match because we won’t be passing on a list of bindings. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The join node makes sure that both of its inputs have matched and any variables agree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.49 shows three situations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the first situation, there are different variables in each input pattern node.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Both pattern nodes match and pass in their matches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The join node passes out its output. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the second situation, the join node receives matches from both its inputs, as before, but the variable bindings clash, so it does not generate an output.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the third situation, the same variable is found in both patterns, but there is one set of matches that doesn’t clash, and the join node can output this. </p>
<span origfont="g_font_7" data-canvas-width="55.83638796" style="left: 109.41px; top: 713.479px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05352); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_32" data-canvas-width="31.33962" style="left: 254.041px; top: 168.528px; font-size: 8.35456px; font-family: sans-serif; transform: scaleX(0.921754); border-left: 50px solid blue;" yquantized="160" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = Whistler?person-2 = Captain?person-1 = Whistler?person-1 = Captain </p><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_32" data-canvas-width="31.33962" style="left: 280.139px; top: 249.738px; font-size: 8.35456px; font-family: sans-serif; transform: scaleX(0.921754); border-left: 50px solid blue;" yquantized="240" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = WhistlerNone ?person-2 = Captain 1 2 </p><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_32" data-canvas-width="31.33962" style="left: 356.702px; top: 292.129px; font-size: 8.35456px; font-family: sans-serif; transform: scaleX(0.921754); border-left: 50px solid blue;" yquantized="290" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_32" style="font-family: sans-serif; font-size: 8.35456px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = Whistler?person-1 = Whistler ?person-2 = Captain </p><span origfont="g_font_32" style="font-family: sans-serif; font-size: 8.172px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_32" style="left: 258.982px; top: 317.967px; font-size: 8.172px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="310" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 354.702px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="350" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = Whistler 3?person-2 = Captain </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.49 </span><span origfont="g_font_7" data-canvas-width="441.0865434239999" style="left: 140.615px; top: 391.835px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03785); border-left: none;" yquantized="390" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.0865434239999" style="left: 140.615px; top: 391.835px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03785); border-left: none;" yquantized="390" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A join node with variable clash and two others withoutThe join node generates its own match list that contains the matching input facts it receives and a list of variable bindings.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It passes this down the Rete to other join nodes or to a rule node. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the join node receives multiple possible bindings from its input, then it needs to work out all possible combinations of bindings that may be correct.  </p>
<span origfont="g_font_35" data-canvas-width="123.73631999999998" style="left: 150.59px; top: 498.316px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> Take the previous example, and let’s imagine we are processing the AND join in: </p>
<span origfont="g_font_35" data-canvas-width="123.73631999999998" style="left: 150.59px; top: 498.316px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (?person (health &lt; 15)) </p><span origfont="g_font_7" style="left: 125.724px; top: 516.251px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">AND (?radio (held-by ?person)) </p><span origfont="g_font_7" data-canvas-width="98.11208330400001" style="left: 122.615px; top: 560.102px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.022); border-left: none;" yquantized="560" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 3 </p></pre>
<span origfont="g_font_7" data-canvas-width="98.11208330400001" style="left: 122.615px; top: 560.102px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.022); border-left: none;" yquantized="560" class="highlight4"></span>
<span origfont="g_font_7" style="left: 125.724px; top: 598.121px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> against the database: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 598.121px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(Whisker (health 12)) (Captain (health 9)) </p><span origfont="g_font_7" style="left: 125.724px; top: 626.921px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(radio-1 (held-by Whisker)) (radio-2 (held-by Sale)) </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 670.77px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="670" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 4 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 670.77px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="670" class="highlight4"></span>
<span origfont="g_font_7" style="left: 125.724px; top: 704.847px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The </p>
<span origfont="g_font_7" style="left: 125.724px; top: 704.847px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">(?person (health &lt; 15)) </p></pre>
</html></html><html><html><p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">pattern has two possible matches: </p>
<span origfont="g_font_35" data-canvas-width="91.45728" style="left: 137.39px; top: 127.874px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> ?person = Whisker </p><span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 109.415px; top: 158.468px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="150" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 109.415px; top: 158.468px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="150" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="91.45728" style="left: 137.39px; top: 187.667px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> and </p>
<span origfont="g_font_35" data-canvas-width="91.45728" style="left: 137.39px; top: 187.667px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> ?person = Captain </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 218.261px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="210" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 127.415px; top: 218.261px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="210" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="145.25568" style="left: 137.39px; top: 247.461px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">The </p>
<span origfont="g_font_35" data-canvas-width="145.25568" style="left: 137.39px; top: 247.461px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> (radio (held-by ?person-1)) </p><span origfont="g_font_7" data-canvas-width="181.21690447200004" style="left: 109.415px; top: 278.055px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00676); border-left: none;" yquantized="270" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="181.21690447200004" style="left: 109.415px; top: 278.055px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00676); border-left: none;" yquantized="270" class="highlight2"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 313.552px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> pattern also has two possible matches: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 313.552px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock4"></span>
<pre markupfor="codeBlock4" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 109.415px; top: 340.61px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="340" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">?person = Whisker, ?radio = radio-1 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.052231199999998" style="left: 109.415px; top: 340.61px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0619); border-left: none;" yquantized="340" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="172.15487999999996" style="left: 137.39px; top: 369.81px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="360" class="highlight3" markup="codeBlock5"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> and </p>
<span origfont="g_font_35" data-canvas-width="172.15487999999996" style="left: 137.39px; top: 369.81px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="360" class="highlight3" markup="codeBlock5"></span>
<pre markupfor="codeBlock5" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> ?person = Sale, ?radio = radio-2 </p><span origfont="g_font_7" data-canvas-width="441.03633191999995" style="left: 127.415px; top: 400.405px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04511); border-left: none;" yquantized="400" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.03633191999995" style="left: 127.415px; top: 400.405px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04511); border-left: none;" yquantized="400" class="highlight2"></span>
<span origfont="g_font_35" data-canvas-width="188.29439999999997" style="left: 137.39px; top: 446.897px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock6"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">The join node therefore has two sets of two possible bindings, and there are four possible combinations, but only one is valid: </p>
<span origfont="g_font_35" data-canvas-width="188.29439999999997" style="left: 137.39px; top: 446.897px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock6"></span>
<pre markupfor="codeBlock6" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> ?person = Whisker, ?radio = radio-1 </p><span origfont="g_font_7" data-canvas-width="441.0315498719998" style="left: 127.415px; top: 477.491px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.995557); border-left: none;" yquantized="470" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.0315498719998" style="left: 127.415px; top: 477.491px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.995557); border-left: none;" yquantized="470" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So this is the only one it passes down.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If multiple combinations were valid, then it would pass down multiple bindings. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If your system doesn’t need to support unification, then the join node can be much simpler: variable bindings never need to be passed in,and anAND join node will always output if it receives two inputs. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We don’t have to limit ourselves to AND join nodes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use additional types of join nodes for different Boolean operators.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some of them (such as AND and XOR) require additional matchingtosupportunification,butothers(suchasOR)donotandhaveasimpleimplementation whether unification is used or not.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Alternatively, these operators can be implemented in the structure of the Rete, and AND join nodes are sufficient to represent them.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is exactly the same as we saw in decision trees. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Eventually, the descending data will stop (when no more join nodes or pattern nodes have output to send), or they will reach one or more rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> All the rules that receive input are triggered. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">We keep a list of rules that are currently triggered, along with the variable bindings and facts that triggered it.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We call this a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">trigger record </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A rule may have multiple trigger records, with different variable bindings, if it received multiple valid variable bindings from a join node or pattern. </p>
<span origfont="g_font_7" data-canvas-width="37.641890832" style="left: 109.41px; top: 707.807px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07548); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some kind of rule arbitration system needs to determine which triggered rule will go on to fire.  </p>
<span origfont="g_font_8" data-canvas-width="67.892146176" style="left: 122.443px; top: 146.498px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.956227); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 19.9054px; font-style: normal; font-weight: 400;"> (This isn’t part of the Rete algorithm; it can be handled as before.) </p>
<span origfont="g_font_7" data-canvas-width="291.987068832" style="left: 122.615px; top: 173.355px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00567); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An Example </p>
<span origfont="g_font_7" style="left: 125.724px; top: 208.984px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Let’s apply our initial Rete example to the following database: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 208.984px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(Captain (health 57) (is-covering Johnson)) (Johnson (health 38)) </p><span origfont="g_font_7" style="left: 125.724px; top: 237.784px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="230" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">(Sale (health 42)) (Whisker (health 15) (is-covering Sale)) </p><span origfont="g_font_7" style="left: 125.724px; top: 266.584px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" data-canvas-width="308.51024018399994" style="left: 140.615px; top: 293.643px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00492); border-left: none;" yquantized="290" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(Radio (held-by Whisker)) </p></pre>
<span origfont="g_font_7" data-canvas-width="308.51024018399994" style="left: 140.615px; top: 293.643px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00492); border-left: none;" yquantized="290" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.50 shows the network with the data stored at each node. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Notice that each pattern node is passing down all of the data that it matches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each join node is acting as a filter.  </p>
<span origfont="g_font_63" data-angle="-45.138162737239064" data-canvas-width="96.49209402010413" style="left: 201.187px; top: 478.54px; font-size: 11.5302px; font-family: sans-serif; transform: rotate(-45.1382deg) scaleX(0.918972); border-left: 50px solid blue;" yquantized="470" class="highlight4" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_63" style="font-family: sans-serif; font-size: 11.5302px; font-style: normal; font-weight: 400;"> With this database, only the Swap Radio rule is active; the Change </p>
<span origfont="g_font_63" data-angle="-45.138162737239064" data-canvas-width="96.49209402010413" style="left: 201.187px; top: 478.54px; font-size: 11.5302px; font-family: sans-serif; transform: rotate(-45.1382deg) scaleX(0.918972); border-left: 50px solid blue;" yquantized="470" class="highlight4" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_64" data-canvas-width="31.173487800000004" style="left: 255.317px; top: 514.235px; font-size: 8.12868px; font-family: sans-serif; transform: scaleX(0.944651); border-left: 50px solid blue;" yquantized="510" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_64" style="font-family: sans-serif; font-size: 8.12868px; font-style: normal; font-weight: 400; display: inline;"> (radio (held-by ?person-1))(?person-1 (health &lt;15))(?person-2 (health &gt;45))(?person-2 (is-covering ?person-1)) </p><span origfont="g_font_63" style="font-family: sans-serif; font-size: 8.31027px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_64" style="font-family: sans-serif; font-size: 8.12868px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_63" style="font-family: sans-serif; font-size: 8.31027px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_64" data-canvas-width="31.173487800000004" style="left: 174.03px; top: 549.798px; font-size: 8.12868px; font-family: sans-serif; transform: scaleX(0.944651); border-left: 50px solid blue;" yquantized="540" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_64" style="font-family: sans-serif; font-size: 8.12868px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = Whisker?person-2 = Captain </p><span origfont="g_font_63" style="font-family: sans-serif; font-size: 8.31027px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_64" style="font-family: sans-serif; font-size: 8.12868px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_63" style="font-family: sans-serif; font-size: 8.31027px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_63" data-canvas-width="75.05210244000001" style="left: 153.14px; top: 559.422px; font-size: 8.31027px; font-family: sans-serif; transform: scaleX(0.938151); border-left: 50px solid blue;" yquantized="550" class="highlight3" markup="figureBlock"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_64" style="font-family: sans-serif; font-size: 8.12868px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = Whisker </span><span origfont="g_font_64" data-canvas-width="31.173487800000004" style="left: 225.222px; top: 627.866px; font-size: 8.12868px; font-family: sans-serif; transform: scaleX(0.944651); border-left: 50px solid blue;" yquantized="620" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_64" style="font-family: sans-serif; font-size: 8.12868px; font-style: normal; font-weight: 400; display: inline;">:(?person-1 = Johnson, ?person-1 = Whisker, ?person-2 = Captain) OR ?person-2 = Captain(?person-1 = Sale, ?person-2 = Whisker) </p><span origfont="g_font_63" style="font-family: sans-serif; font-size: 8.31027px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_64" style="font-family: sans-serif; font-size: 8.12868px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = Whisker, </span><span origfont="g_font_63" style="font-family: sans-serif; font-size: 8.31027px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_63" data-canvas-width="73.87344384000001" style="left: 184.782px; top: 647.244px; font-size: 8.31027px; font-family: sans-serif; transform: scaleX(0.935107); border-left: 50px solid blue;" yquantized="640" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_63" data-canvas-width="59.631996480000005" style="left: 233.347px; top: 665.572px; font-size: 8.31027px; font-family: sans-serif; transform: scaleX(0.93175); border-left: 50px solid blue;" yquantized="660" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 706.299px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="700" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">: ?person-2 = CaptainNoneSwap Radio ruleChange Backup rule </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.50 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">The Rete with data </p></pre>
<span origfont="g_font_64" data-canvas-width="31.173487800000004" style="left: 330.457px; top: 557.418px; font-size: 11.2785px; font-family: sans-serif; transform: scaleX(0.944651); border-left: none;" yquantized="550" class="highlight4"></span>
<span origfont="g_font_63" style="font-family: sans-serif; font-size: 11.5305px; font-style: normal; font-weight: 400;">Bindings </span>
<span origfont="g_font_63" data-canvas-width="81.55504644000003" style="left: 439.687px; top: 553.833px; font-size: 11.5305px; font-family: sans-serif; transform: scaleX(0.937414); border-left: 50px solid blue;" yquantized="550" class="highlight3" markup="figureBlock"></span>
<span origfont="g_font_63" data-canvas-width="93.29286036" style="left: 439.687px; top: 563.587px; font-size: 11.5305px; font-family: sans-serif; transform: scaleX(0.951968); border-left: none;" yquantized="560" class="highlight2"></span>
<span origfont="g_font_63" data-canvas-width="73.87344384000001" style="left: 330.458px; top: 576.797px; font-size: 11.5305px; font-family: sans-serif; transform: scaleX(0.935107); border-left: 50px solid blue;" yquantized="570" class="highlight3" markup="figureBlock"></span>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Backup rule doesn’t get triggered because the join node immediately above it doesn’t have a clash-free set of inputs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Swap Radio rule gets a complete set of variable bindings and is told to fire. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can use Rete by plugging in the complete database each time and seeing which rules fire. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is a simple approach, but in many applications data don’t change much from iteration to iteration. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Reteisdesignedtokeepholdof dataandonlyupdatethosenodesthatneedit.Eachnodekeeps a list of the database facts that it matches or that it can join successfully.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At successive iterations, only the data that have changed are processed,and knock-on effects are handled by walking down the Rete. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The update process consists of an algorithm to remove a database fact and another algorithm to add one (if a value has changed, then the database fact will be removed and then added back with the correct value). </p>
<span origfont="g_font_8" data-canvas-width="92.23915007999997" style="left: 109.415px; top: 313.855px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.950919); border-left: none;" yquantized="310" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9451016800001" style="left: 109.415px; top: 340.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0017); border-left: none;" yquantized="340" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Removing a Fact </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To remove a fact,a removal request is sent to each pattern node.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The request identifies the fact that has been removed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the pattern node has a stored match on the fact, then the match is removed, and the removal request is sent down its outputs to any join nodes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When a join node receives a removal request, it looks at its list of matches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there are any entries that use the removed fact, it deletes them from its list and passes the removal request on down. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If arulenodereceivesaremovalrequest,itremovesanyof itstriggerrecordsfromthetriggered list that contains the removed fact. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If any node doesn’t have the given fact in its storage, then it needs to do nothing; it doesn’t pass the request on down. </p>
<span origfont="g_font_8" data-canvas-width="77.04935116799999" style="left: 109.243px; top: 515.455px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.963117); border-left: none;" yquantized="510" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.20094124800005" style="left: 109.176px; top: 542.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0704); border-left: none;" yquantized="540" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Adding a Fact </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Adding a fact is very similar to removing one.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each pattern node is sent an addition request containing the new fact.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Patterns that match the fact add it to their list and pass a notification of the new match down the Rete. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When a join node receives a new match, it checks if there are any new sets of non-clashing inputs that it can make, using the new fact.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there are, it adds them to its match list and sends the notification of the new match down.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Notice that, unlike removal requests, the noti- fication it sends down is different from the one it received.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is sending down notification of one or more whole new matches: a full set of inputs and variable bindings involving the new fact. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If a rule node receives a notification, it adds one or more trigger records to the trigger list containing the new input it received. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Once again, if the fact doesn’t update the node, then there is no need to pass the addition request on. </p>
<span origfont="g_font_7" data-canvas-width="53.06877768" style="left: 109.415px; top: 715.039px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02055); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Managing the Update </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each iteration, the update routine sends the appropriate series of add and remove requests to the pattern nodes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It doesn’t check if rules are triggered during this process but allows them all to process.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In general, it is more efficient to perform all the removals first and then all the new additions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">After all the updates have been performed, the triggered list contains all the rules that could be fired (along with the variable bindings that cause them to trigger).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The rule arbiter can decide which rule should fire. </p>
<span origfont="g_font_8" data-canvas-width="111.83611391999999" style="left: 122.443px; top: 259.782px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.972488); border-left: none;" yquantized="250" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.3396206400001" style="left: 122.376px; top: 286.639px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04542); border-left: none;" yquantized="280" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An Update Example </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll use our previous example to illustrate the update procedure.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Let’s say that, since the last update, Whisker has used a med-pack and Sale has been hit by enemy fire.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 348.174px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> We have four changes to make: two additions and two removals: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 348.174px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">remove (Whisker (health 12)) add (Whisker (health 62)) </p><span origfont="g_font_7" style="left: 125.724px; top: 376.974px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">remove (Sale (health 42)) add (Sale (health 5)) </p><span origfont="g_font_7" data-canvas-width="440.90482560000004" style="left: 140.615px; top: 418.432px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.06499); border-left: none;" yquantized="410" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 4 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.90482560000004" style="left: 140.615px; top: 418.432px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06499); border-left: none;" yquantized="410" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">First, the removal requests are given to all the patterns.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The check for low health used to have only Whisker in its match list.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is deleted, and the removal request is passed on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Join node A receives the request, removes the match involving Whisker from its match list, and passes on the request.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Join node B does the same.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The rule node now receives the removal request and removes the corresponding entry from the triggered list.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same process occurs for removingSale’s health, leaving the Rete as shown in Figure 5.51. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Now we can add the new data.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> First, Whisker’s new health is added.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 539.098px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> This matches the </p>
<span origfont="g_font_7" style="left: 125.724px; top: 539.098px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="459.4101558480001" style="left: 122.615px; top: 566.157px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02776); border-left: none;" yquantized="560" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(?person (health &gt; 45)) </p></pre>
<span origfont="g_font_7" data-canvas-width="459.4101558480001" style="left: 122.615px; top: 566.157px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02776); border-left: none;" yquantized="560" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> pattern, which duly outputs notification of its new match.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Join node A receives the notification, but can find no new matches, so the update stops there.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Second, we add Sale’s new health.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 616.054px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> The </p>
<span origfont="g_font_7" style="left: 125.724px; top: 616.054px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="459.0168324" style="left: 122.615px; top: 643.113px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01328); border-left: none;" yquantized="640" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(?person (health &lt; 15)) </p></pre>
<span origfont="g_font_7" data-canvas-width="459.0168324" style="left: 122.615px; top: 643.113px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01328); border-left: none;" yquantized="640" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> pattern matches and sends notification down to join node A.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Now join node A does have a valid match, and it sends notification on down the Rete.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Join node B can’t make a match, but join nodeC,previously inactive,now can make a match.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It sends notification on to the Change Backup rule, which adds its newly triggered state to the triggered list.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The final situation is shown in Figure 5.52. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The update management algorithm can now select one triggered rule from the list to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our case, there is only one to choose, so it is fired. </p>
<span origfont="g_font_7" data-canvas-width="234.54032620799995" style="left: 122.615px; top: 715.095px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993815); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">(radio (held-by ?person-1))(?person-1 (health &lt;15))(?person-2 (health &gt;45))(?person-2 (is-covering ?person-1)) </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_53" data-canvas-width="30.909333000000004" style="left: 425.76px; top: 267.38px; font-size: 8.23985px; font-family: sans-serif; transform: scaleX(0.936646); border-left: 50px solid blue;" yquantized="260" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">:NoneA?person-2 = Captain </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><p origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: (?person-1 = Johnson, ?person-1 = Whisker </span><span origfont="g_font_53" data-canvas-width="30.909333000000004" style="left: 213.113px; top: 350.329px; font-size: 8.23985px; font-family: sans-serif; transform: scaleX(0.936646); border-left: 50px solid blue;" yquantized="350" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: ?person-2 = Captain) ORNone (?person-1 = Sale, ?person-2 = Whisker)BC </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_53" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_37" data-canvas-width="59.00579580000001" style="left: 222.756px; top: 387.232px; font-size: 8.0598px; font-family: sans-serif; transform: scaleX(1.05367); border-left: 50px solid blue;" yquantized="380" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 429.102px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="420" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">:NoneNoneSwap Radio ruleChange Backup rule </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.51 </span><span origfont="g_font_13" data-canvas-width="90.10873344" style="left: 109.415px; top: 464.627px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.02569); border-left: none;" yquantized="460" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">Rete in mid-update </p></pre>
<span origfont="g_font_53" data-canvas-width="30.909333000000004" style="left: 317.456px; top: 280.477px; font-size: 11.4328px; font-family: sans-serif; transform: scaleX(0.936646); border-left: none;" yquantized="280" class="highlight4"></span>
<span origfont="g_font_37" style="font-family: sans-serif; font-size: 11.183px; font-style: normal; font-weight: 400;">Bindings </span>
<span origfont="g_font_37" data-canvas-width="19.262922" style="left: 317.455px; top: 290.278px; font-size: 11.183px; font-family: sans-serif; transform: scaleX(1.07016); border-left: 50px solid blue;" yquantized="290" class="highlight4" markup="figureBlock"></span>
<span origfont="g_font_13" data-canvas-width="90.10873344" style="left: 109.415px; top: 464.627px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02569); border-left: none;" yquantized="460" class="highlight3"></span>
<span origfont="g_font_7" data-canvas-width="459.098127216" style="left: 109.415px; top: 495.07px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02527); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The pseudo-code of Rete is many pages long and doesn’t make the algorithm any clearer for its complexity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We decided not to include it here and waste several pages with difficult-to-follow code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A full source code implementation is provided on the website, with lots of comments, that we’d recommend you work through. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Rule-Based System program on the website allows you to play with a simple rule-based system and database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a command line program that allows you to add facts to the database using the simple LISP syntax shown above.You can run a rule set against it to see how matches are processed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Rete can be viewed at any time, and the program gives lots of feedback on which nodes in the Rete are being processed and the variable bindings they are passing on. </p>
<span origfont="g_font_13" data-canvas-width="76.74808012799998" style="left: 109.415px; top: 648.642px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06595); border-left: none;" yquantized="640" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="95.662479216" style="left: 109.415px; top: 679.085px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02863); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Rete approaches O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nmp </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of rules, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of clauses per rule, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">p </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of facts in the database.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a large number of wild card matches is possible,then the process of unifying the bindings in the join node can take over the performance. </p>
<span origfont="g_font_7" data-canvas-width="458.98216255200003" style="left: 109.391px; top: 707.873px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00214); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">(radio (held-by ?person-1))(?person-1 (health &lt;15))(?person-2 (health &gt;45))(?person-2 (is-covering ?person-1)) </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: </span><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><p origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: ?person-1 = SaleA?person-2 = Whisker OR ?person-2 = Captain </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><p origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400; display: inline;">Bindings </span><span origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: (?person-1 = Johnson, ?person-1 = Whisker </span><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><p origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: ?person-2 = Captain) ORNone (?person-1 = Sale, ?person-2 = Whisker)BC </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><p origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;">: (?person-1 = Sale, ?person-2 = Whisker) OR </p><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400; display: inline;">Bindings: </span><span origfont="g_font_47" style="font-family: sans-serif; font-size: 8.23985px; font-style: normal; font-weight: 400; display: inline;"> (?person-1 = Sale, </span><span origfont="g_font_37" style="font-family: sans-serif; font-size: 8.0598px; font-style: normal; font-weight: 400;">Bindings </span><span origfont="g_font_37" data-canvas-width="61.2464202" style="left: 235.956px; top: 387.232px; font-size: 8.0598px; font-family: sans-serif; transform: scaleX(1.05597); border-left: 50px solid blue;" yquantized="380" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 429.102px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="420" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">:None ?person-2 = Captain)?person-1 = Sale ?person-2 = WhiskerSwap Radio rule Change Backup rule </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.52 </span><span origfont="g_font_7" data-canvas-width="46.29022464" style="left: 140.616px; top: 466.737px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.96438); border-left: none;" yquantized="460" class="highlight4"></span><p class="after_vGap" style="display: inline;"></p></pre>
<span origfont="g_font_7" data-canvas-width="46.29022464" style="left: 140.616px; top: 466.737px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.96438); border-left: none;" yquantized="460" class="highlight4"></span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Rete after-updateRete is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nmq </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in memory, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">q </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of different wild-card matches per pattern. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is significantly higher than the basic rule matching system we developed first.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In addition, in order to take advantage of the fast update, we need to keep the data between iterations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is this high memory usage that gives the speed advantage. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 544.948px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="540" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.8.9 </span>
<span origfont="g_font_7" data-canvas-width="459.2439796799999" style="left: 122.615px; top: 578.285px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.985959); border-left: none;" yquantized="570" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Extensions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The ubiquity of rule-based systems in early AI research led to a whole host of different extensions, modifications, and optimizations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each area in which a rule-based system was applied (such as language understanding, controlling industrial processes, diagnosing faults in machinery, and many others) has its own set of common tricks. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Very few of these are directly usable in games development.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Given that rule-based systems are only needed in a minority of AI scenarios,we’ll safely ignore most of them here.  </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We’d recommend </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Expert Systems: Principles and Programming </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">[Giarratano and Riley, 1998], for more background on industrial uses.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It comes with a copy of CLIPS, a reasonably general expert system shell. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are two extensions that are widespread enough to be worth mentioning.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first man- ages huge rule-based systems and is of direct use to games developers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The second is justification, </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could fill an entire book on algorithms for rule-based systems.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Given their niche status in game development, we will limit this section to a brief overview of each extension. </p>
<span origfont="g_font_13" data-canvas-width="152.27959910399997" style="left: 109.415px; top: 151.868px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.99698); border-left: none;" yquantized="150" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.6031852479999" style="left: 109.415px; top: 182.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07907); border-left: none;" yquantized="180" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Managing Large Rule Sets </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">One developer we know has used a rule-based system to control the team AI in a series of two-dimensional (2D) turn-based war games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Their rule set was huge, and as each game in the series was released they added a large number of new rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some new rules allowed theAI to cope with new weapons and power-ups, and other new rules were created as a result of player feedback from previous releases.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Over the course of developing each title, bug reports from the QA department would lead to even more rules being added.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> After several itera- tions of the product, the set of rules was huge and difficult to manage.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It also had serious implications for performance: with such a large rule set, even the Rete matching algorithm is too slow. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The solution was to group rules together.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each rule set could be switched on and off as it was needed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Only rules in active sets would be considered for triggering.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rules in disabled sets were never given the chance to trigger.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This took the system down from several thousand rules to no more than a hundred active rules at any time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is a technique used in many large rule-based systems. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The rule-based system contains a single rule set which is always switched on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Inside this rule set are any number of rules and any number of other rule sets.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rule sets at this level or below can be switched on or off.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This switching can be performed directly by the game code or in the THEN action of another rule. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Typically, each high-level rule set contains several rules and a few rule sets.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The rules are only used to switch on and off the contained sets.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is arranged in a hierarchy, with the sets at the lowest level containing the useful rules that do the work. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At each iteration of the rule-based system, the top-level set is asked to provide one triggered rule that should be fired.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This set looks through all its constituent rules, searching for triggers in the normal way.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It also delegates the same query to any sets it contains: provide one triggered rule that should be fired.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each set uses one of the arbitration algorithms to decide which rule to return for firing. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our implementation of this process, shown in Figure 5.53, a different arbitration routine could be set for each set in the hierarchy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the end, this flexibility wasn’t used, and all sets ran on a most specific strategy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The hierarchy of sets allows a great deal of flexibility.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At one point in the hierarchy, we used a rule set for all the rules corresponding to the peculiarities of each weapon in the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Only one of these sets was enabled at any time: the set corresponding to the weapon held by the character. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The enabling of the appropriate set was handled by the game code. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At another point in the hierarchy, there were sets containing rules for moving in the presence of enemies or moving freely.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because information about nearby enemies was being added to the database anyway, we switched between these two sets using five rules placed in the set that contained them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An overview schematic of the rule sets is shown in Figure 5.53. </p>
<span origfont="g_font_7" data-canvas-width="297.9622378079999" style="left: 127.18px; top: 715.008px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.98663); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">DefenseStrategy </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">Activated on theActive when player opponents move. </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">has more than one character. </p><span origfont="g_font_38" data-canvas-width="49.654638000000006" style="left: 497.959px; top: 176.634px; font-size: 9.71558px; font-family: sans-serif; transform: scaleX(0.993093); border-left: 50px solid blue;" yquantized="170" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">One set perOffenseMelee weapon type </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">Activated on theActive when character players move. </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">is using melee weapon. </p><span origfont="g_font_38" data-canvas-width="44.36131104000001" style="left: 189.894px; top: 220.586px; font-size: 9.71558px; font-family: sans-serif; transform: scaleX(0.985807); border-left: 50px solid blue;" yquantized="220" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_38" data-canvas-width="80.94893904000001" style="left: 154.654px; top: 237.767px; font-size: 9.50328px; font-family: sans-serif; transform: scaleX(1.01186); border-left: 50px solid blue;" yquantized="230" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400; display: inline;">Master set </p><span origfont="g_font_38" style="font-family: sans-serif; font-size: 9.71558px; font-style: normal; font-weight: 400;">Contains only rules </span><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">One set per </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400; display: inline;"> to enable other sets. </p><span origfont="g_font_38" style="font-family: sans-serif; font-size: 9.71558px; font-style: normal; font-weight: 400;"> </span><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">NetworkMissiles weapon type </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">Contains rules forActive when character lag and other networkis using missile weapon. </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;"> stuff.  </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400; display: inline;"> Only active in network play. </p><span origfont="g_font_38" style="font-family: sans-serif; font-size: 9.71558px; font-style: normal; font-weight: 400;"> </span><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">Power-upsOne set per power-up </p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">Active when character has a power-up. </p><span origfont="g_font_38" data-canvas-width="102.72095352000004" style="left: 400.549px; top: 345.317px; font-size: 9.71558px; font-family: sans-serif; transform: scaleX(1.0088); border-left: 50px solid blue;" yquantized="340" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.71558px; font-style: normal; font-weight: 400;">Different sets dependingMovement on presence and number of enemies. </p><span origfont="g_font_38" data-canvas-width="74.32515288" style="left: 298.381px; top: 370.024px; font-size: 9.50328px; font-family: sans-serif; transform: scaleX(1.00439); border-left: 50px solid blue;" yquantized="370" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_38" style="font-family: sans-serif; font-size: 9.50328px; font-style: normal; font-weight: 400;">Contains rules for character movement. </p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 419.502px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="410" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.53 </p><span origfont="g_font_13" data-canvas-width="180.7984896" style="left: 122.615px; top: 454.268px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.01005); border-left: none;" yquantized="450" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">Schematic of the rule sets in the game </p></pre>
<span origfont="g_font_13" data-canvas-width="180.7984896" style="left: 122.615px; top: 454.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01005); border-left: none;" yquantized="450" class="highlight4"></span>
<span origfont="g_font_7" data-canvas-width="459.0036817679999" style="left: 122.615px; top: 484.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00609); border-left: none;" yquantized="480" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Justification in Expert Systems </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Most generally, an expert system is any AI that encodes the knowledge from a human expert and performsthatexpert’sjob.Mostexpertsystemsareimplementedusingrule-basedsystems.Strictly, the expert system is the end product: the combination of the algorithm and rules that encodes the expert’s knowledge.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The algorithm itself is the rule-based system, also known as an </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">expert system shell </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">or sometimes a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">production system </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">(the term </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">production </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">refers to the forward-chaining nature of the algorithm: it produces new knowledge from existing data). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A common extension to the basic rule-based system has been incorporated in many expert system shells: an audit trail of how knowledge came to be added. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When the rule-based system fires a database rewrite rule, any data added have additional information stored with them.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The rule that created the data, the items of data in the database that the rule matched, the current values of these items, and a time stamp are all commonly retained.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Let’s call this the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">firing information </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, when an item of data is removed, it is retained in a"deleted"list, accompanied by the same firing information.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Finally, if an item of data is modified, its old value is retained along with the firing information. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a game context, the data in the database can also be added or modified directly by the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similar auditing information is also retained, with an indication that the data were altered by an external process, rather than by the firing of a rule.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Obviously, if a piece of data is </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">changing every frame, it may not be sensible to keep a complete record of every value it has ever taken. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Any piece of data in the database can then be queried, and the expert system shell will return the audit trail of how the data got there and how the current value came to be set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This information can be recursive.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the data we are interested in came from a rule, we can ask where the matches came from that triggered that rule.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This process can continue until we are left with just the items of data that were added by the game (or were there from the start). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In an expert system this is used to justify the decisions that the system makes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the expert system is controlling a factory and chooses to shut down a production line, then the justification system can give the reasons for its decision. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a game context,we don’t need to justify decisions to the player,but during testing,it is often very useful to have a mechanism for justifying the behavior of a character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rule-based systems can be so much more complicated than the previous decision making techniques in this chapter. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Finding out the detailed and long-term causes of a strange-looking behavior can save days of debugging. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve built an expert system shell specifically for inclusion in a game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We added a justification system late in the development cycle after a bout of hair-pulling problems.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The difference in debugging power was dramatic.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A sample portion of the output is shown below (the full output was around 200 lines long).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unfortunately, because the code was developed commercially, we are not able to include this application on the website. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 407.998px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="left: 112.524px; top: 407.998px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">Carnage XS.  </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> V104 2002-9-12. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">JUSTIFICATION FOR &lt;Action: Grenade (2.2,0.5,2.1)&gt; </p><span origfont="g_font_7" style="left: 112.524px; top: 436.798px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> &lt;Action: grenade ?target&gt; </p><span origfont="g_font_7" style="left: 112.524px; top: 465.598px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 479.998px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="470" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">FROM RULE: flush-nest </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 494.398px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">BINDINGS: target = (2.2,0.5,2.1) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 508.798px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="500" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">CONDITIONS: </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> &lt;Visible: heavy-weapon &lt;ptr008F8850&gt; at (2.2,0.5,2.1)&gt; </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 537.598px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">FROM RULE: covered-by-heavy-weaponBINDINGS: ?weapon = &lt;ptr008F8850&gt; </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 566.398px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">CONDITIONS: &lt;Ontology: machine-gun &lt;ptr008F8850&gt;&gt; </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 595.198px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 609.598px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">FROM FACT: &lt;Ontology: machine-gun &lt;ptr008F8850&gt;&gt; </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 623.998px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">&lt;Location: &lt;ptr008F8850&gt; at (312.23, 0.54, 12.10)&gt; </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 638.398px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="630" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">FROM FACT: &lt;Location: &lt;ptr008F8850&gt; at (2.2,0.5,2.1)&gt; </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> &lt;Visible: enemy-units in group&gt; </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 667.198px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">... </p><span origfont="g_font_7" data-canvas-width="441.1176267359999" style="left: 127.415px; top: 697.245px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00038); border-left: none;" yquantized="690" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.1176267359999" style="left: 127.415px; top: 697.245px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00038); border-left: none;" yquantized="690" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To make sure the final game wasn’t using lots of memory to store the firing data, the justifica- tion code was conditionally compiled so it didn’t end up in the final product. </p>
<span origfont="g_font_7" data-canvas-width="366.0753384959999" style="left: 109.41px; top: 711.639px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02032); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;">5.8.10 </span>
<span origfont="g_font_7" data-canvas-width="459.059870832" style="left: 122.615px; top: 125.853px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01338); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Where Next </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The rule-based systems in this section represent the most complex non-learning decision makers we’ll cover in this book.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A full Rete-implementation with justification and rule set support is a formidable programming task that can support incredible sophistication of behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can support more advanced AI than any seen in current-generation games (providing someone was capable of writing enough good rules).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Likewise, GOAP is well ahead of the current state of the art and is the cutting edge of AI being explored in several big studios. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The remainder of this chapter looks at the problem of making decisions from some different angles,examining ways to combine different decision makers together,to script behaviors directly from code, and to execute actions that are requested from any decision making algorithm. </p>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 103.158px; top: 283.053px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="280" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.9 </p>
<span origfont="g_font_7" data-canvas-width="459.2117008559999" style="left: 122.376px; top: 324.878px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02096); border-left: none;" yquantized="320" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Blackboard Architectures </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A blackboard system isn’t a decision making tool in its own right.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a mechanism for coordi- nating the actions of several decision makers. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The individual decision making systems can be implemented in any way: from a decision tree to an expert system or even to learning tools such as the neural networks we’ll meet in Chapter 7. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is this flexibility that makes blackboard architectures appealing. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the AI literature, blackboard systems are often large and unwieldy, requiring lots of man- agement code and complicated data structures.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For this reason they have something of a bad rep- utation among game AI programmers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At the same time, many developers implement AI systems that use the same techniques without associating them with the term "blackboard architecture." </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 480.175px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.9.1 </span>
<span origfont="g_font_7" data-canvas-width="459.21528739200005" style="left: 122.376px; top: 513.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01861); border-left: none;" yquantized="510" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Problem </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We would like to be able to coordinate the decision making of several different techniques.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each technique may be able to make suggestions as to what to do next, but the final decision can only be made if they cooperate. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We may have a decision making technique specializing in targeting enemy tanks, for example. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It can’t do its stuff until a tank has been selected to fire at.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A different kind of AI is used to select a firing target, but that bit of AI can’t do the firing itself.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, even when the target tank is selected, we may not be in a position where firing is possible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The targeting AI needs to wait until a route-planning AI can move to a suitable firing point. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could simply put each bit of AI in a chain.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The target selector AI chooses a target, the movement AI moves into a firing position, and the ballistics AI calculates the firing solution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This approach is very common but doesn’t allow for information to pass in the opposite direction.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the ballistics AI calculates that it cannot make an accurate shot, then the targeting AI may need to calculate a new solution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On the other hand, if the ballistics AI can work out a shot, then there is no need to even consider the movement AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Obviously, whatever objects are in the way do not affect the shell’s trajectory. </p>
<span origfont="g_font_7" data-canvas-width="126.13010253600004" style="left: 122.615px; top: 715.039px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00623); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We would like a mechanism whereby each AI can communicate freely without requiring all the communication channels to be set up explicitly. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 151.437px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="150" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.9.2 </span>
<span origfont="g_font_7" data-canvas-width="459.12562399199993" style="left: 109.415px; top: 184.774px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05599); border-left: none;" yquantized="180" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The Algorithm </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The basic structure of a blackboard system has three parts: a set of different decision making tools (called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">experts </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">in blackboard-speak), a blackboard, and an arbiter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is illustrated inFigure 5.54. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The blackboard is an area of memory that any expert may use to read from and write to. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each expert needs to read and write in roughly the same language, although there will usually be messages on the blackboard that not everyone can understand. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each expert looks at the blackboard and decides if there’s anything on it that they can use. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If there is, they ask to be allowed to have the chalk and board eraser for a while.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When they get control they can do some thinking, remove information from the blackboard, and write new information, as they see fit.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> After a short time, the expert will relinquish control and allow other expertstohaveago. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The arbiter picks which expert gets control at each go.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Experts need to have some mechanism of indicating that they have something interesting to say.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The arbiter chooses one at a time and gives it control.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Often, none or only one expert wants to take control, and the arbiter is not required. </p>
<span origfont="g_font_21" data-canvas-width="47.48160000000001" style="left: 309.949px; top: 449.212px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.03221); border-left: 50px solid blue;" yquantized="440" class="highlight2" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="47.48160000000001" style="left: 309.949px; top: 449.212px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.03221); border-left: 50px solid blue;" yquantized="440" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_21" data-canvas-width="42.4416" style="left: 216.205px; top: 482.005px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03516); border-left: 50px solid blue;" yquantized="480" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="67.0368" style="left: 302.932px; top: 510.21px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03134); border-left: 50px solid blue;" yquantized="510" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="40.2816" style="left: 290.605px; top: 538.415px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.00704); border-left: 50px solid blue;" yquantized="530" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="18.144000000000002" style="left: 319.079px; top: 596.015px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.06729); border-left: 50px solid blue;" yquantized="590" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="29.884800000000002" style="left: 223.405px; top: 637.996px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.03051); border-left: 50px solid blue;" yquantized="630" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="69.0816" style="left: 302.461px; top: 672.805px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01591); border-left: 50px solid blue;" yquantized="670" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">The ArbiterManeuverFirearms expertexpertThe Blackboard ammo=4Tr a phealthy detectionPower-ups expertenemy-sightedexpert hideStealthLevel tactics expertexpertPanel of experts </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.54 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Blackboard architecture </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm works in iterations: 1.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Experts look at the board and indicate their interest. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 2.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The arbiter selects an expert to have control. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The expert does some work, possibly modifying the blackboard. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 4.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The expert voluntarily relinquishes control. </p>
<span origfont="g_font_7" data-canvas-width="441.0733927920001" style="left: 140.615px; top: 203.771px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07317); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm used by the arbiter can vary from implementation to implementation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The simple and common approach we will use asks the experts to indicate how useful they think they can be in the form of a numeric insistence value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The arbiter can then simply pick the expert with the highest insistence value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the case of a tie, a random expert is selected. </p>
<span origfont="g_font_13" data-canvas-width="122.0865024" style="left: 122.615px; top: 289.116px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03463); border-left: none;" yquantized="280" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0658483920001" style="left: 122.615px; top: 319.559px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04571); border-left: none;" yquantized="310" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Extracting an Action </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Suggested actions can be written to the blackboard by experts in the same way that they write any other information.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At the end of an iteration (or multiple iterations if the system is running for longer), actions placed on the blackboard can be removed and carried out using the action execution techniques at the end of this chapter. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Often, an action can be suggested on the blackboard before it has been properly thought through.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our tank example, the targeting expert may post a "fire at tank 15" action on the board.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the algorithm stopped at that point,the action would be carried out without the ballistic and movement experts having had a chance to agree. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A simple solution is to store the potential action along with a set of agreement flags.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An action on the blackboard is only carried out if all relevant experts have agreed to it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This does not have to be every expert in the system, just those who would be capable of finding a reason not to carry the action out. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our example the"fire at tank 15"action would have one agreement slot: that of the ballistics expert.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Only if the ballistics expert has given the go ahead would the action be carried out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The ballistics expert may refuse to give the go ahead and instead either delete the action or add a new action "move into firing position for tank 15." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">" With the "fire at tank 15" action still on the blackboard, the ballistics expert can wait to agree to it until the firing position is reached. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 588.01px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="580" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.9.3 </p>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 122.615px; top: 621.346px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Pseudo-Code </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">blackboardIteration </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function below takes as input a blackboard and a set of experts.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It returns a list of actions on the blackboard that have been passed for execution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The function acts as the arbiter, following the highest insistence algorithm given above. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 685.775px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="left: 125.724px; top: 685.775px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 700.175px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def blackboardIteration(blackboard, experts): </p><span origfont="g_font_7" style="left: 125.724px; top: 714.575px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="710" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Go through each expert for their insistence </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">bestExpert = None </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">highestInsistence = 0 </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for expert in experts: # Ask for the expert’s insistence </p><span origfont="g_font_7" style="left: 112.524px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </span><span origfont="g_font_7" style="left: 112.524px; top: 172.156px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">insistence = expert.getInsistence(blackboard) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check against the highest value so far if insistence &gt; highestInsistence: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">highestInsistence = insistence </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bestExpert = expert </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Make sure somebody insisted if bestExpert: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Give control to the most insistent expert </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 330.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">bestExpert.run(blackboard) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Return all passed actions from the blackboard </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 </span><span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 403.089px; font-size: 16.7372px; font-family: serif; transform: scaleX(0.94541); border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_15" style="font-family: serif; font-size: 16.7372px; font-style: normal; font-weight: 400; display: inline;">return blackboard.passedActions </p><span origfont="g_font_12" style="font-family: sans-serif; font-size: 16.7372px; font-style: normal; font-weight: 400;"> 5.9.4 </span></pre>
<span origfont="g_font_12" data-canvas-width="277.7377605599999" style="left: 138.209px; top: 407.005px; font-size: 23.2229px; font-family: sans-serif; transform: scaleX(1.22405); border-left: none;" yquantized="400" class="highlight4"></span>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 109.415px; top: 436.425px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="430" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Data Structures and Interfaces </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">blackboardIteration </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">function relies on three data structures: a blackboard consisting of entries and a list of experts. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Blackboard </span>
<span origfont="g_font_35" data-canvas-width="91.45728000000001" style="left: 137.39px; top: 497.319px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">has the following structure: </p>
<span origfont="g_font_35" data-canvas-width="91.45728000000001" style="left: 137.39px; top: 497.319px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class Blackboard: </p><span origfont="g_font_7" style="left: 112.524px; top: 515.254px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="510" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 112.524px; top: 529.654px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">entries </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="441.12001775999994" style="left: 127.415px; top: 556.712px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01174); border-left: none;" yquantized="550" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">passedActions </p></pre>
<span origfont="g_font_7" data-canvas-width="441.12001775999994" style="left: 127.415px; top: 556.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01174); border-left: none;" yquantized="550" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It has two components: a list of blackboard entries and a list of ready-to-execute actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The list of blackboard entries isn’t used in the arbitration code above and is discussed in more detail later in the section on blackboard language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The actions list contains actions that are ready to execute (i.e., they have been agreed upon by every expert whose permission is required).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can be seen as a special section of the blackboard: a to-do list where only agreed-upon actions are placed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">More complex blackboard systems also add meta-data to the blackboard that controls its execution, keeps track of performance, or provides debugging information.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Just as for rule- based systems, we can also add data to hold an audit trail for entries: which expert added them and when. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Other blackboard systems hold actions as just another entry on the blackboard itself, without a special section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For simplicity, we’ve elected to use a separate list; it is the responsibility of each expert to write to the "actions" section when an action is ready to be executed and to keep </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">unconfirmed actions off the list.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This makes it much faster to execute actions.We can simply work through this list rather than searching the main blackboard for items that represent confirmed actions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Experts can be implemented in any way required.  </p>
<span origfont="g_font_7" style="left: 125.724px; top: 189.14px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> For the purpose of being managed by the arbiter in our code, they need to conform to the following interface: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 189.14px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">class Expert: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 217.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def getInsistence(blackboard) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 244.999px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="240" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">def run(blackboard) </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 244.999px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="240" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getInsistence </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function returns an insistence value (greater than zero) if the expert thinks it can do something with the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In order to decide on this, it will usually need to have a look at the contents of the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because this function is called for each expert, the blackboard should not be changed at all from this function.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It would be possible, for example, for an expert to return some instance, only to have the interesting stuff removed from the blackboard by another expert.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> When the original expert is given control, it has nothing to do. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getInsistence </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function should also run as quickly as possible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the expert takes a long time to decide if it can be useful, then it should always claim to be useful.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can spend the time working out the details when it gets control.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our tanks example, the firing solution expert may take a while to decide if there is a way to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In this case,the expert simply looks on the blackboard for a target, and if it sees one, it claims to be useful.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> It may turn out later that there is no way to actually hit this target, but that processing is best done in the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">function when the expert has control. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function is called when the arbiter gives the expert control.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It should carry out the processing it needs, read and write to the blackboard as it sees fit, and return.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In general, it is better for an expert to take as little time as possible to run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If an expert requires lots of time, then it can benefit from stopping in the middle of its calculations and returning a very high insistence on the next iteration.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This way the expert gets its time split into slices, allowing the rest of the game to be processed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Chapter 9 has more details on this kind of scheduling and time slicing. </p>
<span origfont="g_font_13" data-canvas-width="154.11161395200003" style="left: 122.615px; top: 555.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02741); border-left: none;" yquantized="550" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9259734880001" style="left: 122.615px; top: 585.513px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05796); border-left: none;" yquantized="580" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Blackboard Language </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we haven’t paid any attention to the structure of data on the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> More so than any of the other techniques in this chapter, the format of the blackboard will depend on the application.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Blackboard architectures can be used for steering characters, for example, in which case the blackboard will contain three-dimensional (3D) locations, combinations of maneuvers, or animations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Used as a decision making architecture, it might contain information about the game state, the position of enemies or resources, and the internal state of a character. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are general features to bear in mind, however, that go some way toward a generic black- board language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because the aim is to allow different bits of code to talk to each other seamlessly, information on the blackboard needs at least three components: value, type identification, and semantic identification. </p>
<span origfont="g_font_7" data-canvas-width="112.54310865600002" style="left: 122.615px; top: 715.071px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04207); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The value of a piece of data is self-explanatory.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The blackboard will typically have to cope with a wide range of different data types, however, including structures.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It might contain health values expressed as an integer and positions expressed as a 3D vector, for example. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because the data can be in a range of types, its content needs to be identified.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be a simple type code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It is designed to allow an expert to use the appropriate type for the data (inC/C++ this is normally done by typecasting the value to the appropriate type).  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Blackboard entries could achieve this by being polymorphic: using a generic </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Datum </span>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">base class with sub-classes for </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">FloatDatum </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Vector3DDatum </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, and so on, or with runtime-type information (RTTI) in a language such as C++, or the sub-classes containing a type identifier.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is more common, however, to explicitly create a set of type codes to identify the data, whether or not RTTI is used. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The type identifier tells an expert what format the data are in, but it doesn’t help the expert understand what to do with it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Some kind of semantic identification is also needed.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The semantic identifier tells each expert what the value </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">means </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In production blackboard systems this is com- monly implemented as a string (representing the name of the data).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a game,using lots of string comparisons can slow down execution, so some kind of magic number is often used. </p>
<span origfont="g_font_7" style="left: 112.524px; top: 347.541px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">A blackboard item may therefore look like the following: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 347.541px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct BlackboardDatum: id </p><span origfont="g_font_7" style="left: 112.524px; top: 376.341px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">type value </p><span origfont="g_font_7" data-canvas-width="270.20244916799993" style="left: 127.415px; top: 417.799px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.997057); border-left: none;" yquantized="410" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 4 </p></pre>
<span origfont="g_font_7" data-canvas-width="270.20244916799993" style="left: 127.415px; top: 417.799px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997057); border-left: none;" yquantized="410" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The whole blackboard consists of a list of such instances. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this approach complex data structures are represented in the same way as built-in types.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> All the data for a character (its health, ammo, weapon, equipment, and so on) could be represented in one entry on the blackboard or as a whole set of independent values. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could make the system more general by adopting an approach similar to the one we used in the rule-based system.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Adopting a hierarchical data representation allows us to effectively expand complex data types and allows experts to understand parts of them without having to be hard- coded to manipulate the type.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In languages such as Java, where code can examine the structure of a type, this would be less important.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In C++, it can provide a lot of flexibility.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An expert could look for just the information on a weapon, for example, without caring if the weapon is on the ground, in a character’s hand, or currently being constructed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">While many blackboard architectures in non-game AI follow this approach, using nested data to represent their content, we have not seen it used in games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Hierarchical data tend to be associated with rule-based systems and flat lists of labeled data with blackboard systems (although the two approaches overlap, as we’ll see below). </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 652.975px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.9.5 </span>
<span origfont="g_font_7" data-canvas-width="261.092647728" style="left: 109.415px; top: 686.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00808); border-left: none;" yquantized="680" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The blackboard arbiter uses no memory and runs in O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) time,where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of experts. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Often,eachexpertneedstoscanthroughtheblackboardtofindanentrythatitmightbeinterested in.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If the list of entries is stored as a simple list,this takes O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) time for each expert,where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">number of entries in the blackboard.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be reduced to almost O(1) time if the blackboard entries are stored in some kind of hash.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The hash must support lookup based on the semantics of the data, so an expert can quickly tell if something interesting is present. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The majority of the time spent in the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">blackboardIteration </span>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">function should be spent in the </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">function of the expert who gains control.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Unless a huge number of experts is used (or they are searching through a large linear blackboard), the performance of each </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">run </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function is the most important factor in the overall efficiency of the algorithm. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 220.177px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="220" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.9.6 </span>
<span origfont="g_font_7" data-canvas-width="459.36353088000016" style="left: 122.376px; top: 253.515px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03928); border-left: none;" yquantized="250" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Other Things Are Blackboard Systems </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When we described the blackboard system, we said it had three parts: a blackboard containing data, a set of experts (implemented in any way) that read and write to the blackboard, and an arbiter to control which expert gets control.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is not alone in having these components, however. </p>
<span origfont="g_font_13" data-canvas-width="117.39097804799997" style="left: 122.615px; top: 338.67px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.986479); border-left: none;" yquantized="330" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.07421697599995" style="left: 122.615px; top: 369.113px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02931); border-left: none;" yquantized="360" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule-Based Systems </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rule-based systems have each of these three elements: their database contains data, each rule is like an expert—it can read from and write to the database, and there is an arbiter that controls which rule gets to fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The triggering of rules is akin to experts registering their interest, and the arbiter will then work in the same way in both cases. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This similarity is no coincidence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Blackboard architectures were first put forward as a kind of generalization of rule-based systems: a generalization in which the rules could have any kind of trigger and any kind of rule. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A side effect of this is that if you intend to use both a blackboard system and a rule-based system in your game,you may need to implement only the blackboard system.You can then create "experts" that are simply rules: the blackboard system will be able to manage them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The blackboard language will have to be able to support the kind of rule-based matching you intend to perform, of course.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> But, if you are planning to implement the data format needed in the rule-based system we discussed earlier,then it will be available for use in more flexible blackboard applications. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If your rule-based system is likely to be fairly stable, and you are using the Rete match- ing algorithm, then the correspondence will break down.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because the blackboard architecture is a super-set of the rule-based system, it cannot benefit from optimizations specific to rule handling. </p>
<span origfont="g_font_13" data-canvas-width="126.95418163199999" style="left: 122.615px; top: 655.868px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02382); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.904454272" style="left: 122.615px; top: 686.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997133); border-left: none;" yquantized="680" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Finite State Machines </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Less obviously, finite state machines are also a subset of the blackboard architecture (actually they are a subset of a rule-based system and, therefore, of a blackboard architecture).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The blackboard is replaced by the single state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Experts are replaced by transitions, determining whether to act </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">based on external factors, and rewriting the sole item on the blackboard when they do.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the state machines in this chapter we have not mentioned an arbiter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We simply assumed that the first triggered transition would fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is simply the first-applicable arbitration algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Other arbitration strategies are possible in any state machine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use dynamic priorities, randomized algorithms, or any kind of ordering.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They aren’t normally used because the state machine is designed to be simple; if a state machine doesn’t support the behavior you are looking for, it is unlikely that arbitration will be the problem. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State machines, rule-based systems, and blackboard architectures form a hierarchy of increas- ing representational power and sophistication.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> State machines are fast, easy to implement, and restrictive, while blackboard architectures can often appear far too general to be practical.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The general rule, as we saw in the introduction, is to use the simplest technique that supports the behavior you are looking for. </p>
<span origfont="g_font_15" data-canvas-width="47.34239399999999" style="left: 76.4726px; top: 298.887px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.942936); border-left: none;" yquantized="290" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.10 </p>
<span origfont="g_font_7" data-canvas-width="459.1316015519999" style="left: 109.176px; top: 340.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.989508); border-left: none;" yquantized="340" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripting </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A significant proportion of the decision making in games uses none of the techniques described so far in this chapter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the early and mid-1990s,mostAI was hard-coded using custom written code to make decisions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is fast and works well for small development teams when the programmer is also likely to be designing the behaviors for game characters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is still the dominant model for platforms with modest development needs (i.e., last-generation handheld consoles prior to PSP,PDAs, and mobile phones). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As production became more complex,there arose a need to separate the content (the behavior designs) from the engine.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Level designers were empowered to design the broad behaviors of characters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Many developers moved to use the other techniques in this chapter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Others continued to program their behaviors in a full programming language but moved to a scripting language separate from the main game code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Scripts can be treated as data files,and if the scripting language is simple enough level designers or technical artists can create the behaviors. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An unexpected side effect of scripting language support is the ability for players to create their own character behavior and to extend the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Modding is an important financial force in PC games (it can extend their full-price shelf life beyond the eight weeks typical of other titles), so much so that most triple-A titles have some kind of scripting system included.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On consoles the economics is less clear cut.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most of the companies we worked with who had their own internal game engine had some form of scripting language support. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">While we are unconvinced about the use of scripts to run top-notch character AI, they have several important applications: in scripting the triggers and behavior of game levels (which keys open which doors, for example), for programming the user interface, and for rapidly prototyping character AI. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This section provides a brief primer for supporting a scripting language powerful enough to run AI in your game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is intentionally shallow and designed to give you enough information to either get started or decide it isn’t worth the effort.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Several excellent websites are available comparing existing languages, and a handful of texts cover implementing your own language from scratch. </p>
<span origfont="g_font_7" data-canvas-width="63.142161792" style="left: 109.415px; top: 714.967px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01842); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;">5.10.1 </span>
<span origfont="g_font_7" data-canvas-width="458.58644807999997" style="left: 122.615px; top: 125.853px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01908); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Language Facilities </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are a few facilities that a game will always require of its scripting language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The choice of language often boils down to trade-offs between these concerns. </p>
<span origfont="g_font_13" data-canvas-width="35.34913536" style="left: 122.615px; top: 176.629px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03968); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.67730699199996" style="left: 122.615px; top: 207.073px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04482); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Speed </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripting languages for games need to run as quickly as possible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you intend to use a lot of scripts for character behaviors and events in the game level, then the scripts will need to execute as part of the main game loop.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This means that slow-running scripts will eat into the time you need to render the scene, run the physics engine, or prepare audio. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most languages can be anytime algorithms, running over multiple frames (see Chapter 9 for details).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This takes the pressure off the speed to some extent,but it can’t solve the problem entirely. </p>
<span origfont="g_font_13" data-canvas-width="189.66590054399998" style="left: 122.615px; top: 315.449px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.07765); border-left: none;" yquantized="310" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.997704208" style="left: 122.615px; top: 345.892px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01548); border-left: none;" yquantized="340" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Compilation and Interpretation </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripting languages are broadly interpreted, byte-compiled, or fully compiled, although there are many flavors of each technique. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Interpreted languages are taken in as text.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The interpreter looks at each line, works out what it means, and carries out the action it specifies. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Byte-compiled languages are converted from text to an internal format, called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">byte code </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This byte code is typically much more compact than the text format.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because the byte code is in a format optimized for execution, it can be run much faster. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Byte-compiled languages need a compilation step; they take longer to get started, but then run faster.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The more expensive compilation step can be performed as the level loads but is usually performed before the game ships. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The most common game scripting languages are all byte-compiled.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some, like Lua, offer the ability to detach the compiler and not distribute it with the final game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this way all the scripts can be compiled before the game goes to master, and only the compiled versions need to be included with the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This removes the ability for users to write their own script, however. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fully compiled languages create machine code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This normally has to be linked into the main game code, which can defeat the point of having a separate scripting language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We do know of one developer, however, with a very neat runtime-linking system that can compile and link machine code from scripts at runtime.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In general, however, the scope for massive problems with this approach is huge.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’d advise you to save your hair and go for something more tried and tested. </p>
<span origfont="g_font_13" data-canvas-width="171.76609689600002" style="left: 122.615px; top: 655.868px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05378); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.4508032560001" style="left: 122.197px; top: 686.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01468); border-left: none;" yquantized="680" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Extensibility and Integration </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Your scripting language needs to have access to significant functions in your game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A script that controls a character, for example, needs to be able to interrogate the game to find out what it can see and then let the game know what it wants to do as a result. </p>
<span origfont="g_font_7" data-canvas-width="295.79477455199986" style="left: 122.616px; top: 715.1px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00954); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The set of functions it needs to access is rarely known when the scripting language is implemented or chosen.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is important to have a language that can easily call functions or use classes in your main game code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Equally, it is important for the programmers to be able to expose new functions or classes easily when the script authors request it. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some languages (Lua being the best example) put a very thin layer between the script and the rest of the program.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This makes it very easy to manipulate game data from within scripts,without having a whole set of complicated translations. </p>
<span origfont="g_font_13" data-canvas-width="74.34221568" style="left: 109.415px; top: 219.865px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03253); border-left: none;" yquantized="210" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0216144480002" style="left: 109.415px; top: 250.309px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00223); border-left: none;" yquantized="250" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Re-Entrancy </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is often useful for scripts to be re-entrant.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They can run for a while, and when their time budget runs out they can be put on hold.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a script next gets some time to run, it can pick up where it left off. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is often helpful to let the script yield control when it reaches a natural lull.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Then a scheduling algorithm can give it more time, if it has it available, or else it moves on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A script controlling a character, for example, might have five different stages (examine situation, check health, decide movement, plan route, and execute movement).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These can all be put in one script that yields between each section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Then each will get run every five frames, and the burden of the AI is distributed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Not all scripts should be interrupted and resumed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A script that monitors a rapidly changing game event may need to run from its start at every frame (otherwise, it may be working on incorrect information).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> More sophisticated re-entrancy should allow the script writer to mark sections as uninterruptible. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">These subtleties are not present in most off-the-shelf languages, but can be a massive boon if you decide to write your own. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 485.374px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94441); border-left: none;" yquantized="480" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.10.2 </span>
<span origfont="g_font_7" data-canvas-width="459.236806608" style="left: 109.415px; top: 518.71px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01551); border-left: none;" yquantized="510" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Embedding </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Embedding is related to extensibility.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An embedded language is designed to be incorporated into another program.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When you run a scripting language from your workstation, you normally run a dedicated program to interpret the source code file.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a game, the scripting system needs to be controlled from within the main program.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The game decides which scripts need to be run and should be able to tell the scripting language to process them. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 609.775px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94441); border-left: none;" yquantized="600" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.10.3 </p>
<span origfont="g_font_7" data-canvas-width="459.14953423199995" style="left: 109.176px; top: 643.113px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.99383); border-left: none;" yquantized="640" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Choosing a Language </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A huge range of scripting languages is available,and many of them are released under licences that are suitable for inclusion in a game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Traditionally, most scripting languages in games have been created by developers specifically for their needs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In the last few years there has been a growing interest in off-the-shelf languages. </p>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Some commercial game engines include scripting language support ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Unreal </span>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Quake </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">by id Software, for example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Other than these complete solutions, most existing languages used </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">in games were not originally designed for this purpose.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They have associated advantages and disadvantages that need to be evaluated before you make a choice. </p>
<span origfont="g_font_13" data-canvas-width="68.33114112" style="left: 122.328px; top: 147.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03532); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.08856311999995" style="left: 122.615px; top: 177.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00946); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Advantages </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Off-the-shelf languages tend to be more complete and robust than a language you write yourself. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If you choose a fairly mature language, like those described below, you are benefiting from a lot of development time, debugging effort, and optimization that has been done by other people. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When you have deployed an off-the-shelf language, the development doesn’t stop.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A commu- nity of developers is likely to be continuing work on the language, improving it and removing bugs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Many open source languages provide web forums where problems can be discussed, bugs can be reported, and code samples can be downloaded.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This ongoing support can be invaluable in making sure your scripting system is robust and as bug free as possible. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many games, especially on the PC, are written with the intention of allowing consumers to edit their behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Customers building new objects, levels, or whole mods can prolong a game’s shelf life.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Using a scripting language that is common allows users to learn the language easily using tutorials, sample code, and command line interpreters that can be downloaded from the web.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most languages have newsgroups or web forums where customers can get advice without calling the publisher’s help line. </p>
<span origfont="g_font_13" data-canvas-width="86.28689510399998" style="left: 122.615px; top: 401.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05228); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.32527449599996" style="left: 122.376px; top: 431.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.992063); border-left: none;" yquantized="430" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Disadvantages </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When you create your own scripting language, you can make sure it does exactly what you want it to.Becausegamesaresensitivetomemoryandspeedlimitations,youcanputonlythefeaturesyou need into the language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As we’ve seen with re-entrancy, you can also add features that are specific to game applications and that wouldn’t normally be included in a general purpose language. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">By the same token, when things go wrong with the language, your staff knows how it is built and can usually find the bug and create a workaround faster. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whenever you include third-party code into your game,you are losing some control over it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most cases, the advantages outweigh the lack of flexibility, but for some projects control is a must. </p>
<span origfont="g_font_13" data-canvas-width="143.86409472" style="left: 122.615px; top: 569.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03499); border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="384.31048303200015" style="left: 122.615px; top: 599.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00869); border-left: none;" yquantized="590" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Open-Source Languages </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many popular game scripting languages are released under open-source licences. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Open-source software is released under a licence that gives users rights to include it in their own software without paying a fee.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some open-source licences require that the user release the newly created product open source.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These are obviously not suitable for commercial games. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Open-source software, as its name suggests, also allows access to see and change the source code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This makes it easy to attract studios by giving you the freedom to pull out any extraneous or inefficient code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some open-source licences, even those that allow you to use the language in commercial products, require that you release any modifications to the language itself.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This may be an issue for your project. </p>
<span origfont="g_font_7" data-canvas-width="132.374261712" style="left: 122.615px; top: 715.064px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00284); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whether or not a scripting language is open source, there are legal implications of using the languageinyourproject.Beforeusinganyoutsidetechnologyinaproductyouintendtodistribute (whether commercial or not), you should always consult a good intellectual property lawyer.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This book cannot properly advise you on the legal implications of using a third-party language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The following comments are intended as an indication of the kinds of things that might cause concern. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are many others. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With nobody selling you the software, nobody is responsible if the software goes wrong.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This could be a minor annoyance if a difficult-to-find bug arises during development.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It could be a major legal problem, however, if your software causes your customer’s PC to wipe its hard drive. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">With most open-source software, you are responsible for the behavior of the product. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When you licence technology from a company, the company normally acts as an insulation layer between you and being sued for breach of copyright or breach of patent.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A researcher, for example, who develops and patents a new technique has rights to its commercialization.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the same technique is implemented in a piece of software,without the researcher’s permission,he may have cause to take legal action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When you buy software from a company, it takes responsibility for the software’s content.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So, if the researcher comes after you, the company that sold you the software is usually liable for the breach (it depends on the contract you sign). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When you use open-source software,nobody is licencing the software to you,and because you didn’t write it, you don’t know if part of it was stolen or copied.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unless you are very careful, you will not know if it breaks any patents or other intellectual property rights.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The upshot is that you could be liable for the breach. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">You need to make sure you understand the legal implications of using"free"software.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is not always the cheapest or best choice, even though the up-front costs are very low.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Consult a lawyer before you make the commitment. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 465.178px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94441); border-left: none;" yquantized="460" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.10.4 </span>
<span origfont="g_font_7" data-canvas-width="459.032374056" style="left: 109.415px; top: 498.514px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07001); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Language Selection </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Everyone has a favorite language, and trying to back a single pre-built scripting language is impossible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Read any programming language newsgroup to find endless "my language is better than yours" flame wars. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Even so, it is a good idea to understand which languages are the usual suspects and what their strengths and weaknesses are.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Bear in mind that it is usually possible to hack, restructure, or rewrite existing languages to get around their obvious failings.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Many (probably most) commercial games developers using scripting languages do this.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The languages described below are discussed in their out-of-the-box forms. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll look at three languages in the order we would personally recommend them:Lua,Scheme, and Python. </p>
<span origfont="g_font_13" data-canvas-width="21.705861119999998" style="left: 109.415px; top: 670.269px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.98663); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.11845091999993" style="left: 109.415px; top: 700.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04583); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Lua </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Lua is a simple procedural language built from the ground up as an embedding language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The design of the language was motivated by extensibility.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unlike most embedded languages, this isn’t </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">limited to adding new functions or data types in C or C++.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The way the Lua language works can also be tweaked. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Lua has a small number of core libraries that provide basic functionality.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Its relatively feature- less core is part of the attraction, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In games you are unlikely to need libraries to process anything but maths and logic.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The small core is easy to learn and very flexible. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Lua does not support re-entrant functions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The whole interpreter (strictly the "state" object, which encapsulates the state of the interpreter) is a C++ object and is completely re-entrant.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Using multiple state objects can provide some re-entrancy support, at the cost of memory and lack of communication between them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Lua has the notion of"events"and"tags." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">"Events occur at certain points in a script’s execution: when two values are added together, when a function is called, when a hash table is queried, or when the garbage collector is run, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Routines in C++ or Lua can be registered against these events.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These "tag" routines are called when the event occurs, allowing the default behavior of Lua to be changed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This deep level of behavior modification makes Lua one of the most adjustable languages you can find. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The event and tag mechanism is used to provide rudimentary object-oriented support (Lua isn’t strictly object oriented, but you can adjust its behavior to get as close as you like to it), but it can also be used to expose complex C++ types to Lua or for tersely implementing memory management. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Another Lua feature beloved by C++ programmers is the "userdata" data type.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Lua supports common data types, such as floats, ints, and strings.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In addition, it supports a generic "userdata" with an associated sub-type (the "tag").  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By default, Lua doesn’t know how to do anything with userdata, but by using tag methods, any desired behavior can be added.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Userdata is commonly used to hold a C++ instance pointer.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This native handling of pointers can cause problems, but often means that far less interface code is needed to make Lua work with game objects. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For a scripting language,Lua is at the fast end of the scale.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has a very simple execution model that at peak is fast.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Combined with the ability to call C or C++ functions without lots of interface code, this means that real-world performance is impressive. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The syntax for Lua is recognizable for C and Pascal programmers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is not the easiest language to learn for artists and level designers, but its relative lack of syntax features means it is achievable for keen employees. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Despite its documentation being poorer than for the other two main languages here, Lua is the most widely used pre-built scripting language in games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The high-profile switch of Lucas Arts from its internal SCUMM language to Lua motivated a swathe of developers to investigate its capabilities. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">We started using Lua several years ago, and it is easy to see why it is rapidly becoming the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">de facto </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">standard for game scripting.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> To find out more, the best source of information is the Lua book </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Programming in Lua </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">[Ierusalimschy, 2006], which is also available free online. </p>
<span origfont="g_font_13" data-canvas-width="134.960818176" style="left: 122.615px; top: 670.269px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.07615); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.5673198879998" style="left: 122.615px; top: 700.713px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.995424); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scheme andVariations </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scheme is a scripting language derived from LISP, an old language that was used to build most of the classic AI systems prior to the 1990s (and many since, but without the same dominance). </p>
<span origfont="g_font_7" data-canvas-width="440.495960496" style="left: 122.615px; top: 715.107px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.008); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">ThefirstthingtonoticeaboutSchemeisitssyntax.ForprogrammersnotusedtoLISP,Scheme can be difficult to understand. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Brackets enclose function calls (and almost everything is a function call) and all other code blocks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This means that they can become very nested.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Good code indentation helps, but an editor that can check enclosing brackets is a must for serious development.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 203.54px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> For each set of brackets, the first element defines what the block does; it may be an arithmetic function: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 203.54px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" data-canvas-width="131.78009224800002" style="left: 109.415px; top: 230.599px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02155); border-left: none;" yquantized="230" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">(+ a 0.5) </p></pre>
<span origfont="g_font_7" data-canvas-width="131.78009224800002" style="left: 109.415px; top: 230.599px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02155); border-left: none;" yquantized="230" class="highlight4"></span>
<span origfont="g_font_35" data-canvas-width="145.25567999999996" style="left: 137.39px; top: 259.799px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> or a flow control statement: </p>
<span origfont="g_font_35" data-canvas-width="145.25567999999996" style="left: 137.39px; top: 259.799px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock2"></span>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> (if (&gt; a 1.0) (set!  </p>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> a 1.0)) </p><span origfont="g_font_7" data-canvas-width="441.07578381599996" style="left: 127.415px; top: 290.392px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.10823); border-left: none;" yquantized="290" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="441.07578381599996" style="left: 127.415px; top: 290.392px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.10823); border-left: none;" yquantized="290" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is easy for the computer to understand but runs counter to our natural language. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Non-programmers and those used to C-like languages can find it hard to think in Scheme for a while. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unlike Lua and Python, there are literally hundreds of versions of Scheme, not to mention other LISP variants suitable for use as an embedded language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each variant has its own trade- offs, which make it difficult to make generalizations about speed or memory use.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At their best, however (minischeme and tinyscheme come to mind), they can be very, very small (minischeme is less than 2500 lines of C code for the complete system, although it lacks some of the more exotic features of a full scheme implementation) and superbly easy to tweak.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The fastest imple- mentations can be as fast as any other scripting language, and compilation can typically be much more efficient than other languages (because the LISP syntax was originally designed for easy parsing). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Where Scheme really shines, however, is its flexibility.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no distinction in the lan- guage between code and data, which makes it easy to pass around scripts within Scheme, modify them, and then execute them later.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is no coincidence that most notable AI programs using the techniques in this book were originally written in LISP. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We have used Scheme a lot, enough to be able to see past its awkward syntax (many of us had to learn LISP as an AI undergraduate).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Professionally, we have never used Scheme unmodified in a game (although we know at least one studio that has), but we have built more languages based on Scheme than on any other language (six to date and one more on the way).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you plan to roll your own language, we would strongly recommend you first learn Scheme and read through a couple of simple implementations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It will probably open your eyes as to how easy a language can be to create. </p>
<span origfont="g_font_13" data-canvas-width="43.888017407999996" style="left: 109.415px; top: 641.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0972); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1363836" style="left: 109.415px; top: 671.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05307); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Python </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Python is an easy-to-learn, object-oriented scripting language with excellent extensibility and embedding support.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It provides excellent support for mixed language programming, including the ability to transparently call C and C++ from Python.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Python has support for re-entrant functions as part of the core language from version 2.2 onward (called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Generators </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">). </p>
<span origfont="g_font_7" data-canvas-width="7.2926231999999995" style="left: 497.048px; top: 715.094px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0418); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Python has a huge range of libraries available for it and has a very large base of users.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> Python users have a reputation for helpfulness, and the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">comp.lang.python </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">newsgroup is an excellent source of troubleshooting and advice. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Python’s major disadvantages are speed and size.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Although significant advances in execution speed have been made over the last few years,it can still be slow.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Python relies on hash table lookup (by string) for many of its fundamental operations (function calls,variable access,object-oriented programming).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This adds lots of overhead. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">While good programming practice can alleviate much of the speed problem, Python also has a reputation for being large.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because it has much more functionality than Lua, it is larger when linked into the game executable. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Python 2.X and further Python 2.3 releases added a lot of functionality to the language. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each additional release fulfilled more of Python’s promise as a software engineering tool, but by the same token made it less attractive as an embedded language for games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Earlier versions of Python were much better in this regard, and developers working with Python often prefer previous releases. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Python often appears strange to C or C++ programmers,because it uses indentation to group statements, just like the pseudo-code in this book. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This same feature makes it easier to learn for non-programmers who don’t have brackets to forget and who don’t go through the normal learning phase of not indenting their code. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Python is renowned for being a very readable language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even relatively novice programmers can quickly see what a script does.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> More recent additions to the Python syntax have damaged this reputation greatly, but it still seems to be somewhat above its competitors. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Of the scripting languages we have worked with,Python has been the easiest for level designers and artists to learn.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On a previous project we needed to use this feature but were frustrated by the speed and size issues.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our solution was to roll our own language (see the section below) but usePython syntax. </p>
<span origfont="g_font_13" data-canvas-width="87.06159206400001" style="left: 122.615px; top: 497.498px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.07483); border-left: none;" yquantized="490" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.900867736" style="left: 122.615px; top: 527.942px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04533); border-left: none;" yquantized="520" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Other Options </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is a whole host of other possible languages.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our experience each is either completely unused in games (to the best of our knowledge) or has significant weaknesses that make it a difficult choice over its competitors.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To our knowledge, none of the languages in this section has seen commercial use as an in-game scripting tool.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As usual, however, a team with a specific bias and a passion for one particular language can work around these limitations and get a usable result. </p>
<span origfont="g_font_8" data-canvas-width="17.445027839999998" style="left: 122.443px; top: 630.655px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.969237); border-left: none;" yquantized="630" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.06465288" style="left: 122.615px; top: 657.513px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.989011); border-left: none;" yquantized="650" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tcl </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tcl is a very well-used embeddable language.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It was designed to be an integration language,linking multiple systems written in different languages.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Tcl stands for Tool Control Language. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most of Tcl’s processing is based on strings, which can make execution very slow. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Another major drawback is its bizarre syntax, which takes some getting used to, and unlikeScheme it doesn’t hold the promise of extra functionality in the end.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Inconsistencies in the </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">syntax (such as argument passing by value or by name) are more serious flaws for the casual learner. </p>
<span origfont="g_font_8" data-canvas-width="23.48479488" style="left: 109.415px; top: 144.156px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.939392); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.4256975040001" style="left: 109.415px; top: 171.013px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01643); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Java </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Java is becoming ubiquitous in many programming domains.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because it is a compiled language, however, its use as a scripting language is restricted.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By the same token, however, it can be fast. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using JIT compiling (the byte code gets turned into native machine code before execution), it can approach C++ for speed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The execution environment is very large,however,and there is a sizeable memory footprint. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is the integration issues that are most serious, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Java Native Interface (that linksJava and C++ code) was designed for extending Java, rather than embedding it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can therefore be difficult to manage. </p>
<span origfont="g_font_8" data-canvas-width="56.53853184000001" style="left: 109.415px; top: 305.657px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.95828); border-left: none;" yquantized="300" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.32527449599996" style="left: 109.415px; top: 332.515px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02072); border-left: none;" yquantized="330" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">JavaScript </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">JavaScript is a scripting language designed for web pages.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It really has nothing to do with Java, other than its C++-like syntax. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There isn’t one standard JavaScript implementation,so developers who claim to use JavaScript are most likely rolling their own language based on the JavaScript syntax. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The major advantage of JavaScript is that it is known by many designers who have worked on the web.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Although its syntax loses lots of the elegance of Java, it is reasonably usable. </p>
<span origfont="g_font_8" data-canvas-width="28.276439039999996" style="left: 109.415px; top: 438.359px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.912143); border-left: none;" yquantized="430" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.85185174400016" style="left: 109.415px; top: 465.215px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07712); border-left: none;" yquantized="460" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Ruby </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Ruby is a very modern language with the same elegance of design found in Python, but its support for object-oriented idioms is more ingrained.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It has some neat features that make it able to manipulate its own code very efficiently.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be helpful when scripts have to call and modify the behavior of other scripts.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is not highly re-entrant from the C++ side, but it is very easy to create sophisticated re-entrancy from within Ruby. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is very easy to integrate with C code (not as easy as Lua,but easier than Python,for example). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rubyisonlybeginningtotakeoff,however,andhasn’treachedtheaudienceof theotherlanguages in this chapter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It hasn’t been used (modified or otherwise) in any game we have heard about.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> One weakness is its lack of documentation, although that may change rapidly as it gains wider use.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It’s a language we have resolved to follow closely for the next few years. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 638.575px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94441); border-left: none;" yquantized="630" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.10.5 </p>
<span origfont="g_font_7" data-canvas-width="458.9797715280001" style="left: 109.415px; top: 671.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03607); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rolling Your Own </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most game scripting languages are custom written for the job at hand.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While this is a long and complex procedure for a single game, the added control can be beneficial in the long run.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Studios developing a whole series of games using the same engine will effectively spread the development effort and cost over multiple titles. </p>
<span origfont="g_font_7" data-canvas-width="164.05054766400002" style="left: 109.415px; top: 715.094px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02032); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Regardless of the look and capabilities of the final language,scripts will pass through the same process on their way to being executed: all scripting languages must provide the same basic set of elements.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because these elements are so ubiquitous, tools have been developed and refined to make it easy to build them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is no way we can give a complete guide to building your own scripting language in this book.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are many other books on language construction (although, surprisingly, there aren’t any good books we know of on creating a scripting, rather than a fully compiled, language).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This section looks at the elements of scripting language construction from a very high level, as an aid to understanding rather than implementation. </p>
<span origfont="g_font_13" data-canvas-width="204.82844160000005" style="left: 122.615px; top: 257.64px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.00406); border-left: none;" yquantized="250" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.45917184" style="left: 122.615px; top: 288.083px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.001); border-left: none;" yquantized="280" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Stages of Language Processing </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Starting out as text in a text file,a script typically passes through four stages: tokenization,parsing, compiling, and interpretation. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The four stages form a pipeline, each modifying its input to convert it into a format more easily manipulated.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The stages may not happen one after another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> All steps can be interlinked, or sets of stages can form separate phases.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The script may be tokenized,parsed,and compiled offline, for example, for interpretation later. </p>
<span origfont="g_font_8" data-canvas-width="60.03901439999999" style="left: 122.443px; top: 397.452px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.95302); border-left: none;" yquantized="390" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0419381519998" style="left: 122.615px; top: 424.309px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01074); border-left: none;" yquantized="420" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tokenizing </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tokenizing identifies elements in the text.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A text file is just a sequence of characters (in the sense of ASCII characters!).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The tokenizer works out which bytes belong together and what kind of group they form. </p>
<span origfont="g_font_35" data-canvas-width="43.03872" style="left: 150.59px; top: 499.602px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">A string of the form: </p>
<span origfont="g_font_35" data-canvas-width="43.03872" style="left: 150.59px; top: 499.602px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> a = 3.2; </p><span origfont="g_font_7" data-canvas-width="128.699257824" style="left: 122.615px; top: 530.195px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00546); border-left: none;" yquantized="530" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="128.699257824" style="left: 122.615px; top: 530.195px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00546); border-left: none;" yquantized="530" class="highlight4"></span>
<span origfont="g_font_35" style="left: 140.615px; top: 554.868px; font-size: 14.9291px; font-family: monospace; border-left: none;" yquantized="550" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> can be split into six tokens: </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> a </span>
<span origfont="g_font_35" data-canvas-width="37.658879999999996" style="left: 140.615px; top: 576.496px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: none;" yquantized="570" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">text </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> &lt;space&gt; </span>
<span origfont="g_font_35" style="left: 140.615px; top: 598.122px; font-size: 14.9291px; font-family: monospace; border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">whitespace </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<span origfont="g_font_35" data-canvas-width="37.658879999999996" style="left: 140.615px; top: 619.75px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: none;" yquantized="610" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">equality operator </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> &lt;space&gt; </span>
<span origfont="g_font_35" data-canvas-width="16.13952" style="left: 140.615px; top: 641.376px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: none;" yquantized="640" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">whitespace </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 3.2 </span>
<span origfont="g_font_35" style="left: 140.615px; top: 663.003px; font-size: 14.9291px; font-family: monospace; border-left: none;" yquantized="660" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">floating point number </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> ; </span>
<span origfont="g_font_7" data-canvas-width="440.96699222399997" style="left: 140.615px; top: 686.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00269); border-left: none;" yquantized="680" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">end of statement identifierNotice that the tokenizer doesn’t work out how these fit together into meaningful chunks; that is the job of the parser. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The input to the tokenizer is a sequence of characters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The output is a sequence of tokens. </p>
<span origfont="g_font_7" data-canvas-width="426.1701401999999" style="left: 140.615px; top: 715.1px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01469); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Parsing </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Themeaningof aprogramisveryhierarchical:avariablenamemaybefoundinsideanassignment statement, found inside an IF-statement, which is inside a function body, inside a class definition, inside a namespace declaration, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The parser takes the sequence of tokens, identifies the role each plays in the program,and identifies the overall hierarchical structure of the program. </p>
<span origfont="g_font_35" data-canvas-width="96.83712000000001" style="left: 137.39px; top: 207.872px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">The line of code: </p>
<span origfont="g_font_35" data-canvas-width="96.83712000000001" style="left: 137.39px; top: 207.872px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> if (a &lt; b) return; </p><span origfont="g_font_7" data-canvas-width="165.5903671199999" style="left: 109.415px; top: 238.466px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02216); border-left: none;" yquantized="230" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="165.5903671199999" style="left: 109.415px; top: 238.466px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02216); border-left: none;" yquantized="230" class="highlight4"></span>
<span origfont="g_font_7" style="left: 112.524px; top: 273.963px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> converted into the token sequence: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 273.963px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight2" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 288.362px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">keyword(if), whitespace, open-brackets, name(a), operator(&lt;), </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">name(b), close-brackets, whitespace, keyword(return), end-of-statement </p><span origfont="g_font_7" data-canvas-width="361.84800806399994" style="left: 109.415px; top: 329.821px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.00513); border-left: none;" yquantized="320" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 3 </p></pre>
<span origfont="g_font_7" data-canvas-width="361.84800806399994" style="left: 109.415px; top: 329.821px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00513); border-left: none;" yquantized="320" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> is converted by the parser into a structure such as that shown in Figure 5.55. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">This hierarchical structure is known as the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">parse tree </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, or sometimes a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">syntax tree </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">or </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">abstract syntax tree </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(AST for short).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Parse trees in a full language may be more complex,adding additional layers for different types of symbol or for grouping statements together.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Typically, the parser will output additional data along with the tree, most notably a symbol table that identifies what variable or function names have been used in the code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is not essential.  </p>
<span origfont="g_font_21" data-canvas-width="43.7568" style="left: 329.954px; top: 473.61px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.0176); border-left: 50px solid blue;" yquantized="470" class="highlight2" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> Some languages </p>
<span origfont="g_font_21" data-canvas-width="43.7568" style="left: 329.954px; top: 473.61px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.0176); border-left: 50px solid blue;" yquantized="470" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_21" data-canvas-width="5.3376" style="left: 349.759px; top: 518.01px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.8896); border-left: 50px solid blue;" yquantized="510" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="91.536" style="left: 242.354px; top: 578.01px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01707); border-left: 50px solid blue;" yquantized="570" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" style="left: 284.95px; top: 621.21px; font-size: 9.6px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="620" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="99.6" style="left: 259.75px; top: 665.61px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(9.96); border-left: 50px solid blue;" yquantized="660" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="710" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">StatementIfBracketed expressionReturn &lt; ab </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.55 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">A parse tree </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">look up variable names dynamically when they run in the interpreter (Python does this, for example). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Syntax errors in the code show up during parsing because they make it impossible for the parser to build an output. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The parser doesn’t work out how the program should be run; that is the job of the compiler. </p>
<span origfont="g_font_8" data-canvas-width="58.317465600000006" style="left: 122.615px; top: 186.288px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.956024); border-left: none;" yquantized="180" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9953131839997" style="left: 122.615px; top: 213.145px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04); border-left: none;" yquantized="210" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Compiling </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The compiler turns the parse tree into byte code that can be run by the interpreter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Byte code is typically sequential binary data. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Non-optimizing compilers typically output byte code as a literal translation of the parse tree. </p>
<span origfont="g_font_7" style="left: 125.724px; top: 289.079px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">Soacodesuchas: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 289.079px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">a=3; if (a &lt; 0) return 1; </p><span origfont="g_font_7" style="left: 125.724px; top: 317.879px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" data-canvas-width="116.23963176000001" style="left: 122.615px; top: 344.938px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02867); border-left: none;" yquantized="340" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">else return 0; </p></pre>
<span origfont="g_font_7" data-canvas-width="116.23963176000001" style="left: 122.615px; top: 344.938px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02867); border-left: none;" yquantized="340" class="highlight3"></span>
<span origfont="g_font_35" data-canvas-width="32.27904" style="left: 161.35px; top: 377.032px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> could get compiled into: </p>
<span origfont="g_font_35" data-canvas-width="32.27904" style="left: 161.35px; top: 377.032px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> load 3 </p><span origfont="g_font_7" style="left: 125.724px; top: 394.967px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><span origfont="g_font_7" style="left: 125.724px; top: 409.367px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">set-value-of a </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 423.767px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="420" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">get-value-of a </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 438.167px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">compare-with-zero </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if-greater-jump-to LABEL load 1 </p><span origfont="g_font_7" style="left: 125.724px; top: 466.967px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">returnLABEL: </p><span origfont="g_font_7" style="left: 125.724px; top: 495.767px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">load 0 return </p><span origfont="g_font_7" data-canvas-width="440.8952615040001" style="left: 140.615px; top: 537.225px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.05477); border-left: none;" yquantized="530" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 10 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.8952615040001" style="left: 140.615px; top: 537.225px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05477); border-left: none;" yquantized="530" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Optimizing compilers try to understand the program and make use of prior knowledge to make the generated code faster.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> An optimizing compiler may notice that </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">a </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">must be 3 when theIF-statement above is encountered.  </p>
<span origfont="g_font_35" data-canvas-width="32.27904" style="left: 150.59px; top: 598.119px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> It can therefore generate: </p>
<span origfont="g_font_35" data-canvas-width="32.27904" style="left: 150.59px; top: 598.119px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="590" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> load 3 </p><span origfont="g_font_7" style="left: 125.724px; top: 616.054px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">set-value-of a load 0 </p><span origfont="g_font_7" style="left: 125.724px; top: 644.854px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" data-canvas-width="441.03035436000005" style="left: 140.615px; top: 671.913px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.0407); border-left: none;" yquantized="670" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return </p></pre>
<span origfont="g_font_7" data-canvas-width="441.03035436000005" style="left: 140.615px; top: 671.913px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0407); border-left: none;" yquantized="670" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Building an efficient compiler is well beyond the scope of this book.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Simple compilers are not difficult to build, but don’t underestimate the effort and experience needed to build a good solution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are many hundreds of home-brewed languages out there with pathetic compilers. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve seen it very many times. </p>
<span origfont="g_font_7" data-canvas-width="145.21286508000003" style="left: 122.383px; top: 715.094px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.987553); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tokenizing, parsing, and compiling are often done offline and are usually called "compiling," even though the process includes all three stages.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The generated byte code can then be stored and interpreted at runtime.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The parser and compiler can be large, and it makes sense not to have the overhead of these modules in the final game. </p>
<span origfont="g_font_8" data-canvas-width="66.216505344" style="left: 109.415px; top: 170.964px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.988306); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.3982007280002" style="left: 109.415px; top: 197.821px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00745); border-left: none;" yquantized="190" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Interpreting </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The final stage of the pipeline runs the byte code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a compiler for a language such as C or C++, the final product will be machine instructions that can be directly run by the processor.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a scripting language, you often need to provide services (such as re-entrancy and secure execution) that are not easily achieved with machine language. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The final byte code is run on a"virtual machine." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">"This is effectively an emulator for a machine that has never existed in hardware. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">You decide the instructions that the machine can execute, and these are the byte code instruc- tions.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 334.118px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> In the previous example, </p>
<span origfont="g_font_7" style="left: 112.524px; top: 334.118px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="330" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 348.518px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">load &lt;value&gt; </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">set-value-of &lt;variable&gt; get-value-of &lt;variable&gt; </p><span origfont="g_font_7" style="left: 112.524px; top: 377.318px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">compare-with-zero if-greater-jump-to &lt;location&gt; </p><span origfont="g_font_7" style="left: 112.524px; top: 406.118px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><span origfont="g_font_7" data-canvas-width="83.714532288" style="left: 109.415px; top: 433.177px; font-size: 11.9551px; font-family: serif; transform: scaleX(0.996602); border-left: none;" yquantized="430" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return </p></pre>
<span origfont="g_font_7" data-canvas-width="83.714532288" style="left: 109.415px; top: 433.177px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.996602); border-left: none;" yquantized="430" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> are all byte codes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Your byte code instructions don’t have to be limited to those that might be seen in real hardware, either.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For example, there may be a byte code for "turn the data into a set of game coordinates": the kind of instruction that makes your compiler easier to create but that no real hardware would ever need. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most virtual machines consist of a big switch statement in C: each byte code has a short bit ofC code that gets executed when the byte code is reached in the interpreter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So the"add"byte code has a bit of C/C++ code that performs the addition operation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our conversion example may have two or three lines of C++ to perform the required conversion and copy the results back into the appropriate place. </p>
<span origfont="g_font_8" data-canvas-width="132.9179136" style="left: 109.415px; top: 594.629px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.959725); border-left: none;" yquantized="590" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1064957999998" style="left: 109.415px; top: 621.485px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.998058); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Just-in-Time Compiling </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because of the highly sequential nature of byte code,it is possible to write a virtual machine that is very fast at running it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even though it is still interpreted, it is many times faster than interpreting the source language a line at a time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is possible to remove the interpretation step entirely, however, by adding an additional compilation step.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Some byte code can be compiled into the machine language of the target hardware.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When this is done in the virtual machine, just before execution, it is called </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">just-in-time </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (JIT) compiling.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is not common in game scripting languages but is a mainstay of languages </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tools:A Quick Look at Lex andYacc </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Lex andYacc are the two principal tools used in building tokenizers and parsers,respectively.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each has many different implementations and is provided with most UNIX distributions (versions are available for other platforms, too).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The Linux variants we have most often used are Flex andBison. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To create a tokenizer with Lex, you tell it what makes up different tokens in your language. </p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">What constitutes a number, for example (even this differs from language to language—compare </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> − </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0.4f to 1.2e9).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It produces C code that will convert the text stream from your program into a stream of token codes and token data.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The software it generates is almost certainly better and faster than that you could write yourself. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Yacc builds parsers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It takes a representation of the grammar of your language—what tokens make sense together and what large structures can be made up of smaller ones, for example.  </p>
<span origfont="g_font_35" data-canvas-width="172.15488" style="left: 150.59px; top: 329.42px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="320" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> This grammar is given in a set of rules that show how larger structures are made from simpler ones or from tokens, for example: </p>
<span origfont="g_font_35" data-canvas-width="172.15488" style="left: 150.59px; top: 329.42px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="320" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> assignment: NAME ‘=’ expression; </p><span origfont="g_font_7" data-canvas-width="184.95527049600003" style="left: 140.615px; top: 360.014px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01177); border-left: none;" yquantized="360" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 1 </p></pre>
<span origfont="g_font_7" data-canvas-width="184.95527049600003" style="left: 140.615px; top: 360.014px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01177); border-left: none;" yquantized="360" class="highlight2"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">This rule tells Yacc that when it finds a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">NAME </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">token, followed by an equals sign, followed by a structure it knows as an expression (for which there will be a recognizer rule elsewhere), then it knows it has an assignment. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Yacc also generates C code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most cases, the resulting software is as good as or better than you would create manually, unless you are experienced with writing parsers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unlike Lex, the final code can often be further optimized if speed is absolutely critical.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Fortunately, for game scripting the code can usually be compiled when the game is not being played, so the slight inefficiency is not important. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Both Lex and Yacc allow you to add your own C code to the tokenizing or parsing software. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">There isn’t a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">de facto </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">standard tool for doing the compiling, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Depending on the way the language will behave, this will vary widely.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is very common to have Yacc build an AST for the compilertoworkon,however,andtherearevarioustoolstodothis,eachwiththeirownparticular output format. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many Yacc-based compilers don’t need to create a syntax tree.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They can create byte code output from within the rules using C code written into the Yacc file.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As soon as an assignment is found, for example, its byte code is output.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is very difficult to create optimizing compilers this way, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So if you intend to create a professional solution, it is worth heading directly for a parse tree of some kind. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 97.5154px; top: 645.749px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94441); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.10.6 </span>
<span origfont="g_font_7" data-canvas-width="458.62111792799993" style="left: 122.615px; top: 679.086px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00183); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripting Languages and Other AI </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If you make the effort to build a scripting language into your game,chances are it will run most of your AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most of the other techniques in this book will not need to be coded into your game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can seem appealing at first, but you should still have a general purpose language for the heavy </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is a successful approach taken by many commercial studios.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Typically, some extra AI is provided (normally a pathfinding engine, for example) for very processor intensive needs. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">But in our opinion it misses the point of establishedAI techniques.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They exist because they are elegant solutions to behavior problems, not because programming in C++ is inconvenient.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Even if you go to a scripting language, you have to think about the algorithms used in the character scripts.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Writing </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">ad hoc </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">code in scripts can rapidly become as difficult to debug as writing it inC++ (more so in fact, since scripting languages often have much less mature debugging tools). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Several developers we know have fallen into this trap, assuming that a scripting language means they don’t need to think about the way characters are implemented.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even if you are using a scripting language, we’d advise you to think about the architecture and algorithms you use in those scripts.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It may be that the script can implement one of the other techniques in this chapter, or it may be that a separate dedicated C++ implementation would be more practical alongside or instead of the scripting language. </p>
<span origfont="g_font_15" data-canvas-width="47.34239399999999" style="left: 76.4726px; top: 304.056px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.963364); border-left: none;" yquantized="300" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 5.11 </p>
<span origfont="g_font_7" data-canvas-width="459.03835161600017" style="left: 109.415px; top: 345.88px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00446); border-left: none;" yquantized="340" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action Execution </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Throughout this chapter we’ve talked about actions as if it were clear what they were.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Everything from decision trees to rule-based systems generates actions,and we’ve avoided being clear on what format they might take. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many developers don’t work with actions as a distinct concept.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The result of each decision making technique is simply a snippet of code that calls some function, tweaks some state variable, or asks a different bit of the game (AI, physics, rendering, whatever) to perform some task. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the other hand, it can be beneficial to handle a character’s actions through a central piece of code.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It makes the capabilities of a character explicit, makes the game more flexible (you can add and remove new types of actions easily), and can aid hugely in debugging the AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This calls for a distinct concept for actions, with a distinct algorithm to manage and run them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This section looks at actions in general and how they can be scheduled and executed through a general action manager.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The discussion about how different types of actions are executed is relevant, even to projects that don’t use a central execution manager. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 552.121px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.958639); border-left: none;" yquantized="550" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.11.1 </span>
<span origfont="g_font_7" data-canvas-width="459.1339925759999" style="left: 109.176px; top: 585.459px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05055); border-left: none;" yquantized="580" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Types of Action </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can divide the kind of actions that result from AI decisions into four flavors: state change actions, animations, movement, and AI requests. </p>
<span origfont="g_font_13" data-canvas-width="99.32313696000001" style="left: 127.42px; top: 614.247px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04551); border-left: none;" yquantized="610" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State change actions </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">are the simplest kind of action, simply changing some piece of the game state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is often not directly visible to the player.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character may change the firing mode of its weapon, for example, or use one of its health packs.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most games, these changes only have associated animations or visual feedback when the player carries them out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For other characters, they simply involve a change in a variable somewhere in the game’s state. </p>
<span origfont="g_font_13" data-canvas-width="58.532267520000005" style="left: 127.192px; top: 686.229px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06422); border-left: none;" yquantized="680" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Animations </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">are the most primitive kind of visual feedback.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This might be a particle effect when a character casts a spell or a quick shuffle of the hands to indicate a weapon reload.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Often, combat is simply a matter of animation, whether it be the recoil from a gun, sheltering behind a </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Animations may be more spectacular.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We might request an in-engine cutscene, sending the camera along some predefined track and coordinating the movement of many characters. </p>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Actions may also require the character to make some </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">movement </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">through the game level. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Although it isn’t always clear where an animation leaves off and movement begins,we are thinking aboutlargerscalemovementhere.Adecisionmakerthattellsacharactertorunforcover,tocollect a nearby power-up, or to chase after an enemy is producing a movement action. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">In Chapter 3 on movement algorithms we saw the kind of AI that converts this kind of high- level movement request (sometimes called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">staging </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) into primitive actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These primitive actions (e.g., apply such-and-such a force in such-and-such a direction) can then be passed to the game physics, or an animation controller, to execute. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Although these movement algorithms are typically considered part of AI, we’re treating them here as if they are just a single action that can be executed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a game, they will be executed by calling the appropriate algorithms and passing the results onto the physics or animation layer.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In other words, they will usually be implemented in terms of the next type of action. </p>
<span origfont="g_font_13" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">In </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">AIrequests </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">forcomplexcharacters,ahigh-leveldecisionmakermaybetaskedwithdeciding which lower level decision maker to use.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> TheAI controlling one team in a real-time strategy game, for example, may decide that it is time to build.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A different AI may actually decide which building gets to be constructed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In squad-based games, several tiers of AI are possible, with the output from one level guiding the next level (we will cover specific tactical and strategic AI techniques inChapter 6). </p>
<span origfont="g_font_13" data-canvas-width="90.90208051200001" style="left: 122.328px; top: 411.014px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.988066); border-left: none;" yquantized="410" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.983358064" style="left: 122.615px; top: 441.458px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01321); border-left: none;" yquantized="440" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Single Action </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The action that is output from a decision making tool may combine any or all of these flavors.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In fact, most actions have at least two of these components to them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Reloading a weapon involves both a state change (replenishing ammo in the gun from the overall total belonging to the character) and an animation (the hand shuffle).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Running for cover may involve an AI request (to a pathfinder), movement (following the path), and animation (waving hands over head in panic).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Deciding to build something may involve more AI (choosing what to build) and animation (the construction yard’s chimney starts smoking). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions involving any animation or movement take time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> State changes may be immediate, and anAI request can be honored straight away,but most actions will take some time to complete. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A general action manager will need to cope with actions that take time; we can’t simply complete the action in an instant. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many developers engineer their AI so that the decision maker keeps scheduling the same action every frame (or every time it is called) until the action is completed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This has the advantage that the action can be interrupted at any time (see the next section), but it means that the decision making system is being constantly processed and may have to be more complex than necessary. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Take, for example, a state machine with a sleeping and on-guard state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the character wakes up,it will need to carry out a"wake-up"action,probably involving an animation and maybe some movement.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, when a character decides to take a nap, it will need a "go-to-sleep" action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we need to continually wake up or go to sleep every frame, then the state machine will </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">[Rested]SleepWake-up [Go-to-sleep[Wake-up animationanimation complete]complete]Go-to-sleepOn guard [Tired] </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.56 </span><span origfont="g_font_7" data-canvas-width="440.8115756640002" style="left: 127.416px; top: 306.471px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02328); border-left: none;" yquantized="300" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="440.8115756640002" style="left: 127.416px; top: 306.471px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02328); border-left: none;" yquantized="300" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">State machine with transition statesThis isn’t a problem when we only have two states to transition between, but allowing tran- sitions between five states would involve 40 additional transition states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It soon scales out of control. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If wecansupportactionswithsomeduration,thenthewake-upactionwillsimplyberequested on exiting the sleep state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The go-to-sleep action will likewise be carried out when entering the sleep state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case, the state machine doesn’t need continual processing.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> After it signals that it is waking up, we can wait until the character has played its waking animation before moving onto the next thing. </p>
<span origfont="g_font_13" data-canvas-width="123.32171366400001" style="left: 109.415px; top: 440.736px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.06312); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9929221600001" style="left: 109.415px; top: 471.181px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02963); border-left: none;" yquantized="470" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Interrupting Actions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because actions take time, they may start off being sensible things to do, but may end up being stupid long before the action is complete.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a character is sent wandering off toward a power-up, it will appear silly if it carries on toward the power-up after a squad of enemy units spring their ambush: it’s time to stop going after the power-up and run away. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If a decision making system decides that an important action is needed, then it should be able to trump other actions currently being carried out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most games allow such emergencies to even break the consistency of animation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While in normal circumstances a whole anima- tion is played, if the character needs to do a rapid volte-face, the animation can be interrupted for another (possibly with a couple of frames of blending between them to avoid a distinct jump). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our action manager should allow actions with higher importance to interrupt the execution of others. </p>
<span origfont="g_font_13" data-canvas-width="115.92479232000002" style="left: 109.415px; top: 663.042px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04437); border-left: none;" yquantized="660" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9642298719999" style="left: 109.415px; top: 693.485px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02677); border-left: none;" yquantized="690" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Compound Actions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is rare for a character in a game to be doing only one thing at a time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The action of a character is typically layered.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They might be playing a "make-obscene-gesture" animation, while moving </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is a common implementation strategy to split these actions up so they are generated by different decision making processes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might use one simple decision maker to monitor health levels and schedule the use of a health pack when things look dangerous.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might use another decision maker to choose which enemy to pursue.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This could then hand-off to a pathfinding routine to work out a pursuit route.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In turn, this might use some other AI to work out how to follow the route and yet another piece of code to schedule the correct animations. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this scenario, each decision making system is outputting one action of a very particular form.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The action manager needs to accumulate all these actions and determine which ones can be layered. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An alternative is to have decision makers that output compound actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a strategy game, for example, we may need to coordinate several actions in order to be successful.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The decision making system might decide to launch a small attack at a strong point in the enemy defense,while making a full-strength flanking assault.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Both actions need to be carried out together.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It would be difficult to coordinate separate decision making routines to get this effect. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In these cases the action returned from a decision making system will need to be made up of several atomic actions, all of which are to be executed at the same time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is an obvious requirement, but one close to our hearts.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> One AI system we know of ignored the need for compound actions until late in the development schedule.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Eventually, the decision making tool (including its loading and saving formats, the connections into the rest of the game code, and the bindings to the scripting language and other tools) needed rewriting, a major headache we could have avoided. </p>
<span origfont="g_font_13" data-canvas-width="97.64768255999999" style="left: 122.615px; top: 418.242px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02787); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.06465288000004" style="left: 122.615px; top: 448.685px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03626); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripted Actions </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Developers and (more commonly) games journalists occasionally talk about "scripted AI" in a way that has nothing to do with scripting languages.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Scripted AI in this context usually means a set of pre-programmed actions that will always be carried out in sequence by a character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no decision making involved; the script is always run from the start. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For example, a scientist character may be placed in a room.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When the player enters the room, the script starts running.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character rushes to a computer bank, starts the self-destruct sequence, and then runs for the door and escapes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripting the behavior in this way allows developers to give the impression of better AI than would be possible if the character needed to make its own decisions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character can be scripted to act spitefully, recklessly, or secretly, all without any AI effort. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This kind of scripted behavior is less common in current games because the player often has the potential to disrupt the action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our example, if the player immediately runs for the door and stands there, the scientist may not be able to escape, but the script won’t allow the scientist to react sensibly to the blockage.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For this reason, these kinds of scripted actions are often limited to in-game cutscenes in recent games. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripted behavior has been used for many years in a different guise without removing the need for decision making. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Primitive actions (such as move to a point,play an animation,or shoot) can be combined into short scripts that can then be treated as a single action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A decision making system can decide to </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Forexample,itiscommoninshootersforenemycharacterstousecovercorrectlyinafirefight. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A character may lay down a burst of suppressing fire before rolling out of cover and running for its next cover point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This script (fire, roll, run) can be treated as a whole, and the decision making system can request the whole sequence. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The sequence of actions becomes a single action as far as the decision making technique is concerned.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It doesn’t need to request each component in turn.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The"run to new cover"action will contain each element. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach gives some of the advantages of the scripted AI approach,while not putting the character at the mercy of a changing game environment.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the character gets blocked or thwarted in the middle of its script, it can always use its decision making algorithms to choose another course of action. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Scripted actions are similar to compound actions,but their elements are executed in sequence. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we allow compound actions to be part of the sequence, then the character can perform any number of actions at the same time and any number of actions in sequence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This gives us a powerful mechanism. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will return to scripted actions in Chapter 6.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When it comes to coordinating the actions of several characters at the same time, scripted actions can be a crucial technology, but they need to have several characteristics that we’ll discuss in Section 6.4.3. </p>
<span origfont="g_font_8" data-canvas-width="107.005734912" style="left: 109.243px; top: 376.623px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.922463); border-left: none;" yquantized="370" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0108548399999" style="left: 109.415px; top: 403.48px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01104); border-left: none;" yquantized="400" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An Aside on Scripts </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our opinion,this kind of action script is an essential element of modern game AI development. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It may seem like we’re belaboring an obvious point here,but the industry has known about scripts for a long time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They aren’t new and they aren’t clever, so what’s all the fuss about? </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our experience has shown that developers regularly get caught up in researching new tech- nologies to provide results that would be more cheaply and reliably achieved with this"low-tech" approach.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A number of developers we’ve seen have experimented with higher level decision mak- ing techniques intended to give the illusion of a deeper intelligence (such as neural networks and emotional and cognitive modeling), none of which gives convincing results at the current state of the art. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Companies such asValve and EA have realized that most of the effect can be achieved without the technical headaches and for a fraction of the cost using decision scripts of this kind. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">While they could be seen as a hacked approach, it is difficult to overestimate their practical value,especiallyconsideringhoweasytheyaretoimplement.Toooftentheyaredismissedbecause of the bad reputation of scripted AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our advice is to use them freely, but don’t brag about it on the box! </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 652.975px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.958639); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.11.2 </span>
<span origfont="g_font_7" data-canvas-width="459.38265907200014" style="left: 109.176px; top: 686.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00559); border-left: none;" yquantized="680" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We will deal with three different types of action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Primitive actions represent state changes, anima- tions, movement, and AI requests.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this implementation the action is responsible for carrying out its effect.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The implementation notes discussed later cover this assumption in more detail.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">addition to primitive actions, we will support compound actions of two types: action combina- tions and action sequences. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action combinations provide any set of actions that should be carried out together.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A reload action, for example, may consist of one animation action (play the shuffle-hands animation, for example) and a state change action (reset the ammo in the current weapon).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We assume that all actions in a combination can be executed at the same time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action sequences are identical in structure to action combinations but are treated as a sequen- tialsetof actionstocarryout,oneafteranother.Thesequencewaitsuntilitsfirstactioniscomplete before going on to another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Action sequences can be used for actions such as "pull door lever," which involves movement (go to the lever) followed by animation (pull the lever) followed by a state change (change the door’s locked status).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The actions in an action sequence can be action combinations (i.e., carry out a bunch of actions all together, then another bunch, and so on) or vice versa.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Compound actions can be nested in any combination to any depth. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Every action (primitive or compound) has an expiry time and a priority.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The expiry time controls how long the action should be queued before it is discarded, and the priority controls whether an action has priority over another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In addition, it has methods that we can use to check if it has completed, if it can be executed at the same time as another action, or if it should interrupt currently executing actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Action sequences keep track of their component action that is currently active and are responsible for updating this record as each subsequent action completes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The action manager contains two groups of actions: the queue is where actions are initially placedandwaituntiltheycanbeexecuted,andtheactivesetisagroupof actionsthatarecurrently being executed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Actions from any source are passed to the action manager where they join the queue.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The queue is processed, and high-priority actions are moved to the active set, as many as can be executed at the same time, in decreasing order of priority.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> At each frame, the active actions are executed, and if they complete, they are removed from the set. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If an item is added to the queue and wants to interrupt the currently executing actions, then it is checked for priority.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it has higher priority than the currently executing actions, it is allowed to interrupt and is placed in the active set. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If there are no currently executing actions (they have been completed), then the highest priority action is moved out of the queue into the active set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The manager then adds the next highest priority action if it can be simultaneously executed, and so on until no more actions can be added to the currently active set. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 97.5154px; top: 607.192px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.958639); border-left: none;" yquantized="600" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.11.3 </p>
<span origfont="g_font_7" data-canvas-width="292.0755367199999" style="left: 122.615px; top: 640.528px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02483); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 125.724px; top: 676.157px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight3" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The action manager implementation looks like the following: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 676.157px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 690.557px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">class ActionManager: </p><span origfont="g_font_7" style="left: 125.724px; top: 704.957px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Holds the queue of pending actions queue </p></pre>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">5 6 </span><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># The currently executing actions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 143.356px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="140" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">active </p><span origfont="g_font_7" style="left: 112.524px; top: 157.756px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="150" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># The current time, a simple counter in this case currentTime </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 11 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Adds an action to the queue </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def scheduleAction(action): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Add it to the queue. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 272.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="270" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">queue += action </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Processes the manager. </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def execute(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Update the time </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">currentTime += 1 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Go through the queue to find interrupters </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 402.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for action in queue: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 416.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 27 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># If we drop below active priority, give up if action.priority &lt;= active.getHighestPriority(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 445.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 28 29 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 460.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="460" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">break </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 31 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 488.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># If we have an interrupter, interrupt </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if action.canInterrupt(): active.clear() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 517.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 33 34 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 532.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">active = [action] </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 546.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 35 36 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Try to add as many actions to active set as possible for action in copy(queue): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 575.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 589.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 37 38 39 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 604.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Check if the action has timed out </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 40 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 618.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if action.expiryTime &lt; currentTime: </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 41 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Remove it from the queue </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 647.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 42 43 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 661.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">queue -= action </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 676.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 44 45 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check if we can combine for activeAction in active: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 704.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 46 47 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">if not action.canDoBoth(activeAction): break continue # i.e., go to next action in queue </p></pre>
</html></html><html><html><pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400; display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">49 50 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Move the action to the active set </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 51 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">queue -= action active += action </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 52 53 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Process the active set </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 54 55 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="200" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for activeAction in copy(active): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 56 57 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Remove completed actions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 58 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if activeAction.isComplete(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 59 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">active -= activeAction </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 60 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Execute others </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 61 62 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">else: activeAction.execute() </p><span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 328.815px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="320" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 63 </p></pre>
<span origfont="g_font_7" data-canvas-width="18.67389744" style="left: 140.615px; top: 328.815px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03744); border-left: none;" yquantized="320" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">execute </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">function performs all the scheduling, queue processing, and action execution. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">scheduleAction </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">function simply adds a new action to the queue. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">copy </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">function creates a copy of a list of actions (either the queue or the active set).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is needed in both top-level loops in the process function because items may be removed from the list within the loop. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 97.5154px; top: 429.436px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.958639); border-left: none;" yquantized="420" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.11.4 </p>
<span origfont="g_font_7" data-canvas-width="399.57597575999995" style="left: 122.615px; top: 462.773px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02193); border-left: none;" yquantized="460" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<span origfont="g_font_7" style="left: 125.724px; top: 498.401px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The action manager relies on a general action structure with the following interface: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 498.401px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct Action: expiryTime </p><span origfont="g_font_7" style="left: 125.724px; top: 527.201px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">priority def canInterrupt() </p><span origfont="g_font_7" style="left: 125.724px; top: 556.001px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="550" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 5 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def canDoBoth(otherAction) def isComplete() </p><span origfont="g_font_7" data-canvas-width="440.97057875999985" style="left: 140.615px; top: 597.46px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04549); border-left: none;" yquantized="590" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 6 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.97057875999985" style="left: 140.615px; top: 597.46px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04549); border-left: none;" yquantized="590" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Fundamental actions will have different implementations for each method.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The compound actions can be implemented as sub-classes of this base </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_35" data-canvas-width="182.91456" style="left: 150.59px; top: 658.222px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">Action combinations can be implemented as: </p>
<span origfont="g_font_35" data-canvas-width="182.91456" style="left: 150.59px; top: 658.222px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> struct ActionCombination (Action): </p><span origfont="g_font_7" style="left: 125.724px; top: 676.157px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Holds the sub-actions </p><span origfont="g_font_7" style="left: 125.724px; top: 704.957px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="700" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">actions </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">def canInterrupt(): </p>
<span origfont="g_font_7" style="left: 112.524px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" style="left: 112.524px; top: 114.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 112.524px; top: 128.956px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># We can interrupt if any of our sub-actions can </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for action in actions: if action.canInterrupt(): return true </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return false </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def canDoBoth(otherAction): # We can do both if all of our sub-actions can </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">for action in actions: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">if not action.canDoBoth(otherAction): return false </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return true </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def isComplete(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 19 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># We are complete if all of our sub-actions are for action in actions: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 316.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 21 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not action.isComplete(): return false return true </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 344.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 359.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="350" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 373.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">def execute(): </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 388.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="380" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Execute all of our sub-actions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 </span><span origfont="g_font_7" data-canvas-width="441.36509771999994" style="left: 127.176px; top: 415.215px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.01697); border-left: none;" yquantized="410" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">for action in actions: action.execute() </p></pre>
<span origfont="g_font_7" data-canvas-width="441.36509771999994" style="left: 127.176px; top: 415.215px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01697); border-left: none;" yquantized="410" class="highlight2"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Action sequences are just as simple.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They only expose one sub-action at a time.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 465.112px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> They can be implemented as: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 465.112px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight4" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 479.512px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="470" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">struct ActionSequence (Action): </p><span origfont="g_font_7" style="left: 112.524px; top: 493.912px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="490" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 508.312px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Holds the sub-actions </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 522.712px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="520" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions </p><span origfont="g_font_7" style="left: 112.524px; top: 537.112px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Holds the index of the currently executing sub-action activeIndex = 0 </p><span origfont="g_font_7" style="left: 112.524px; top: 565.912px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="560" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def canInterrupt(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 594.712px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 609.112px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="600" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># We can interrupt if our first sub-actions can </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 623.512px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="620" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return actions[0].canInterrupt() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 637.912px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="630" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def canDoBoth(otherAction): # We can do both if all of our sub-actions can </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 666.712px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># If we only tested the first one, we’d be in danger # of suddenly finding ourselves incompatible </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 695.512px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="690" class="highlight2" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 709.912px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight4" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># mid-sequence </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">for action in actions: </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">if not action.canDoBoth(otherAction): return false </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">return true </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def isComplete(): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># We are complete if all of our sub-actions are return activeIndex &gt;= len(actions) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 25 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def execute() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 27 28 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Execute our current action </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">actions[activeIndex].execute() </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # If our current action is complete, go to the next </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 31 32 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if actions[activeIndex].isComplete(): activeIndex += 1 </p><span origfont="g_font_7" data-canvas-width="386.1121196160002" style="left: 140.615px; top: 328.815px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02417); border-left: none;" yquantized="320" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 33 </p></pre>
<span origfont="g_font_7" data-canvas-width="386.1121196160002" style="left: 140.615px; top: 328.815px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02417); border-left: none;" yquantized="320" class="highlight4"></span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">In addition to the action structures,the manager algorithm has two list structures: </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">active </span>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">and </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> queue </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, both of which keep their component actions in decreasing priority order at all times.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For actions with identical priority values, the order is undefined.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Marginally better performance can be gained by ordering identical priorities by increasing expiry time (i.e., those closer to expiring are nearer the front of the list). </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">In addition to its list-like behavior (adding and removing items,the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">clear </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">method),the active list has one method: </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">getHighestPriority </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">returns the priority of the highest priority action (i.e., the first in the list). </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 97.5154px; top: 482.62px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.958639); border-left: none;" yquantized="480" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.11.5 </span>
<span origfont="g_font_7" data-canvas-width="458.9917266479999" style="left: 122.615px; top: 515.957px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03377); border-left: none;" yquantized="510" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Implementation Notes </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The active and queue lists should be implemented as priority heaps: data structures that always retain their content in priority order.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Priority heaps are a standard data structure detailed in any algorithms text.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> They are discussed in more detail in Chapter 4. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">We have assumed in this algorithm that actions can be executed by calling their </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">execute </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> method.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This follows the polymorphic structure used for algorithms throughout the book.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It may seem odd to have created an action manager so that decision makers weren’t running arbitrary bits of code, only to then have the actions call an opaque method. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As we saw at the start of this section,actions typically come in four flavors.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A full implementa- tion, such as the one given on the website, has four types of actions, one for each flavor.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400; display: inline;"> Each type of action is executed in a different way by the game: state changes are simply applied to the game state, animations are handled by an animation controller, movement is handled by movement </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Library </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">algorithms found later in this book,andAI requests can be processed by any other decision maker. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The code on the website uses only four classes, one for each action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Parameters within each of those classes determine how the action is executed. </p>
<span origfont="g_font_7" data-canvas-width="241.85446862399994" style="left: 122.615px; top: 703.133px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00773); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Debugging </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">One major advantage with channeling all character actions through a central point is the ability to add simple reporting and logging for debugging.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the execute method of each action class we can add code that outputs logging data: the action can carry with it any information that might help debugging (e.g., the decision maker that gave rise to the action, the time it was added to the queue, whether it is complete or not, and so on). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our experience in trying to debug decentralized AI has led us to come back to a centralized action system on many occasions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We feel that debugging is the best reason to always use some kind of centralized approach, whether it is as complete as the one above or it is a simple first-in first-out queue. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 278.548px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.958639); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.11.6 </p>
<span origfont="g_font_7" data-canvas-width="94.30198656000002" style="left: 109.415px; top: 311.885px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.014); border-left: none;" yquantized="310" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Performance </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">n </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in memory, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the maximum number of actions in the queue.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The algorithmassumesthatactionproducerswillbehavenicely.If anactionproducerdumpsanaction in the queue every frame, then the queue can rapidly grow unwieldy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The expiry time mechanism will help, but probably not fast enough.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The best solution is to make sure contributors to the manager do not flood it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In an environment where that can’t be guaranteed (when the manager is receiving actions from user scripts, for example), a limit can be placed on the size of the queue. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">When a new action is added to a full queue, the lowest priority element is removed. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The algorithm is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">mh </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of actions in the active set, including sub-actions of a compound action, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">h </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of actions in the queue, again including sub-actions ( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">in the last paragraph refers to actions in the queue excluding sub-actions).  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> This timing is due to the </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">canDoBoth </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">test, which tries all combinations of items in the queue with those in the active set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When there are many actions in both lists, this can become a major issue. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this case, we can make the algorithm less flexible.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The ability to combine actions in the active list can easily be removed, and we can enforce that all simultaneous actions be explicitly requested by embedding them in an action combination structure.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> This reduces the algorithm toO( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">h </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) in time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Typically, however, only a few actions are present in the manager at any one time, and the checks do not pose a significant problem. </p>
<span origfont="g_font_15" data-canvas-width="39.499886399999994" style="left: 84.3152px; top: 609.775px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.958639); border-left: none;" yquantized="600" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 5.11.7 </p>
<span origfont="g_font_7" data-canvas-width="325.5020522399999" style="left: 109.415px; top: 643.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00358); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Putting It All Together </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 5.57 shows a complete AI structure using the action manager. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An alarm mechanism is updated every frame and can schedule emergency actions if needed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The queue of actions is then queued.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is a single decision making system, which is called whenever the action queue is empty (it may be made up of many component decision making tools).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a valid action is in the queue, it is sent to be executed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The execution may be performed by sending requests to the game state, the animation controller, the movement AI, or </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.81448px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.81448px; font-style: normal; font-weight: 400; display: inline;">Action managerAction queue  Decision makerAlarm systemAction execution </p><span origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Called once </span><span origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"> per frame </span><span origfont="g_font_21" data-canvas-width="34.6752" style="left: 242.786px; top: 250.735px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01986); border-left: 50px solid blue;" yquantized="250" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="36" style="left: 237.583px; top: 288.329px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1); border-left: 50px solid blue;" yquantized="280" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 122.615px; top: 371.502px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.946425); border-left: 50px solid blue;" yquantized="370" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;"> mechanismSchedule actionGet next action [While no action but time available]ProcessSchedule decision maker actionGet next actionExecute action </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 5.57 </span><span origfont="g_font_7" data-canvas-width="459.05030673599987" style="left: 122.612px; top: 412.652px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04725); border-left: none;" yquantized="410" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_21" data-canvas-width="61.584" style="left: 224.556px; top: 138.031px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.0264); border-left: none;" yquantized="130" class="highlight4"></span>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.6176px; font-style: normal; font-weight: 400; display: inline;">Process alarm </p>
<span origfont="g_font_21" data-canvas-width="40.982400000000005" style="left: 159.093px; top: 145.398px; font-size: 13.6176px; font-family: sans-serif; transform: scaleX(1.02456); border-left: 50px solid blue;" yquantized="140" class="highlight2" markup="figureBlock"></span>
<span origfont="g_font_7" data-canvas-width="459.05030673599987" style="left: 122.612px; top: 412.652px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04725); border-left: none;" yquantized="410" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The action manager in context some subsidiary decision maker.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the system runs out of processing time before an action is added to the queue, then it simply returns having done nothing. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This structure represents a comprehensive architecture for building a sophisticated character. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It may be overkill for simple, quick-to-implement AI for subsidiary characters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The flexibility it provides can be very useful duringAI development,as characters inevitably require more complex behaviors. </p>
<span origfont="g_font_13" data-canvas-width="90.10873344" style="left: 122.615px; top: 526.087px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02569); border-left: none;" yquantized="520" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.00846381599996" style="left: 122.615px; top: 556.532px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0338); border-left: none;" yquantized="550" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the Website </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Action Manager program that is available on the website allows you to manually schedule new actions and to see the current state of the queue and active set change.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Actions can be added with different priorities, different expiry times, and different abilities to interrupt. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Compound actions can also be added and introduced into the queue.  </p>
<p origfont="g_font_48" style="font-family: serif; font-size: 13.2702px; font-style: normal; font-weight: 400;"> Because of the user- </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Program </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> interface complexity it would require, the program does not allow you to nest compound actions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The source code is fully general, however, and you are welcome to modify the program to experi- ment with deeper hierarchies. </p>
<span origfont="g_font_7" data-canvas-width="141.969441024" style="left: 122.615px; top: 642.914px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02876); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_14" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_14" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Th </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">i </span>
<span origfont="g_font_14" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">s page </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">i </span>
<span origfont="g_font_14" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">ntent </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">i </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">onally left blank </p>
</html></html><html><html><p origfont="g_font_10" style="font-family: sans-serif; font-size: 59.7161px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 59.7161px; font-style: normal; font-weight: 400;">6 </p>
<span origfont="g_font_7" data-canvas-width="431.65395374400003" style="left: 150.091px; top: 396.039px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.11827); border-left: none;" yquantized="390" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical andStrategic AI </p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 59.7161px; font-style: normal; font-weight: 400;"> he decision making techniques we looked at in the last chapter have two important </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">T </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> limitations: they are intended for use by a single character, and they don’t try to infer from the knowledge they have a prediction of the whole situation. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Each of these limitations is broadly in the category of tactics and strategy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This chapter looks at techniques that provide a framework for tactical and strategic reasoning in characters. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It includes methods to deduce the tactical situation from sketchy information, to use the tactical situation to make decisions, and to coordinate between multiple characters. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the model of AI we’ve been using so far,this provides the third layer of our system,as shown in Figure 6.1. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is worth remembering again that not all parts of the model are needed in every game. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical and strategic AI, in particular, is simply not needed in many game genres.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Where players expect to see predictable behavior (in a two-dimensional [2D] shooter or a platform game, for example), it may simply frustrate them to face more complex behaviors. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Looking at the developments being made in game AI, it is clear to us that tactical and strategic AI will be one of the key fields for the next five years.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We have seen a rapid increase in the tactical capabilities of AI-controlled characters over the last five years, and given the techniques we know are being researched at the moment we’ll probably see that trend continue. </p>
<span origfont="g_font_7" data-canvas-width="45.209481792000005" style="left: 122.618px; top: 640.754px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05138); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">AI gets given processor time </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.2px; font-style: normal; font-weight: 400;">Execution management </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">AI gets its informationGroup AI </p><span origfont="g_font_21" data-canvas-width="40.3416" style="left: 268.278px; top: 187.74px; font-size: 7.2px; font-family: sans-serif; transform: scaleX(1.00854); border-left: 50px solid blue;" yquantized="180" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.2px; font-style: normal; font-weight: 400; display: inline;">StrategyContent creation </p><span origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400; display: inline;">Character AI </span><span origfont="g_font_21" style="font-family: sans-serif; font-size: 7.2px; font-style: normal; font-weight: 400;">ScriptingDecision making </span><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">AI has implications for related technologies </p><span origfont="g_font_21" data-canvas-width="42.681599999999996" style="left: 269.506px; top: 257.218px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.04101); border-left: 50px solid blue;" yquantized="250" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="113.83920000000002" style="left: 261.049px; top: 275.292px; font-size: 7.2px; font-family: sans-serif; transform: scaleX(0.989906); border-left: 50px solid blue;" yquantized="270" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.2px; font-style: normal; font-weight: 400;">World interfaceMovementAnimationPhysics </p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 311.502px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="310" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">AI gets turned into on-screen action </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.1 </span><p origfont="g_font_15" style="font-family: serif; font-size: 28.6924px; font-style: normal; font-weight: 400;">The AI model </p></pre>
<span origfont="g_font_15" data-canvas-width="33.85698479999999" style="left: 89.9581px; top: 345.478px; font-size: 39.8107px; font-family: serif; transform: scaleX(0.944079); border-left: none;" yquantized="340" class="highlight3"></span>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"> 6.1 </p>
<span origfont="g_font_7" data-canvas-width="459.3037552800002" style="left: 109.176px; top: 387.304px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00715); border-left: none;" yquantized="380" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Waypoint Tactics </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A waypoint is a single position in the game level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We met waypoints in Chapter 4, although there they were called"nodes"or"representative points." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">"Pathfinding uses nodes as intermediate points along a route through the level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This was the original use of waypoints, and the techniques in this section grew naturally from extending the data needed for pathfinding to allow other kinds of decision making. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When we used waypoints in pathfinding, they represented nodes in the pathfinding graph, along with associated data the algorithm required: connections, quantization regions, costs, and so on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To use waypoints tactically, we need to add more data to the nodes, and the data we store will depend on what we are using the waypoints for. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this section we’ll look at using waypoints to represent positions in the level with unusual tactical features, so a character occupying that position will take advantage of the tactical feature. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Initially, we will consider waypoints that have their position and tactical information set by the game designer.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Then, we will look at ways to deduce first the tactical information and then the position automatically. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 609.775px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="600" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.1.1 </p>
<span origfont="g_font_7" data-canvas-width="459.3109283520001" style="left: 109.176px; top: 643.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04855); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical Locations </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Waypoints used to describe tactical locations are sometimes called "rally points." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">" One of their early uses in simulations (in particular military simulation) was to mark a fixed safe location that a character in a losing firefight could retreat to.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The same principle is used in real-world military planning; when a platoon engages the enemy,it will have at least one pre-determined safe withdrawal point that it can retreat to if the tactical situation warrants it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this way a lost battle doesn’t always lead to a rout. </p>
<span origfont="g_font_7" data-canvas-width="136.44976212" style="left: 109.415px; top: 715.082px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.990316); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">More common in games is the use of tactical locations to represent defensive locations, or cover points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a static area of the game, the designer will typically mark locations behind barrels or protruding walls as being good cover points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a character engages the enemy, it will move to the nearest cover point in order to provide itself with some shelter. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are other popular kinds of tactical locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Sniper locations are particularly important in squad-based shooters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The level designer marks locations as being suitable for snipers,and then characters with long-range weapons can head there to find both cover and access to the enemy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In stealth games, characters that also move secretly need to be given a set of locations where there are intense shadows.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Their movement can then be controlled by moving between shadow regions, as long as enemy sight cones are diverted (implementing sensory perception is covered in Chapter 10, World Interfacing). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are unlimited different ways to use waypoints to represent tactical information.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could mark fire points where a large arc of fire can be achieved,power-up points where power-ups are likely to respawn, reconnaissance points where a large area can be viewed easily, quick exit points where characters can hide with many escape options if they are found, and so on.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Tactical points can even be locations to avoid, such as ambush hotspots, exposed areas, or sinking sand. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Depending on the type of game you are creating, there will be several kinds of tactics that your characters can follow.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For each of these tactics, there are likely to be corresponding tactical locations in the game, either positive (locations that help the tactic) or negative (locations that hamper it). </p>
<span origfont="g_font_13" data-canvas-width="106.879488" style="left: 122.328px; top: 411.068px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.989625); border-left: none;" yquantized="410" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.110082336" style="left: 122.615px; top: 441.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04077); border-left: none;" yquantized="440" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Set of Locations </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most games that use tactical locations don’t limit themselves to one type or another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The game level contains a large set of waypoints, each labeled with its tactical qualities.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the waypoints are also used for pathfinding, then they will also have pathfinding data such as connections and regions attached. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In practice, locations for cover and sniper fire are not very useful as part of a pathfinding graph.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 6.2 illustrates this situation.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Although it is most common to combine the two sets of waypoints, it may provide more efficient pathfinding to have a separate pathfinding graph and tactical location set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You would have to do this, of course, if you were using a different method for representing the pathfinding graph, such as navigation meshes or a tile-based world. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Wewillassumeformostof thissectionthatthelocationsweareinterestedinarenotnecessarily part of the pathfinding graph.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Later, we’ll see some situations in which merging the two together can provide very powerful behavior with almost no additional effort.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In general, however, there is no reason to link the two techniques. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 6.2 shows a typical set of tactical locations for an area of a game level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It combines three types of tactical locations: cover points, shadow points, and sniping points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Some points have more than one tactical property.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most of the shadow points are also cover points, for example. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is only one tactical location at each of these locations, but it has both properties. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Marking all useful locations can produce a large number of waypoints in the level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To get very good quality behavior, this is necessary but time consuming for the level designer.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Later in the section we’ll look at some methods of automatically generating the waypoint data. </p>
<span origfont="g_font_7" data-canvas-width="391.5899555999999" style="left: 122.615px; top: 715.009px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01712); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Cover/shadowShadow/ sniping </p><span origfont="g_font_21" data-canvas-width="25.2192" style="left: 201.428px; top: 245.03px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.00877); border-left: 50px solid blue;" yquantized="240" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="81.95542212" style="left: 396.88px; top: 272.887px; font-size: 8.42556px; font-family: sans-serif; transform: scaleX(0.964181); border-left: 50px solid blue;" yquantized="270" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 8.42556px; font-style: normal; font-weight: 400;">CoverCover </p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 318.702px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="310" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Sniping/cover/shadow </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.2 </span><span origfont="g_font_13" data-canvas-width="195.985419264" style="left: 109.415px; top: 367.868px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.04248); border-left: none;" yquantized="360" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">Tactical points are not the best pathfinding graph </p></pre>
<span origfont="g_font_13" data-canvas-width="195.985419264" style="left: 109.415px; top: 367.868px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04248); border-left: none;" yquantized="360" class="highlight4"></span>
<span origfont="g_font_7" data-canvas-width="459.00487728000013" style="left: 109.415px; top: 398.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01715); border-left: none;" yquantized="390" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Primitive and Compound Tactics </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In most games, having a set of pre-defined tactical qualities (such as sniper, shadow, cover, etc.) is sufficient to support interesting and intelligent tactical behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The algorithms we’ll look at later in this section make decisions based on these fixed categories. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can make the model more sophisticated, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When we looked at sniper locations, we mentioned that a sniper location would have good cover and provide a wide view of the enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can decompose this into two separate requirements: cover and view of the enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we support both cover points and high visibility points in our game, we have no need to specify good sniper locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can simply say the sniper locations are those points that are both cover points and reconnaissance points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Sniper locations have a compound tactical quality; they are made up of two or more primitive tactics. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We don’t need to limit ourselves to a single location with both properties, either.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> When a character is on the offensive in a firefight, it needs to find a good cover point very near to a location that provides clear fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character can duck into the cover point to reload or when incoming fire is particularly dense and then pop out into the fire point to attack the enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can specify that a defensive cover point is a cover point with a fire point very near (often within the radius of a sideways roll: the stereotypical animation for getting in and out of cover). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the same way, if we are looking for good locations to mount an ambush, we could look for exposed locations with good hiding places nearby.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The "good hiding places" are compound tactics in their own right, combining locations with good cover and shadow. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 6.3 shows an example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the corridor,cover points,shadow points,and exposed points are marked.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We decide that a good ambush point is one with both cover and shadow, next to an exposed point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the enemy moves into the exposed point, with a character in shadow, then it will be susceptible to attack.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The good ambush points are marked in the figure. </p>
<span origfont="g_font_7" data-canvas-width="355.29540679199994" style="left: 109.415px; top: 714.991px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01804); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_21" style="font-family: sans-serif; font-size: 8.42556px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 8.42556px; font-style: normal; font-weight: 400;">ExposedCover/shadow </p><span origfont="g_font_21" data-canvas-width="25.2192" style="left: 289.072px; top: 214.464px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.00877); border-left: 50px solid blue;" yquantized="210" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">ExposedShadow </p><span origfont="g_font_21" data-canvas-width="32.783853959999995" style="left: 322.71px; top: 237.404px; font-size: 8.42556px; font-family: sans-serif; transform: scaleX(0.964231); border-left: 50px solid blue;" yquantized="230" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 8.42556px; font-style: normal; font-weight: 400;">Cover </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Exposed </p><span origfont="g_font_21" data-canvas-width="81.95542212" style="left: 420.284px; top: 274.087px; font-size: 8.42556px; font-family: sans-serif; transform: scaleX(0.964181); border-left: 50px solid blue;" yquantized="270" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 8.42556px; font-style: normal; font-weight: 400;">Cover </p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 122.615px; top: 319.902px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="310" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;">Sniping/cover/shadowAmbush points </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.3 </p><span origfont="g_font_7" data-canvas-width="441.1068671279999" style="left: 140.377px; top: 368.332px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.03536); border-left: none;" yquantized="360" class="highlight4"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="441.1068671279999" style="left: 140.377px; top: 368.332px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03536); border-left: none;" yquantized="360" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Ambush points derived from other locationsWe can take advantage of these compound tactics by storing only the primitive qualities.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the example above, we stored three tactical qualities: cover, shadow, and exposure.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> From these we could calculate the best places to lay or avoid an ambush.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By limiting the number of different tactical qualities, we can support a huge number of different tactics without making the level designer’s job impossible or flooding the memory with waypoint data that are rarely needed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On the other hand,what we gain in memory,we lose in speed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To work out the nearest ambush point, we would need to look for cover points in shadow and then check each nearby exposed point to make sure it was within the radius we were looking for. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the vast majority of cases this extra processing isn’t important.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a character needs to find an ambush location, for example, then it is likely to be able to think for several frames.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Decision making based on tactical locations isn’t something a character needs to do every frame, and so for a reasonable number of characters time isn’t of the essence. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For lots of characters or if the set of conditions is very complex, however, the waypoint sets can be pre-processed offline, and all the compound qualities can be identified.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This doesn’t save memory when the game is running,but it removes the need for the level designer to specify all the qualities of every location.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be taken further,and we can use algorithms to detect even the primitive qualities.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We will return to algorithms for automatically detecting primitive qualities later in this section. </p>
<span origfont="g_font_13" data-canvas-width="255.18517862400003" style="left: 122.328px; top: 654.673px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02546); border-left: none;" yquantized="650" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0646528799998" style="left: 122.615px; top: 685.117px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997967); border-left: none;" yquantized="680" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Waypoint Graphs and Topological Analysis </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The waypoints we have looked at so far are separate,isolated locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no information as to whether one waypoint can be reached from another.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We mentioned at the start of this section the similarity of waypoints to nodes in a pathfinding graph.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can certainly use nodes in a </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">pathfinding graph as tactical locations (although they aren’t always the best suited, as we’ll see later in Section 6.3 on tactical pathfinding). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">But even if we aren’t using a pathfinding graph, we can link together tactical locations to give access to more sophisticated compound tactics. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Let’s suppose that we’re looking for somewhere that provides a good location to mount a hit and run attack.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The set of waypoints in Figure 6.4 shows part of a level to consider.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Waypoints are connected when one can be reached from the other directly.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are no connections through the wall, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the balcony we have a location (A) with good visibility of the room, a candidate for an attack spot.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similarly, there is one other location in a small anteroom (B) that might be useful. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The balcony is obviously better than the anteroom because it has three exits, only one of which leads into the room.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are looking to perform a hit and run attack, then we need to find locations with good visibility, but lots of exit routes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is a topological analysis.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It reasons about the structure of the level by looking at the propertiesof thewaypointgraph.Itisakindof compoundtactic,butonethatusestheconnections between waypoints as well as their tactical qualities and positions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Topological analysis can be performed using the pathfinding graph,or it can be performed on basic tactical waypoints.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It does require connections between waypoints, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Without these connections, we wouldn’t know whether the nearby waypoints constitute exit routes or whether there was a wall between them. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unfortunately, this kind of topological analysis can rapidly get complicated.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is extremely sensitive to the density of waypoints.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Take location C in Figure 6.4.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Once again the shooting position has three exit routes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case, however, they all lead to locations in the same vicinity with immediate escape.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character looking for a good hit and run location based on the number of exits alone might mistakenly mount its attack in the middle of the room. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Of course, we can make the topological analysis algorithm more sophisticated.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could look not just at the number of connections, but also where those connections lead, and so on. </p>
<span origfont="g_font_21" style="left: 233.393px; top: 562.964px; font-size: 11.6905px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="560" class="highlight2" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" style="left: 233.393px; top: 562.964px; font-size: 11.6905px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="560" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_21" data-canvas-width="21.53573136" style="left: 220.157px; top: 592.538px; font-size: 8.42556px; font-family: sans-serif; transform: scaleX(0.978897); border-left: 50px solid blue;" yquantized="590" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" style="left: 433.644px; top: 648.585px; font-size: 8.42556px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="640" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 717.51px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="710" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">AStairsCB </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.4 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Topological analysis of a waypoint graph </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our experience the complexity of this kind of analysis is formidable and beyond what most developers want to spend time implementing and tweaking.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In our opinion there isn’t a dilemma between developing a comprehensive topological analysis system and having a level designer simply specify the appropriate tactical locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For all but the simplest analysis, the level designer gets the job every time. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Automatic topological analysis comes up from time to time in books and papers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Our advice would be to treat it with caution, unless you can spare a couple of months of playing to get it right.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The manual way is often less painful in the long run. </p>
<span origfont="g_font_13" data-canvas-width="114.45430272" style="left: 122.615px; top: 245.765px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04051); border-left: none;" yquantized="240" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.95705680000003" style="left: 122.615px; top: 276.208px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01502); border-left: none;" yquantized="270" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Continuous Tactics </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To support more complicated compound tactics, we can move away from simple Boolean states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rather than marking a location as being "cover" or "shadow," for example, we can provide a numerical value for each.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A waypoint will have a value for "cover" and a different value for "shadow." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The meaning of these values will depend on the game, and they can have any range that is convenient.  </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For the purpose of clarity, however, let’s assume the values are floating points in </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> (,) </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> the range01, where a value of 1 indicates that the waypoint has the maximum amount of a property (a maximum amount of cover or shadow, for example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The value doesn’t have to be floating point.  </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If we were developing a game for a memory-limited platform or a game without optimized floating point hardware, we could as easily use an integer in the range </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 0 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 255 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> . </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">On its own we can use this information to simply compare the quality of a waypoint.  </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If a character is trying to find cover, and it has equally achievable options between a waypoint with cover </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 9orcover </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 6, it should head for the waypoint with cover </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 9. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can also interpret these values as a degree of membership of a fuzzy set (we looked at the basics of fuzzy logic in Chapter 5, Decision Making).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A waypoint with a"cover"value of 0.9 has a high degree of membership in the set of cover locations. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Interpreting the values as degrees of membership allows us to produce values for compound tactics using the fuzzy logic rule.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Recall that we defined a sniper location as a waypoint that had both a view of the enemy and good cover.  </p>
<span origfont="g_font_7" data-canvas-width="29.658261696000004" style="left: 277.673px; top: 564.052px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0227); border-left: none;" yquantized="560" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> In other words, sniper </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> cover AND visibility. </p>
<span origfont="g_font_9" style="left: 299.06px; top: 589.325px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="580" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">= </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_7" data-canvas-width="155.88280968" style="left: 140.559px; top: 592.792px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.9866); border-left: none;" yquantized="590" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_9" style="left: 335.318px; top: 618.18px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="610" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">If we have a waypoint with cover09 and visibility07, we can use the fuzzy rule: </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">(,), </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> ( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">A AND B </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">min </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">m </span>
<span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 122.613px; top: 650.4px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="650" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">B </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">A </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">B </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">are the degrees of membership of A and B.  </p>
<span origfont="g_font_8" style="left: 278.627px; top: 679.146px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Adding in our data, we get </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">) </p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> snipercovervisibility </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">,. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) </p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min0907 </p>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> = </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">. </p>
<span origfont="g_font_39" style="left: 339.328px; top: 718.806px; font-size: 16.5877px; font-family: sans-serif; border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Sowecanderivethequalityof asniperlocationandusethatasthebasisof acharacter’stactical actions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This example is very simple, using just AND to combine its components.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As we saw in the previous section, we can devise considerably more complex conditions for compound tactics. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Interpreting the values as degrees of membership in fuzzy states allows us to work with even the most complex definitions made up of lots of clauses.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It provides a tried and tested mechanism for ending up with a dependable value. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The disadvantage of using this approach is that each waypoint needs to have a complete set of values stored for it.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are keeping track of five different tactical properties, then for the non-numeric situation we only need to keep a list of waypoints in each set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no wasted storage.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On the other hand, if we store a numeric value for each, then there will be five numbers for each waypoint. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can slightly reduce the need for storage by not storing zero values, although this makes things more complex because we need a reliable way to store both the value and the meaning of that value (if we always store the five numbers, then we can tell what each number means by its position in the array). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For large outdoor worlds, such as those used in real-time strategy (RTS) or massively multi- player games, we might be driven to save memory.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most shooters, however, the extra memory is unlikely to cause problems. </p>
<span origfont="g_font_13" data-canvas-width="113.447196672" style="left: 109.415px; top: 382.214px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03134); border-left: none;" yquantized="380" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.07899902399976" style="left: 109.415px; top: 412.658px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.989688); border-left: none;" yquantized="410" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Context Sensitivity </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">However, there is still a problem with marking tactical locations in the way we’ve described so far. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The tactical properties of a location are almost always sensitive to actions of the character or the current state of the game. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Hiding behind a barrel, for example, might produce cover only if the character is crouched. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the character stands behind the barrel, it is a sitting duck for incoming fire.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Likewise, hiding behind a protruding rock is of no use if the enemy is behind you.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The aim is to put the rock between the character and the incoming fire. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This problem isn’t limited to just cover points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Any of the tactical locations in this section may be invalid in certain circumstances.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the enemy manages to mount a flank attack, then there is no use heading for a withdrawal location which is now behind enemy lines. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some tactical locations have an even more complicated context.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A sniper point is likely to be useless if everyone knows the sniper is camped there.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unless it happens to be an impenetrable hideout (which is a sign of faulty level design, we would suggest), then sniper positions depend to some extent on secrecy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are two options for implementing context sensitivity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> First, we could store multiple values for each node.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A cover waypoint, for example, might have four different directions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For any given cover point, only some of those directions are covered.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We call these four directions the states of the waypoint.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For cover, we have four states, and each of these may have a completely independent value for the quality of the cover (or just a different yes/no value if we aren’t using continuous tactic values).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could use any number of different states.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might have an addi- tional state that dictates whether the character needs to be ducking to receive cover, for example, or additional states for different enemy weapons; a location that provides cover from small arms </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For tactics where the set of states is fairly obvious,such as cover or firing points (we can use the four directions again as firing arcs),this is a good solution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For other types of context sensitivities, such as the withdrawal location example, it is difficult to come up with a sensible set of different states for the territory controlled by the enemy, for example. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The second approach is to use only one state per waypoint, as we have seen throughout this section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rather than treating this value as the final truth about the tactical quality of a waypoint, we add an extra step to check if it is appropriate.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This checking step can consist of any check against the game state.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the cover example we might check for line of sight with our enemies. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the withdrawal example we might check on an influence map (see Section 6.2.2 on influence mapping later in this chapter) to see if the location is currently under enemy control. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the sniper example we could simply keep a list of Boolean flags to track if the enemy has firedtowardasniperlocation(asimpleheuristictoapproximateif theenemyknowsthelocationis there).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This post-processing step has similarities to the processing used to automatically generate the tactical properties of a waypoint.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll return to these techniques later. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As an example of each approach, consider a character that needs to choose a cover point to reload behind during a firefight.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are two cover points nearby that it can select from, as shown in Figure 6.5. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the diagram on the left of Figure 6.5 the cover points are shown with their quality of cover in each of the four directions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character works out the direction to each enemy and determines that it needs cover from the south and east directions.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So the character checks for a cover point that provides that.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Cover point B does, and it selects that point. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the diagram on the right of Figure 6.5 we use a post-processing step.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character checks the line of sight from both cover points to both enemies.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It determines that cover point B does not have a line of sight to either,so it is preferable to cover pointA that has a line of sight to one enemy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The trade-off between these two methods is between quality, memory, and execution speed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using multiple states per waypoint makes decision making fast.  </p>
<span origfont="g_font_21" data-canvas-width="57.772800000000004" style="left: 181.717px; top: 535.006px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.01356); border-left: none;" yquantized="530" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> We don’t need to perform any </p>
<span origfont="g_font_21" data-canvas-width="57.772800000000004" style="left: 175.064px; top: 577.994px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.01356); border-left: none;" yquantized="570" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="29.731199999999998" style="left: 257.471px; top: 648.103px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02521); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="122.42880000000002" style="left: 233.413px; top: 675.07px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.02881); border-left: none;" yquantized="670" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Cover point AEnemyCover point AEnemyCover point BCharacterCover point BCharacter needing coverneeding coverEnemyEnemyIndicates the pre-determinedIndicates ray checks directions of covermade from a cover point </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">tactical calculations during the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We just need to work out which states we are interested in.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> On the other hand, to get very high-quality tactics we may need a huge number of states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we need cover in four directions, both standing and crouched, against any of five different types of weapons, we’d need 40 states for a cover waypoint.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clearly, this can very quickly become too much. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Performing a post-processing step gives us much more flexibility.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It allows the character to take advantage of quirks in the environment.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A cover point may not provide cover to the north except for attacks from a particular walkway (the position of a roof girder provides cover there, for example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the enemy is on that walkway, then the cover point is valid.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Using a simple state for the cover from northerly attacks would not allow the character to take advantage of this. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the other hand, post-processing takes time, especially if we are doing lots of line-of-sight checks through the level geometry.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In several games we’ve seen, tactical line-of-sight checks have taken up the majority of all the AI time used in the game, over 30% of the total processor time in some cases.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you have a lot of characters that have to react quickly to changing tactical situations, this may be unacceptable.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the characters can afford to take a couple of seconds to weigh up their options, then it is unlikely to be a problem. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In our opinion, the games that really benefit from good tactical play, such as squad-based shooters,needthepost-processingapproach.Forothergameswheretacticsaren’tthefocus,asmall number of states will be sufficient.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We know of one developer who combined both approaches in the same game, with a good deal of success: the multiple states provided a filtering mechanism that reduced the number of different cover waypoints that needed line-of-sight checks. </p>
<span origfont="g_font_13" data-canvas-width="112.698322944" style="left: 109.415px; top: 426.066px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04352); border-left: none;" yquantized="420" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.1698579360002" style="left: 109.176px; top: 456.509px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06773); border-left: none;" yquantized="450" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Putting It Together </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ve considered a range of complexities for tactical waypoints, from a simple label for the tactical quality of a location through to compound, context-sensitive tactics based on fuzzy logic. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In practice, most games don’t need to go the whole way. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many games can get away with simple tactical labels.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If this produces odd behavior, then the next stage to implement is context sensitivity, which provides a huge increase in the competency of the AI. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Next, we would advise trying to add continuous tactical values and allow characters to make decisions based on the quality of a waypoint. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For highly tactical games where the quality of the tactical play is a selling point for the game, using compound tactics (with fuzzy logic) then allows you to support new tactics without adding or changing the information that the level designer needs to create.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> So far we haven’t worked on a game that has gone this far, although it isn’t new in the field of military simulation. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 652.975px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.1.2 </span>
<span origfont="g_font_7" data-canvas-width="459.36950843999983" style="left: 109.415px; top: 686.312px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03807); border-left: none;" yquantized="680" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using Tactical Locations </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we’ve looked at how a game level can be augmented with tactical waypoints.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> However, on their own they are just values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need some mechanism to include their data into decision making. </p>
<span origfont="g_font_7" data-canvas-width="39.0932424" style="left: 109.415px; top: 715.1px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02877); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll look at three approaches.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first is a very simple process for controlling tactical move- ment.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The second incorporates tactical information into the decision making process.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The third uses tactical information during pathfinding to produce character motion that is always tactically aware.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> None of these three approaches is a new algorithm or technique.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They are simply ways in which to bring the tactical information into the algorithms we looked at in previous chapters. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For now, we’ll limit our focus to decision making for a single character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Later, in Section 6.4, we’ll return to the task of coordinating the actions of several characters, while making sure they remain tactically aware. </p>
<span origfont="g_font_13" data-canvas-width="155.880505344" style="left: 122.615px; top: 238.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01884); border-left: none;" yquantized="230" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0287875200001" style="left: 122.615px; top: 268.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.994033); border-left: none;" yquantized="260" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Simple Tactical Movement </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In most cases a character’s decision making process implies what kind of tactical location it needs. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For example, we might have a decision tree that looks at the current state of the character, its health and ammo supply, and the current position of the enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The decision tree is run, and the character decides that it needs to reload its weapon. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The action generated by the decision making system is"reload." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">"This could be achieved simply by playing the reload animation and updating the number of rounds in the character’s weapon. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Alternatively, and more tactically, we can choose to find a suitable place to reload, under cover. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is simply achieved by querying the tactical waypoints in the immediate vicinity.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Suitable waypoints (in our case, waypoints providing cover) are found, and any post-processing steps are taken to ensure that they are suitable for the current context. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The character then chooses a suitable location and uses it as the target of its movement.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The choice can be simply "the nearest suitable location," in which case the character can begin with the nearest waypoint and check them in order of increasing distance until a match is found. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Alternatively, we can use some kind of numeric measure of how good a location is.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are using continuous values for the quality of a waypoint, this might be what we need.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We are not necessarily interested in selecting the best node in the whole level, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no point in running all the way across the map just to find a really secure location to reload.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Instead, we need to balance distance and quality. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach makes the action decision first, independent of the tactical information, and then applies tactical information to achieve its decision.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a powerful technique on its own and forms the basis of most squad-based AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is the bread and butter of shooters right through to present titles. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It does have a significant limitation, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because the tactical information isn’t used in the decision making process, we may end up discovering the decision is foolish only after the decision has been made.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might find, for example, that after making a decision to reload, we can’t find anywhere safe nearby to do so.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A person in this situation would try something different. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For example, he may choose to run away.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the character is committed to the decision, however, thenitwillbestuck. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Games rarely allow the AI to detect this and go back and reconsider the decision, so it can cause problems. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In most games this isn’t a significant problem in practice, particularly if the level designer is clued up.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Every area in the game usually has several tactical points of each type (with the exception </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">of sniping points, perhaps, but we normally don’t mind if characters go wandering off a long way to find these). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When it is an issue,however,we need to take account of the tactical information in the original decision making process. </p>
<span origfont="g_font_13" data-canvas-width="284.414208" style="left: 109.415px; top: 176.129px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02308); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0048772800001" style="left: 109.415px; top: 206.572px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05276); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using Tactical Information Like Any Other Data </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The simplest way to bring tactical information into the decision making process is to give the decision maker access to it in the same way as it has access to other information about the game world. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we want to use a decision tree, for example, we could allow decisions to be made based on the tactical context of the character.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We might make a decision based on the nearest cover point, as Figure 6.6 shows.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The character in this case will not decide to head for cover and then find there is no suitable cover.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The decision to move to cover takes into account the availability of cover points to move to. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Similarly, if we are using a state machine we might only trigger certain transitions based on the availability of waypoints. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In both of these cases we should keep track of any suitable waypoints we find during decision making so that we can use them after the decision has been made.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the decision tree in the first example ends up suggesting the "take cover" action, then we will need to work out which cover point to take cover in. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This involves the same search for nearby decision points that we had using the simple tactical movement approach previously.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To avoid a duplication of effort, we cache the cover point that is found during the decision tree processing.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We then use that target in the movement AI and move directly toward it without further search. </p>
<span origfont="g_font_21" data-canvas-width="75.3312" style="left: 335.98px; top: 519.778px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.00442); border-left: 50px solid blue;" yquantized="510" class="highlight4" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="75.3312" style="left: 335.98px; top: 519.778px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.00442); border-left: 50px solid blue;" yquantized="510" class="highlight4" markup="figureBlock"></span>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">Do I have ammo? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_21" data-canvas-width="13.8528" style="left: 278.456px; top: 541.128px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.764556); border-left: 50px solid blue;" yquantized="540" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="91.10399999999998" style="left: 167.01px; top: 570.11px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01227); border-left: 50px solid blue;" yquantized="570" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Ye sNoCan I see an enemy? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">Is there cover nearby? </p><span origfont="g_font_21" data-canvas-width="12.2688" style="left: 231.714px; top: 597.768px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.0224); border-left: 50px solid blue;" yquantized="590" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 9.6px; font-style: normal; font-weight: 400;">NoYe sIs thereYe sNo cover nearby? </p><span origfont="g_font_21" data-canvas-width="13.8528" style="left: 276.21px; top: 628.987px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.764556); border-left: 50px solid blue;" yquantized="620" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="20.2752" style="left: 201.358px; top: 656.141px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01376); border-left: 50px solid blue;" yquantized="650" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="710" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Ye sNoHuntTa k eTa k e enemycoverAttack coverReload </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Tactical information in a decision tree </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical Information in Fuzzy Logic Decision Making </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For both decision trees and state machines, we can use tactical information as a yes or no condition, either at a decision node in the decision tree or as a condition of making a state transition. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In both cases we are interested in finding a tactical location where some condition is met (it might be to find a tactical location where the character can take cover, for example).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We aren’t interested in the quality of the tactical location. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can go one stage further and allow the decision making to take account of the quality of a tactical location as it makes a decision.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Imagine a character is weighing up two strategies.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It might camp out behind cover and provide suppression fire, or it might take up a position in shadow ready to lay an ambush to unwary enemies passing by.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We are using continuous tactical data for each location, and the cover quality is 0.7 while the shadow quality is 0.9. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Using a decision tree, we would simply check if there is a cover point, and upon finding that there is, the character would follow the suppression fire strategy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no sense in weighing up the pros and cons of each option. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we use a fuzzy decision making system, however, we can use the quality values directly in the decision making process.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Recall from Chapter 5 that a fuzzy decision making system has a set of fuzzy rules.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These rules combine the degrees of membership of several fuzzy sets into values that indicate which action is preferred. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can incorporate our tactical values directly into this method, as another degree of mem- bership value. </p>
<span origfont="g_font_7" data-canvas-width="200.46345216000003" style="left: 254.755px; top: 441.289px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.998519); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="295.1181147599999" style="left: 140.619px; top: 488.022px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993664); border-left: none;" yquantized="480" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="160.5572616" style="left: 260.206px; top: 516.774px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00979); border-left: none;" yquantized="510" class="highlight3"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">For example, we might have the following rules:IF cover-point THEN lay-suppression-fireIF shadow-point THEN lay-ambushFor the tactical values given above, we get the following result: lay-suppression-fire: membership </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 7 lay-ambush: membership </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="441.0219857759999" style="left: 140.595px; top: 563.507px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.991061); border-left: none;" yquantized="560" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 9If the two values are independent (i.e.,if it is impossible to do both at once,which we’ll assume it is), then we choose lay-ambush as the action to take. </p>
<span origfont="g_font_7" data-canvas-width="301.127953584" style="left: 204.4px; top: 621.058px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.997903); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="192.766745904" style="left: 140.595px; top: 667.779px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.988547); border-left: none;" yquantized="660" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="70.090477536" style="left: 295.151px; top: 696.519px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03074); border-left: none;" yquantized="690" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The rules can be significantly more complex, however:IF cover-point AND friend-moving THEN lay-suppression-fireIF shadow-point AND no-visible-enemies THEN lay-ambushNow if we have the memberships values: friend-moving </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 9 no-visible-enemies </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 5 </p>
</html></html><html><html><p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">we would end up with the results: lay-suppression-fire: membership </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 7 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 9 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="121.81789075200001" style="left: 207.962px; top: 146.235px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02368); border-left: none;" yquantized="140" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 7 lay-ambush: membership </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> min </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">( </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 9 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 5 </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">. </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> </span>
<span origfont="g_font_7" data-canvas-width="224.54106384" style="left: 109.38px; top: 174.987px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01145); border-left: none;" yquantized="170" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 5 and the correct action is to lay suppression fire. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are no doubt numerous other ways to include the tactical values into a decision making process.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use them to calculate priorities for rules in a rule-based system, or we can include them in the input state for a learning algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This approach, using the rule-based fuzzy logic system, provides a simple to implement extension that gives very powerful results.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is not a well-used technique, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most games rely on a much simpler use of tactical information in decision making. </p>
<span origfont="g_font_13" data-canvas-width="179.42125056" style="left: 109.415px; top: 304.657px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04405); border-left: none;" yquantized="300" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9929221599998" style="left: 109.415px; top: 335.101px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.09545); border-left: none;" yquantized="330" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Generating Nearby Waypoints </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we use any of these approaches, we will need a fast method of generating nearby way- points.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Given the location of a character, we ideally need a list of suitable waypoints in order of distance. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most game engines provide a mechanism to rapidly work out what objects are nearby.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Spatial data structures such as quad-trees or binary space partitions (BSPs) are often used for collision detection.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Other spatial data structures such as multi-resolution maps (a tile-based approach with a hierarchy of different tile sizes) are also suitable.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For tile-based worlds, we have also used stored patterns of tiles for different radii, simply superimposed the pattern on the character’s tile, and looked up the tiles within that pattern for suitable waypoints. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As we said in Chapter 3, spatial data structures for proximity and collision detection are beyond the scope of this book.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is another book in this series [Ericson, 2005] that covers the topic.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The references appendix lists this and other suitable resources. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Distance isn’t the only thing to take into account, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 6.7 shows a character in a corridor.  </p>
<span origfont="g_font_21" data-canvas-width="19.209600000000002" style="left: 214.924px; top: 610.366px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.01103); border-left: none;" yquantized="610" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> The nearest waypoint is in an adjacent room and is completely impractical as a cover </p>
<span origfont="g_font_21" data-canvas-width="32.0064" style="left: 277.823px; top: 661.649px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.0002); border-left: none;" yquantized="660" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">BestCharacter cover pointClosest cover point </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we simply selected the cover point based on distance, we’d see the character run into a different room to reload, rather than use the crate near the end of the corridor. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can minimize this problem with careful level design.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is often a sensible idea not to use thin walls in a game level.As we saw in Chapter 4,this can also confuse the quantization algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Sometimes, however, it is unavoidable, and a better solution is required. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Another approach would be to determine how close each tactical waypoint is by performing a pathfinding step to generate the distance.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This then takes into account the structure of the level, rather than using a simple Euclidean distance.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can interrupt the pathfinding when we realize that it will be a longer path than the path to the nearest waypoint we’ve found so far.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even with such optimizations, this adds a significant amount of processing overhead. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fortunately, we can perform the pathfinding and the search for the nearest target in one step. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This also solves the problem of confusion by thin walls and of finding nearby waypoints.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It also has an additional benefit: the route it returns can be used to make characters move, while constantly taking into account their tactical situation. </p>
<span origfont="g_font_13" data-canvas-width="118.84425216000001" style="left: 122.615px; top: 324.071px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04251); border-left: none;" yquantized="320" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.972598456" style="left: 122.615px; top: 354.514px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04949); border-left: none;" yquantized="350" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical Pathfinding </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical waypoints can also be used for tactical pathfinding.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Tactical pathfinding is a hot topic in game AI, but is a relatively simple extension of the basic A* pathfinding algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rather than finding the shortest or quickest route, however, it takes into account the tactical situation of the game. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical pathfinding is more commonly associated with tactical analyses, however, so we’ll return to a full discussion in Section 6.3 later in the chapter. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 463.384px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="460" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.1.3 </span>
<span origfont="g_font_7" data-canvas-width="458.86141584000006" style="left: 122.615px; top: 511.067px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.999698); border-left: none;" yquantized="510" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Generating the Tactical Properties of a Waypoint </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we have assumed that all the waypoints for our game have been created, and each has been given its appropriate properties: a set of labels for the tactical features of its location and possibly additional data for the quality of the tactical location, or context-sensitive information. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In the simplest case these are often created by the level designer.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The level designer can place cover points, shadow points, locations with high visibility, and excellent sniper locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As long as there are only a few hundred cover points, this task isn’t onerous.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is the approach used in a large number of shooters.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Beyond the simplest games, however, the effort may increase dramatically. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the level designer has to place context-sensitive information or set the tactical quality of a location, then the job becomes very difficult, and the tools needed to support the designer have to be significantly more complicated.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For context-sensitive,continuous valued tactical waypoints, we may need to set up different context states and be able to enter numeric values for each.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To make sure the values are sensible, we will need some kind of visualization. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">While it is possible for the designer to place the waypoints, all the extra burden makes it unlikely that the level designer will be tasked with setting the tactical information unless it is of </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For other games we may not need to have the locations placed manually; they may arise naturally from the structure of the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the game relies on a tile-based grid, for example, then locations in the game are often positioned at corresponding tiles.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While we know where the locations are, we don’t know the tactical properties of each one.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the game level is built up from pre-fabricated sections, then we could have tactical locations placed in the pre-fabs. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Inbothcasesweneedsomemechanismforcalculatingthe tacticalpropertiesof eachwaypoint automatically. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is usually performed using an offline pre-processing step, although it can also be per- formed as it is needed during the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The latter approach allows us to generate the tactical properties of a waypoint in the current game context, which in turn can support more subtle tac- tical behavior.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As we saw in the section on context sensitivity above,however,this has a significant impact on performance, especially if there are a large number of waypoints to consider. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm for calculating a tactical quality depends on the type of tactic we are interested in.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are as many calculations as there are types of tactics.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We will look at the types of waypoints we’ve used so far in the chapter to give a feel for the types of processing involved.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Other tactics will tend to be similar to these types, but may need some modification. </p>
<span origfont="g_font_13" data-canvas-width="75.997771776" style="left: 109.415px; top: 353.468px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0133); border-left: none;" yquantized="350" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0168324000001" style="left: 109.415px; top: 383.912px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02738); border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Cover Points </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The quality of a cover point is calculated by testing how many different incoming attacks might succeed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We run many different simulated attacks and see how many get through. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Wecanrunacompletesimulatedattack,butthistakestime.Itisnormallyeasiertoapproximate an attack by a line-of-sight test: a ray cast through the level geometry. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For each attack we start by selecting a location in the vicinity of the candidate cover point. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This location will usually be in the same or an adjoining room to the cover point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can test from everywhere in the level, of course, but that is wasteful as most attacks will not succeed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In outdoor levels we may have to check everywhere within weapons range, which is potentially a time-consuming process. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">One way to do this is to check attacks at regular angles around the point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We need to first make sure that the location we are checking is in the same room or area as the point it is trying to attack.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A point in the middle of a corridor, for example, can be hit from anywhere in the corridor. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the corridor is thin,however,using all the angles around will give a high cover value: most of the angles are covered by the corridor walls.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Testing nearby locations that can be occupied, however, will show correctly that the point is 100% exposed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Being too regular, however, can also lead to problems.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we test just locations around the point at the same height as the point, we might get the wrong value.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A character standing behind an oil can, for example, can be covered from the ground level, but would be exposed from a gun at shoulder height.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can solve this problem by checking each angle several times, with small random offsets, and at different heights. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">From the location we select, a ray is cast toward the candidate cover point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Crucially, the ray is cast toward a random point in a person-sized volume at the candidate point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we aim toward just the point, we may be checking if a small point on the floor is covered, rather than the area a character would occupy. </p>
<span origfont="g_font_7" data-canvas-width="115.873805088" style="left: 109.415px; top: 714.973px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01444); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This process is repeated many times from different locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We keep track of the proportion of rays that hit the volume. </p>
<span origfont="g_font_35" data-canvas-width="306.65088000000003" style="left: 150.59px; top: 156.804px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="150" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;">The pseudo-code to perform these checks looks like the following: </p>
<span origfont="g_font_35" data-canvas-width="306.65088000000003" style="left: 150.59px; top: 156.804px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="150" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> def getCoverQuality(location, iterations, characterSize): </p><span origfont="g_font_7" style="left: 125.724px; top: 174.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="170" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 189.14px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="180" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 3 </span><span origfont="g_font_7" style="left: 125.724px; top: 203.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="200" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Set up the initial angle </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 217.94px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="210" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">theta = 0 </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We start with no hits </p><span origfont="g_font_7" style="left: 125.724px; top: 246.74px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><span origfont="g_font_7" style="left: 125.724px; top: 261.14px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="260" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">hits = 0 </p><span origfont="g_font_7" style="left: 125.724px; top: 275.54px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="270" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 8 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 289.94px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Not all rays are valid </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 304.34px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="300" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">valid = 0 </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 318.74px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="310" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 12 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 333.14px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="330" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">for i in 0..iterations: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 347.54px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 13 14 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Create the from location from = location </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 376.34px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 15 16 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">from.x += RADIUS * cos(theta) + randomBinomial() * RANDOM_RADIUS from.y += rand()*2*RANDOM_RADIUS </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 405.14px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="400" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 17 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 419.54px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">from.z += RADIUS * sin(theta) + randomBinomial() * RANDOM_RADIUS </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 433.94px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 448.34px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Check for a valid from location </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">if not inSameRoom(from, location): continue else: valid++ </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 477.14px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 22 23 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Create the to location </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 505.94px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="500" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 24 25 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">to = location to.x += randomBinomial() * characterSize.x </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 534.74px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 27 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 549.14px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">to.y += rand() * characterSize.y </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 28 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 563.54px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">to.z += randomBinomial() * characterSize.z </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 577.94px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 29 30 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Do the check if doesRayCollide(from, to): hits++ </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 606.74px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 31 32 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Update the angle </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 635.54px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="630" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 33 34 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 649.94px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">theta += ANGLE </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 664.34px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 35 36 </span><span origfont="g_font_7" data-canvas-width="138.41398833600002" style="left: 140.615px; top: 699.767px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.04071); border-left: none;" yquantized="690" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">return float(hits) / float(valid) </p></pre>
<span origfont="g_font_7" data-canvas-width="138.41398833600002" style="left: 140.615px; top: 699.767px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04071); border-left: none;" yquantized="690" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In this code, we have used afunction to perform the actual ray cast. </p>
<span origfont="g_font_35" data-canvas-width="75.31775999999999" style="left: 283.026px; top: 700.476px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: none;" yquantized="700" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">doesRayColliderand </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> returns a random number from 0 to 1, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">randomBinomial </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">creates a binomially distributed </p>
</html></html><html><html><p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">random number from </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1to1,asbefore. </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">inSameRoom </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">checks if two locations are in the same room.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be done very easily with a hierarchical pathfinding graph, for example, or can be calculated using a pathfinder. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">There are a number of constants in the function.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">RADIUS </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">constant controls how far from the point to begin the attack.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This should be far enough so that the attack isn’t trivially easy, but not so far that the attack is guaranteed to be in another room.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> It depends on the scale of your level geometry.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">RANDOM_RADIUS </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">constant controls how much randomness is added to the from location.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> This should be smaller than </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">RADIUS * sin(ANGLE) </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">; otherwise, we will be moving it farther than it will move to check the next angle, and we’ll not cover all the angles correctly.  </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">ANGLE </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">constant controls how many samples around the point are considered.  </p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> It should be set so that each angle is considered many times (i.e., the smaller the number of iterations, the larger the </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">ANGLE </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">should be). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Context-sensitive values can be calculated in the same way as above.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rather than lumping all the results together, we need to calculate the proportion of ray casts that hit coming from each direction or the proportion that hit a crouched or standing character volume, depending on the contexts we are interested in. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we are running the processing during the game, then there is no reason to choose random directions to test.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Instead, we use the enemy characters that the AI is trying to find cover from to check the possibility of hitting the cover point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is still a good idea to repeat the test several times with different random offsets, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If time is a critical issue, we can skip this and only check a direct line of sight.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This makes the algorithm faster, but it can be foiled by thin structures that happen to block the only ray tested. </p>
<span origfont="g_font_13" data-canvas-width="95.61482035200001" style="left: 108.913px; top: 445.953px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02658); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.45438979200003" style="left: 108.997px; top: 476.397px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04592); border-left: none;" yquantized="470" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Visibility Points </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Visibility points are calculated in a similar way to cover points, using many line of sight tests. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For each ray cast, we select a location in the vicinity of the cover point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This time we shoot rays out from the waypoint (actually from the position of the character’s eyes if it was occupying the waypoint).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no random component needed around the waypoint.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use their eye location directly. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The quality of visibility for the waypoint is related to the average length of the rays sent out (i.e., the distance they travel before they hit an object).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because the rays are being shot out, we are approximating the volume of the level that can be seen from the waypoint: a measure of how good the location is for viewing or targeting enemies. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Context-sensitive values can be generated in the same way by grouping the ray tests into a number of different states. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">At first glance it might seem like visibility and cover are merely opposites.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a location is a good cover point, then it is a poor visibility point.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because of the way the ray tests are performed, this isn’t the case.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 6.8 shows a point which has both good cover and reasonable visibility. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It’s the same logic that has people spying through keyholes: they can see a good amount while maintaining low visibility themselves. </p>
<span origfont="g_font_7" data-canvas-width="179.34473267999996" style="left: 109.415px; top: 692.318px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00755); border-left: none;" yquantized="690" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Non-visible regionRegion of full coverRegion of partial coverVisibility arcArc of no coverRegion of partial coverRegion ofNon-visible full cover region </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.8 </span><span origfont="g_font_13" data-canvas-width="87.52067174400001" style="left: 122.615px; top: 351.131px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.02965); border-left: none;" yquantized="350" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">Good cover and visibility </p></pre>
<span origfont="g_font_13" data-canvas-width="87.52067174400001" style="left: 122.615px; top: 351.131px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02965); border-left: none;" yquantized="350" class="highlight3"></span>
<span origfont="g_font_7" data-canvas-width="458.98096703999994" style="left: 122.615px; top: 381.574px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02911); border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Shadow Points </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Shadow points need to be calculated based on the lighting model for a level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most studios now use some kind of global illumination (radiosity) lighting as a pre-processing step to calculate light maps for in-game use.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For titles that involve a great deal of stealth, a dynamic shadow model is used at runtime to render cast shadows from static and moving lights. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To determine the quality of a shadow point, several samples are taken from a character-sized volume around the waypoint.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For each sample, the amount of light at the point is tested.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This might involve ray casts to nearby light sources to determine if the point is in shadow, or it may involve looking up data from the global illumination model to check the strength of indirect illumination. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because the aim of a shadow point is to conceal, we take the maximum lightness found in the sampling.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we took the average,then the character would prefer a spot where its body was in very dark shadow but its head was in direct light, over a location where all its body was in moderate shadow.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The quality of a hiding position is related to the visibility of the most visible part of the character, not its average visibility as a whole. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For games with dynamic lighting, the shadow calculations need to be performed at runtime. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Global illumination is a very slow process, however, and is best performed offline.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Combining the two can be problematic.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Developers are only just beginning to get simple global illumination models running at interactive frame rates in next-generation hardware.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We are a couple of years away from general solutions for real-time rendering. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Fortunately, in many current-generation stealth games, no global illumination is used at runtime.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The environments are simply lit by direct line, and the global illumination is handled with static texture maps.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case the shadow calculations can be performed over several frames without a severe slowdown. </p>
<span origfont="g_font_7" data-canvas-width="131.37003163199998" style="left: 122.615px; top: 698.253px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.987745); border-left: none;" yquantized="690" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Compound Tactics </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">As we saw earlier, a compound tactic is one that can be assessed by combining a set of primitive tactics.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A sniper location might be one that has both cover and good visibility of the level. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If compound tactics are needed in the game, we may be able to generate them as part of a pre-processing step, using the output results of the primitive calculations above.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The results can then be stored as an additional channel of tactical information for appropriate waypoints.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This only works if the tactics they are using are also available at this time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You can’t pre-process a compound tactic based on information that changes during the game. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Alternatively, we can calculate the compound tactical information dynamically during the game by combining the tactical data of nearby waypoints on the fly. </p>
<span origfont="g_font_13" data-canvas-width="306.7584768" style="left: 109.415px; top: 273.825px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0294); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.8614158399998" style="left: 109.415px; top: 304.269px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04287); border-left: none;" yquantized="300" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Generating Tactical Properties and Tactical Analysis </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Generating the tactical properties of waypoints in this way brings us very close to a technique we’ll cover in the next section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Tactical analysis works in a similar way: we try to find the tactical and strategic properties of regions in a game level by combining different concerns together. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Taking tactical waypoints to the extreme,using automatic identification of the tactical proper- ties of a location, would be akin to performing a tactical analysis on a game level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Tactical analysis tends to use larger scale properties—for example, balance of power or influence—rather than the amount of cover. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is not common to recognize the similarity, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> As fairly new techniques in game AI, they both tend to have their own devotees and advocates.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is worth recognizing the similarity and even combining the best of both approaches, as required by your game design. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 467.333px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="460" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.1.4 </p>
<span origfont="g_font_7" data-canvas-width="459.0287875199997" style="left: 109.415px; top: 500.671px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0015); border-left: none;" yquantized="500" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Automatically Generating the Waypoints </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In most games waypoints are specified by the level designer.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Cover points, areas that are prone to ambush, and dark corners are all more easily identified by a human being than by an algorithm. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some developers have experimented with the automatic placement of waypoints.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The most promising approaches we have seen are similar to those used in automatically marking up a level for pathfinding. </p>
<span origfont="g_font_13" data-canvas-width="150.44901887999998" style="left: 109.128px; top: 592.237px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03864); border-left: none;" yquantized="590" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9020632480002" style="left: 109.415px; top: 622.681px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00858); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Watching Human Players </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If your game engine supports it, keeping records of the way human players act can provide good information on tactically significant locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The position of each character is stored at each frame or every few frames.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the character remains in roughly the same location for several samples in a row, or if the same location is used by several characters repeatedly over the course of the game, then it is likely that the location is significant tactically. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Withasetof candidatepositions,wecanthenassesstheirtacticalqualities,usingthealgorithms to assess the tactical quality we saw in the previous section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Locations with sufficient quality are </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">It is worth generating far more candidate locations than you will end up using.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The assessment of the tactical quality can then filter out the best waypoints from the rest.You do need to be careful in choosing just the best 50 waypoints,for example,because they may be concentrated in one part of the level, leaving no tactical locations in more tactically tight areas (where, conversely, they are probably more important). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A better approach is to make sure the best few locations for each type of tactic in a specific area are kept.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can be achieved using the condensation algorithm (see Section 6.1.5), a technique that can also be used on its own without generating the candidate locations by watching human players. </p>
<span origfont="g_font_13" data-canvas-width="172.553705472" style="left: 122.615px; top: 246.663px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03417); border-left: none;" yquantized="240" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.000095232" style="left: 122.615px; top: 277.107px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02915); border-left: none;" yquantized="270" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Condensing a Waypoint Grid </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Rather than trying to anticipate the best locations in the game level, we can instead test (almost) every possible location in the level and choose the best. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This is usually done by applying a dense grid to all floor areas in the level and testing each one. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">First, the locations are tested to make sure they are a valid location for the character to occupy. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Locations too close to the walls or underneath obstacles are discarded. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Valid locations are then assessed for tactical qualities in the same way as we saw in the previous section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In order to perform the condensation step, we need to work with real-valued tactical qualities.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A simple Boolean value will not suffice. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Normally,wekeepasetof thresholdvaluesforeachtacticalproperty.If alocationdoesn’tmake the grade for any property, then it can be immediately discarded.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This makes the condensation step much faster. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The threshold levels should be low enough so that many more locations pass than could possibly be needed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is to avoid discarding locations that are significant, but only marginally. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In a room where there is virtually no cover, a location with even very poor cover might be the best place to defend from. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The remaining locations then enter into a condensation algorithm, which ends with only a small number of significant locations in each area of the level for each tactical property.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we used the "watching player actions" technique above, then the tactical locations that resulted could be condensed in the same way as the remaining locations from a grid.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because it is useful in several contexts, it is worth taking a look at the condensation algorithm in more detail. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 589.344px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="580" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.1.5 </p>
<span origfont="g_font_7" data-canvas-width="458.9678164080002" style="left: 122.615px; top: 622.681px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02677); border-left: none;" yquantized="620" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Condensation Algorithm </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The condensation algorithm works by having tactical locations compete against one another for inclusion into the final set.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We would like to keep locations that are either very high quality or a long distance from any other waypoint of the same type. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For each pair of locations, we first check that a character can move between the locations easily.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is almost always done using a line-of-sight test, although it would be better to allow slight deviations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the movement check fails, then the locations can’t compete with one another. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Including this check makes sure that we don’t remove a waypoint on one side of a wall, for </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If the movement check succeeds, then the quality values for each location are compared.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the difference between the values is greater than a weighted distance between the locations, then the location with the lower value is discarded.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are no hard and fast rules for the weight value to use.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It depends on the size of the level, the complexity of the level geometry, and the scale and distribution of quality values for the tactical property.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The weight should be selected so that it gives the right number of output waypoints, and that means tweaking by hand so that it looks right.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you use a lower weight value, the difference in quality will be more important, leaving fewer waypoints.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Higher weights similarly produce more waypoints. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If there are a large number of waypoints,then there will be a huge number of pairs to consider. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because the final check depends on distance,we can speed this up significantly by only considering pairs of locations that are fairly close together.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are using a grid representation, this is fairly simple; otherwise, we may have to rely on some other spatial data structure to provide sensible pairs to test. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This condensation algorithm is highly dependent on the order in which pairs of locations are considered.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Figure 6.9 shows three locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we perform a competition between locations A and B, then A is discarded.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> B is then checked against C.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case C wins.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We end up with only location C.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we first check B and C, however, then C wins.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A is now too far from C for C to beat it, so both C and A remain. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To avoid removing a series of waypoints in this way, we start with the strongest waypoints and work down to the weakest.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For each of these waypoints, we perform the competition against other waypoints working from the weakest to the strongest.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The first waypoint check, therefore, is between the strongest and the weakest.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because we will only consider pairs of waypoints fairly close to one another, the first check is likely to be between the overall strongest waypoint and the weakest nearby waypoint. </p>
<span origfont="g_font_21" data-canvas-width="46.2144" style="left: 294.749px; top: 507.512px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.00466); border-left: 50px solid blue;" yquantized="500" class="highlight2" markup="figureBlock"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="46.2144" style="left: 294.749px; top: 507.512px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(1.00466); border-left: 50px solid blue;" yquantized="500" class="highlight2" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_21" data-canvas-width="45.6864" style="left: 194.515px; top: 566.61px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.01525); border-left: 50px solid blue;" yquantized="560" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="24.6048" style="left: 309.012px; top: 593.91px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.984192); border-left: 50px solid blue;" yquantized="590" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="25.132800000000003" style="left: 345.05px; top: 610.71px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.966646); border-left: 50px solid blue;" yquantized="610" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="46.2144" style="left: 316.646px; top: 638.61px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(1.00466); border-left: 50px solid blue;" yquantized="630" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="25.132800000000003" style="left: 468.348px; top: 667.11px; font-size: 9.6px; font-family: sans-serif; transform: scaleX(0.966646); border-left: 50px solid blue;" yquantized="660" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="52.366007759999995" style="left: 109.415px; top: 711.081px; font-size: 13.1507px; font-family: serif; transform: scaleX(0.952109); border-left: 50px solid blue;" yquantized="710" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">Check B-CB: 1.7A: 1.1A: 1.1C: 2.3C: 2.3Check A-BB: 1.7C: 2.3Check B-CC: 2.3 </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.9 </span><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Order dependence in condensation checks </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The condensation phase should be carried out for each different tactical property.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There is no use discarding a cover point because there is a good nearby ambush location, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The tactical locations that make it through the algorithm are those that are left in any property after condensation. </p>
<span origfont="g_font_13" data-canvas-width="78.851238912" style="left: 122.615px; top: 178.085px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.03752); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="271.3214483999999" style="left: 122.615px; top: 208.528px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02001); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Pseudo-Code </p>
<span origfont="g_font_7" style="left: 125.724px; top: 244.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;">The algorithm can be implemented in the following way: </p>
<span origfont="g_font_7" style="left: 125.724px; top: 244.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 125.724px; top: 258.556px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def condenseWaypoints(waypoints, distanceWeight): </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # We only ever need this squared, so do it now </p><span origfont="g_font_7" style="left: 125.724px; top: 287.357px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </span><span origfont="g_font_7" style="left: 125.724px; top: 301.757px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="300" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">distanceWeight *= distanceWeight </p><span origfont="g_font_7" style="left: 125.724px; top: 316.157px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="310" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Sort the list in decreasing order waypoints.sortReversed() </p><span origfont="g_font_7" style="left: 125.724px; top: 344.957px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="340" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 125.724px; top: 359.357px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="350" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 7 8 9 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 373.757px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="370" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Loop through </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 10 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 388.157px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="380" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">while current: </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 11 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Get the next waypoint </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 416.957px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="410" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 431.357px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">current = waypoints.next() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 445.757px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="440" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Find and sort its neighbors neighbors = waypoints.getNearby(current) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 474.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="470" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 488.957px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="480" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">neighbors.sort() </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Check each in turn </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 517.757px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="510" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 20 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 532.157px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="530" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">while neighbors: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 546.557px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="540" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 560.957px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="560" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">target = neighbors.next() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 575.357px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="570" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 23 24 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 589.757px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="580" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># If the target’s value is higher than </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 25 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 604.157px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="600" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># ours, then we’ve already performed this </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 26 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 618.557px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="610" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># check (when the target was the current) and </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 27 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># all subsequent checks on the neighbors if target.value &gt; current.value: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 647.357px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="640" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 28 29 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 661.757px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="660" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">break </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 676.157px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="670" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 30 31 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check for easy movement if not canMove(current, target): </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 704.957px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="700" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 32 33 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;">continue </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"># Perform competition calculations </p>
<span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 100.156px; font-size: 8.29386px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 35 36 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="120" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">deltaPos = current.position - target.position </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 37 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">deltaPos *= deltaPos * deltaWeight deltaVal = current.value - target.value </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 38 39 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="170" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">deltaVal *= deltaVal </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 40 41 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Check if the difference is value is significant if deltaPos &lt; deltaVal: </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 42 43 44 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># They are close enough so the target loses </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 45 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 109.654px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">neighbors.remove(target) </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 46 </span><span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 109.415px; top: 313.465px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="310" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;">waypoints.remove(target) </p></pre>
<span origfont="g_font_13" data-canvas-width="180.613423104" style="left: 109.415px; top: 313.465px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05008); border-left: none;" yquantized="310" class="highlight3"></span>
<span origfont="g_font_7" data-canvas-width="459.01563688799996" style="left: 109.415px; top: 343.909px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01328); border-left: none;" yquantized="340" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Data Structures and Interfaces </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm assumes we can get position and value from the waypoints.  </p>
<span origfont="g_font_7" style="left: 112.524px; top: 393.938px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight3" markup="codeBlock2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400; display: inline;"> They should have the following structure: </p>
<span origfont="g_font_7" style="left: 112.524px; top: 393.938px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="390" class="highlight3" markup="codeBlock2"></span>
<pre markupfor="codeBlock2" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 </span><span origfont="g_font_7" style="left: 112.524px; top: 408.338px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="400" class="highlight2" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;">struct Waypoint: </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 2 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Holds the position of the waypoint position </p><span origfont="g_font_7" style="left: 112.524px; top: 437.138px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="430" class="highlight3" markup="codeBlock2"></span><p class="after_vGap"></p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 3 4 </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> # Holds the value of the waypoint for the tactic we are </p><span origfont="g_font_7" style="left: 112.524px; top: 465.938px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="460" class="highlight3" markup="codeBlock2"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 6 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># currently condensing value </p><span origfont="g_font_7" data-canvas-width="440.9968800240001" style="left: 127.415px; top: 507.395px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02796); border-left: none;" yquantized="500" class="highlight4"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 7 </p></pre>
<span origfont="g_font_7" data-canvas-width="440.9968800240001" style="left: 127.415px; top: 507.395px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02796); border-left: none;" yquantized="500" class="highlight4"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The waypoints are presented in a data structure in a way that allows the algorithm to extract the elements in sequence and to perform a spatial query to get the nearby waypoints to any given waypoint.  </p>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;"> The order of elements is set by a call to either </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">sort </span>
<span origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400; display: inline;">or </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">sortReversed </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, which orders the elements either by increasing or decreasing value, respectively.  </p>
<span origfont="g_font_35" data-canvas-width="102.21696" style="left: 137.39px; top: 597.089px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_35" style="font-family: monospace; font-size: 14.9291px; font-style: normal; font-weight: 400;"> The interface looks like the following: </p>
<span origfont="g_font_35" data-canvas-width="102.21696" style="left: 137.39px; top: 597.089px; font-size: 14.9291px; font-family: monospace; transform: scaleX(0.910233); border-left: 50px solid orange;" yquantized="590" class="highlight4" markup="codeBlock3"></span>
<pre markupfor="codeBlock3" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> class WaypointList: </p><span origfont="g_font_7" style="left: 112.524px; top: 615.024px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="610" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><span origfont="g_font_7" style="left: 112.524px; top: 629.424px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="620" class="highlight4" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 1 2 3 </span><span origfont="g_font_7" style="left: 112.524px; top: 643.824px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="640" class="highlight3" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Initializes the iterator to move in order of </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 4 </span><span origfont="g_font_7" style="left: 112.524px; top: 658.224px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="650" class="highlight2" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># increasing value </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 5 </span><span origfont="g_font_7" style="left: 112.524px; top: 672.624px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="670" class="highlight4" markup="codeBlock3"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def sort() </p><span origfont="g_font_7" style="left: 112.524px; top: 687.024px; font-size: 5.97756px; font-family: serif; border-left: 50px solid orange;" yquantized="680" class="highlight2" markup="codeBlock3"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 6 7 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Initializes the iterator to move in order of # decreasing value </p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"> 8 </p></pre>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 8.29386px; font-style: normal; font-weight: 400;">def sortReversed() </p>
<span origfont="g_font_7" style="left: 125.724px; top: 100.156px; font-size: 8.29386px; font-family: serif; border-left: 50px solid orange;" yquantized="100" class="highlight3" markup="codeBlock1"></span>
<pre markupfor="codeBlock1" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 114.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="110" class="highlight4" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 128.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.993078); border-left: 50px solid orange;" yquantized="120" class="highlight2" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 9 10 11 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Returns a new waypoint list containing those waypoints # that are near to the given one. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 143.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="140" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 157.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="150" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 12 13 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 172.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="170" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def getNearby(waypoint) </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 186.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="180" class="highlight3" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 14 15 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># Returns the next waypoint in the iteration.  </p><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> Iterations # are initialized by a call to one of the sort functions. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 200.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="200" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 215.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="210" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 16 17 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 229.756px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="220" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># Note that this function must work in such a way that </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 18 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 244.156px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="240" class="highlight2" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400; display: inline;"># remove() can be called between calls to next() without </p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 19 </span><p origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"># causing problems. </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 258.556px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="250" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 20 </span><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 272.956px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="270" class="highlight3" markup="codeBlock1"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;">def next() </p><span origfont="g_font_7" data-canvas-width="5.738457599999999" style="left: 122.855px; top: 287.356px; font-size: 5.97756px; font-family: serif; transform: scaleX(0.95641); border-left: 50px solid orange;" yquantized="280" class="highlight4" markup="codeBlock1"></span><p class="after_vGap" style="display: inline;"></p><span origfont="g_font_35" style="font-family: monospace; font-size: 10.7597px; font-style: normal; font-weight: 400;"> 21 22 </span><p origfont="g_font_7" style="font-family: serif; font-size: 5.97756px; font-style: normal; font-weight: 400;"># Removes the given waypoint from the list def remove(waypoint) </p><span origfont="g_font_13" data-canvas-width="84.63420825600001" style="left: 122.615px; top: 353.522px; font-size: 14.3462px; font-family: serif; transform: scaleX(1.01679); border-left: none;" yquantized="350" class="highlight2"></span><p class="after_vGap"></p><p origfont="g_font_13" style="font-family: serif; font-size: 14.3462px; font-style: normal; font-weight: 400;"> 23 </p></pre>
<span origfont="g_font_13" data-canvas-width="84.63420825600001" style="left: 122.615px; top: 353.522px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01679); border-left: none;" yquantized="350" class="highlight2"></span>
<span origfont="g_font_7" data-canvas-width="459.2499572400001" style="left: 122.376px; top: 383.966px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00483); border-left: none;" yquantized="380" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The Trade-Off </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Watching player actions produces better quality tactical waypoints than simply condensing a grid. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the other hand, it requires additional infrastructure to capture player actions and a lot of playing time by testers.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To get a similar quality using condensation, we need to start with an exceptionally dense grid (in the order of every 10 centimeters of game space for average human- sized characters).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This also has time implications.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For a reasonably sized level, there could be billions of candidate locations to check.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can take many minutes or hours, depending on the complexity of the tactical assessment algorithms being used. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The results from these algorithms are less robust than the automatic generation of pathfinding meshes (which have been used without human supervision), because the tactical properties of a location apply to such a small area.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Automatic generation of waypoints involves generating locations and testing them for tactical properties.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the generated location is even slightly out, its tactical properties can be very different.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A location slightly to the side of a pillar, for example, has no cover, whereas it might provide perfect cover if it were immediately behind the pillar. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When we generate pathfinding graphs, the same kind of small error rarely makes any difference. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Because of this, we’re not aware of anyone reliably using automatic tactical waypoint gen- eration without some degree of human supervision.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Automatic algorithms can provide a useful initial guess at tactical locations, but you will probably need to add facilities into your level design tool to allow the locations to be tweaked by the level designer. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Before you embark on implementing an automatic system, make sure you work out whether the implementation effort will be worth it for time saved in level design.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you are designing huge, tactically complex levels, it may be so.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there will only be a few tens of waypoints of each kind in a level, then it is probably better to go the manual route. </p>
<span origfont="g_font_7" data-canvas-width="266.615913168" style="left: 122.615px; top: 700.645px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02152); border-left: none;" yquantized="700" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_10" style="font-family: sans-serif; font-size: 26.5404px; font-style: normal; font-weight: 400;">6.2 </p>
<span origfont="g_font_7" data-canvas-width="459.069434928" style="left: 109.415px; top: 130.103px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04295); border-left: none;" yquantized="130" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical Analyses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Tactical analyses of all kinds are sometimes known as influence maps.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Influence mapping is a technique pioneered and widely applied in real-time strategy games, where the AI keeps track of the areas of military influence for both sides.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Similar techniques have also made inroads into squad-based shooters and massively multi-player games.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> For this chapter,we’ll refer to the general approach as tactical analysis to emphasize that military influence is only one thing we might base our tactics on. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">In military simulation an almost identical approach is commonly called </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">terrain analysis </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(a phrase also used in game AI), although again that also more properly refers to just one type of tactical analysis.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll look at both influence mapping and terrain analysis in this section, as well as general tactical analysis architectures. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is not much difference between tactical waypoint approaches and tactical analyses.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> By and large,papers and talks onAI have treated them as separate beasts,and admittedly the technical problems are different depending on the genre of game being implemented.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The general theory is remarkably similar, however, and the constraints in some games (in shooters, particularly) mean that implementing the two approaches would give pretty much the same structure. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 379.375px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="370" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.2.1 </p>
<span origfont="g_font_7" data-canvas-width="459.07899902399987" style="left: 109.415px; top: 412.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.987267); border-left: none;" yquantized="410" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Representing the Game Level </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For tactical analysis we need to split the game level into chunks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The areas contained in each chunk should have roughly the same properties for any tactics we are interested in.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we are interested in shadows, for example, then all locations within a chunk should have roughly the same amount of illumination. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are lots of different ways to split a level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The problem is exactly the same as for pathfind- ing (in pathfinding we are interested in chunks with the same movement characteristics), and all the same approaches can be used: Dirichlet domains, floor polygons, and so on. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Becauseof theancestryof tacticalanalysisinRTSgames,theoverwhelmingmajorityof current implementations are based on a tile-based grid.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This may change over the coming years, as the technique is applied to more indoor games, but most current papers and books talk exclusively about tile-based representations. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This does not mean that the level itself has to be tile based, of course.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Very few RTS games are purely tile based anymore, although the outdoor sections of RTS, shooters, and other genres normally use a grid-based height field for rendering terrain.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For a non-tile-based level, we can impose a grid over the geometry and use the grid for tactical analysis. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We haven’t been involved in a game that used Dirichlet domains for tactical analysis, but our understanding is that several developers have experimented with this approach and have had some success.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The disadvantage of having a more complex level representation is balanced against having fewer, more homogeneous, regions. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Our advice would be to use a grid representation initially, for ease of implementation and debugging, and then experiment with other representations when you have the core code robust. </p>
<span origfont="g_font_7" data-canvas-width="33.782778095999994" style="left: 109.415px; top: 714.997px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02372); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400; display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;">6.2.2 </span>
<span origfont="g_font_7" data-canvas-width="459.19376817600005" style="left: 122.376px; top: 125.853px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07038); border-left: none;" yquantized="120" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Simple Influence Maps </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An influence map keeps track of the current balance of military influence at each location in the level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are many factors that might affect military influence: the proximity of a military unit, the proximity of a well-defended base, the duration since a unit last occupied a location, the surrounding terrain, the current financial state of each military power, the weather, and so on. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is scope to take advantage of a huge range of different factors when creating a tactical or strategic AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Most factors only have a small effect, however.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Rainfall is unlikely to dramatically affect the balance of power in a game (although it often has a surprisingly significant effect in real-world conflict).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can build up complex influence maps, as well as other tactical analyses, from many different factors, and we’ll return to this combination process later in the section.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For now,let’s focus on the simplest influence maps,responsible for (we estimate) 90% of the influence mapping in games. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Most games make influence mapping easier by applying a simplifying assumption: military influence is primarily a factor of the proximity of enemy units and bases and their relative military power. </p>
<span origfont="g_font_13" data-canvas-width="99.646113792" style="left: 122.615px; top: 354.816px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.02728); border-left: none;" yquantized="350" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0443291760001" style="left: 122.615px; top: 385.261px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03388); border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Simple Influence </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If four infantry soldiers in a fire team are camped out in a field, then the field is certainly under their influence, but probably not very strongly.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Even a modest force (such as a single platoon) would be able to take it easily.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we instead have a helicopter gunship hovering over the same corner,then the field is considerably more under their control.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the corner of the field is occupied by an anti-aircraft battery, then the influence may be somewhere between the two (anti-aircraft guns aren’t so useful against a ground-based force, for example). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Influence is taken to drop off with distance.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The fire team’s decisive influence doesn’t sig- nificantly extend beyond the hedgerow of the next field.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The apache gunship is mobile and can respond to a wide area, but when stationed in one place its influence is only decisive for a mile or so.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The gun battery may have a larger radius of influence. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we think of power as a numeric quantity, then the power value drops off with distance: the farther from the unit, the smaller the value of its influence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Eventually, its influence will be so small that it is no longer felt. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We can use a linear drop off to model this: double the distance and we get half the influence. </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">The influence is given by: </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">II </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> d </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">0 </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">− </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;">I </span>
<span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 122.616px; top: 648.668px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="640" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> t </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">I </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the influence at a given distance, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">d </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">I </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the influence at a distance of 0.  </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;"> This is </p>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> d </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">0 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> equivalent to the intrinsic military power of the unit.  </p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We could instead use a more rapid initial drop off, but with a longer range of influence, such as: </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">II </span>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> d </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">=√ </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">0 </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> 1 </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">+ </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> d </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">for example.  </p>
<span origfont="g_font_9" style="left: 314.611px; top: 127.031px; font-size: 16.5877px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="120" class="highlight3" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Or we could use something that plateaus first before rapidly tailing off at a distance: </p>
<span origfont="g_font_9" style="left: 314.611px; top: 127.031px; font-size: 16.5877px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="120" class="highlight3" markup="figureBlock"></span>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><span origfont="g_font_8" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> = </span><span origfont="g_font_7" style="font-family: serif; font-size: 8.36856px; font-style: normal; font-weight: 400;">I </span><p origfont="g_font_8" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 0 </p><span origfont="g_font_8" style="font-family: serif; font-size: 8.36856px; font-style: normal; font-weight: 400; display: inline;">I </span><span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> d </span><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">( </span><span origfont="g_font_9" style="font-family: sans-serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> 1 </span><span origfont="g_font_8" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;">+ </span><span origfont="g_font_39" style="font-family: sans-serif; font-size: 11.9551px; font-style: normal; font-weight: 400; display: inline;"> d </span><span origfont="g_font_7" style="font-family: serif; font-size: 8.36856px; font-style: normal; font-weight: 400;">) </span><span origfont="g_font_7" data-canvas-width="459.44721672" style="left: 109.415px; top: 165.215px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.09041); border-left: 50px solid blue;" yquantized="160" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> 2 </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> hasthisformat.Itisalsopossibletousedifferentdrop-off equationsfordifferentunits.Inpractice, however,thelineardropoff isperfectlyreasonableandgivesgoodresults.Itisalsofastertoprocess. </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">In order for this analysis to work, we need to assign each unit in the game a single military influence value.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> This might not be the same as the unit’s offensive or defensive strength: a recon- naissance unit might have a large influence (it can command artillery strikes, for example) with minimal combat strength. </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">The values should usually be set by the game designers.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> Because they can affect the AI con- siderably, some tuning is almost always required to get the balance right.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> During this process it is often useful to be able to visualize the influence map, as a graphical overlay into the game, to make sure that areas clearly under a unit’s influence are being picked up by the tactical analysis. </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Given the drop-off formula for the influence at a distance and the intrinsic power of each unit, we can work out the influence of each side on each location in the game: who has control there and by how much.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> The influence of one unit on one location is given by the drop-off formula above.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> The influence for a whole side is found by simply summing the influence of each unit belonging to that side. </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">The side with the greatest influence on a location can be considered to have control over it, and the degree of control is the difference between its winning influence value and the influence of the second placed side.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> If this difference is very large, then the location is said to be secure. </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">The final result is an influence map: a set of values showing both the controlling side and the degree of influence (and optionally the degree of security) for each location in the game. </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.10 shows an influence map calculated for all locations on a tiny RTS map.  </p><p origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;"> There are two sides, white and black, with a few units on each side.  </p></pre>
<span origfont="g_font_7" data-canvas-width="415.6520256240001" style="left: 109.415px; top: 481.895px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00559); border-left: none;" yquantized="480" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The military influence of each unit is shown as a number.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The border between the areas that each side controls is also shown. </p>
<span origfont="g_font_13" data-canvas-width="148.977094656" style="left: 109.415px; top: 525.399px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.0418); border-left: none;" yquantized="520" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0526977599999" style="left: 109.415px; top: 555.843px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00633); border-left: none;" yquantized="550" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Calculating the Influence </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To calculate the map we need to consider each unit in the game for each location in the level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is obviously a huge task for anything but the smallest levels.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> With a thousand units and a million locations (well within the range of current RTS games), a billion calculations would be needed. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">In fact, execution time is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nm </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">), and memory is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">), where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of locations in the level, and </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">n </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the number of units. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Therearethreeapproacheswecanusetoimprovematters:limitedradiusof effect,convolution filters, and map flooding. </p>
<span origfont="g_font_8" data-canvas-width="132.790232064" style="left: 109.415px; top: 673.855px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.923816); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.09693170399987" style="left: 109.415px; top: 700.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01171); border-left: none;" yquantized="700" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Limited Radius of Effect </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The first approach is to limit the radius of effect for each unit.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Along with a basic influence, each unit has a maximum radius.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Beyond this radius the unit cannot exert influence, no matter how </p>
</html></html><html><html><pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400;"></p><p origfont="g_font_7" style="font-family: serif; font-size: 13.1507px; font-style: normal; font-weight: 400; display: inline;">WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWB 23 42WWWWWWWWWWWWWWBBWWWWWWWWWWWWWBBB 2WWWWWWWWWWWWWBBB 21BBBB 1WWWWWWWWWWWWWWWWWWWWWWWBB 2BBBWWWWWWWWWWWBBBBBWWWWWWWWWWBBBBBB 2WWWWWWWWWBBBBBBBWWWWWWWWBBBBBBBBWWWWWWWWBBBBBBBB 2WBBBBWWBBBBBBBBB 2BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB </p><span origfont="g_font_7" style="font-family: serif; font-size: 11.9551px; font-style: normal; font-weight: 400;">Figure 6.10 </span><span origfont="g_font_7" data-canvas-width="458.61514036800014" style="left: 122.611px; top: 545.33px; font-size: 11.9551px; font-family: serif; transform: scaleX(1.02141); border-left: none;" yquantized="540" class="highlight3"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_7" data-canvas-width="458.61514036800014" style="left: 122.611px; top: 545.33px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02141); border-left: none;" yquantized="540" class="highlight3"></span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An example influence map weak.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The maximum radius might be manually set for each unit, or we could use a threshold.  </p>
<span origfont="g_font_8" style="left: 322.202px; top: 608.716px; font-size: 16.5877px; font-family: serif; border-left: none;" yquantized="600" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> If we use the linear drop-off formula for influence, and if we have a threshold influence (beyond which influence is considered to be zero), then the radius of influence is given by: </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> r </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">= </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">I </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 0 </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">I </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">− </span>
<p origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400;"> 1 </p>
<span origfont="g_font_7" data-canvas-width="28.805861639999996" style="left: 122.609px; top: 643.112px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.993306); border-left: none;" yquantized="640" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> t </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> where </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 11.6114px; font-style: normal; font-weight: 400; display: inline;">I </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> t </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">is the threshold value for influence. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">This approach allows us to pass through each unit in the game, adding its contribution to only those locations within its radius.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> We end up with O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nr </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) in time and O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">)inmemory, where </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">r </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is the number of locations within the average radius of a unit.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> Because </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">r </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">is going to be much smaller than </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">(the number of locations in the level), this is a significant reduction in execution time. </p>
<span origfont="g_font_7" data-canvas-width="73.665058416" style="left: 122.607px; top: 715.082px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.03754); border-left: none;" yquantized="710" class="highlight3"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The disadvantage of this approach is that small influences don’t add up over large distances. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Three infantry units could together contribute a reasonable amount of influence to a location between them, although individually they have very little.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a radius is used and the location is outside this influence, it would have no influence even though it is surrounded by troops who could take it at will. </p>
<span origfont="g_font_8" data-canvas-width="106.31998463999999" style="left: 109.415px; top: 184.227px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.949286); border-left: none;" yquantized="180" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.9869446000001" style="left: 109.415px; top: 211.085px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02672); border-left: none;" yquantized="210" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Convolution Filters </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The second approach applies techniques more common in computer graphics.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We start with the influencemapwheretheonlyvaluesmarkedarethosewheretheunitsareactuallylocated.Youcan imagine these as spots of influence in the midst of a level with no influence.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Then the algorithm works through each location and changes its value so it incorporates not only its own value but also the values of its neighbors.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This has the effect of blurring out the initial spots so that they form gradients reaching out.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Higher initial values get blurred out further. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">This approach uses a filter: a rule that says how a location’s value is affected by its neighbors. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Depending on the filter, we can get different kinds of blurring.  </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The most common filter is called a </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Gaussian </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">, and it is useful because it has mathematical properties that make it even easier to calculate. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To perform filtering, each location in the map needs to be updated using this rule.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> To make sure the influence spreads to the limits of the map, we need to then repeat the whole update several times again.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If there are significantly fewer units in the game than there are locations in the map (we can’t imagine a game when this wouldn’t be true), then this approach is more expensive than even our initial naive algorithm.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because it is a graphics algorithm, however, it is easy to implement using graphical techniques. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll return to filtering, including a full algorithm, later in this chapter. </p>
<span origfont="g_font_8" data-canvas-width="77.82548275200001" style="left: 109.415px; top: 472.201px; font-size: 19.9054px; font-family: serif; transform: scaleX(0.960808); border-left: none;" yquantized="470" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.06943492800013" style="left: 109.415px; top: 499.059px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.06021); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Map Flooding </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The last approach uses an even more dramatic simplifying assumption: the influence of each location is equal to the largest influence contributed by any unit.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this assumption if a tank is covering a street,then the influence on that street is the same even if 20 solders arrive to also cover the street.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Clearly, this approach may lead to some errors, as the AI assumes that a huge number of weak troops can be overpowered by a single strong unit (a very dangerous assumption). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">On the other hand,there exists a very fast algorithm to calculate the influence values,based on the Dijkstra algorithm we saw in Chapter 4.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The algorithm floods the map with values, starting from each unit in the game and propagating its influence out. </p>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">Map flooding can usually perform in around O(min[ </span>
<span origfont="g_font_39" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nr </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">, </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> m </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">]) time and can exceed O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">nr </span>
<span origfont="g_font_8" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;">) time if many locations are within the radius of influence of several units (it is O( </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">m </span>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">) in memory, once again).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Because it is so easy to implement and is fast in operation, several developers favor this approach.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The algorithm is useful beyond simple influence mapping and can also incorporate terrain analysis while performing its calculations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll analyze it in more depth in Section 6.2.6. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whatever algorithm is used for calculating the influence map, it will still take a while.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The balance of power on a level rarely changes dramatically from frame to frame, so it is normal for the influence mapping algorithm to run over the course of many frames.All the algorithms can be </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">a rate of one pass through the algorithm every 10 seconds, the data are usually sufficiently recent for character AI to look sensible. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We’ll also return to this algorithm later in the chapter, after we have looked at other kinds of tactical analyses besides influence mapping. </p>
<span origfont="g_font_13" data-canvas-width="75.65346201599999" style="left: 122.328px; top: 174.308px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.05074); border-left: none;" yquantized="170" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.56676792000013" style="left: 122.376px; top: 204.752px; font-size: 16.5877px; font-family: serif; transform: scaleX(0.984083); border-left: none;" yquantized="200" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Applications </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An influence map allows theAI to see which areas of the game are safe (those that are very secure), which areas to avoid, and where the border between the teams is weakest (i.e., where there is little difference between the influence of the two sides). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 6.11 shows the security for each location in the same map as we looked at previously. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Look at the region marked.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You can see that, although white has the advantage in this area, its border is less secure.  </p>
<span origfont="g_font_21" data-canvas-width="-309.06239999999997" style="left: 490.854px; top: 335.581px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-2.28935); border-left: none;" yquantized="330" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;"> The region near black’s unit has a higher security (paler color) than the area </p>
<span origfont="g_font_21" data-canvas-width="-309.06239999999997" style="left: 490.873px; top: 358.381px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-2.28935); border-left: none;" yquantized="350" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" style="left: 206.591px; top: 389.017px; font-size: 13.32px; font-family: sans-serif; border-left: none;" yquantized="380" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="-263.6064" style="left: 445.36px; top: 403.981px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-2.25305); border-left: none;" yquantized="400" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="-218.15999999999997" style="left: 399.808px; top: 495.181px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-2.20364); border-left: none;" yquantized="490" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="-195.43679999999998" style="left: 377.065px; top: 517.981px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-2.17152); border-left: none;" yquantized="510" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="-149.99039999999997" style="left: 331.83px; top: 563.581px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-2.0832); border-left: none;" yquantized="560" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="-149.99999999999994" style="left: 331.724px; top: 586.372px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-2.08333); border-left: none;" yquantized="580" class="highlight2"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" style="left: 172.662px; top: 609.172px; font-size: 13.32px; font-family: sans-serif; border-left: none;" yquantized="600" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" style="left: 228.446px; top: 638.346px; font-size: 13.32px; font-family: sans-serif; border-left: none;" yquantized="630" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="-312.25919999999985" style="left: 491.353px; top: 654.176px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-3.46955); border-left: none;" yquantized="650" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_21" data-canvas-width="-312.25919999999985" style="left: 491.372px; top: 676.976px; font-size: 13.32px; font-family: sans-serif; transform: scaleX(-3.46955); border-left: none;" yquantized="670" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 13.32px; font-style: normal; font-weight: 400;">WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWB 23 42WWWWWWWWWWWWWWBBWWWWWWWWWWWWWBBB 2WWWWWWWWWWWWWBBB 21WWWWWWWWWWWWBBBB 1WWWWWWWWWWWBB 2BBBWWWWWWWWWWWBBBBBWWWWWWWWWWBBBBBB 2WWWWWWWWWBBBBBBBWWWWWWWWBBBBBBBBWWWWWWWWBBBBBBBB 2WBBBBWWBBBBBBBBB 2BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">immediately over the border.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This would be a good point to mount an attack,since white’s border is much weaker than black’s border at this point. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The influence map can be used to plan attack locations or to guide movement.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A decision making system that decides to "attack enemy territory," for example, might look at the current influence map and consider every location on the border that is controlled by the enemy.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The location with the smallest security value is often a good place to launch an attack.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A more sophisticated test might look for a connected sequence of such weak points to indicate a weak area in the enemy defense.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A (usually beneficial) feature of this approach is that flanks often show up as weak spots in this analysis.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> An AI that attacks the weakest spots will tend naturally to prefer flank attacks. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The influence map is also perfectly suited for tactical pathfinding (explored in detail later in this chapter).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can also be made considerably more sophisticated, when needed, by combining its results with other kinds of tactical analyses, as we’ll see later. </p>
<span origfont="g_font_13" data-canvas-width="144.346128384" style="left: 109.415px; top: 304.329px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.04599); border-left: none;" yquantized="300" class="highlight3"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="459.0467202" style="left: 109.415px; top: 334.774px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.07505); border-left: none;" yquantized="330" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Dealing with Unknowns </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we do a tactical analysis on the units we can see, then we run the risk of underestimating the enemy forces.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Typically, games don’t allow players to see all of the units in the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In indoor environments we may be only able to see characters in direct line of sight.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In outdoor environments units typically have a maximum distance they can see, and their vision may be additionally limited by hills or other terrain features.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is often called "fog-of-war" (but isn’t the same thing as fog-of-war in military-speak). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The influence map on the left of Figure 6.12 shows only the units visible to the white side. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The squares containing a question mark show the regions that the white team cannot see.  </p>
<span origfont="g_font_21" data-canvas-width="123.81742994400003" style="left: 272.244px; top: 497.555px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(20.6362); border-left: 50px solid blue;" yquantized="490" class="highlight3" markup="figureBlock"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;"> The </p>
<span origfont="g_font_21" data-canvas-width="123.81742994400003" style="left: 272.244px; top: 497.555px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(20.6362); border-left: 50px solid blue;" yquantized="490" class="highlight3" markup="figureBlock"></span>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;"> ?? </p>
<pre markupfor="figureBlock" style="padding: 10px; background-color: rgb(242, 242, 242);"><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWWWWWWWWW ???? </p><span origfont="g_font_21" style="left: 197.51px; top: 509.17px; font-size: 5.64876px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="500" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWBBBBBBBBBB 2? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">?? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWWWWWWWWW ???? </p><span origfont="g_font_21" data-canvas-width="-155.48776776000003" style="left: 302.858px; top: 517.315px; font-size: 5.64876px; font-family: sans-serif; transform: scaleX(-2.22125); border-left: 50px solid blue;" yquantized="510" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">W 2WWWWWWBBBBBBBBBBWWWWWWWWWWWWWWWWWWWWWWBBBBBBBBBB 4?? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWWWWWWW???? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWW4WWWWWWBBBBBBBBBB ?? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">????? </p><span origfont="g_font_21" style="left: 209.926px; top: 546.538px; font-size: 5.64876px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="540" class="highlight2" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">1 1?? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWWWWWWWBBB ???? </p><span origfont="g_font_21" data-canvas-width="123.81742994400003" style="left: 272.244px; top: 559.33px; font-size: 5.64876px; font-family: sans-serif; transform: scaleX(20.6362); border-left: 50px solid blue;" yquantized="550" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWW 1BBBBBBBBBB ?? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWWWWWWBBBB ???? </p><span origfont="g_font_21" data-canvas-width="-106.01027892" style="left: 253.459px; top: 579.395px; font-size: 5.64876px; font-family: sans-serif; transform: scaleX(-2.12021); border-left: 50px solid blue;" yquantized="570" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><span origfont="g_font_21" data-canvas-width="-93.63949452" style="left: 241.1px; top: 591.811px; font-size: 5.64876px; font-family: sans-serif; transform: scaleX(-2.08088); border-left: 50px solid blue;" yquantized="590" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">BBBBBBBBBBBBBBBB 4WWWWWWWWWWWBBBBBBBBBBBBBBBBBBBBBWWWWWWWWWWBBBBBBBBBBBBBBBBBBBBBBWWWWWWWWWBBBBBB 2BBBBBBBBBBBBBBBBB 2WWWW ? </p><span origfont="g_font_21" data-canvas-width="-68.89792572" style="left: 216.24px; top: 616.648px; font-size: 5.64876px; font-family: sans-serif; transform: scaleX(-1.96851); border-left: none;" yquantized="610" class="highlight3"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWBBBBBBBBBBBBBBBBBBBBBBBBWWWWWWWBBBBBBBBBBBBBBBBBBBBBBBBB ?? </p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWBBBBBBBBBBBBBBBBBBBBBBBBB ?? </p><span origfont="g_font_21" data-canvas-width="123.81855969600001" style="left: 148.491px; top: 658.612px; font-size: 5.64876px; font-family: sans-serif; transform: scaleX(20.6364); border-left: 50px solid blue;" yquantized="650" class="highlight3" markup="figureBlock"></span><p class="after_vGap"></p><p origfont="g_font_21" style="font-family: sans-serif; font-size: 5.64876px; font-style: normal; font-weight: 400;">WWWWWWWBBBBBBBBB 2BBBBBBBBBBBBBBBB ?? </p><span origfont="g_font_21" data-canvas-width="148.1952186" style="left: 142.026px; top: 666.03px; font-size: 5.64876px; font-family: sans-serif; transform: scaleX(14.8195); border-left: 50px solid blue;" yquantized="660" class="highlight4" markup="figureBlock"></span><p class="after_vGap"></p></pre>
<span origfont="g_font_21" data-canvas-width="-68.89792572" style="left: 216.24px; top: 616.648px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(-1.96851); border-left: none;" yquantized="610" class="highlight3"></span>
<span origfont="g_font_21" style="left: 419.154px; top: 616.089px; font-size: 7.83765px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="610" class="highlight4" markup="figureBlock"></span>
<span origfont="g_font_21" data-canvas-width="-21.62345328" style="left: 185.637px; top: 621.319px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(-2.40261); border-left: none;" yquantized="620" class="highlight2"></span>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">??? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">? </p>
<span origfont="g_font_21" style="left: 419.149px; top: 628.5px; font-size: 7.83765px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="620" class="highlight2" markup="figureBlock"></span>
<span origfont="g_font_21" data-canvas-width="-34.005535200000004" style="left: 198.019px; top: 633.747px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(-2.83379); border-left: none;" yquantized="630" class="highlight3"></span>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">???? </p>
<span origfont="g_font_21" data-canvas-width="123.81855969600001" style="left: 148.491px; top: 646.18px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(20.6364); border-left: none;" yquantized="640" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">222 ?? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">???? </p>
<span origfont="g_font_21" style="left: 419.143px; top: 640.91px; font-size: 7.83765px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="640" class="highlight3" markup="figureBlock"></span>
<span origfont="g_font_21" data-canvas-width="-34.005535200000004" style="left: 198.019px; top: 658.612px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(-2.83379); border-left: none;" yquantized="650" class="highlight4"></span>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">???? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">WWWWWWBB ? </p>
<span origfont="g_font_21" style="left: 419.137px; top: 653.32px; font-size: 7.83765px; font-family: sans-serif; border-left: 50px solid blue;" yquantized="650" class="highlight4" markup="figureBlock"></span>
<span origfont="g_font_21" data-canvas-width="-44.06032799999999" style="left: 203.767px; top: 666.03px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(-1.76241); border-left: none;" yquantized="660" class="highlight2"></span>
<span origfont="g_font_21" data-canvas-width="148.1952186" style="left: 142.032px; top: 678.44px; font-size: 7.83765px; font-family: sans-serif; transform: scaleX(14.8195); border-left: none;" yquantized="670" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">BBBBBBBBBBBBBBBBBBBBBBBBWWWWWWWBBBBBBBBBBBBBBBBBBBBBBBBBWW?? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">???? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">WWWWW? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">BBBBBBBBBBBBBBBBBBBBBBBBB ?? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">???? </p>
<p origfont="g_font_21" style="font-family: sans-serif; font-size: 7.83765px; font-style: normal; font-weight: 400;">? </p>
<span origfont="g_font_7" data-canvas-width="58.67833415999999" style="left: 109.415px; top: 718.254px; font-size: 18.2466px; font-family: serif; transform: scaleX(0.946425); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 18.2466px; font-style: normal; font-weight: 400;">4 </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 18.2466px; font-style: normal; font-weight: 400;">Figure 6.12 </p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">influence map made from the white team’s perspective shows (incorrectly) that they control a large proportion of the map.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If we knew the full story, the influence map on the right would be created. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The second issue with lack of knowledge is that each side has a different subset of the whole knowledge.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the example above, the units that the white team is aware of are very different from the units that the black team is aware of.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They both create very different influence maps.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> With partial information, we need to have one set of tactical analyses per side in the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For terrain analysis and many other tactical analyses, each side has the same information, and we can get away with only a single set of data. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Some games solve this problem by allowing all of the AI players to know everything.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This allows the AI to build only one influence map, which is accurate and correct for all sides.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The AI will not underestimate the opponent’s military might.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is widely viewed as cheating, however, because the AI has access to information that a human player would not have.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It can be quite oblivious.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If a player secretly builds a very powerful unit in a well-hidden region of the level, they wouldbefrustratedif theAIlaunchedamassiveattackaimeddirectlyatthehiddensuper-weapon, obviously knowing full well that it was there.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In response to cries of foul, developers have recently stayed away from building a single influence map based on the correct game situation. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">When human beings see only partial information, they make force estimations based on a prediction of what units they can’t see.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If you see a row of pike men on a medieval battlefield, you may assume there is a row of archers somewhere behind, for example.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Unfortunately, it is very difficult to create AI that can accurately predict the forces it can’t see.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> One approach is to use neural networks with Hebbian learning.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> A detailed run-through of this example is given inChapter 7. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 451.375px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="450" class="highlight4"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.2.3 </span>
<span origfont="g_font_7" data-canvas-width="458.9570568000002" style="left: 122.615px; top: 484.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.00923); border-left: none;" yquantized="480" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Terrain Analysis </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Behind influence mapping,the next most common form of tactical analysis deals with the proper- ties of the game terrain.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Although it doesn’t necessarily need to work with outdoor environments, the techniques in this section originated for outdoor simulations and games, so the"terrain anal- ysis" name fits.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Earlier in the chapter we looked at waypoint tactics in depth.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> These are more common for indoor environments, although in practice there is almost no difference between the two. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Terrain analysis tries to extract useful data from the structure of the landscape.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The most common data to extract are the difficulty of the terrain (used for pathfinding or other movement) and the visibility of each location (used to find good attacking locations and to avoid being seen). </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In addition, other data, such as the degree of shadow, cover, or the ease of escape, can be obtained in the same way. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Unlike influence mapping, most terrain analyses will always be calculated on a location-by- location basis.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For military influence we can use optimizations that spread the influence out starting from the original units, allowing us to use the map flooding techniques later in the chapter.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For terrain analysis this doesn’t normally apply. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The algorithm simply visits each location in the map and runs an analysis algorithm for each one.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The analysis algorithm depends on the type of information we are trying to extract. </p>
<span origfont="g_font_7" data-canvas-width="420.7293650880001" style="left: 122.615px; top: 715.027px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.02119); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Terrain Difficulty </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Perhaps the simplest useful information to extract is the difficulty of the terrain at a location. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Many games have different terrain types at different locations in the game.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This may include rivers, swampland, grassland, mountains, or forests.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each unit in the game will face a different level of difficulty moving through each terrain type.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use this difficulty directly; it doesn’t qualify as a terrain analysis because there’s no analysis to do. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">In addition to the terrain type, it is often important to take account of the ruggedness of the location.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the location is grassland at a one in four gradient, then it will be considerably more difficult to navigate than a flat pasture. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If thelocationcorrespondstoasingleheightsampleinaheightfield(averycommonapproach foroutdoorlevels),thegradientcaneasilybecalculatedbycomparingtheheightof alocationwith the height of neighboring locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the location covers a relatively large amount of the level (a room indoors, for example), then its gradient can be estimated by making a series of random heighttestswithinthelocation.Thedifferencebetweenthehighestandthelowestsampleprovides an approximation to the ruggedness of the location.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> You could also calculate the variance of the height samples, which may also be faster if well optimized. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Whichever gradient calculation method we use,the algorithm for each location takes constant time (assuming a constant number of height checks per location,if we use that technique).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is relativelyfastforaterrainanalysisalgorithm,andcombinedwiththeabilitytorunterrainanalyses offline (as long as the terrain doesn’t change), it makes terrain difficulty an easy technique to use without heavily optimizing the code. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Withabasevalueforthetypeof terrainandanadditionalvalueforthegradientof thelocation, we can calculate a final terrain difficulty.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The combination may use any kind of function—a weighted linear sum, for example, or a product of the base and gradient values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is equivalent to having two different analyses—the base difficulty and the gradient—and applying a multi- tiered analysis approach.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We’ll look at more issues in combining analyses later in the section on multi-tiered analysis. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There is nothing to stop us from including additional factors into the calculation of terrain difficulty.If thegamesupportsbreakdownsof equipment,wemightaddafactorforhowpunishing the terrain is.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> For example, a desert may be easy to move across, but it might take its toll on machinery.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The possibilities are bounded only by what kinds of features you want to implement in your game design. </p>
<span origfont="g_font_13" data-canvas-width="84.51369983999999" style="left: 108.913px; top: 598.268px; font-size: 19.9054px; font-family: serif; transform: scaleX(1.01654); border-left: none;" yquantized="590" class="highlight4"></span>
<p class="after_vGap"></p>
<span origfont="g_font_7" data-canvas-width="458.95107923999984" style="left: 109.415px; top: 628.712px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.04545); border-left: none;" yquantized="620" class="highlight2"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Visibility Map </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The second most common terrain analysis we have worked with is a visibility map.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> There are many kinds of tactics that require some estimation of how exposed a location is.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the AI is controlling a reconnaissance unit, it needs to know locations that can see a long way.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If it is trying to move without being seen by the enemy, then it needs to use locations that are well hidden instead. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">The visibility map is calculated in the same way as we calculated visibility for waypoint tactics: we check the line of sight between the location and other significant locations in the level. </p>
<span origfont="g_font_7" data-canvas-width="426.55031301599996" style="left: 109.415px; top: 715.076px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0156); border-left: none;" yquantized="710" class="highlight2"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">An exhaustive test will test the visibility between the location and all other locations in the level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is very time consuming, however, and for very large levels it can take many minutes. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">There are algorithms intended for rendering large landscapes that can perform some important optimizations, culling large areas of the level that couldn’t possibly be seen.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Indoors, the situation is typically better still, with even more comprehensive tools for culling locations that couldn’t possibly be seen.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The algorithms are beyond the scope of this book but are covered in most texts on programming rendering engines. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Another approach is to use only a subset of locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use a random selection of locations, as long as we select enough samples to give a good approximation of the correct result. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">We could also use a set of "important"locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is normally only done when the terrain analysis is being performed online during the game’s execution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Here, the important locations can be key strategic locations (as decided by the influence map, perhaps) or the location of enemy forces. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Finally, we could start at the location we are testing, shoot out rays at a fixed angular interval, and test the distance they travel, as we saw for waypoint visibility checks.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is a good solution for indoor levels, but doesn’t work well outdoors because it is not easy to account for hills and valleys without shooting a very large number of rays. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Regardless of the method chosen, the end point will be an estimate of how visible the map is from the location.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This will usually be the number of locations that can be seen, but may be an average ray length if we are shooting out rays at fixed angles. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 105.382px; top: 408.175px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="400" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.2.4 </p>
<span origfont="g_font_7" data-canvas-width="459.01683239999994" style="left: 122.615px; top: 441.512px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.05279); border-left: none;" yquantized="440" class="highlight3"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Learning with Tactical Analyses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we have looked at analyses that involve finding information about the game level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The values in the resulting map are calculated by analyzing the game level and its contents. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A slightly different approach has been used successfully to support learning in tactical AI.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We start with a blank tactical analysis and perform no calculations to set its values.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> During the game, whenever an interesting event happens, we change the values of some locations in the map. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For example,suppose we are trying to avoid our character falling into the same trap repeatedly by being ambushed.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We would like to know where the player is most likely to lay a trap and where it is best to avoid.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> While we can perform analysis for cover locations, or ambush waypoints, the human player is often more ingenious than our algorithms and can find creative ways to lay an ambush. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">To solve the problem we create a "frag-map." </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">" This initially consists of an analysis where each location gets a zero.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Each time the AI sees a character get hit (including itself), it subtracts a number from the location in the map corresponding to the victim.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The number to subtract could be proportional to the amount of hit points lost.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In most implementations, developers simply use a fixed value each time a character is killed (after all the player doesn’t normally know the amount of hit points lost when another player is hit, so it would be cheating to give the AI that information).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We could alternatively use a smaller value for non-fatal hits. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Similarly, if the AI sees a character hit another character, it increases the value of the location corresponding to the attacker.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The increase can again be proportional to the damage, or it may be a single value for a kill or non-fatal hit. </p>
<span origfont="g_font_7" data-canvas-width="185.04134736" style="left: 122.615px; top: 715.009px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.01115); border-left: none;" yquantized="710" class="highlight4"></span>
<p class="after_vGap"></p>
</html></html><html><html><p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Over time we will build up a picture of the locations in the game where it is dangerous to hang about (those with negative values) and where it is useful to stand to pick off enemies (those with positive values).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The frag-map is independent of any analysis.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is a set of data learned from experience. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">For a very detailed map, it can take a lot of time to build up an accurate picture of the best and worst places.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We only find a reasonable value for a location if we have several experiences of combat at that location.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We can use filtering (see later in this section) to take the values we do know and expand them out to form estimates for locations we have no experience of. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Frag-maps are suitable for offline learning.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> They can be compiled during testing to build up a good approximation of the potential for a level.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the final game they will be fixed. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Alternatively, they can be learned online during the game execution.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case it is usually common to take a pre-learned version as the basis to avoid having to learn really obvious things from scratch.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> It is also common, in this case, to gradually move all the values in the map toward zero.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This effectively "unlearns" the tactical information in the frag-map over time.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This is done to make sure that the character adapts to the player’s playing style. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Initially, the character will have a good idea where the hot and dangerous locations are from the pre-compiled version of the map.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The player is likely to react to this knowledge, trying to set up attacks that expose the vulnerabilities of the hot locations.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> If the starting values for these hot locations are too high, then it will take a huge number of failures before the AI realizes that the location isn’t worth using.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> This can look stupid to the player: the AI repeatedly using a tactic that obviously fails. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we gradually reduce all the values back toward zero, then after a while all the character’s knowledge will be based on information learned from the player, and so the character will be tougher to beat. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">Figure 6.13 shows this in action.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In the first diagram we see a small section of a level with the danger values created from play testing.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> Note the best location to ambush from, A, is exposed from two directions (locations B and C).  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> We have assumed that the AI character gets killed ten times in location A by five attacks from B and C.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> The second map shows the values that would result if there was no unlearning: A is still the best location to occupy.  </p>
<span origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400; display: inline;"> A frag provides </span>
<span origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">+ </span>
<p origfont="g_font_9" style="font-family: sans-serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> 1 point </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> − </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> to the attacker’s location and1 point to that of the victim; it will take another 10 frags before the character learns its lesson.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The third map shows the values that would result if all the values are multiplied by 0.9 before each new frag is logged.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In this case location A will no longer be used by the AI; it has learned from its mistakes.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> In a real game it may be beneficial to forget even more quickly: the player may find it frustrating that it takes even five frags for the AI to learn that a location is vulnerable. </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">If we are learning online, and gradually unlearning at the same time, then it becomes crucial to try to generalize from what the character does know into areas that it has no experience of.  </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;"> The filtering technique later in the section gives more information on how to do this. </p>
<span origfont="g_font_15" data-canvas-width="31.633383599999995" style="left: 92.1818px; top: 664.931px; font-size: 23.2229px; font-family: serif; transform: scaleX(0.94541); border-left: none;" yquantized="660" class="highlight2"></span>
<p class="after_vGap" style="display: inline;"></p>
<span origfont="g_font_12" style="font-family: sans-serif; font-size: 23.2229px; font-style: normal; font-weight: 400;"> 6.2.5 </span>
<span origfont="g_font_7" data-canvas-width="459.1602938399999" style="left: 109.415px; top: 698.268px; font-size: 16.5877px; font-family: serif; transform: scaleX(1.0728); border-left: none;" yquantized="690" class="highlight4"></span>
<p class="after_vGap"></p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">A Structure for Tactical Analyses </p>
<p origfont="g_font_7" style="font-family: serif; font-size: 16.5877px; font-style: normal; font-weight: 400;">So far we’ve looked at the two most common kinds of tactical analyses: influence mapping (determining military influence at each location) and terrain analysis (determining the effect of </p>
</html></html>